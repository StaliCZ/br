!function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([,function(t,e,i){"use strict";i.r(e);var s=function(){function t(t){var e=this;this.resolutionAdjustment=1,this.canvas=document.getElementById("gameScreen"),this.helperCanvas=document.getElementById("helper"),this.ctx=this.canvas.getContext("2d"),this.playerSVG=new Image,this.playerSVG.src="img/player.svg",this.playerHandSVG=new Image,this.playerHandSVG.src="img/hand.svg",this.waterTrianglePNG=new Image,this.waterTrianglePNG.src="img/waterTriangle.png",this.waterTerrainData=t,this.waterTrianglePNG.onload=function(){e.saveWaterPixels("waterTriangle1"),e.saveWaterPixels("waterTriangle2"),e.saveWaterPixels("waterTriangle3"),e.saveWaterPixels("waterTriangle4")}}return t.prototype.screenResize=function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,console.log("Resize: x: width "+this.canvas.width+" height: "+this.canvas.height),this.changeResolutionAdjustment()},t.prototype.changeResolutionAdjustment=function(){var t=(this.canvas.width/1920+this.canvas.height/1050)/2;this.resolutionAdjustment=t,console.log("finalAdjustment:",t)},t.prototype.saveWaterPixels=function(t){var e=this,i=this.helperCanvas.getContext("2d");this.helperCanvas.width=this.waterTrianglePNG.width,this.helperCanvas.height=this.waterTrianglePNG.height,i.fillStyle="#FFFFFF",i.fillRect(0,0,this.helperCanvas.width,this.helperCanvas.height);var s=this.waterTrianglePNG.width/2;switch(i.save(),i.translate(s,s),t){case"waterTriangle1":i.rotate(0*Math.PI/180);break;case"waterTriangle2":i.rotate(90*Math.PI/180);break;case"waterTriangle3":i.rotate(180*Math.PI/180);break;case"waterTriangle4":i.rotate(270*Math.PI/180)}if(i.drawImage(this.waterTrianglePNG,-s,-s),i.restore(),"undefined"!=typeof Worker){var a=new Worker("workerFindWater.js");a.onmessage=function(t){e.waterTerrainData.setData(t.data.type,t.data.data)};var r=i.getImageData(0,0,this.waterTrianglePNG.width,this.waterTrianglePNG.height).data;a.postMessage({data:r,size:this.waterTrianglePNG.width,type:t,time:(new Date).getTime()})}else console.log("Your browser doesn't support web workers.")},t.prototype.draw=function(t,e){var i=this.ctx;i.clearRect(0,0,this.canvas.width,this.canvas.height);var s=e.getX()+e.size/2,a=e.getY()+e.size/2,r=this.canvas.width/2,n=this.canvas.height/2;i.fillStyle="#69A2E0",i.fillRect(0,0,this.canvas.width,this.canvas.height);for(var h=t.blocks[1].x*this.resolutionAdjustment,o=0,l=t.blocks;o<l.length;o++){var u=l[o];i.fillStyle="#A2CB69";var c=r+(u.x-s)*this.resolutionAdjustment,g=n+(u.y-a)*this.resolutionAdjustment;i.fillRect(c,g,h,h)}for(var w=0,d=t.terrain;w<d.length;w++){var p=d[w];i.fillStyle="#69A2E0";c=r+(p.x-s)*this.resolutionAdjustment,g=n+(p.y-a)*this.resolutionAdjustment;if("water"===p.type&&i.fillRect(c,g,p.width*this.resolutionAdjustment,p.height*this.resolutionAdjustment),"waterTriangle1"===p.type&&i.drawImage(this.waterTrianglePNG,c,g,this.waterTrianglePNG.width*this.resolutionAdjustment,this.waterTrianglePNG.height*this.resolutionAdjustment),"waterTriangle2"===p.type||"waterTriangle3"===p.type||"waterTriangle4"===p.type){var y=p.width/2*this.resolutionAdjustment;this.ctx.save(),this.ctx.translate(c+y,g+y),this.ctx.rotate(p.angle*Math.PI/180),this.ctx.drawImage(this.waterTrianglePNG,-y,-y,this.waterTrianglePNG.width*this.resolutionAdjustment,this.waterTrianglePNG.height*this.resolutionAdjustment),this.ctx.restore()}}for(var m=0,f=t.blocks;m<f.length;m++){u=f[m];i.fillStyle="gray";c=r+(u.x-s)*this.resolutionAdjustment,g=n+(u.y-a)*this.resolutionAdjustment;0===u.y&&i.fillRect(c,g,h,1),i.fillRect(c,g+h,h,1),0===u.x&&i.fillRect(c,g,1,h),i.fillRect(c+h,g,1,h)}i.drawImage(this.playerSVG,r-e.size*this.resolutionAdjustment/2,n-e.size*this.resolutionAdjustment/2,this.playerSVG.width*this.resolutionAdjustment,this.playerSVG.height*this.resolutionAdjustment);for(var v=0;v<e.hands.length;v++)i.drawImage(this.playerHandSVG,r+(e.hands[v].getX()-s)*this.resolutionAdjustment,n+(e.hands[v].getY()-a)*this.resolutionAdjustment,this.playerHandSVG.width*this.resolutionAdjustment,this.playerHandSVG.height*this.resolutionAdjustment)},t}(),a=function(){function t(t){this.size=26,this.x=0,this.y=0,this.shiftAngle=40,this.hitTimer=0,this.playerRadius=t/2}return t.prototype.ready=function(){return 0===this.hitTimer},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.moveHand=function(t,e,i,s,a){var r=this.shiftAngle,n=this.playerRadius;if(this.hitTimer>0){switch(this.hitTimer){case 20:r-=4,n+=2;break;case 19:r-=8,n+=4;break;case 18:r-=12,n+=6;break;case 17:r-=16,n+=8;break;case 16:r-=20,n+=10;break;case 15:r-=24,n+=12;break;case 14:r-=28,n+=14;break;case 13:r-=32,n+=16;break;case 12:r-=36,n+=18;break;case 11:r-=40,n+=20;break;case 10:r-=36,n+=18;break;case 9:r-=32,n+=16;break;case 8:r-=28,n+=14;break;case 7:r-=24,n+=12;break;case 6:r-=20,n+=10;break;case 5:r-=16,n+=8;break;case 4:r-=12,n+=6;break;case 3:r-=8,n+=4;break;case 2:r-=4,n+=2;break;case 1:r-=0,n+=0}this.hitTimer--}var h=t+r*e;h<0&&(h=359+h),h>359&&(h-=359);var o=Math.round(Math.sin(h*Math.PI/180)*n),l=Math.round(Math.cos(h*Math.PI/180)*n);this.x=s+i/2+o-this.size/2,this.y=a+i/2-l-this.size/2},t.prototype.hit=function(){this.hitTimer=20},t}(),r=function(){function t(t){this.size=100,this.speed=5,this.angle=0,this.x=300,this.y=300,this.canvas=document.getElementById("gameScreen"),this.ctx=this.canvas.getContext("2d"),this.hands=[],this.hands.push(new a(this.size)),this.hands.push(new a(this.size)),this.map=t}return t.prototype.getCenterX=function(){return Math.round(this.x+this.size/2)},t.prototype.getCenterY=function(){return Math.round(this.y+this.size/2)},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.getAngle=function(){return this.angle},t.prototype.setAngle=function(t){this.angle=t},t.prototype.hit=function(){if(this.hands[0].ready()&&this.hands[1].ready()){var t=Math.round(Math.random());this.hands[t].hit()}},t.prototype.playerMove=function(t,e,i,s,a,r){for(var n=this.speed,h=0;h<this.map.terrain.length;h++)if(this.getCenterX()<this.map.terrain[h].x+this.map.terrain[h].width&&this.getCenterX()>=this.map.terrain[h].x&&this.getCenterY()<this.map.terrain[h].y+this.map.terrain[h].height&&this.getCenterY()>=this.map.terrain[h].y&&("water"===this.map.terrain[h].type&&(n=this.speed/2),"waterTriangle1"===this.map.terrain[h].type||"waterTriangle2"===this.map.terrain[h].type||"waterTriangle3"===this.map.terrain[h].type||"waterTriangle4"===this.map.terrain[h].type)){var o=this.getCenterX()-this.map.terrain[h].x,l=this.getCenterY()-this.map.terrain[h].y;this.map.waterTerrainData.includeWater(this.map.terrain[h].type,o,l)&&(n=this.speed/2)}(t&&e||t&&s||i&&e||i&&s)&&(n/=Math.sqrt(2)),t&&(this.y-=n),i&&(this.y+=n),e&&(this.x-=n),s&&(this.x+=n),this.x+this.size>this.map.width&&(this.x=this.map.width-this.size),this.x<0&&(this.x=0),this.y+this.size>this.map.height&&(this.y=this.map.height-this.size),this.y<0&&(this.y=0);var u=this.canvas.width/2,c=this.canvas.height/2,g=u-a,w=c-r,d=Math.abs(180*Math.atan(g/w)/Math.PI);a>=u&&r<c&&(this.angle=d),a>=u&&r>=c&&(this.angle=180-d),a<u&&r>=c&&(this.angle=180+d),a<u&&r<c&&(this.angle=360-d),this.angle=Math.round(this.angle),360===this.angle&&(this.angle=0),this.hands[0].moveHand(this.angle,-1,this.size,this.x,this.y),this.hands[1].moveHand(this.angle,1,this.size,this.x,this.y)},t}(),n=function(){return function(t,e,i,s,a){switch(this.angle=0,this.type=t,this.x=e,this.y=i,this.width=s,this.height=a,t){case"waterTriangle2":this.angle=90;break;case"waterTriangle3":this.angle=180;break;case"waterTriangle4":this.angle=270}}}(),h=function(){return function(t){this.blocks=[],this.terrain=[],this.waterTerrainData=t,this.width=1500,this.height=1500;for(var e=0;e<this.height/300;e++)for(var i=0;i<this.width/300;i++)this.blocks.push({x:300*i,y:300*e});this.terrain.push(new n("water",0,0,this.width,300)),this.terrain.push(new n("water",0,this.height-300,this.width,300)),this.terrain.push(new n("water",0,300,300,this.height-600)),this.terrain.push(new n("water",this.width-300,300,300,this.height-600)),this.terrain.push(new n("waterTriangle1",300,300,300,300)),this.terrain.push(new n("waterTriangle2",900,300,300,300)),this.terrain.push(new n("waterTriangle3",900,900,300,300)),this.terrain.push(new n("waterTriangle4",300,900,300,300))}}(),o=function(){function t(){this.waterTriangle1=[],this.waterTriangle2=[],this.waterTriangle3=[],this.waterTriangle4=[]}return t.prototype.setData=function(t,e){switch(t){case"waterTriangle1":this.waterTriangle1=e;break;case"waterTriangle2":this.waterTriangle2=e;break;case"waterTriangle3":this.waterTriangle3=e;break;case"waterTriangle4":this.waterTriangle4=e;break;default:throw new Error("Unknown water type")}},t.prototype.includeWater=function(t,e,i){var s,a=!1;switch(t){case"waterTriangle1":s=this.waterTriangle1;break;case"waterTriangle2":s=this.waterTriangle2;break;case"waterTriangle3":s=this.waterTriangle3;break;case"waterTriangle4":s=this.waterTriangle4;break;default:throw new Error("Unknown water type")}if(e<s.length&&i<s[e].length)s[e][i]&&(a=!0);else{if(0!==s.length)throw new Error("Out of range on water type");a=!0}return a},t}(),l=function(){function t(t,e){this.waterTerrainData=new o,this.view=new s(this.waterTerrainData),this.map=new h(this.waterTerrainData),this.player=new r(this.map),this.keys=t,this.mouse=e,this.gameLoop()}return t.prototype.gameLoop=function(){var t=this;requestAnimationFrame(function(){t.gameLoop()}),this.player.playerMove(this.keys.w,this.keys.a,this.keys.s,this.keys.d,this.mouse.x,this.mouse.y),this.mouse.left&&(this.player.hit(),this.mouse.left=!1),this.view.draw(this.map,this.player)},t.prototype.screenResize=function(){this.view.screenResize()},t}();(function(){function t(){var t=this;this.keys={w:!1,a:!1,s:!1,d:!1},this.mouse={x:0,y:0,left:!1,middle:!1,right:!1},this.model=new l(this.keys,this.mouse),this.model.screenResize(),window.addEventListener("resize",function(){t.model.screenResize()}),this.keysController(),this.mouseController()}return t.run=function(){if(t.instance)throw new Error("Only one controller!");t.instance=new t},t.prototype.mouseController=function(){var t=this,e=document.getElementsByTagName("canvas")[0];e.addEventListener("mousemove",function(e){t.mouse.x=e.x,t.mouse.y=e.y}),e.addEventListener("click",function(e){t.mouse.left=!0})},t.prototype.keysController=function(){var t=this;document.addEventListener("keydown",function(e){switch(e.code){case"KeyW":t.keys.w=!0;break;case"KeyA":t.keys.a=!0;break;case"KeyS":t.keys.s=!0;break;case"KeyD":t.keys.d=!0}}),document.addEventListener("keyup",function(e){switch(e.code){case"KeyW":t.keys.w=!1;break;case"KeyA":t.keys.a=!1;break;case"KeyS":t.keys.s=!1;break;case"KeyD":t.keys.d=!1}})},t})().run()}]);
//# sourceMappingURL=app.js.map