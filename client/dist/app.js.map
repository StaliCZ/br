{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/Weapon.ts","webpack:///./src/Terrain.ts","webpack:///./src/LootType.ts","webpack:///./src/Point.ts","webpack:///./src/RoundObstacle.ts","webpack:///./src/Tree.ts","webpack:///./src/Rock.ts","webpack:///./src/Bush.ts","webpack:///./src/RectangleObstacle.ts","webpack:///./src/Wall.ts","webpack:///./src/Colors.ts","webpack:///./src/PartBulletLine.ts","webpack:///./src/BulletLine.ts","webpack:///./src/Scope.ts","webpack:///./src/View.ts","webpack:///./src/Map.ts","webpack:///./src/WaterTerrainData.ts","webpack:///./src/CollisionPoints.ts","webpack:///./src/Hand.ts","webpack:///./src/Blood.ts","webpack:///./src/Player.ts","webpack:///./src/ZoneCircle.ts","webpack:///./src/Zone.ts","webpack:///./src/Message.ts","webpack:///./src/SnapshotManager.ts","webpack:///./src/Model.ts","webpack:///./src/ServerClientSync.ts","webpack:///./src/MyHtmlElements.ts","webpack:///./src/MapData.ts","webpack:///./src/Editor.ts","webpack:///./src/Controller.ts","webpack:///./src/app.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Weapon","TerrainType","LootType","Terrain","type","x","y","size","angle","this","WaterTriangle2","WaterTriangle3","WaterTriangle4","Point","id","changed","opacity","active","hitAnimateTimer","hitAnimateShiftX","hitAnimateShiftY","radius","point","Math","sqrt","handCenter","createAnimateHit","getCenterX","getCenterY","hitAngle","abs","atan","PI","round","sin","cos","animateX","animateY","super","treeTrankRadius","RectangleObstacle","width","height","Colors","water","grass","blockFrame","blockFrameActive","bullet","text","collisionPoint","player","hand","handBorder","vest","PartBulletLine","startX","startY","endX","endY","age","maxAge","parts","length","push","isActive","Scope","loadingMax","loading","scope","scopeLoadingChange","scopeResolutionAdjustment","newScope","oldScope","resolutionAdjustment","map","mouse","waterTerrainData","serverClientSync","myHtmlElements","collisionPoints","snapshotManager","finalResolutionAdjustment","bulletLines","takeLootText","colors","gameScreen","editorScreen","editor","screen","mapScreen","helperScreen","ctxGame","getContext","ctxMap","ctxEditor","bushSVG","Image","src","rockSVG","treeSVG","cursorSVG","loadingProgresSVG","loadingCircleSVG","pistolSVG","machinegunSVG","rifleSVG","shotgunSVG","hammerSVG","granadeSVG","smokeSVG","medkitSVG","smokeCloudSVG","rifleLootSVG","pistolLootSVG","shotgunLootSVG","machinegunLootSVG","hammerLootSVG","granadeLootSVG","smokeLootSVG","redAmmoLootSVG","greenAmmoLootSVG","blueAmmoLootSVG","orangeAmmoLootSVG","medkitLootSVG","vestLootSVG","scope2LootSVG","scope4LootSVG","scope6LootSVG","deadPlayer","waterTrianglePNG","onload","saveWaterPixels","WaterTriangle1","screenResize","myPlayer","el","window","innerWidth","innerHeight","zoneSVG","setAttribute","toString","mapSize","floor","mapZoneSVG","mapContainer","style","screenCenterX","screenCenterY","changeResolutionAdjustment","drawGame","finalAdjustment","waterType","ctx","fillStyle","fillRect","middleImage","save","translate","rotate","drawImage","restore","Worker","worker","onmessage","e","setData","data","getImageData","postMessage","time","Date","getTime","console","log","clearRect","blockSize","getSize","getBlockSize","sizeReduction","biggerBlockSize","terrain","Water","playerSize","beginPath","arc","fill","zone","innerCircle","getRadius","strokeStyle","stroke","outerCircle","mapZoneCircle","terrains","blockX","blockY","getTerrainType","getX","getY","Grass","getObjectType","globalAlpha","rock","rocks","wall","walls","bush","bushes","tree","trees","deleteObject","myPlayerId","betweenSnapshot","players","spectate","setScope","getFinalResolutionAdjustment","drawMap","block","blocks","isOnScreen","howToDraw","size2","getOpacity","rectangleObstacle","rectangleObstacles","alive","loot","lootSVG","Pistol","Machinegun","Shotgun","Rifle","Smoke","Granade","Hammer","RedAmmo","BlueAmmo","GreenAmmo","OrangeAmmo","Vest","Medkit","Scope2","Scope4","Scope6","getWeapon","gunSize","gunX","gunY","getAngle","getHammerAngle","isReady","hammer","Hand","hands","radiusHand","granadeShiftAngle","playerAngle","shiftZ","shiftX","shiftY","SVG","colorVest","v","bodyRadius","bloods","blood","getTimer","timerMax","shift","bloodX","bloodY","alpha","splice","granade","g","granadeSize","b","a","createBulletLines","line","partLine","getAge","moveTo","lineTo","lineWidth","increaseAge","smoke","outerRadius","zoneCircle","font","row","rowMultiple","fillText","sumaNewer","getPing","getTimeDiference","getDrawDelay","olderExists","newerExists","healthBar","in","h","progres","lE","seconds","takeLoot","display","main","visibility","textContent","lT","secondsString","counter","circle","takeLootInfo","items","redAmmo","greenAmmo","blueAmmo","orangeAmmo","item1in","itemName","i1","item2in","i2","itemAmmoColor","item3in","i3","item4Text","i4","item4Count","s4","item4in","item5Text","i5","item5Count","s5","item5in","activeItem","ai","ammo","activeGunAmmo","count","scope2","scope4","scope6","messageManager","messages","innerHTML","message","element","document","createElement","appendChild","z","zoneTimer","innerText","spectateName","thereIsLine","setEnd","item1","classList","remove","item2","item3","item4","item5","add","item","weapon","item1Ammo","item2Ammo","background","weaponName","lootName","quantity","gameObject","animateShiftX","animateShiftY","animateShift","animate","stats","win","winnerName","setTimeout","gameOverMenu","h1","open","kills","damageDealt","damageTaken","survive","minutes","surviveTime","impassableRoundObstacles","yy","xx","newRock","newTree","rects","waterTriangle1","waterTriangle2","waterTriangle3","waterTriangle4","Error","waterData","state","CollisionPoints","body","ready","Blood","timer","random","playerSnapshot","live","hammerAngle","w","lX","lY","hSize","rX","rY","power","ZoneCircle","centerX","centerY","Message","snapshots","averageSumaNewer","totalSuma","suma","now","cut","snapshot","numberOfPlayers","updateDelay","getServerTime","createInjury","completeSnapshot","updateMap","obsacleSnapshots","obstacleSnapshot","obstacle","update","zoneSnapshot","setRadius","iR","setCenterX","iX","setCenterY","iY","oR","oX","oY","previousSnapshot","lastSnapshot","completePlayerSnapshots","completeMyPlayerSnapshot","completeLootSnapshots","completeZoneSnapshot","previousMyPlayerSnapshot","lastMyPlayerSnapshot","aM","previousZoneSnapshot","lastZoneSnapshot","previousSnapshotLoots","lastSnapshotLoots","lastSnapshotLoot","previousSnapshotLoot","missingLoots","previous","lootExists","last","missingLoot","previousSnapshotPlayers","lastSnapshotPlayers","lastSnapshotPlayer","previousSnapshotPlayer","missingPlayerIds","playerExists","missingPlayerId","sort","newerSnapshot","olderSnapshot","percentShift","wantedSnapshotTime","reset","changeDrawDelay","addSumaNewer","timeDistance","distanceOlderFromWantedTime","copyFrom","positionBetweenSnapshots","olderLoot","newerLoot","older","newer","updatePlayers","updateZone","playerInstance","setX","setY","setAngle","setWeapon","setHammerAngle","die","olderPosition","newerPosition","direction","keys","socket","gameRun","gameId","playerId","view","loop","close","mainMenu","hideGame","notAllowedCharacter","lastIndexOf","requestAnimationFrame","drawEditor","emit","createBetweenSnapshot","ServerClientSync","ping","pings","timeDiference","timeDiferences","attempts","defaultDrawDelay","drawDelay","pingsSuma","timeDiferenceSuma","change","serverTime","MyHtmlElements","getElementById","getElementsByTagName","scopeSVG","coordinates","container","terrainImgs","terrainWater","terrainGrass","terrainWaterTriangle1","terrainWaterTriangle2","terrainWaterTriangle3","terrainWaterTriangle4","objectImgs","objectBush","objectRock","objectTree","objectRect","objectDelete","openMenu","saveMapMenu","back","mapEditorMenu","changeSize","alertMenu","ok","openMapMenu","maps","controlsMenu","ip","games","join","openEditor","controls","gameCanceledMenu","mapSizeMenu","mapMenu","lobbyMenu","gameName","forJoinPlayers","leave","forCreatePlayer","start","cancel","escFromGameMenu","zoneRect","transparentLayer","elements","MapData","objects","controller","terrainType","objectType","cleanMap","widthString","heightString","cleanMapAfterChangeSize","arr","mapData","addEventListener","canvasRect","getBoundingClientRect","clientX","scrollLeft","left","clientY","scrollTop","top","children","borderColor","target","deletePosition","deleteIndex","on","openMap","middle","right","canvas","io","connect","model","event","Event","dispatchEvent","preventDefault","returnValue","keysController","mouseController","socketController","menuController","instance","nameOk","localStorage","setItem","disabled","gameExists","joinDisabled","gameOver","stop","gameStart","setPlayerId","playerName","setGameId","openGames","openGame","option","index","playerNames","li","optionCopy","cloneNode","setName","clientDateNow","serverDateNow","timeNow","timeDiferenceClientServer","addData","addSnapshot","which","gameActive","undefined","previousPlayerAngle","rotatePlayer","getGameId","clickPoint","serverPosition","calculateServerPosition","mouseX","mouseY","code","getSpectate","getItem","changePlayerName","startSpectate","parseInt","mapName","getMapData","isNameOk","selectedMap","gameIndex","run"],"mappings":"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","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","export enum Weapon {\r\n\tEmpty,\r\n\tHand,\r\n\tPistol,\r\n    Machinegun,\r\n    Shotgun,\r\n    Rifle,\r\n    Hammer,\r\n    Granade,\r\n    Smoke,\r\n    Medkit\r\n}","export enum TerrainType {\r\n\tGrass,\r\n\tWater,\r\n\tWaterTriangle1,\r\n\tWaterTriangle2,\r\n\tWaterTriangle3,\r\n\tWaterTriangle4\r\n}\r\n\r\nexport class Terrain {\r\n\treadonly type: TerrainType;\r\n\treadonly x: number;\r\n\treadonly y: number;\r\n\treadonly size: number;\r\n\treadonly angle: number = 0;\r\n\r\n\tconstructor(type: TerrainType, x: number, y: number, size: number) {\r\n\t\tthis.type = type;\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.size = size;\r\n\r\n\t\tswitch (type) {\r\n\t\t\tcase TerrainType.WaterTriangle2:\r\n\t\t\t\tthis.angle = 90;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle3:\r\n\t\t\t\tthis.angle = 180;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle4:\r\n\t\t\t\tthis.angle = 270;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n","export enum LootType {\r\n\tPistol,\r\n\tMachinegun,\r\n\tShotgun,\r\n\tRifle,\r\n\tHammer,\r\n\tRedAmmo,\r\n\tGreenAmmo,\r\n\tBlueAmmo,\r\n\tOrangeAmmo,\r\n\tVest,\r\n\tMedkit,\r\n\tGranade,\r\n\tSmoke,\r\n\tScope2,\r\n\tScope4,\r\n\tScope6\r\n}\r\n","export default class Point {\r\n\treadonly x: number;\r\n\treadonly y: number;\r\n\r\n\tconstructor(x: number, y: number) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n}\r\n","import Point from './Point';\r\n\r\nexport default abstract class RoundObstacle {\r\n\treadonly id: number;\r\n\tprotected changed: boolean = false;\r\n\treadonly x: number;\r\n\treadonly y: number;\r\n\tprotected opacity: number = 1;\r\n\treadonly size: number;\r\n\treadonly radius: number;\r\n\tprivate active: boolean = true;\r\n\tprivate hitAnimateTimer: number = 0;\r\n\tprivate hitAnimateShiftX: number = 0;\r\n\tprivate hitAnimateShiftY: number = 0;\r\n\r\n\tconstructor(id: number, x: number, y: number, size: number) {\r\n\t\tthis.id = id;\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.size = size;\r\n\t\tthis.radius = size / 2;\r\n\t}\r\n\r\n\tgetChanged(): boolean {\r\n\t\treturn this.changed;\r\n\t}\r\n\r\n\tnullChanged(): void {\r\n\t\tthis.changed = false;\r\n\t}\r\n\r\n\tupdate(opacity: number): void {\r\n\t\tthis.opacity = opacity;\r\n\t}\r\n\r\n\tisPointIn(point: Point): boolean {\r\n\t\t//triangle\r\n\t\tconst x = this.x + this.radius - point.x;\r\n\t\tconst y = this.y + this.radius - point.y;\r\n\t\tconst radius = Math.sqrt(x * x + y * y);\r\n\t\tif (radius <= this.radius) return true;\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetCenterX(): number {\r\n\t\treturn this.x + this.size / 2;\r\n\t}\r\n\r\n\tgetCenterY(): number {\r\n\t\treturn this.y + this.size / 2;\r\n\t}\r\n\r\n\tgetOpacity(): number {\r\n\t\treturn this.opacity;\r\n\t}\r\n\r\n\tisActive(): boolean {\r\n\t\treturn this.active;\r\n\t}\r\n\r\n\tacceptHit(handCenter: Point): void {\r\n\t\tif (this.opacity > 0.1) this.opacity -= 0.1;\r\n\t\tthis.createAnimateHit(handCenter);\r\n\t\tif (this.opacity < 0.1) {\r\n\t\t\tthis.active = false;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate createAnimateHit(handCenter: Point): void {\r\n\t\tconst x = handCenter.x - this.getCenterX();\r\n\t\tconst y = handCenter.y - this.getCenterY();\r\n\t\tlet hitAngle = Math.abs(Math.atan(x / y) * (180 / Math.PI));\r\n\t\t//1..2..3..4.. Q; 0 - 90, 90 - 180...\r\n\t\t//1\r\n\t\tif (handCenter.x >= this.getCenterX() && handCenter.y < this.getCenterY()) {\r\n\t\t\thitAngle = hitAngle;\r\n\t\t}\r\n\t\t//2\r\n\t\tif (handCenter.x >= this.getCenterX() && handCenter.y >= this.getCenterY()) {\r\n\t\t\thitAngle = 180 - hitAngle;\r\n\t\t}\r\n\t\t//3\r\n\t\tif (handCenter.x < this.getCenterX() && handCenter.y >= this.getCenterY()) {\r\n\t\t\thitAngle = 180 + hitAngle;\r\n\t\t}\r\n\t\t//4\r\n\t\tif (handCenter.x < this.getCenterX() && handCenter.y < this.getCenterY()) {\r\n\t\t\thitAngle = 360 - hitAngle;\r\n\t\t}\r\n\t\thitAngle = Math.round(hitAngle);\r\n\t\tif (hitAngle === 360) hitAngle = 0;\r\n\r\n\t\tthis.hitAnimateTimer = 10;\r\n\t\t//triangle\r\n\t\tconst hitShift = 3;\r\n\t\tthis.hitAnimateShiftX = Math.sin(hitAngle * Math.PI / 180) * hitShift * -1;\r\n\t\tthis.hitAnimateShiftY = Math.cos(hitAngle * Math.PI / 180) * hitShift;\r\n\t}\r\n\r\n\tanimate(): Point {\r\n\t\tlet animateX = 0;\r\n\t\tlet animateY = 0;\r\n\t\tif (this.hitAnimateTimer > 0) this.hitAnimateTimer--;\r\n\t\tswitch (this.hitAnimateTimer) {\r\n\t\t\tcase 1:\r\n\t\t\t\tanimateX = this.hitAnimateShiftX;\r\n\t\t\t\tanimateY = this.hitAnimateShiftY;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tanimateX = 2 * this.hitAnimateShiftX;\r\n\t\t\t\tanimateY = 2 * this.hitAnimateShiftY;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tanimateX = 3 * this.hitAnimateShiftX;\r\n\t\t\t\tanimateY = 3 * this.hitAnimateShiftY;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tanimateX = 4 * this.hitAnimateShiftX;\r\n\t\t\t\tanimateY = 4 * this.hitAnimateShiftY;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tanimateX = 5 * this.hitAnimateShiftX;\r\n\t\t\t\tanimateY = 5 * this.hitAnimateShiftY;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tanimateX = 4 * this.hitAnimateShiftX;\r\n\t\t\t\tanimateY = 4 * this.hitAnimateShiftY;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 7:\r\n\t\t\t\tanimateX = 3 * this.hitAnimateShiftX;\r\n\t\t\t\tanimateY = 3 * this.hitAnimateShiftY;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 8:\r\n\t\t\t\tanimateX = 2 * this.hitAnimateShiftX;\r\n\t\t\t\tanimateY = 2 * this.hitAnimateShiftY;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 9:\r\n\t\t\t\tanimateX = 1 * this.hitAnimateShiftX;\r\n\t\t\t\tanimateY = 1 * this.hitAnimateShiftY;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 10:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn new Point(animateX, animateY);\r\n\t}\r\n}\r\n","import RoundObstacle from './RoundObstacle';\r\n\r\nexport default class Tree extends RoundObstacle {\r\n\treadonly treeTrankRadius: number;\r\n\r\n\tconstructor(id: number, x: number, y: number) {\r\n\t\tconst size = 200;\r\n\t\tsuper(id, x, y, size);\r\n\t\tthis.treeTrankRadius = 35;\r\n\t\tthis.opacity = 0.9;\r\n\t}\r\n}\r\n","import RoundObstacle from './RoundObstacle';\r\n\r\nexport default class Rock extends RoundObstacle {\r\n\tconstructor(id: number,x: number, y: number) {\r\n\t\tconst size = 100;\r\n\t\tsuper(id, x, y, size);\r\n\t\tthis.opacity = 1;\r\n\t}\r\n}\r\n","import RoundObstacle from './RoundObstacle';\r\n\r\nexport default class Bush extends RoundObstacle {\r\n\tconstructor(id: number, x: number, y: number) {\r\n\t\tconst size = 100;\r\n\t\tsuper(id, x, y, size);\r\n\t\tthis.opacity = 0.9;\r\n\t}\r\n}\r\n","import Point from './Point';\r\n\r\nexport default abstract class RectangleObstacle {\r\n\treadonly id: number;\r\n\tprotected changed: boolean = false;\r\n\treadonly x: number;\r\n\treadonly y: number;\r\n\tprotected opacity: number = 1;\r\n\treadonly width: number;\r\n\treadonly height: number;\r\n\tprivate active: boolean = true;\r\n\r\n\tconstructor(id: number, x: number, y: number, width: number, height: number) {\r\n\t\tthis.id = id;\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t}\r\n\r\n\tgetChanged(): boolean {\r\n\t\treturn this.changed;\r\n\t}\r\n\r\n\tnullChanged(): void {\r\n\t\tthis.changed = false;\r\n\t}\r\n\r\n\tgetChangedData(): any {\r\n\t\treturn { id: this.id, opacity: this.opacity };\r\n\t}\r\n\r\n\tupdate(opacity: number): void {\r\n\t\tthis.opacity = opacity;\r\n\t}\r\n\r\n\tisPointIn(point: Point): boolean {\r\n\t\tconst { x, y } = point;\r\n\t\tif (x < this.x + this.width && x >= this.x && y >= this.y && y < this.y + this.height) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetOpacity(): number {\r\n\t\treturn this.opacity;\r\n\t}\r\n\r\n\tisActive(): boolean {\r\n\t\treturn this.active;\r\n\t}\r\n\r\n\tacceptHit(): void {\r\n\t\tif (this.active) {\r\n\t\t\tif (this.opacity > 0.1) this.opacity -= 0.1;\r\n\t\t\tif (this.opacity < 0.1) {\r\n\t\t\t\tthis.active = false;\r\n\t\t\t}\r\n\t\t\tthis.changed = true;\r\n\t\t}\r\n\t}\r\n}\r\n","import RectangleObstacle from './RectangleObstacle';\r\n\r\nexport default class Wall extends RectangleObstacle {\r\n\tconstructor(id: number, x: number, y: number, width: number, height: number) {\r\n\t\tsuper(id, x, y, width, height);\r\n\t}\r\n}\r\n","export default class Colors {\r\n\treadonly water: string = '#69A2E0';\r\n\treadonly grass: string = '#A2CB69';\r\n\treadonly blockFrame: string = 'gray';\r\n\treadonly blockFrameActive: string = 'red';\r\n\treadonly bullet: string = 'red';\r\n\treadonly text: string = 'white';\r\n\treadonly collisionPoint: string = 'red';\r\n\treadonly player: string = '#5B7324';\r\n\treadonly hand: string = '#76952F';\r\n\treadonly handBorder: string = '#587021';\r\n\treadonly vest: string = '#2E3911';\r\n}\r\n","export default class PartBulletLine {\r\n\treadonly startX: number;\r\n\treadonly startY: number;\r\n\treadonly endX: number;\r\n\treadonly endY: number;\r\n\tprivate active: boolean = true;\r\n\tprivate age: number = 0;\r\n\tprivate maxAge: number = 10;\r\n\r\n\tconstructor(startX: number, startY: number, endX: number, endY: number) {\r\n\t\tthis.startX = startX;\r\n\t\tthis.startY = startY;\r\n\t\tthis.endX = endX;\r\n\t\tthis.endY = endY;\r\n\t}\r\n\r\n\tincreaseAge(): void {\r\n\t\tif (this.age++ === this.maxAge) {\r\n\t\t\tthis.active = false;\r\n\t\t}\r\n\t}\r\n\r\n\tisActive(): boolean {\r\n\t\treturn this.active;\r\n\t}\r\n\r\n\tgetAge(): number {\r\n\t\treturn this.age;\r\n\t}\r\n}\r\n","import PartBulletLine from './PartBulletLine';\r\n\r\nexport default class BulletLine {\r\n\treadonly id: number;\r\n\treadonly startX: number;\r\n\treadonly startY: number;\r\n\tprivate endX: number;\r\n\tprivate endY: number;\r\n\tparts: PartBulletLine[] = [];\r\n\r\n\tconstructor(id: number, startX: number, startY: number) {\r\n\t\tthis.id = id;\r\n\t\tthis.startX = startX;\r\n\t\tthis.startY = startY;\r\n\t}\r\n\r\n\tgetEndX(): number {\r\n\t\treturn this.endX;\r\n\t}\r\n\r\n\tgetEndY(): number {\r\n\t\treturn this.endY;\r\n\t}\r\n\r\n\tsetEnd(endX: number, endY: number): void {\r\n\t\tthis.endX = endX;\r\n\t\tthis.endY = endY;\r\n\r\n        //part line\r\n        let startX = this.startX;\r\n        let startY = this.startY;\r\n        if(this.parts.length){\r\n            startX = this.parts[this.parts.length - 1].endX\r\n            startY = this.parts[this.parts.length - 1].endY\r\n        }\r\n\t\tthis.parts.push(new PartBulletLine(startX, startY, endX, endY));\r\n\t}\r\n\r\n\tisActive(): boolean {\r\n        if(this.parts.length){\r\n            return this.parts[this.parts.length - 1].isActive()\r\n        }\r\n\r\n        //co kdyz budu mit jen jeden bod bullety a zadnou celou part?\r\n        //toto by nemel server dopustit...\r\n\t\treturn true;\r\n\t}\r\n}\r\n","export default class Scope {\r\n\tprivate loadingMax: number = 40;\r\n\tprivate loading: number = this.loadingMax;\r\n\tprivate scope: number = 0.3; //1\r\n\tprivate scopeLoadingChange: number = 0;\r\n\tprivate scopeResolutionAdjustment: number = 0.3; //1\r\n\r\n\tsetScope(newScope: number): void {\r\n\t\tswitch (newScope) {\r\n\t\t\tcase 2:\r\n\t\t\t\tnewScope = 1.2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tnewScope = 1.4;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tnewScope = 1.6;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tconst oldScope = this.scope;\r\n\t\tthis.scope = newScope;\r\n\t\tif (newScope !== oldScope) {\r\n\t\t\tthis.scopeLoadingChange = (newScope - oldScope) / this.loadingMax;\r\n\t\t\tthis.loading = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tgetFinalResolutionAdjustment(resolutionAdjustment: number): number {\r\n\t\tif (this.loading !== this.loadingMax) {\r\n\t\t\tthis.scopeResolutionAdjustment += this.scopeLoadingChange;\r\n\t\t\tthis.loading++;\r\n\t\t}\r\n\t\treturn resolutionAdjustment / this.scopeResolutionAdjustment;\r\n\t}\r\n}\r\n","import Player from './Player';\r\nimport { Weapon } from './Weapon';\r\nimport Map from './Map';\r\nimport { Mouse } from './Controller';\r\nimport WaterTerrainData from './WaterTerrainData';\r\nimport { TerrainType } from './Terrain';\r\nimport Bullet from './Bullet';\r\nimport RoundObstacle from './RoundObstacle';\r\nimport RectangleObstacle from './RectangleObstacle';\r\nimport Tree from './Tree';\r\nimport Rock from './Rock';\r\nimport Bush from './Bush';\r\nimport Wall from './Wall';\r\nimport ServerClientSync from './ServerClientSync';\r\nimport { Snapshot } from './Snapshot';\r\nimport MyHtmlElements from './MyHtmlElements';\r\nimport Editor from './Editor';\r\nimport Colors from './Colors';\r\nimport BulletLine from './BulletLine';\r\nimport PartBulletLine from './PartBulletLine';\r\nimport CollisionPoints from './CollisionPoints';\r\nimport Point from './Point';\r\nimport ZoneSnapshot from './ZoneSnapshot';\r\nimport SnapshotManager from './SnapshotManager';\r\nimport { PlayerOld } from './PlayerOld';\r\nimport { LootType } from './LootType';\r\nimport Scope from './Scope';\r\nimport PlayerStats from './PlayerStats';\r\n\r\ntype DrawData = {\r\n\tx: number;\r\n\ty: number;\r\n\tsize: number;\r\n\twidth: number;\r\n\theight: number;\r\n\tisOnScreen: boolean;\r\n};\r\n\r\ninterface RoundObject {\r\n\tx: number;\r\n\ty: number;\r\n\tsize: number;\r\n}\r\n\r\ninterface RectObject {\r\n\tx: number;\r\n\ty: number;\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\nexport default class View {\r\n\tprivate scope: Scope;\r\n\tprivate snapshotManager: SnapshotManager;\r\n\tprivate gameScreen: HTMLCanvasElement;\r\n\tprivate editorScreen: HTMLCanvasElement;\r\n\tprivate mapScreen: HTMLCanvasElement;\r\n\tprivate helperScreen: HTMLCanvasElement;\r\n\tprivate ctxGame: CanvasRenderingContext2D;\r\n\tprivate ctxMap: CanvasRenderingContext2D;\r\n\tprivate ctxEditor: CanvasRenderingContext2D;\r\n\r\n\tprivate bushSVG: HTMLImageElement;\r\n\tprivate rockSVG: HTMLImageElement;\r\n\tprivate treeSVG: HTMLImageElement;\r\n\tprivate pistolSVG: HTMLImageElement;\r\n\tprivate machinegunSVG: HTMLImageElement;\r\n\tprivate shotgunSVG: HTMLImageElement;\r\n\tprivate rifleSVG: HTMLImageElement;\r\n\tprivate hammerSVG: HTMLImageElement;\r\n\tprivate cursorSVG: HTMLImageElement;\r\n\tprivate granadeSVG: HTMLImageElement;\r\n\tprivate smokeSVG: HTMLImageElement;\r\n\tprivate medkitSVG: HTMLImageElement;\r\n\tprivate smokeCloudSVG: HTMLImageElement;\r\n\tprivate loadingProgresSVG: HTMLImageElement;\r\n\tprivate loadingCircleSVG: HTMLImageElement;\r\n\tprivate waterTrianglePNG: HTMLImageElement;\r\n\r\n\tprivate pistolLootSVG: HTMLImageElement;\r\n\tprivate shotgunLootSVG: HTMLImageElement;\r\n\tprivate machinegunLootSVG: HTMLImageElement;\r\n\tprivate rifleLootSVG: HTMLImageElement;\r\n\r\n\tprivate hammerLootSVG: HTMLImageElement;\r\n\tprivate granadeLootSVG: HTMLImageElement;\r\n\tprivate smokeLootSVG: HTMLImageElement;\r\n\r\n\tprivate redAmmoLootSVG: HTMLImageElement;\r\n\tprivate greenAmmoLootSVG: HTMLImageElement;\r\n\tprivate blueAmmoLootSVG: HTMLImageElement;\r\n\tprivate orangeAmmoLootSVG: HTMLImageElement;\r\n\r\n\tprivate medkitLootSVG: HTMLImageElement;\r\n\tprivate vestLootSVG: HTMLImageElement;\r\n\tprivate scope2LootSVG: HTMLImageElement;\r\n\tprivate scope4LootSVG: HTMLImageElement;\r\n\tprivate scope6LootSVG: HTMLImageElement;\r\n\r\n\tprivate deadPlayer: HTMLImageElement;\r\n\r\n\tprivate waterTerrainData: WaterTerrainData;\r\n\tprivate resolutionAdjustment: number = 1;\r\n\tprivate finalResolutionAdjustment: number = 1;\r\n\tprivate screenCenterX: number;\r\n\tprivate screenCenterY: number;\r\n\tprivate map: Map;\r\n\tprivate mouse: Mouse;\r\n\tmyPlayer: Player;\r\n\r\n\tprivate serverClientSync: ServerClientSync;\r\n\tprivate myHtmlElements: MyHtmlElements;\r\n\r\n\tprivate colors: Colors;\r\n\tprivate bulletLines: BulletLine[] = [];\r\n\tprivate collisionPoints: CollisionPoints;\r\n\r\n\tprivate takeLootText: string = '';\r\n\r\n\tconstructor(\r\n\t\tmap: Map,\r\n\t\tmouse: Mouse,\r\n\t\twaterTerrainData: WaterTerrainData,\r\n\t\tserverClientSync: ServerClientSync,\r\n\t\tmyHtmlElements: MyHtmlElements,\r\n\t\tcollisionPoints: CollisionPoints,\r\n\t\tsnapshotManager: SnapshotManager\r\n\t) {\r\n\t\tthis.scope = new Scope();\r\n\t\tthis.snapshotManager = snapshotManager;\r\n\t\tthis.colors = new Colors();\r\n\t\tthis.serverClientSync = serverClientSync;\r\n\t\tthis.myHtmlElements = myHtmlElements;\r\n\t\tthis.map = map;\r\n\t\tthis.collisionPoints = collisionPoints;\r\n\t\tthis.mouse = mouse;\r\n\t\tthis.gameScreen = <HTMLCanvasElement>this.myHtmlElements.gameScreen;\r\n\t\tthis.editorScreen = <HTMLCanvasElement>this.myHtmlElements.editor.screen;\r\n\t\tthis.mapScreen = <HTMLCanvasElement>this.myHtmlElements.mapScreen;\r\n\t\tthis.helperScreen = <HTMLCanvasElement>this.myHtmlElements.helperScreen;\r\n\t\tthis.ctxGame = this.gameScreen.getContext('2d');\r\n\t\tthis.ctxMap = this.mapScreen.getContext('2d');\r\n\t\tthis.ctxEditor = this.editorScreen.getContext('2d');\r\n\r\n\t\tthis.bushSVG = new Image();\r\n\t\tthis.bushSVG.src = 'img/bush.svg';\r\n\r\n\t\tthis.rockSVG = new Image();\r\n\t\tthis.rockSVG.src = 'img/rock.svg';\r\n\r\n\t\tthis.treeSVG = new Image();\r\n\t\tthis.treeSVG.src = 'img/tree.svg';\r\n\r\n\t\tthis.cursorSVG = new Image();\r\n\t\tthis.cursorSVG.src = 'img/cursor.svg';\r\n\r\n\t\tthis.loadingProgresSVG = new Image();\r\n\t\tthis.loadingProgresSVG.src = 'img/loadingProgres.svg';\r\n\r\n\t\tthis.loadingCircleSVG = new Image();\r\n\t\tthis.loadingCircleSVG.src = 'img/loadingCircle.svg';\r\n\r\n\t\tthis.pistolSVG = new Image();\r\n\t\tthis.pistolSVG.src = 'img/pistol.svg';\r\n\r\n\t\tthis.machinegunSVG = new Image();\r\n\t\tthis.machinegunSVG.src = 'img/machinegun.svg';\r\n\r\n\t\tthis.rifleSVG = new Image();\r\n\t\tthis.rifleSVG.src = 'img/rifle.svg';\r\n\r\n\t\tthis.shotgunSVG = new Image();\r\n\t\tthis.shotgunSVG.src = 'img/shotgun.svg';\r\n\r\n\t\tthis.hammerSVG = new Image();\r\n\t\tthis.hammerSVG.src = 'img/hammer.svg';\r\n\r\n\t\tthis.granadeSVG = new Image();\r\n\t\tthis.granadeSVG.src = 'img/granade.svg';\r\n\r\n\t\tthis.smokeSVG = new Image();\r\n\t\tthis.smokeSVG.src = 'img/smoke.svg';\r\n\r\n\t\tthis.medkitSVG = new Image();\r\n\t\tthis.medkitSVG.src = 'img/medkit.svg';\r\n\r\n\t\tthis.smokeCloudSVG = new Image();\r\n\t\tthis.smokeCloudSVG.src = 'img/smokeCloud.svg';\r\n\r\n\t\tthis.rifleLootSVG = new Image();\r\n\t\tthis.rifleLootSVG.src = 'img/rifleLoot.svg';\r\n\r\n\t\tthis.pistolLootSVG = new Image();\r\n\t\tthis.pistolLootSVG.src = 'img/pistolLoot.svg';\r\n\r\n\t\tthis.shotgunLootSVG = new Image();\r\n\t\tthis.shotgunLootSVG.src = 'img/shotgunLoot.svg';\r\n\r\n\t\tthis.machinegunLootSVG = new Image();\r\n\t\tthis.machinegunLootSVG.src = 'img/machinegunLoot.svg';\r\n\r\n\t\tthis.hammerLootSVG = new Image();\r\n\t\tthis.hammerLootSVG.src = 'img/hammerLoot.svg';\r\n\r\n\t\tthis.granadeLootSVG = new Image();\r\n\t\tthis.granadeLootSVG.src = 'img/granadeLoot.svg';\r\n\r\n\t\tthis.smokeLootSVG = new Image();\r\n\t\tthis.smokeLootSVG.src = 'img/smokeLoot.svg';\r\n\r\n\t\tthis.redAmmoLootSVG = new Image();\r\n\t\tthis.redAmmoLootSVG.src = 'img/redAmmoLoot.svg';\r\n\r\n\t\tthis.greenAmmoLootSVG = new Image();\r\n\t\tthis.greenAmmoLootSVG.src = 'img/greenAmmoLoot.svg';\r\n\r\n\t\tthis.blueAmmoLootSVG = new Image();\r\n\t\tthis.blueAmmoLootSVG.src = 'img/blueAmmoLoot.svg';\r\n\r\n\t\tthis.orangeAmmoLootSVG = new Image();\r\n\t\tthis.orangeAmmoLootSVG.src = 'img/orangeAmmoLoot.svg';\r\n\r\n\t\tthis.medkitLootSVG = new Image();\r\n\t\tthis.medkitLootSVG.src = 'img/medkitLoot.svg';\r\n\t\tthis.vestLootSVG = new Image();\r\n\t\tthis.vestLootSVG.src = 'img/vestLoot.svg';\r\n\t\tthis.scope2LootSVG = new Image();\r\n\t\tthis.scope2LootSVG.src = 'img/scope2Loot.svg';\r\n\t\tthis.scope4LootSVG = new Image();\r\n\t\tthis.scope4LootSVG.src = 'img/scope4Loot.svg';\r\n\t\tthis.scope6LootSVG = new Image();\r\n\t\tthis.scope6LootSVG.src = 'img/scope6Loot.svg';\r\n\r\n\t\tthis.deadPlayer = new Image();\r\n\t\tthis.deadPlayer.src = 'img/deadPlayer.svg';\r\n\r\n\t\tthis.waterTrianglePNG = new Image();\r\n\t\tthis.waterTrianglePNG.src = 'img/waterTriangle.png';\r\n\r\n\t\tthis.waterTerrainData = waterTerrainData;\r\n\t\tthis.waterTrianglePNG.onload = () => {\r\n\t\t\tthis.saveWaterPixels(TerrainType.WaterTriangle1);\r\n\t\t\tthis.saveWaterPixels(TerrainType.WaterTriangle2);\r\n\t\t\tthis.saveWaterPixels(TerrainType.WaterTriangle3);\r\n\t\t\tthis.saveWaterPixels(TerrainType.WaterTriangle4);\r\n\t\t\t//this.waterTerrainData.write();\r\n\t\t};\r\n\t\tthis.screenResize();\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tthis.myPlayer = null;\r\n\t\tthis.scope = new Scope();\r\n\t}\r\n\r\n\tscreenResize(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\t\t//gameScreen\r\n\t\tthis.gameScreen.width = window.innerWidth;\r\n\t\tthis.gameScreen.height = window.innerHeight;\r\n\t\tel.zoneSVG.setAttribute('width', window.innerWidth.toString());\r\n\t\tel.zoneSVG.setAttribute('height', window.innerHeight.toString());\r\n\t\t//mapScreen\r\n\t\tconst mapSize = Math.floor((window.innerWidth / 5 + window.innerHeight / 5) / 2);\r\n\t\tthis.mapScreen.width = mapSize;\r\n\t\tthis.mapScreen.height = mapSize;\r\n\t\tel.mapZoneSVG.setAttribute('width', mapSize.toString());\r\n\t\tel.mapZoneSVG.setAttribute('height', mapSize.toString());\r\n\t\tel.mapContainer.style.width = (mapSize + 10).toString() + 'px';\r\n\t\tel.mapContainer.style.height = (mapSize + 10).toString() + 'px';\r\n\t\t//center\r\n\t\tthis.screenCenterX = window.innerWidth / 2;\r\n\t\tthis.screenCenterY = window.innerHeight / 2;\r\n\t\tthis.changeResolutionAdjustment();\r\n\t\tif (this.myPlayer) {\r\n\t\t\tthis.drawGame(this.myPlayer.id);\r\n\t\t}\r\n\t}\r\n\r\n\tcalculateServerPosition(point: Point): Point {\r\n\t\tlet x, y;\r\n\t\tif (this.screenCenterX > point.x) {\r\n\t\t\tx = (this.screenCenterX - point.x) * -1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tx = point.x - this.screenCenterX;\r\n\t\t}\r\n\t\tif (this.screenCenterY > point.y) {\r\n\t\t\ty = (this.screenCenterY - point.y) * -1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\ty = point.y - this.screenCenterY;\r\n\t\t}\r\n\t\tx /= this.finalResolutionAdjustment;\r\n\t\ty /= this.finalResolutionAdjustment;\r\n\t\tx += this.myPlayer.getCenterX();\r\n\t\ty += this.myPlayer.getCenterY();\r\n\t\treturn new Point(x, y);\r\n\t}\r\n\r\n\t/*\r\n\tprivate isPointInZone(serverPoint: Point, zoneSnapshot: ZoneSnapshot): boolean {\r\n\t\t//triangle\r\n\t\tconst x = zoneSnapshot.oX - serverPoint.x;\r\n\t\tconst y = zoneSnapshot.oY - serverPoint.y;\r\n\t\tconst radius = Math.sqrt(x * x + y * y);\r\n\t\tif (radius <= zoneSnapshot.oR) return true;\r\n\t\treturn false;\r\n\t}\r\n\t*/\r\n\r\n\tprivate changeResolutionAdjustment(): void {\r\n\t\tconst defaultWidth = 1920;\r\n\t\tconst defaultHeight = 1050;\r\n\t\tconst width = this.gameScreen.width / defaultWidth;\r\n\t\tconst height = this.gameScreen.height / defaultHeight;\r\n\t\tconst finalAdjustment = (width + height) / 2;\r\n\t\tthis.resolutionAdjustment = finalAdjustment;\r\n\t}\r\n\r\n\tprivate saveWaterPixels(waterType: TerrainType): void {\r\n\t\tconst ctx = this.helperScreen.getContext('2d');\r\n\t\tthis.helperScreen.width = this.waterTrianglePNG.width;\r\n\t\tthis.helperScreen.height = this.waterTrianglePNG.height;\r\n\t\t//white background\r\n\t\tctx.fillStyle = '#FFFFFF';\r\n\t\tctx.fillRect(0, 0, this.helperScreen.width, this.helperScreen.height);\r\n\t\tlet middleImage = this.waterTrianglePNG.width / 2;\r\n\t\tctx.save();\r\n\t\tctx.translate(middleImage, middleImage);\r\n\t\tswitch (waterType) {\r\n\t\t\tcase TerrainType.WaterTriangle1:\r\n\t\t\t\tctx.rotate(0 * Math.PI / 180);\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle2:\r\n\t\t\t\tctx.rotate(90 * Math.PI / 180);\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle3:\r\n\t\t\t\tctx.rotate(180 * Math.PI / 180);\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle4:\r\n\t\t\t\tctx.rotate(270 * Math.PI / 180);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tctx.drawImage(this.waterTrianglePNG, -middleImage, -middleImage);\r\n\t\tctx.restore();\r\n\r\n\t\t//worker\r\n\t\tif (typeof Worker !== 'undefined') {\r\n\t\t\tconst worker = new Worker('workerFindWater.js');\r\n\t\t\tworker.onmessage = (e) => {\r\n\t\t\t\tthis.waterTerrainData.setData(e.data.type, e.data.data);\r\n\t\t\t};\r\n\t\t\tconst data = ctx.getImageData(0, 0, this.waterTrianglePNG.width, this.waterTrianglePNG.height).data;\r\n\t\t\tworker.postMessage({\r\n\t\t\t\tdata,\r\n\t\t\t\tsize: this.waterTrianglePNG.width,\r\n\t\t\t\ttype: waterType,\r\n\t\t\t\ttime: new Date().getTime()\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log(\"Your browser doesn't support web workers.\");\r\n\t\t}\r\n\t}\r\n\r\n\tprivate drawMap(): void {\r\n\t\tconst ctx = this.ctxMap;\r\n\t\tconst el = this.myHtmlElements;\r\n\t\t//clear canvas\r\n\t\tctx.clearRect(0, 0, this.mapScreen.width, this.mapScreen.height);\r\n\t\t//background\r\n\t\tctx.fillStyle = this.colors.grass;\r\n\t\tctx.fillRect(0, 0, this.mapScreen.width, this.mapScreen.height);\r\n\t\tconst blockSize = this.mapScreen.width / (this.map.getSize() / this.map.getBlockSize());\r\n\t\tconst sizeReduction = blockSize / this.map.getBlockSize();\r\n\t\tconst biggerBlockSize = blockSize + blockSize / 50;\r\n\t\t//terrain\r\n\t\tfor (const terrain of this.map.terrain) {\r\n\t\t\tconst x = terrain.x * sizeReduction;\r\n\t\t\tconst y = terrain.y * sizeReduction;\r\n\t\t\tif (terrain.type === TerrainType.Water) {\r\n\t\t\t\tctx.fillStyle = this.colors.water;\r\n\t\t\t\tctx.fillRect(x, y, biggerBlockSize, biggerBlockSize);\r\n\t\t\t}\r\n\t\t\tif (terrain.type !== TerrainType.Water) {\r\n\t\t\t\tconst middleImage = biggerBlockSize / 2;\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\tctx.rotate(terrain.angle * Math.PI / 180);\r\n\t\t\t\tctx.drawImage(this.waterTrianglePNG, -middleImage, -middleImage, blockSize, blockSize);\r\n\t\t\t\tctx.restore();\r\n\t\t\t}\r\n\t\t}\r\n\t\t//player\r\n\t\t{\r\n\t\t\tconst playerSize = this.mapScreen.width / 40;\r\n\t\t\tconst x = this.myPlayer.getCenterX() * sizeReduction - playerSize / 2;\r\n\t\t\tconst y = this.myPlayer.getCenterY() * sizeReduction - playerSize / 2;\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.arc(x, y, playerSize, 0, 2 * Math.PI);\r\n\t\t\tctx.fillStyle = this.colors.player;\r\n\t\t\tctx.fill();\r\n\t\t}\r\n\t\t//zone\r\n\t\t//inner\r\n\t\t{\r\n\t\t\tconst x = this.snapshotManager.zone.innerCircle.getCenterX() * sizeReduction;\r\n\t\t\tconst y = this.snapshotManager.zone.innerCircle.getCenterY() * sizeReduction;\r\n\t\t\tconst radius = this.snapshotManager.zone.innerCircle.getRadius() * sizeReduction;\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.arc(x, y, radius, 0, 2 * Math.PI);\r\n\t\t\tctx.strokeStyle = 'green';\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\t\t//outer\r\n\t\t{\r\n\t\t\tconst x = this.snapshotManager.zone.outerCircle.getCenterX() * sizeReduction;\r\n\t\t\tconst y = this.snapshotManager.zone.outerCircle.getCenterY() * sizeReduction;\r\n\t\t\tconst radius = this.snapshotManager.zone.outerCircle.getRadius() * sizeReduction;\r\n\t\t\t//SVG change\r\n\t\t\tel.mapZoneCircle.setAttribute('r', radius.toString());\r\n\t\t\tel.mapZoneCircle.setAttribute('cx', x.toString());\r\n\t\t\tel.mapZoneCircle.setAttribute('cy', y.toString());\r\n\t\t}\r\n\t}\r\n\r\n\tdrawEditor(editor: Editor): void {\r\n\t\tconst ctx = this.ctxEditor;\r\n\t\t//clear canvas\r\n\t\tctx.clearRect(0, 0, this.editorScreen.width, this.editorScreen.height);\r\n\r\n\t\t//grass\r\n\t\tctx.fillStyle = this.colors.grass;\r\n\t\tctx.fillRect(0, 0, this.editorScreen.width, this.editorScreen.height);\r\n\r\n\t\t//terrain blocks\r\n\t\tctx.fillStyle = this.colors.water;\r\n\t\tfor (const terrain of editor.terrains) {\r\n\t\t\tswitch (terrain.type) {\r\n\t\t\t\tcase TerrainType.Water:\r\n\t\t\t\t\tctx.fillRect(terrain.x, terrain.y, editor.blockSize, editor.blockSize);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.WaterTriangle1:\r\n\t\t\t\t\tctx.drawImage(this.waterTrianglePNG, terrain.x, terrain.y, editor.blockSize, editor.blockSize);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.WaterTriangle2:\r\n\t\t\t\tcase TerrainType.WaterTriangle3:\r\n\t\t\t\tcase TerrainType.WaterTriangle4:\r\n\t\t\t\t\tlet middleImage = editor.blockSize / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(terrain.x + middleImage, terrain.y + middleImage);\r\n\t\t\t\t\tctx.rotate(terrain.angle * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(\r\n\t\t\t\t\t\tthis.waterTrianglePNG,\r\n\t\t\t\t\t\t-middleImage,\r\n\t\t\t\t\t\t-middleImage,\r\n\t\t\t\t\t\teditor.blockSize,\r\n\t\t\t\t\t\teditor.blockSize\r\n\t\t\t\t\t);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//terrain blocks under mouse\r\n\t\tlet blockX, blockY;\r\n\t\tif (editor.getTerrainType() != null) {\r\n\t\t\t//x, y to [blocks]\r\n\t\t\tblockX = Math.floor(editor.getX() / editor.blockSize) * editor.blockSize;\r\n\t\t\tblockY = Math.floor(editor.getY() / editor.blockSize) * editor.blockSize;\r\n\t\t\tlet angle = -1;\r\n\t\t\tswitch (editor.getTerrainType()) {\r\n\t\t\t\tcase TerrainType.Water:\r\n\t\t\t\t\tctx.fillStyle = this.colors.water;\r\n\t\t\t\t\tctx.fillRect(blockX, blockY, editor.blockSize, editor.blockSize);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.Grass:\r\n\t\t\t\t\tctx.fillStyle = this.colors.grass;\r\n\t\t\t\t\tctx.fillRect(blockX, blockY, editor.blockSize, editor.blockSize);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.WaterTriangle1:\r\n\t\t\t\t\tangle = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.WaterTriangle2:\r\n\t\t\t\t\tangle = 90;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.WaterTriangle3:\r\n\t\t\t\t\tangle = 180;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.WaterTriangle4:\r\n\t\t\t\t\tangle = 270;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (angle !== -1) {\r\n\t\t\t\t//grass\r\n\t\t\t\tctx.fillStyle = this.colors.grass;\r\n\t\t\t\tctx.fillRect(blockX, blockY, editor.blockSize, editor.blockSize);\r\n\t\t\t\tlet middleImage = editor.blockSize / 2;\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.translate(blockX + middleImage, blockY + middleImage);\r\n\t\t\t\tctx.rotate(angle * Math.PI / 180);\r\n\t\t\t\tctx.drawImage(this.waterTrianglePNG, -middleImage, -middleImage, editor.blockSize, editor.blockSize);\r\n\t\t\t\tctx.restore();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//mapGrid\r\n\t\tctx.fillStyle = this.colors.blockFrame;\r\n\t\tfor (let i = 0; i < editor.getSize(); i++) {\r\n\t\t\tctx.fillRect(i * editor.blockSize, 0, 1, editor.getSize() * editor.blockSize);\r\n\t\t}\r\n\t\tfor (let i = 0; i < editor.getSize(); i++) {\r\n\t\t\tctx.fillRect(0, i * editor.blockSize, editor.getSize() * editor.blockSize, 1);\r\n\t\t}\r\n\r\n\t\tif (editor.getTerrainType() != null) {\r\n\t\t\t//frame\r\n\t\t\tctx.fillStyle = this.colors.blockFrameActive;\r\n\t\t\tctx.fillRect(blockX, blockY, editor.blockSize, 1);\r\n\t\t\tctx.fillRect(blockX, blockY + editor.blockSize, editor.blockSize, 1);\r\n\r\n\t\t\tctx.fillRect(blockX, blockY, 1, editor.blockSize);\r\n\t\t\tctx.fillRect(blockX + editor.blockSize, blockY, 1, editor.blockSize);\r\n\t\t}\r\n\r\n\t\t//objects\r\n\t\tctx.save();\r\n\t\tif (editor.getObjectType() === 'delete') ctx.globalAlpha = 0.6;\r\n\r\n\t\tfor (const rock of editor.rocks) {\r\n\t\t\tctx.drawImage(this.rockSVG, rock.x, rock.y, rock.size, rock.size);\r\n\t\t}\r\n\t\tctx.fillStyle = 'black';\r\n\t\tfor (const wall of editor.walls) {\r\n\t\t\tctx.fillRect(wall.x, wall.y, wall.width, wall.height);\r\n\t\t}\r\n\t\tfor (const bush of editor.bushes) {\r\n\t\t\tctx.drawImage(this.bushSVG, bush.x, bush.y, bush.size, bush.size);\r\n\t\t}\r\n\t\tfor (const tree of editor.trees) {\r\n\t\t\tctx.drawImage(this.treeSVG, tree.x, tree.y, tree.size, tree.size);\r\n\t\t}\r\n\t\tctx.restore();\r\n\r\n\t\tif (editor.getObjectType() === 'delete') {\r\n\t\t\t//delete object\r\n\t\t\tlet deleteObject;\r\n\t\t\tfor (const rock of editor.rocks) {\r\n\t\t\t\tconst object = rock;\r\n\t\t\t\tif (\r\n\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\tobject.x + object.size >= editor.getX() &&\r\n\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\tobject.y + object.size >= editor.getY()\r\n\t\t\t\t) {\r\n\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (const wall of editor.walls) {\r\n\t\t\t\tconst object = wall;\r\n\t\t\t\tif (\r\n\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\tobject.x + object.width >= editor.getX() &&\r\n\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\tobject.y + object.height >= editor.getY()\r\n\t\t\t\t) {\r\n\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (const bush of editor.bushes) {\r\n\t\t\t\tconst object = bush;\r\n\t\t\t\tif (\r\n\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\tobject.x + object.size >= editor.getX() &&\r\n\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\tobject.y + object.size >= editor.getY()\r\n\t\t\t\t) {\r\n\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (const tree of editor.trees) {\r\n\t\t\t\tconst object = tree;\r\n\t\t\t\tif (\r\n\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\tobject.x + object.size >= editor.getX() &&\r\n\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\tobject.y + object.size >= editor.getY()\r\n\t\t\t\t) {\r\n\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (deleteObject instanceof Rock) {\r\n\t\t\t\tctx.drawImage(this.rockSVG, deleteObject.x, deleteObject.y, deleteObject.size, deleteObject.size);\r\n\t\t\t}\r\n\t\t\tif (deleteObject instanceof Bush) {\r\n\t\t\t\tctx.drawImage(this.bushSVG, deleteObject.x, deleteObject.y, deleteObject.size, deleteObject.size);\r\n\t\t\t}\r\n\t\t\tif (deleteObject instanceof Tree) {\r\n\t\t\t\tctx.drawImage(this.treeSVG, deleteObject.x, deleteObject.y, deleteObject.size, deleteObject.size);\r\n\t\t\t}\r\n\t\t\tif (deleteObject instanceof Wall) {\r\n\t\t\t\tctx.fillStyle = 'black';\r\n\t\t\t\tctx.fillRect(deleteObject.x, deleteObject.y, deleteObject.width, deleteObject.height);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//objects under mouse\r\n\t\tif (editor.getObjectType()) {\r\n\t\t\tlet size;\r\n\t\t\tswitch (editor.getObjectType()) {\r\n\t\t\t\tcase 'bush':\r\n\t\t\t\t\tsize = editor.bush.size;\r\n\t\t\t\t\tctx.drawImage(this.bushSVG, editor.getX() - size / 2, editor.getY() - size / 2, size, size);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'rock':\r\n\t\t\t\t\tsize = editor.rock.size;\r\n\t\t\t\t\tctx.drawImage(this.rockSVG, editor.getX() - size / 2, editor.getY() - size / 2, size, size);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'tree':\r\n\t\t\t\t\tsize = editor.tree.size;\r\n\t\t\t\t\tctx.drawImage(this.treeSVG, editor.getX() - size / 2, editor.getY() - size / 2, size, size);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'rect':\r\n\t\t\t\t\tsize = editor.rock.size;\r\n\t\t\t\t\tctx.fillStyle = 'black';\r\n\t\t\t\t\tctx.fillRect(editor.getX() - size / 2, editor.getY() - size / 2, size, size);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdrawGame(myPlayerId: number): void {\r\n\t\tconst betweenSnapshot = this.snapshotManager.betweenSnapshot;\r\n\t\tconst players = this.snapshotManager.players;\r\n\t\tif (!betweenSnapshot) return;\r\n\r\n\t\t//spectate\r\n\t\tif (betweenSnapshot.i.spectate !== -1) {\r\n\t\t\tmyPlayerId = betweenSnapshot.i.spectate;\r\n\t\t}\r\n\r\n\t\t//my player or spectate\r\n\t\tfor (const player of players) {\r\n\t\t\tif (player.id === myPlayerId) {\r\n\t\t\t\tthis.myPlayer = player;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!this.myPlayer) return;\r\n\r\n\t\t//scope\r\n\t\tthis.scope.setScope(this.snapshotManager.betweenSnapshot.i.s);\r\n\t\tthis.finalResolutionAdjustment = this.scope.getFinalResolutionAdjustment(this.resolutionAdjustment);\r\n\r\n\t\tthis.drawMap();\r\n\r\n\t\tconst ctx = this.ctxGame;\r\n\t\tconst el = this.myHtmlElements;\r\n\r\n\t\t//clear canvas\r\n\t\tctx.clearRect(0, 0, this.gameScreen.width, this.gameScreen.height);\r\n\r\n\t\t//water\r\n\t\tctx.fillStyle = this.colors.water;\r\n\t\tctx.fillRect(0, 0, this.gameScreen.width, this.gameScreen.height);\r\n\r\n\t\t//grass blocks\r\n\t\tctx.fillStyle = this.colors.grass;\r\n\t\tconst blockSize = 300;\r\n\t\tfor (const block of this.map.blocks) {\r\n\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({ x: block.x, y: block.y, size: blockSize });\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\tctx.fillRect(x, y, size, size);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//water terrain blocks\r\n\t\tctx.fillStyle = this.colors.water;\r\n\t\tfor (const terrain of this.map.terrain) {\r\n\t\t\tconst { x, y, width, height, isOnScreen } = this.howToDraw({\r\n\t\t\t\tx: terrain.x,\r\n\t\t\t\ty: terrain.y,\r\n\t\t\t\tsize: terrain.size\r\n\t\t\t});\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\tif (terrain.type === TerrainType.Water) {\r\n\t\t\t\t\tctx.fillRect(x, y, width, height);\r\n\t\t\t\t}\r\n\t\t\t\telse if (terrain.type === TerrainType.WaterTriangle1) {\r\n\t\t\t\t\tctx.drawImage(this.waterTrianglePNG, x, y, width, height);\r\n\t\t\t\t}\r\n\t\t\t\telse if (\r\n\t\t\t\t\tterrain.type === TerrainType.WaterTriangle2 ||\r\n\t\t\t\t\tterrain.type === TerrainType.WaterTriangle3 ||\r\n\t\t\t\t\tterrain.type === TerrainType.WaterTriangle4\r\n\t\t\t\t) {\r\n\t\t\t\t\tlet middleImage = width / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(terrain.angle * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(this.waterTrianglePNG, -middleImage, -middleImage, width, height);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//mapGrid\r\n\t\tctx.fillStyle = this.colors.blockFrame;\r\n\t\tconst size2 = 1 * this.resolutionAdjustment;\r\n\t\tfor (const block of this.map.blocks) {\r\n\t\t\t//top\r\n\t\t\tif (block.y === 0) {\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: block.x,\r\n\t\t\t\t\ty: block.y,\r\n\t\t\t\t\tsize: blockSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) ctx.fillRect(x, y, size, size2);\r\n\t\t\t}\r\n\t\t\t//bottom\r\n\t\t\t{\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: block.x,\r\n\t\t\t\t\ty: block.y + blockSize,\r\n\t\t\t\t\tsize: blockSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) ctx.fillRect(x, y, size, size2);\r\n\t\t\t}\r\n\t\t\t//left\r\n\t\t\tif (block.x === 0) {\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: block.x,\r\n\t\t\t\t\ty: block.y,\r\n\t\t\t\t\tsize: blockSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) ctx.fillRect(x, y, size2, size);\r\n\t\t\t}\r\n\t\t\t//right\r\n\t\t\t{\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: block.x + blockSize,\r\n\t\t\t\t\ty: block.y,\r\n\t\t\t\t\tsize: blockSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) ctx.fillRect(x, y, size2, size);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//rocks\r\n\t\tfor (const rock of this.map.rocks) {\r\n\t\t\tif (rock.isActive()) {\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw(rock);\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.globalAlpha = rock.getOpacity();\r\n\t\t\t\t\tctx.drawImage(this.rockSVG, x, y, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//walls\r\n\t\tctx.fillStyle = 'black';\r\n\t\tfor (const rectangleObstacle of this.map.rectangleObstacles) {\r\n\t\t\tif (rectangleObstacle.isActive()) {\r\n\t\t\t\tconst { x, y, width, height, isOnScreen } = this.howToDraw(rectangleObstacle);\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.globalAlpha = rectangleObstacle.getOpacity();\r\n\t\t\t\t\tctx.fillRect(x, y, width, height);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//dead players\r\n\t\tfor (const player of players) {\r\n\t\t\tif (player.alive()) continue;\r\n\t\t\tconst { x, y, width, height, isOnScreen } = this.howToDraw({\r\n\t\t\t\tx: player.getX(),\r\n\t\t\t\ty: player.getY(),\r\n\t\t\t\tsize: player.size\r\n\t\t\t});\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\tctx.drawImage(this.deadPlayer, x, y, width, height);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//loot\r\n\t\tfor (const loot of betweenSnapshot.l) {\r\n\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw(loot);\r\n\t\t\tlet lootSVG;\r\n\t\t\tswitch (loot.type) {\r\n\t\t\t\tcase LootType.Pistol:\r\n\t\t\t\t\tlootSVG = this.pistolLootSVG;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LootType.Machinegun:\r\n\t\t\t\t\tlootSVG = this.machinegunLootSVG;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LootType.Shotgun:\r\n\t\t\t\t\tlootSVG = this.shotgunLootSVG;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LootType.Rifle:\r\n\t\t\t\t\tlootSVG = this.rifleLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Smoke:\r\n\t\t\t\t\tlootSVG = this.smokeLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Granade:\r\n\t\t\t\t\tlootSVG = this.granadeLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Hammer:\r\n\t\t\t\t\tlootSVG = this.hammerLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.RedAmmo:\r\n\t\t\t\t\tlootSVG = this.redAmmoLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.BlueAmmo:\r\n\t\t\t\t\tlootSVG = this.blueAmmoLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.GreenAmmo:\r\n\t\t\t\t\tlootSVG = this.greenAmmoLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.OrangeAmmo:\r\n\t\t\t\t\tlootSVG = this.orangeAmmoLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Vest:\r\n\t\t\t\t\tlootSVG = this.vestLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Medkit:\r\n\t\t\t\t\tlootSVG = this.medkitLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Scope2:\r\n\t\t\t\t\tlootSVG = this.scope2LootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Scope4:\r\n\t\t\t\t\tlootSVG = this.scope4LootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Scope6:\r\n\t\t\t\t\tlootSVG = this.scope6LootSVG;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tctx.drawImage(lootSVG, x, y, size, size);\r\n\t\t}\r\n\r\n\t\t//players\r\n\t\tfor (const player of players) {\r\n\t\t\tif (!player.alive()) continue;\r\n\t\t\t//pistol\r\n\t\t\tif (player.getWeapon() === Weapon.Pistol) {\r\n\t\t\t\t//draw pistol\r\n\t\t\t\tconst gunSize = 200;\r\n\t\t\t\tconst gunX = player.getCenterX() - gunSize / 2;\r\n\t\t\t\tconst gunY = player.getCenterY() - gunSize / 2;\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: gunX,\r\n\t\t\t\t\ty: gunY,\r\n\t\t\t\t\tsize: gunSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(player.getAngle() * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(this.pistolSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//machinegun\r\n\t\t\tif (player.getWeapon() === Weapon.Machinegun) {\r\n\t\t\t\tconst gunSize = 200;\r\n\t\t\t\tconst gunX = player.getCenterX() - gunSize / 2;\r\n\t\t\t\tconst gunY = player.getCenterY() - gunSize / 2;\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: gunX,\r\n\t\t\t\t\ty: gunY,\r\n\t\t\t\t\tsize: gunSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(player.getAngle() * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(this.machinegunSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//shotgun\r\n\t\t\tif (player.getWeapon() === Weapon.Shotgun) {\r\n\t\t\t\tconst gunSize = 200;\r\n\t\t\t\tconst gunX = player.getCenterX() - gunSize / 2;\r\n\t\t\t\tconst gunY = player.getCenterY() - gunSize / 2;\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: gunX,\r\n\t\t\t\t\ty: gunY,\r\n\t\t\t\t\tsize: gunSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(player.getAngle() * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(this.shotgunSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//rifle\r\n\t\t\tif (player.getWeapon() === Weapon.Rifle) {\r\n\t\t\t\tconst gunSize = 200;\r\n\t\t\t\tconst gunX = player.getCenterX() - gunSize / 2;\r\n\t\t\t\tconst gunY = player.getCenterY() - gunSize / 2;\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: gunX,\r\n\t\t\t\t\ty: gunY,\r\n\t\t\t\t\tsize: gunSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(player.getAngle() * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(this.rifleSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//hammer\r\n\t\t\tif (player.getWeapon() === Weapon.Hammer) {\r\n\t\t\t\tconst gunSize = 200;\r\n\t\t\t\tconst gunX = player.getCenterX() - gunSize / 2;\r\n\t\t\t\tconst gunY = player.getCenterY() - gunSize / 2;\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: gunX,\r\n\t\t\t\t\ty: gunY,\r\n\t\t\t\t\tsize: gunSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(player.getHammerAngle() * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(this.hammerSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t\tif (this.collisionPoints.isReady()) {\r\n\t\t\t\t\t\t//collisionPoints\r\n\t\t\t\t\t\tctx.fillStyle = this.colors.collisionPoint;\r\n\t\t\t\t\t\tfor (const point of this.collisionPoints.hammer[player.getHammerAngle()]) {\r\n\t\t\t\t\t\t\tconst { x, y, size } = this.howToDraw({\r\n\t\t\t\t\t\t\t\tx: player.getCenterX() - 100 + point.x,\r\n\t\t\t\t\t\t\t\ty: player.getCenterY() - 100 + point.y,\r\n\t\t\t\t\t\t\t\tsize: 1\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tctx.fillRect(x, y, size, size);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//player hands\r\n\t\t\tif (\r\n\t\t\t\tplayer.getWeapon() === Weapon.Hand ||\r\n\t\t\t\tplayer.getWeapon() === Weapon.Granade ||\r\n\t\t\t\tplayer.getWeapon() === Weapon.Smoke ||\r\n\t\t\t\tplayer.getWeapon() === Weapon.Medkit\r\n\t\t\t) {\r\n\t\t\t\tfor (let i = 0; i < 2; i++) {\r\n\t\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\t\tx: player.hands[i].getX(),\r\n\t\t\t\t\t\ty: player.hands[i].getY(),\r\n\t\t\t\t\t\tsize: player.hands[i].size\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\t\tconst radius = size / 2;\r\n\t\t\t\t\t\t//hand border\r\n\t\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\t\tctx.arc(x + radius, y + radius, radius, 0, 2 * Math.PI);\r\n\t\t\t\t\t\tctx.fillStyle = this.colors.handBorder;\r\n\t\t\t\t\t\tctx.fill();\r\n\t\t\t\t\t\t//hand\r\n\t\t\t\t\t\tconst radiusHand = radius * 0.9;\r\n\t\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\t\tctx.arc(x + radius, y + radius, radiusHand, 0, 2 * Math.PI);\r\n\t\t\t\t\t\tctx.fillStyle = this.colors.hand;\r\n\t\t\t\t\t\tctx.fill();\r\n\t\t\t\t\t\t//hand collisionPoints\r\n\t\t\t\t\t\t/*\r\n\t\t\t\t\t\tctx.fillStyle = this.colors.collisionPoint;\r\n\t\t\t\t\t\tfor (const point of this.collisionPoints.hand) {\r\n\t\t\t\t\t\t\tconst { x, y, size } = this.howToDraw({\r\n\t\t\t\t\t\t\t\tx: player.hands[i].getCenterX() + point.x,\r\n\t\t\t\t\t\t\t\ty: player.hands[i].getCenterY() + point.y,\r\n\t\t\t\t\t\t\t\tsize: 1\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tctx.fillRect(x, y, size, size);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t*/\r\n\t\t\t\t\t\t//granade || smoke || medkit in hand\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t(player.getWeapon() === Weapon.Granade ||\r\n\t\t\t\t\t\t\t\tplayer.getWeapon() === Weapon.Smoke ||\r\n\t\t\t\t\t\t\t\tplayer.getWeapon() === Weapon.Medkit) &&\r\n\t\t\t\t\t\t\ti === 1\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tconst granadeShiftAngle = 30;\r\n\t\t\t\t\t\t\tconst playerAngle = player.getAngle();\r\n\t\t\t\t\t\t\tconst shiftZ = player.hands[1].radius;\r\n\t\t\t\t\t\t\t//triangle\r\n\t\t\t\t\t\t\tconst shiftX = Math.sin(playerAngle * Math.PI / 180) * shiftZ;\r\n\t\t\t\t\t\t\tconst shiftY = Math.cos(playerAngle * Math.PI / 180) * shiftZ;\r\n\r\n\t\t\t\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\t\t\t\tx: player.hands[i].getX() + shiftX,\r\n\t\t\t\t\t\t\t\ty: player.hands[i].getY() - shiftY,\r\n\t\t\t\t\t\t\t\tsize: player.hands[i].size\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\t\t\t\tctx.save();\r\n\t\t\t\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\t\t\t\tctx.rotate((playerAngle - granadeShiftAngle) * Math.PI / 180);\r\n\t\t\t\t\t\t\t\tlet SVG;\r\n\t\t\t\t\t\t\t\tif (player.getWeapon() === Weapon.Granade) SVG = this.granadeSVG;\r\n\t\t\t\t\t\t\t\tif (player.getWeapon() === Weapon.Smoke) SVG = this.smokeSVG;\r\n\t\t\t\t\t\t\t\tif (player.getWeapon() === Weapon.Medkit) SVG = this.medkitSVG;\r\n\t\t\t\t\t\t\t\tctx.drawImage(SVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\t\t\t\tctx.restore();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//player body\r\n\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\tx: player.getX(),\r\n\t\t\t\ty: player.getY(),\r\n\t\t\t\tsize: player.size\r\n\t\t\t});\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\t//vest\r\n\t\t\t\tconst radius = size / 2;\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(x + radius, y + radius, radius, 0, 2 * Math.PI);\r\n\t\t\t\tlet colorVest = this.colors.handBorder;\r\n\t\t\t\tif (this.snapshotManager.betweenSnapshot.i.v) colorVest = this.colors.vest;\r\n\t\t\t\tctx.fillStyle = colorVest;\r\n\t\t\t\tctx.fill();\r\n\t\t\t\t//body\r\n\t\t\t\tlet bodyRadius = radius * 0.95;\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(x + radius, y + radius, bodyRadius, 0, 2 * Math.PI);\r\n\t\t\t\tctx.fillStyle = this.colors.player;\r\n\t\t\t\tctx.fill();\r\n\t\t\t\t//collisionPoints\r\n\t\t\t\t/*\r\n\t\t\t\tctx.fillStyle = this.colors.collisionPoint;\r\n\t\t\t\tfor (const point of this.collisionPoints.body) {\r\n\t\t\t\t\tconst { x, y, size } = this.howToDraw({\r\n\t\t\t\t\t\tx: player.getCenterX() + point.x,\r\n\t\t\t\t\t\ty: player.getCenterY() + point.y,\r\n\t\t\t\t\t\tsize: 1\r\n\t\t\t\t\t});\r\n\t\t\t\t\tctx.fillRect(x, y, size, size);\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t}\r\n\r\n\t\t\t//blood\r\n\t\t\tctx.fillStyle = this.colors.collisionPoint;\r\n\t\t\tfor (let i = player.bloods.length - 1; i >= 0; i--) {\r\n\t\t\t\tconst blood = player.bloods[i];\r\n\t\t\t\tif (blood.getTimer() < blood.timerMax) {\r\n\t\t\t\t\tblood.shift();\r\n\t\t\t\t\tconst bloodX = player.getCenterX() + blood.getX();\r\n\t\t\t\t\tconst bloodY = player.getCenterY() + blood.getY();\r\n\t\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\t\tx: bloodX,\r\n\t\t\t\t\t\ty: bloodY,\r\n\t\t\t\t\t\tsize: blood.size\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\t\tconst alpha = 1 - blood.getTimer() / blood.timerMax;\r\n\t\t\t\t\t\tctx.save();\r\n\t\t\t\t\t\tctx.globalAlpha = alpha;\r\n\t\t\t\t\t\tctx.fillRect(x, y, size, size);\r\n\t\t\t\t\t\tctx.restore();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tplayer.bloods.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//granades\r\n\t\tfor (const granade of betweenSnapshot.g) {\r\n\t\t\tconst granadeSize = 30 * granade.b;\r\n\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\tx: granade.x - granadeSize / 2,\r\n\t\t\t\ty: granade.y - granadeSize / 2,\r\n\t\t\t\tsize: granadeSize\r\n\t\t\t});\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\tctx.rotate(granade.a * Math.PI / 180);\r\n\t\t\t\tif (granade.t === 'g') {\r\n\t\t\t\t\tctx.drawImage(this.granadeSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t}\r\n\t\t\t\tif (granade.t === 's') {\r\n\t\t\t\t\tctx.drawImage(this.smokeSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t}\r\n\t\t\t\tctx.restore();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//bullet points\r\n\t\tctx.fillStyle = 'orange';\r\n\t\tfor (const bullet of betweenSnapshot.b) {\r\n\t\t\t//bullet point\r\n\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\tx: bullet.x,\r\n\t\t\t\ty: bullet.y,\r\n\t\t\t\tsize: 3\r\n\t\t\t});\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\tctx.fillRect(\r\n\t\t\t\t\tx - 1.5 * this.finalResolutionAdjustment,\r\n\t\t\t\t\ty - 1.5 * this.finalResolutionAdjustment,\r\n\t\t\t\t\tsize,\r\n\t\t\t\t\tsize\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.createBulletLines();\r\n\t\t//draw bullet lines\r\n\t\tfor (const line of this.bulletLines) {\r\n\t\t\tfor (const partLine of line.parts) {\r\n\t\t\t\tif (partLine.isActive()) {\r\n\t\t\t\t\t//draw part\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.globalAlpha = 0.7 - partLine.getAge() / 14.3;\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tconst { x: startX, y: startY } = this.howToDraw({\r\n\t\t\t\t\t\tx: partLine.startX,\r\n\t\t\t\t\t\ty: partLine.startY,\r\n\t\t\t\t\t\tsize: 1\r\n\t\t\t\t\t});\r\n\t\t\t\t\tctx.moveTo(startX, startY);\r\n\t\t\t\t\tconst { x: endX, y: endY } = this.howToDraw({\r\n\t\t\t\t\t\tx: partLine.endX,\r\n\t\t\t\t\t\ty: partLine.endY,\r\n\t\t\t\t\t\tsize: 1\r\n\t\t\t\t\t});\r\n\t\t\t\t\tctx.lineTo(endX, endY);\r\n\t\t\t\t\tctx.lineWidth = 3 - partLine.getAge() / 3.33;\r\n\t\t\t\t\tctx.strokeStyle = 'white';\r\n\t\t\t\t\tctx.stroke();\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t\tpartLine.increaseAge();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//bushes\r\n\t\tfor (const bush of this.map.bushes) {\r\n\t\t\tif (bush.isActive()) {\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw(bush);\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.globalAlpha = bush.getOpacity();\r\n\t\t\t\t\tctx.drawImage(this.bushSVG, x, y, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//trees\r\n\t\tfor (const tree of this.map.trees) {\r\n\t\t\tif (tree.isActive()) {\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw(tree);\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.globalAlpha = tree.getOpacity();\r\n\t\t\t\t\tctx.drawImage(this.treeSVG, x, y, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//smokes\r\n\t\tfor (const smoke of betweenSnapshot.s) {\r\n\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\tx: smoke.x - smoke.s / 2,\r\n\t\t\t\ty: smoke.y - smoke.s / 2,\r\n\t\t\t\tsize: smoke.s\r\n\t\t\t});\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.globalAlpha = smoke.o;\r\n\t\t\t\tctx.drawImage(this.smokeCloudSVG, x, y, size, size);\r\n\t\t\t\tctx.restore();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//zone\r\n\t\tconst { x, y, size: outerRadius } = this.howToDraw({\r\n\t\t\tx: this.snapshotManager.zone.outerCircle.getCenterX(),\r\n\t\t\ty: this.snapshotManager.zone.outerCircle.getCenterY(),\r\n\t\t\tsize: this.snapshotManager.zone.outerCircle.getRadius()\r\n\t\t});\r\n\r\n\t\tel.zoneCircle.setAttribute('r', outerRadius.toString());\r\n\t\tel.zoneCircle.setAttribute('cx', x.toString());\r\n\t\tel.zoneCircle.setAttribute('cy', y.toString());\r\n\r\n\t\t//info\r\n\t\t{\r\n\t\t\tctx.font = '20px Arial';\r\n\t\t\tctx.fillStyle = this.colors.text;\r\n\t\t\tconst x = 15;\r\n\t\t\tlet row = 30;\r\n\t\t\tlet rowMultiple = 8;\r\n\t\t\t//ctx.fillText('snapshots: ' + this.snapshots.length, x, row * ++rowMultiple);\r\n\t\t\tctx.fillText('newerSnapshots: ' + this.snapshotManager.sumaNewer, x, row * ++rowMultiple);\r\n\t\t\tctx.fillText('ping: ' + this.serverClientSync.getPing(), x, row * ++rowMultiple);\r\n\t\t\tctx.fillText('timeDiference: ' + this.serverClientSync.getTimeDiference(), x, row * ++rowMultiple);\r\n\t\t\tctx.fillText('drawDelay: ' + this.serverClientSync.getDrawDelay(), x, row * ++rowMultiple);\r\n\t\t\tif (!this.snapshotManager.olderExists) {\r\n\t\t\t\tctx.fillText('olderSnapshot missing', x, row * ++rowMultiple);\r\n\t\t\t}\r\n\t\t\tif (!this.snapshotManager.newerExists) {\r\n\t\t\t\tctx.fillText('newerSnapshot missing', x, row * ++rowMultiple);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//healthBar\r\n\t\tel.healthBar.in.style.width = betweenSnapshot.i.h + '%';\r\n\r\n\t\t//loading\r\n\t\tconst progres = Math.round(betweenSnapshot.i.l / betweenSnapshot.i.lE * 100);\r\n\t\tconst seconds = Math.round((betweenSnapshot.i.lE - betweenSnapshot.i.l) / 1000 * 10) / 10;\r\n\t\tif (seconds && this.myPlayer.alive()) {\r\n\t\t\tel.takeLoot.style.display = 'none';\r\n\t\t\tel.loading.main.style.visibility = 'visible';\r\n\t\t\tel.loading.text.style.display = 'block';\r\n\t\t\tel.loading.text.textContent = betweenSnapshot.i.lT;\r\n\t\t\tlet secondsString = seconds.toString();\r\n\t\t\tswitch (secondsString) {\r\n\t\t\t\tcase '0':\r\n\t\t\t\t\tsecondsString = ' 0.0';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '1':\r\n\t\t\t\t\tsecondsString = ' 1.0';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '2':\r\n\t\t\t\t\tsecondsString = ' 2.0';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '3':\r\n\t\t\t\t\tsecondsString = ' 3.0';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '4':\r\n\t\t\t\t\tsecondsString = ' 4.0';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '5':\r\n\t\t\t\t\tsecondsString = ' 5.0';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tel.loading.counter.textContent = secondsString;\r\n\t\t\tel.loading.circle.setAttribute('stroke-dasharray', progres + ', 100');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tel.loading.main.style.visibility = 'hidden';\r\n\t\t\tel.loading.text.style.display = 'none';\r\n\t\t\t//take loot info\r\n\t\t\tel.takeLoot.style.display = 'block';\r\n\t\t\tthis.takeLootInfo();\r\n\t\t}\r\n\r\n\t\t//items\r\n\t\tel.items.redAmmo.textContent = this.snapshotManager.betweenSnapshot.i.r.toString();\r\n\t\tel.items.greenAmmo.textContent = this.snapshotManager.betweenSnapshot.i.g.toString();\r\n\t\tel.items.blueAmmo.textContent = this.snapshotManager.betweenSnapshot.i.b.toString();\r\n\t\tel.items.orangeAmmo.textContent = this.snapshotManager.betweenSnapshot.i.o.toString();\r\n\r\n\t\tel.items.item1in.textContent = this.itemName(this.snapshotManager.betweenSnapshot.i.i1);\r\n\t\tel.items.item2in.textContent = this.itemName(this.snapshotManager.betweenSnapshot.i.i2);\r\n\t\t//ammo color\r\n\t\tthis.itemAmmoColor(1, this.snapshotManager.betweenSnapshot.i.i1);\r\n\t\tthis.itemAmmoColor(2, this.snapshotManager.betweenSnapshot.i.i2);\r\n\t\tel.items.item3in.textContent = this.itemName(this.snapshotManager.betweenSnapshot.i.i3);\r\n\t\tlet item4Text = this.itemName(this.snapshotManager.betweenSnapshot.i.i4);\r\n\t\tconst item4Count = this.snapshotManager.betweenSnapshot.i.s4;\r\n\t\tif (item4Text) item4Text += ' ' + item4Count;\r\n\t\tel.items.item4in.textContent = item4Text;\r\n\r\n\t\tlet item5Text = this.itemName(this.snapshotManager.betweenSnapshot.i.i5);\r\n\t\tconst item5Count = this.snapshotManager.betweenSnapshot.i.s5;\r\n\t\tif (item5Text) item5Text += ' ' + item5Count;\r\n\t\tel.items.item5in.textContent = item5Text;\r\n\r\n\t\t//active item\r\n\t\tthis.activeItem(betweenSnapshot.i.ai);\r\n\r\n\t\t//activeGunAmmo\r\n\t\tlet ammo = '';\r\n\t\tif (\r\n\t\t\tthis.myPlayer.getWeapon() === Weapon.Pistol ||\r\n\t\t\tthis.myPlayer.getWeapon() === Weapon.Rifle ||\r\n\t\t\tthis.myPlayer.getWeapon() === Weapon.Machinegun ||\r\n\t\t\tthis.myPlayer.getWeapon() === Weapon.Shotgun\r\n\t\t) {\r\n\t\t\tammo = betweenSnapshot.i.a.toString();\r\n\t\t}\r\n\t\telse if (this.myPlayer.getWeapon() === Weapon.Hand || this.myPlayer.getWeapon() === Weapon.Hammer) {\r\n\t\t\tammo = '∞';\r\n\t\t}\r\n\t\telse if (this.myPlayer.getWeapon() === Weapon.Granade || this.myPlayer.getWeapon() === Weapon.Smoke) {\r\n\t\t\tammo = item4Count.toString();\r\n\t\t}\r\n\t\telse if (this.myPlayer.getWeapon() === Weapon.Medkit) {\r\n\t\t\tammo = item5Count.toString();\r\n\t\t}\r\n\t\tel.activeGunAmmo.textContent = ammo;\r\n\r\n\t\t//alive\r\n\t\tlet count = 0;\r\n\t\tfor (const player of this.snapshotManager.players) {\r\n\t\t\tif (player.alive()) count++;\r\n\t\t}\r\n\t\tel.alive.textContent = count.toString();\r\n\r\n\t\t//top items\r\n\t\tlet display = 'none';\r\n\t\tif (this.snapshotManager.betweenSnapshot.i.s !== 1) {\r\n\t\t\tdisplay = 'block';\r\n\t\t\tswitch (this.snapshotManager.betweenSnapshot.i.s) {\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tel.items.scope2.style.display = 'block';\r\n\t\t\t\t\tel.items.scope4.style.display = 'none';\r\n\t\t\t\t\tel.items.scope6.style.display = 'none';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\tel.items.scope2.style.display = 'none';\r\n\t\t\t\t\tel.items.scope4.style.display = 'block';\r\n\t\t\t\t\tel.items.scope6.style.display = 'none';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 6:\r\n\t\t\t\t\tel.items.scope2.style.display = 'none';\r\n\t\t\t\t\tel.items.scope4.style.display = 'none';\r\n\t\t\t\t\tel.items.scope6.style.display = 'block';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tel.items.scope.style.display = display;\r\n\t\tdisplay = 'none';\r\n\t\tif (this.snapshotManager.betweenSnapshot.i.v) display = 'block';\r\n\t\tel.items.vest.style.display = display;\r\n\r\n\t\t//messages\r\n\t\tthis.snapshotManager.messageManager();\r\n\t\tel.messages.innerHTML = '';\r\n\t\tfor (let i = this.snapshotManager.messages.length - 1; i >= 0; i--) {\r\n\t\t\tconst message = this.snapshotManager.messages[i];\r\n\t\t\tconst element = document.createElement('p');\r\n\t\t\telement.textContent = message.text;\r\n\t\t\tel.messages.appendChild(element);\r\n\t\t}\r\n\r\n\t\t//zone time\r\n\t\tif (this.snapshotManager.betweenSnapshot.z.hasOwnProperty('d')) {\r\n\t\t\tlet text = '';\r\n\t\t\tif (this.snapshotManager.betweenSnapshot.z.d > 0) {\r\n\t\t\t\ttext += this.snapshotManager.betweenSnapshot.z.d;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttext = 'Zone is moving!';\r\n\t\t\t}\r\n\t\t\tel.zoneTimer.innerText = text;\r\n\t\t}\r\n\r\n\t\t//spectate text\r\n\t\tel.spectate.style.display = 'none';\r\n\t\tif (betweenSnapshot.i.spectateName) {\r\n\t\t\tel.spectateName.innerText = betweenSnapshot.i.spectateName;\r\n\t\t\tel.spectate.style.display = 'block';\r\n\t\t}\r\n\t}\r\n\r\n\tprivate createBulletLines(): void {\r\n\t\tfor (const bullet of this.snapshotManager.betweenSnapshot.b) {\r\n\t\t\tlet thereIsLine = false;\r\n\t\t\t//set end in line\r\n\t\t\tfor (const line of this.bulletLines) {\r\n\t\t\t\tif (line.id === bullet.id) {\r\n\t\t\t\t\tline.setEnd(bullet.x, bullet.y);\r\n\t\t\t\t\tthereIsLine = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//create new line\r\n\t\t\tif (!thereIsLine) this.bulletLines.push(new BulletLine(bullet.id, bullet.x, bullet.y));\r\n\t\t}\r\n\t\t//delete old bullet lines\r\n\t\tfor (let i = this.bulletLines.length - 1; i >= 0; i--) {\r\n\t\t\tif (!this.bulletLines[i].isActive()) {\r\n\t\t\t\tthis.bulletLines.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate activeItem(activeItem: number): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\t\tel.items.item1.classList.remove('active');\r\n\t\tel.items.item2.classList.remove('active');\r\n\t\tel.items.item3.classList.remove('active');\r\n\t\tel.items.item4.classList.remove('active');\r\n\t\tel.items.item5.classList.remove('active');\r\n\r\n\t\tswitch (activeItem) {\r\n\t\t\tcase 1:\r\n\t\t\t\tel.items.item1.classList.add('active');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tel.items.item2.classList.add('active');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tel.items.item3.classList.add('active');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tel.items.item4.classList.add('active');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tel.items.item5.classList.add('active');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate itemAmmoColor(item: number, weapon: Weapon): void {\r\n\t\tlet el;\r\n\t\tif (item === 1) {\r\n\t\t\tel = this.myHtmlElements.items.item1Ammo;\r\n\t\t}\r\n\t\telse if (item === 2) {\r\n\t\t\tel = this.myHtmlElements.items.item2Ammo;\r\n\t\t}\r\n\t\tlet background = 'transparent';\r\n\t\tswitch (weapon) {\r\n\t\t\tcase Weapon.Pistol:\r\n\t\t\t\tbackground = 'orange';\r\n\t\t\t\tbreak;\r\n\t\t\tcase Weapon.Machinegun:\r\n\t\t\t\tbackground = 'blue';\r\n\t\t\t\tbreak;\r\n\t\t\tcase Weapon.Rifle:\r\n\t\t\t\tbackground = 'Green';\r\n\t\t\t\tbreak;\r\n\t\t\tcase Weapon.Shotgun:\r\n\t\t\t\tbackground = 'red';\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tif (el) el.style.background = background;\r\n\t}\r\n\r\n\tprivate itemName(item: any): string {\r\n\t\tlet weaponName: string = '';\r\n\t\tif (item === Weapon.Pistol) weaponName = 'Pistol';\r\n\t\tif (item === Weapon.Rifle) weaponName = 'Rifle';\r\n\t\tif (item === Weapon.Machinegun) weaponName = 'Machinegun';\r\n\t\tif (item === Weapon.Shotgun) weaponName = 'Shotgun';\r\n\t\tif (item === Weapon.Granade) weaponName = 'Granade';\r\n\t\tif (item === Weapon.Smoke) weaponName = 'Smoke';\r\n\t\tif (item === Weapon.Hand) weaponName = 'Hands';\r\n\t\tif (item === Weapon.Hammer) weaponName = 'Hammer';\r\n\t\tif (item === Weapon.Medkit) weaponName = 'Medkit';\r\n\t\treturn weaponName;\r\n\t}\r\n\r\n\tprivate takeLootInfo(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\t\tlet takeLootText = '';\r\n\t\tif (!this.snapshotManager.betweenSnapshot || !this.myPlayer.alive()){\r\n\t\t\tel.takeLoot.innerText = takeLootText;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (const loot of this.snapshotManager.betweenSnapshot.l) {\r\n\t\t\tconst x = this.myPlayer.getCenterX() - (loot.x + loot.size / 2);\r\n\t\t\tconst y = this.myPlayer.getCenterY() - (loot.y + loot.size / 2);\r\n\t\t\tconst distance = Math.sqrt(x * x + y * y);\r\n\t\t\tconst lootAndPlayerRadius = this.snapshotManager.players[0].radius + loot.size / 2;\r\n\t\t\tif (distance < lootAndPlayerRadius) {\r\n\t\t\t\tlet lootName = '';\r\n\t\t\t\tswitch (loot.type) {\r\n\t\t\t\t\tcase LootType.BlueAmmo:\r\n\t\t\t\t\tcase LootType.RedAmmo:\r\n\t\t\t\t\tcase LootType.GreenAmmo:\r\n\t\t\t\t\tcase LootType.OrangeAmmo:\r\n\t\t\t\t\t\tlootName = 'Ammo';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Pistol:\r\n\t\t\t\t\t\tlootName = 'Pistol';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Rifle:\r\n\t\t\t\t\t\tlootName = 'Rifle';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Machinegun:\r\n\t\t\t\t\t\tlootName = 'Machinegun';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Shotgun:\r\n\t\t\t\t\t\tlootName = 'Shotgun';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Scope2:\r\n\t\t\t\t\t\tlootName = '2X scope';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Scope4:\r\n\t\t\t\t\t\tlootName = '4X scope';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Scope6:\r\n\t\t\t\t\t\tlootName = '6X scope';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Granade:\r\n\t\t\t\t\t\tlootName = 'Granade';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Smoke:\r\n\t\t\t\t\t\tlootName = 'Smoke';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Medkit:\r\n\t\t\t\t\t\tlootName = 'Medkit';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Vest:\r\n\t\t\t\t\t\tlootName = 'Vest';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Hammer:\r\n\t\t\t\t\t\tlootName = 'Hammer';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet quantity = '';\r\n\t\t\t\tif (loot.quantity) quantity += loot.quantity;\r\n\t\t\t\ttakeLootText = lootName + ' ' + quantity + ' (E)';\r\n\t\t\t\tel.takeLoot.innerText = takeLootText;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tel.takeLoot.innerText = takeLootText;\r\n\t}\r\n\r\n\tprivate howToDraw(gameObject: RoundObject | RectObject | RectangleObstacle | RoundObstacle): DrawData {\r\n\t\t//size\r\n\t\tlet size = 0;\r\n\t\tlet width = 0;\r\n\t\tlet height = 0;\r\n\t\t//round or square\r\n\t\tif ((<RoundObject>gameObject).size) {\r\n\t\t\tsize = (<RoundObject>gameObject).size * this.finalResolutionAdjustment;\r\n\t\t\twidth = size;\r\n\t\t\theight = size;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//rect\r\n\t\t\twidth = (<RectObject>gameObject).width * this.finalResolutionAdjustment;\r\n\t\t\theight = (<RectObject>gameObject).height * this.finalResolutionAdjustment;\r\n\t\t}\r\n\t\t//animate shift\r\n\t\tlet animateShiftX = 0;\r\n\t\tlet animateShiftY = 0;\r\n\t\tif (gameObject instanceof RoundObstacle) {\r\n\t\t\tconst animateShift = gameObject.animate();\r\n\t\t\tanimateShiftX = animateShift.x;\r\n\t\t\tanimateShiftY = animateShift.y;\r\n\t\t}\r\n\t\t//positions on screen\r\n\t\tconst x =\r\n\t\t\tthis.screenCenterX +\r\n\t\t\t(gameObject.x + animateShiftX - this.myPlayer.getCenterX()) * this.finalResolutionAdjustment;\r\n\t\tconst y =\r\n\t\t\tthis.screenCenterY +\r\n\t\t\t(gameObject.y + animateShiftY - this.myPlayer.getCenterY()) * this.finalResolutionAdjustment;\r\n\t\t//Is is on the screen?\r\n\t\tlet isOnScreen = true;\r\n\t\tif (x > this.gameScreen.width || x < -width || y > this.gameScreen.height || y < -height) {\r\n\t\t\tisOnScreen = false;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tx,\r\n\t\t\ty,\r\n\t\t\tsize,\r\n\t\t\twidth,\r\n\t\t\theight,\r\n\t\t\tisOnScreen\r\n\t\t};\r\n\t}\r\n\r\n\tgameOver(stats: PlayerStats, win: boolean, winnerName?: string): void {\r\n\t\tsetTimeout(() => {\r\n\t\t\tconst el = this.myHtmlElements;\r\n\t\t\tif (win || winnerName) {\r\n\t\t\t\tel.gameOverMenu.h1.textContent = 'Winner!';\r\n\t\t\t\tif (winnerName) el.gameOverMenu.h1.textContent = winnerName + ' win';\r\n\t\t\t\tel.gameOverMenu.spectate.style.display = 'none';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tel.gameOverMenu.h1.textContent = 'You died';\r\n\t\t\t\tel.gameOverMenu.spectate.style.display = 'block';\r\n\t\t\t}\r\n\t\t\tel.open(el.gameOverMenu.main);\r\n\t\t\t//remove stats\r\n\t\t\tel.gameOverMenu.stats.innerHTML = '';\r\n\t\t\tconst kills = document.createElement('p');\r\n\t\t\tkills.textContent = 'Kills: ' + stats.kills.toString();\r\n\t\t\tconst damageDealt = document.createElement('p');\r\n\t\t\tdamageDealt.textContent = 'Damage dealt: ' + stats.damageDealt.toString();\r\n\t\t\tconst damageTaken = document.createElement('p');\r\n\t\t\tdamageTaken.textContent = 'Damage taken: ' + stats.damageTaken.toString();\r\n\t\t\tconst survive = document.createElement('p');\r\n\t\t\tconst minutes = Math.floor(stats.survive / 60);\r\n\t\t\tconst seconds = stats.survive - minutes * 60;\r\n\t\t\tconst surviveTime = minutes + 'm ' + seconds + 's';\r\n\t\t\tsurvive.textContent = 'Survive: ' + surviveTime;\r\n\t\t\tel.gameOverMenu.stats.appendChild(kills);\r\n\t\t\tel.gameOverMenu.stats.appendChild(damageDealt);\r\n\t\t\tel.gameOverMenu.stats.appendChild(damageTaken);\r\n\t\t\tif (!win) el.gameOverMenu.stats.appendChild(survive);\r\n\t\t}, 2000);\r\n\t}\r\n}\r\n","import { Terrain, TerrainType } from './Terrain';\r\nimport Bush from './Bush';\r\nimport Tree from './Tree';\r\nimport Rock from './Rock';\r\nimport Wall from './Wall';\r\nimport WaterTerrainData from './WaterTerrainData';\r\nimport RoundObstacle from './RoundObstacle';\r\nimport RectangleObstacle from './RectangleObstacle';\r\nimport MapData from './MapData';\r\n\r\ntype Block = {\r\n\tx: number;\r\n\ty: number;\r\n};\r\n\r\nexport default class Map {\r\n\tprivate size: number;\r\n\tprivate blockSize: number;\r\n\treadonly blocks: Block[] = [];\r\n\treadonly terrain: Terrain[] = [];\r\n\treadonly impassableRoundObstacles: RoundObstacle[] = [];\r\n\treadonly bushes: Bush[] = [];\r\n\treadonly trees: Tree[] = [];\r\n\treadonly rocks: Rock[] = [];\r\n\treadonly rectangleObstacles: RectangleObstacle[] = [];\r\n\treadonly waterTerrainData: WaterTerrainData;\r\n\r\n\tconstructor(waterTerrainData: WaterTerrainData) {\r\n\t\tthis.waterTerrainData = waterTerrainData;\r\n\t}\r\n\r\n\treset():void{\r\n\tthis.blocks.splice(0,this.blocks.length)\r\n\tthis.terrain.splice(0,this.terrain.length)\r\n\tthis.impassableRoundObstacles.splice(0,this.impassableRoundObstacles.length)\r\n\tthis.bushes.splice(0,this.bushes.length)\r\n\tthis.trees.splice(0,this.trees.length)\r\n\tthis.rocks.splice(0,this.rocks.length)\r\n\tthis.rectangleObstacles.splice(0,this.rectangleObstacles.length)\r\n\t}\r\n\r\n\tgetSize(): number {\r\n\t\treturn this.size;\r\n\t}\r\n\r\n\tgetBlockSize(): number {\r\n\t\treturn this.blockSize;\r\n\t}\r\n\r\n\topenMap(map: MapData): void {\r\n\t\tthis.size = map.size * map.blockSize;\r\n\t\tthis.blockSize = map.blockSize;\r\n\t\t//Create blocks\r\n\t\tfor (let yy = 0; yy < map.size; yy++) {\r\n\t\t\tfor (let xx = 0; xx < map.size; xx++) {\r\n\t\t\t\tthis.blocks.push({ x: xx * map.blockSize, y: yy * map.blockSize });\r\n\t\t\t}\r\n\t\t}\r\n\t\t//terrains\r\n\t\tfor (const terrain of map.terrains) {\r\n\t\t\tthis.terrain.push(new Terrain(terrain.type, terrain.x, terrain.y, terrain.size));\r\n\t\t}\r\n\t\t//rocks\r\n\t\tlet id = 0;\r\n\t\tfor (const rock of map.rocks) {\r\n\t\t\tconst newRock = new Rock(id++, rock.x, rock.y);\r\n\t\t\tthis.rocks.push(newRock);\r\n\t\t\tthis.impassableRoundObstacles.push(newRock);\r\n\t\t}\r\n\t\t//bushes\r\n\t\tfor (const bush of map.bushes) {\r\n\t\t\tthis.bushes.push(new Bush(id++, bush.x, bush.y));\r\n\t\t}\r\n\t\t//trees\r\n\t\tfor (const tree of map.trees) {\r\n\t\t\tconst newTree = new Tree(id++, tree.x, tree.y);\r\n\t\t\tthis.trees.push(newTree);\r\n\t\t\tthis.impassableRoundObstacles.push(newTree);\r\n\t\t}\r\n\t\t//walls\r\n\t\tfor (const wall of map.rects) {\r\n\t\t\tthis.rectangleObstacles.push(new Wall(id++, wall.x, wall.y, wall.width, wall.height));\r\n\t\t}\r\n\t}\r\n}\r\n","import { TerrainType } from './Terrain';\r\n\r\n/*\r\nimport { triangel1 } from './triangel1Data';\r\nimport { triangel2 } from './triangel2Data';\r\nimport { triangel3 } from './triangel3Data';\r\nimport { triangel4 } from './triangel4Data';\r\n*/\r\n\r\nexport default class WaterTerrainData {\r\n\tprivate waterTriangle1: boolean[][] = [];\r\n\tprivate waterTriangle2: boolean[][] = [];\r\n\tprivate waterTriangle3: boolean[][] = [];\r\n\tprivate waterTriangle4: boolean[][] = [];\r\n\r\n\t/*\r\n\tprivate waterTriangle1: number[][] = triangel1;\r\n\tprivate waterTriangle2: number[][] = triangel2;\r\n\tprivate waterTriangle3: number[][] = triangel3;\r\n\tprivate waterTriangle4: number[][] = triangel4;\r\n\t*/\r\n\r\n\tconstructor() {}\r\n\r\n\tsetData(type: TerrainType, data: boolean[][]): void {\r\n\t\tswitch (type) {\r\n\t\t\tcase TerrainType.WaterTriangle1:\r\n\t\t\t\tthis.waterTriangle1 = data;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle2:\r\n\t\t\t\tthis.waterTriangle2 = data;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle3:\r\n\t\t\t\tthis.waterTriangle3 = data;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle4:\r\n\t\t\t\tthis.waterTriangle4 = data;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error('Unknown water type');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tincludeWater(type: TerrainType, x: number, y: number): boolean {\r\n\t\tlet state = false;\r\n\t\tlet waterData;\r\n\t\tswitch (type) {\r\n\t\t\tcase TerrainType.WaterTriangle1:\r\n\t\t\t\twaterData = this.waterTriangle1;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle2:\r\n\t\t\t\twaterData = this.waterTriangle2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle3:\r\n\t\t\t\twaterData = this.waterTriangle3;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle4:\r\n\t\t\t\twaterData = this.waterTriangle4;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error('Unknown water type');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tif (x < waterData.length && y < waterData[x].length) {\r\n\t\t\tif (waterData[x][y]) state = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//no water data yet\r\n\t\t\t//no water data == we are in water\r\n\t\t\tif (waterData.length === 0) {\r\n\t\t\t\tstate = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthrow new Error('Out of range on water type');\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn state;\r\n\t}\r\n\r\n\t/*\r\n\twrite(): void {\r\n\t\tconst el = document.createElement('p');\r\n\t\tel.style.position = 'absolute';\r\n\t\tel.style.top = '0';\r\n\t\tel.style.left = '0';\r\n\r\n\t\tel.textContent = JSON.stringify(this.waterTriangle4);\r\n\t\tdocument.body.appendChild(el);\r\n\t}\r\n\t*/\r\n}\r\n","import Point from './Point';\r\n\r\nexport default class CollisionPoints {\r\n\tbody: Point[] = [];\r\n\thand: Point[] = [];\r\n\thammer: Point[][] = [];\r\n\tready: boolean = false;\r\n\r\n\tsetData(body: Point[], hand: Point[], hammer: Point[][]) {\r\n\t\tthis.body = body;\r\n\t\tthis.hand = hand;\r\n        this.hammer = hammer;\r\n        this.ready = true;\r\n    }\r\n    \r\n    isReady(): boolean{\r\n        return this.ready;\r\n    }\r\n}\r\n","export default class Hand {\r\n\treadonly size: number;\r\n\treadonly radius: number;\r\n\tprivate x: number;\r\n\tprivate y: number;\r\n\r\n\tconstructor(x: number, y: number, size: number) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.size = size;\r\n\t\tthis.radius = size / 2;\r\n\t}\r\n\r\n\tsetX(x: number): void {\r\n\t\tthis.x = x;\r\n\t}\r\n\r\n\tsetY(y: number): void {\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\tgetX(): number {\r\n\t\treturn this.x;\r\n\t}\r\n\r\n\tgetY(): number {\r\n\t\treturn this.y;\r\n\t}\r\n\r\n\tgetCenterX(): number {\r\n\t\treturn this.x + this.radius;\r\n\t}\r\n\r\n\tgetCenterY(): number {\r\n\t\treturn this.y + this.radius;\r\n\t}\r\n}\r\n","export default class Blood {\r\n\treadonly size: number = 8;\r\n\tprivate x: number;\r\n\tprivate y: number;\r\n\tprivate timer: number = 0;\r\n\treadonly timerMax: number = 60;\r\n\r\n\tconstructor() {\r\n\t\tthis.x = Math.round(Math.random() * 30) * -1;\r\n\t\tthis.y = Math.round(Math.random() * 30);\r\n\t}\r\n\r\n\tshift(): void {\r\n\t\tthis.x += 0.7;\r\n\t\tthis.y -= 0.7;\r\n\t\tthis.timer++;\r\n\t}\r\n\r\n\tgetX(): number {\r\n\t\treturn this.x;\r\n\t}\r\n\r\n\tgetY(): number {\r\n\t\treturn this.y;\r\n\t}\r\n\r\n\tgetTimer(): number {\r\n\t\treturn this.timer;\r\n\t}\r\n}\r\n","import Hand from './Hand';\r\nimport { Weapon } from './Weapon';\r\nimport PlayerSnapshot from './PlayerSnapshot';\r\nimport Blood from './Blood';\r\n\r\nexport default class Player {\r\n\treadonly id: number;\r\n\treadonly size: number;\r\n\treadonly radius: number;\r\n\tprivate live: boolean = true;\r\n\tprivate x: number;\r\n\tprivate y: number;\r\n\tprivate angle: number;\r\n\tprivate hammerAngle: number;\r\n\treadonly hands: Hand[] = [];\r\n\tprivate weapon: Weapon;\r\n\treadonly bloods: Blood[] = [];\r\n\r\n\tconstructor(playerSnapshot: PlayerSnapshot) {\r\n\t\tthis.id = playerSnapshot.i;\r\n\t\tthis.x = playerSnapshot.x;\r\n\t\tthis.y = playerSnapshot.y;\r\n\t\tthis.angle = playerSnapshot.a;\r\n\t\tthis.hammerAngle = playerSnapshot.m;\r\n\t\tthis.weapon = playerSnapshot.w;\r\n\t\tthis.size = playerSnapshot.size;\r\n\t\tthis.radius = this.size / 2;\r\n\t\tthis.hands.push(new Hand(playerSnapshot.lX, playerSnapshot.lY, playerSnapshot.hSize));\r\n\t\tthis.hands.push(new Hand(playerSnapshot.rX, playerSnapshot.rY, playerSnapshot.hSize));\r\n\t}\r\n\r\n\tcreateInjury(power: number): void {\r\n\t\tconst powerToBlood = 2;\r\n\t\tfor (let i = 0; i < power / powerToBlood; i++) {\r\n\t\t\tthis.bloods.push(new Blood());\r\n\t\t}\r\n\t}\r\n\r\n\tdie(): void {\r\n\t\tthis.live = false;\r\n\t}\r\n\r\n\talive(): boolean {\r\n\t\treturn this.live;\r\n\t}\r\n\r\n\tsetX(x: number): void {\r\n\t\tthis.x = x;\r\n\t}\r\n\r\n\tsetY(y: number): void {\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\tsetAngle(angle: number): void {\r\n\t\tthis.angle = angle;\r\n\t}\r\n\r\n\tsetHammerAngle(hammerAngle: number): void {\r\n\t\tthis.hammerAngle = hammerAngle;\r\n\t}\r\n\r\n\tsetWeapon(weapon: Weapon): void {\r\n\t\tthis.weapon = weapon;\r\n\t}\r\n\r\n\tgetX(): number {\r\n\t\treturn this.x;\r\n\t}\r\n\r\n\tgetY(): number {\r\n\t\treturn this.y;\r\n\t}\r\n\r\n\tgetAngle(): number {\r\n\t\treturn this.angle;\r\n\t}\r\n\r\n\tgetHammerAngle(): number {\r\n\t\treturn this.hammerAngle;\r\n\t}\r\n\r\n\tgetWeapon(): Weapon {\r\n\t\treturn this.weapon;\r\n\t}\r\n\r\n\tgetCenterX(): number {\r\n\t\treturn this.x + this.radius;\r\n\t}\r\n\r\n\tgetCenterY(): number {\r\n\t\treturn this.y + this.radius;\r\n\t}\r\n}\r\n","export default class ZoneCircle {\r\n\tprivate centerX: number;\r\n\tprivate centerY: number;\r\n\tprivate radius: number;\r\n\r\n\tconstructor(centerX: number, centerY: number, radius: number) {\r\n\t\tthis.centerX = centerX;\r\n\t\tthis.centerY = centerY;\r\n\t\tthis.radius = radius;\r\n\t}\r\n\r\n\tsetCenterX(x: number): void {\r\n\t\tthis.centerX = x;\r\n\t}\r\n\r\n\tsetCenterY(y: number): void {\r\n\t\tthis.centerY = y;\r\n\t}\r\n\r\n\tsetRadius(radius: number): void {\r\n\t\tthis.radius = radius;\r\n\t}\r\n\r\n\tgetCenterX(): number {\r\n\t\treturn this.centerX;\r\n\t}\r\n\r\n\tgetCenterY(): number {\r\n\t\treturn this.centerY;\r\n\t}\r\n\r\n\tgetRadius(): number {\r\n\t\treturn this.radius;\r\n\t}\r\n}\r\n","import ZoneCircle from './ZoneCircle';\r\n\r\nexport default class Zone {\r\n\tinnerCircle: ZoneCircle;\r\n\touterCircle: ZoneCircle;\r\n\r\n\tconstructor() {\r\n        this.innerCircle = new ZoneCircle(0, 0, 0);\r\n        this.outerCircle = new ZoneCircle(0, 0, 0);\r\n    }\r\n    \r\n}\r\n","export default class Message{\r\n    readonly text: string;\r\n    readonly time: number;\r\n\r\n    constructor(time: number, text: string){\r\n        this.time = time;\r\n        this.text = text;\r\n    }\r\n}","import { Snapshot } from './Snapshot';\r\nimport ServerClientSync from './ServerClientSync';\r\nimport Player from './Player';\r\nimport PlayerSnapshot from './PlayerSnapshot';\r\nimport Zone from './Zone';\r\nimport ZoneSnapshot from './ZoneSnapshot';\r\nimport LootSnapshot from './LootSnapshot';\r\nimport { Weapon } from './Weapon';\r\nimport ObstacleSnapshot from './ObstacleSnapshot';\r\nimport Map from './Map';\r\nimport MyPlayerSnapshot from './MyPlayerSnapshot';\r\nimport Message from './Message';\r\n\r\nexport default class SnapshotManager {\r\n\tprivate serverClientSync: ServerClientSync;\r\n\tprivate snapshots: Snapshot[] = [];\r\n\tprivate map: Map;\r\n\tmessages: Message[] = [];\r\n\tbetweenSnapshot: Snapshot | null;\r\n\tplayers: Player[] = [];\r\n\tzone: Zone;\r\n\tprivate numberOfPlayers: number;\r\n\r\n\tnewerExists: boolean = false;\r\n\tolderExists: boolean = false;\r\n\tsumaNewer: number = 0;\r\n\tprivate averageSumaNewer: number[] = [];\r\n\r\n\tconstructor(serverClientSync: ServerClientSync, map: Map) {\r\n\t\tthis.serverClientSync = serverClientSync;\r\n\t\tthis.zone = new Zone();\r\n\t\tthis.map = map;\r\n\t}\r\n\r\n\tprivate addSumaNewer(sumaNewer: number): void {\r\n\t\tconst max = 100;\r\n\t\tthis.averageSumaNewer.push(sumaNewer);\r\n\t\tif (this.averageSumaNewer.length > max) {\r\n\t\t\tthis.averageSumaNewer.splice(0, 1);\r\n\t\t\tlet totalSuma = 0;\r\n\t\t\tfor (const suma of this.averageSumaNewer) {\r\n\t\t\t\ttotalSuma += suma;\r\n\t\t\t}\r\n\t\t\tconsole.log('averageSumaNewer: ', totalSuma / max);\r\n\t\t}\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tthis.snapshots.splice(0, this.snapshots.length);\r\n\t\tthis.betweenSnapshot = null;\r\n\t\tthis.players.splice(0, this.players.length);\r\n\t}\r\n\r\n\tmessageManager(): void {\r\n\t\t//delete old messages\r\n\t\tconst viewTime = 1000 * 5;\r\n\t\tfor (let i = this.messages.length - 1; i >= 0; i--) {\r\n\t\t\tconst message = this.messages[i];\r\n\t\t\tif (message.time + viewTime < Date.now()) this.messages.splice(i, 1);\r\n\t\t}\r\n\t\t//max 5 messages\r\n\t\tif (this.messages.length > 5) {\r\n\t\t\tconst cut = this.messages.length - 5;\r\n\t\t\tthis.messages.splice(0, cut);\r\n\t\t}\r\n\t}\r\n\r\n\taddSnapshot(snapshot: Snapshot): void {\r\n\t\tif (this.snapshots.length === 0) this.numberOfPlayers = snapshot.p.length;\r\n\t\tlet updateDelay = this.serverClientSync.getDrawDelay() - (this.serverClientSync.getServerTime() - snapshot.t);\r\n\t\tif (updateDelay < 0) updateDelay = 0;\r\n\r\n\t\t//blood animate\r\n\t\tif (snapshot.p) {\r\n\t\t\tfor (const playerSnapshot of snapshot.p) {\r\n\t\t\t\tif (playerSnapshot.d) {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tfor (const player of this.players) {\r\n\t\t\t\t\t\t\tif (player.id === playerSnapshot.i) {\r\n\t\t\t\t\t\t\t\tplayer.createInjury(playerSnapshot.d);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, updateDelay);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.snapshots.push(snapshot);\r\n\t\tif (this.snapshots.length > 1) {\r\n\t\t\tthis.completeSnapshot(this.snapshots[this.snapshots.length - 2], snapshot);\r\n\t\t}\r\n\t\t//add message\r\n\t\tif (snapshot.m) {\r\n\t\t\tfor (const message of snapshot.m) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.messages.push(new Message(Date.now(), message));\r\n\t\t\t\t}, updateDelay);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//update map\r\n\t\tthis.updateMap(snapshot, updateDelay);\r\n\r\n\t\t//delete old snapshots\r\n\t\tif (this.snapshots.length > 50) {\r\n\t\t\tthis.snapshots.splice(0, 1);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateMap(snapshot: Snapshot, updateDelay: number): void {\r\n\t\tconst obsacleSnapshots = snapshot.o;\r\n\t\tfor (const obstacleSnapshot of obsacleSnapshots) {\r\n\t\t\tswitch (obstacleSnapshot.t) {\r\n\t\t\t\tcase 'w':\r\n\t\t\t\t\tfor (const obstacle of this.map.rectangleObstacles) {\r\n\t\t\t\t\t\tif (obstacle.id === obstacleSnapshot.i) {\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tobstacle.update(obstacleSnapshot.o);\r\n\t\t\t\t\t\t\t}, updateDelay);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'r':\r\n\t\t\t\t\tfor (const obstacle of this.map.rocks) {\r\n\t\t\t\t\t\tif (obstacle.id === obstacleSnapshot.i) {\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tobstacle.update(obstacleSnapshot.o);\r\n\t\t\t\t\t\t\t}, updateDelay);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 't':\r\n\t\t\t\t\tfor (const obstacle of this.map.trees) {\r\n\t\t\t\t\t\tif (obstacle.id === obstacleSnapshot.i) {\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tobstacle.update(obstacleSnapshot.o);\r\n\t\t\t\t\t\t\t}, updateDelay);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'b':\r\n\t\t\t\t\tfor (const obstacle of this.map.bushes) {\r\n\t\t\t\t\t\tif (obstacle.id === obstacleSnapshot.i) {\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tobstacle.update(obstacleSnapshot.o);\r\n\t\t\t\t\t\t\t}, updateDelay);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateZone(): void {\r\n\t\tif (!this.betweenSnapshot) return;\r\n\t\tconst zoneSnapshot = this.betweenSnapshot.z;\r\n\t\t//inner\r\n\t\tthis.zone.innerCircle.setRadius(zoneSnapshot.iR);\r\n\t\tthis.zone.innerCircle.setCenterX(zoneSnapshot.iX);\r\n\t\tthis.zone.innerCircle.setCenterY(zoneSnapshot.iY);\r\n\t\t//outer\r\n\t\tthis.zone.outerCircle.setRadius(zoneSnapshot.oR);\r\n\t\tthis.zone.outerCircle.setCenterX(zoneSnapshot.oX);\r\n\t\tthis.zone.outerCircle.setCenterY(zoneSnapshot.oY);\r\n\t}\r\n\r\n\tprivate completeSnapshot(previousSnapshot: Snapshot, lastSnapshot: Snapshot): void {\r\n\t\tthis.completePlayerSnapshots(previousSnapshot.p, lastSnapshot.p);\r\n\t\tthis.completeMyPlayerSnapshot(previousSnapshot.i, lastSnapshot.i);\r\n\t\tthis.completeLootSnapshots(previousSnapshot.l, lastSnapshot.l);\r\n\t\tthis.completeZoneSnapshot(previousSnapshot.z, lastSnapshot.z);\r\n\t\t//zone delay\r\n\t\tif (!lastSnapshot.z.hasOwnProperty('d')) lastSnapshot.z.d = previousSnapshot.z.d;\r\n\t}\r\n\r\n\tprivate completeMyPlayerSnapshot(\r\n\t\tpreviousMyPlayerSnapshot: MyPlayerSnapshot,\r\n\t\tlastMyPlayerSnapshot: MyPlayerSnapshot\r\n\t): void {\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('h')) lastMyPlayerSnapshot.h = previousMyPlayerSnapshot.h;\r\n\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('i1')) lastMyPlayerSnapshot.i1 = previousMyPlayerSnapshot.i1;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('i2')) lastMyPlayerSnapshot.i2 = previousMyPlayerSnapshot.i2;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('i3')) lastMyPlayerSnapshot.i3 = previousMyPlayerSnapshot.i3;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('i4')) lastMyPlayerSnapshot.i4 = previousMyPlayerSnapshot.i4;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('i5')) lastMyPlayerSnapshot.i5 = previousMyPlayerSnapshot.i5;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('s4')) lastMyPlayerSnapshot.s4 = previousMyPlayerSnapshot.s4;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('s5')) lastMyPlayerSnapshot.s5 = previousMyPlayerSnapshot.s5;\r\n\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('a')) lastMyPlayerSnapshot.a = previousMyPlayerSnapshot.a;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('aM')) lastMyPlayerSnapshot.aM = previousMyPlayerSnapshot.aM;\r\n\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('r')) lastMyPlayerSnapshot.r = previousMyPlayerSnapshot.r;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('g')) lastMyPlayerSnapshot.g = previousMyPlayerSnapshot.g;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('b')) lastMyPlayerSnapshot.b = previousMyPlayerSnapshot.b;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('o')) lastMyPlayerSnapshot.o = previousMyPlayerSnapshot.o;\r\n\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('s')) lastMyPlayerSnapshot.s = previousMyPlayerSnapshot.s;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('v')) lastMyPlayerSnapshot.v = previousMyPlayerSnapshot.v;\r\n\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('l')) lastMyPlayerSnapshot.l = previousMyPlayerSnapshot.l;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('lE')) lastMyPlayerSnapshot.lE = previousMyPlayerSnapshot.lE;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('lT')) lastMyPlayerSnapshot.lT = previousMyPlayerSnapshot.lT;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('spectate'))\r\n\t\t\tlastMyPlayerSnapshot.spectate = previousMyPlayerSnapshot.spectate;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('spectateName'))\r\n\t\t\tlastMyPlayerSnapshot.spectateName = previousMyPlayerSnapshot.spectateName;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('ai')) lastMyPlayerSnapshot.ai = previousMyPlayerSnapshot.ai;\r\n\t}\r\n\r\n\tprivate completeZoneSnapshot(previousZoneSnapshot: ZoneSnapshot, lastZoneSnapshot: ZoneSnapshot): void {\r\n\t\tif (!lastZoneSnapshot.hasOwnProperty('iX')) lastZoneSnapshot.iX = previousZoneSnapshot.iX;\r\n\t\tif (!lastZoneSnapshot.hasOwnProperty('iY')) lastZoneSnapshot.iY = previousZoneSnapshot.iY;\r\n\t\tif (!lastZoneSnapshot.hasOwnProperty('iR')) lastZoneSnapshot.iR = previousZoneSnapshot.iR;\r\n\t\tif (!lastZoneSnapshot.hasOwnProperty('oX')) lastZoneSnapshot.oX = previousZoneSnapshot.oX;\r\n\t\tif (!lastZoneSnapshot.hasOwnProperty('oY')) lastZoneSnapshot.oY = previousZoneSnapshot.oY;\r\n\t\tif (!lastZoneSnapshot.hasOwnProperty('oR')) lastZoneSnapshot.oR = previousZoneSnapshot.oR;\r\n\t}\r\n\r\n\tprivate completeLootSnapshots(previousSnapshotLoots: LootSnapshot[], lastSnapshotLoots: LootSnapshot[]): void {\r\n\t\t//copy missing values\r\n\t\tfor (const lastSnapshotLoot of lastSnapshotLoots) {\r\n\t\t\tlet previousSnapshotLoot;\r\n\t\t\tfor (const loot of previousSnapshotLoots) {\r\n\t\t\t\tif (loot.i === lastSnapshotLoot.i) previousSnapshotLoot = loot;\r\n\t\t\t}\r\n\t\t\tif (previousSnapshotLoot) {\r\n\t\t\t\tif (!lastSnapshotLoot.hasOwnProperty('size')) lastSnapshotLoot.size = previousSnapshotLoot.size;\r\n\t\t\t\tif (!lastSnapshotLoot.hasOwnProperty('type')) lastSnapshotLoot.type = previousSnapshotLoot.type;\r\n\t\t\t\tif (!lastSnapshotLoot.hasOwnProperty('x')) lastSnapshotLoot.x = previousSnapshotLoot.x;\r\n\t\t\t\tif (!lastSnapshotLoot.hasOwnProperty('y')) lastSnapshotLoot.y = previousSnapshotLoot.y;\r\n\t\t\t\tif (!lastSnapshotLoot.hasOwnProperty('quantity') && previousSnapshotLoot.hasOwnProperty('quantity'))\r\n\t\t\t\t\tlastSnapshotLoot.quantity = previousSnapshotLoot.quantity;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//find missing objects and copy previous values\r\n\t\tconst missingLoots = [];\r\n\t\tfor (const previous of previousSnapshotLoots) {\r\n\t\t\tlet lootExists = false;\r\n\t\t\tfor (const last of lastSnapshotLoots) {\r\n\t\t\t\tif (previous.i === last.i) {\r\n\t\t\t\t\tlootExists = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!lootExists) {\r\n\t\t\t\tmissingLoots.push(previous);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (const missingLoot of missingLoots) {\r\n\t\t\tlastSnapshotLoots.push(missingLoot);\r\n\t\t}\r\n\r\n\t\t//delete !active loot\r\n\t\tfor (let i = lastSnapshotLoots.length - 1; i >= 0; i--) {\r\n\t\t\tif (lastSnapshotLoots[i].hasOwnProperty('del')) {\r\n\t\t\t\tlastSnapshotLoots.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate completePlayerSnapshots(\r\n\t\tpreviousSnapshotPlayers: PlayerSnapshot[],\r\n\t\tlastSnapshotPlayers: PlayerSnapshot[]\r\n\t): void {\r\n\t\t//copy missing values\r\n\t\tfor (const lastSnapshotPlayer of lastSnapshotPlayers) {\r\n\t\t\tlet previousSnapshotPlayer;\r\n\t\t\tfor (const player of previousSnapshotPlayers) {\r\n\t\t\t\tif (player.i === lastSnapshotPlayer.i) previousSnapshotPlayer = player;\r\n\t\t\t}\r\n\t\t\tif (previousSnapshotPlayer) {\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('a')) lastSnapshotPlayer.a = previousSnapshotPlayer.a;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('m')) lastSnapshotPlayer.m = previousSnapshotPlayer.m;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('size')) lastSnapshotPlayer.size = previousSnapshotPlayer.size;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('w')) lastSnapshotPlayer.w = previousSnapshotPlayer.w;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('x')) lastSnapshotPlayer.x = previousSnapshotPlayer.x;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('y')) lastSnapshotPlayer.y = previousSnapshotPlayer.y;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('l')) lastSnapshotPlayer.l = previousSnapshotPlayer.l;\r\n\t\t\t\t//hands\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('hSize'))\r\n\t\t\t\t\tlastSnapshotPlayer.hSize = previousSnapshotPlayer.hSize;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('lX')) lastSnapshotPlayer.lX = previousSnapshotPlayer.lX;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('lY')) lastSnapshotPlayer.lY = previousSnapshotPlayer.lY;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('rX')) lastSnapshotPlayer.rX = previousSnapshotPlayer.rX;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('rY')) lastSnapshotPlayer.rY = previousSnapshotPlayer.rY;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//find missing players and copy previous values\r\n\t\tconst missingPlayerIds = [];\r\n\t\tfor (const previousSnapshotPlayer of previousSnapshotPlayers) {\r\n\t\t\tlet playerExists = false;\r\n\t\t\tfor (const lastSnapshotPlayer of lastSnapshotPlayers) {\r\n\t\t\t\tif (previousSnapshotPlayer.i === lastSnapshotPlayer.i) {\r\n\t\t\t\t\tplayerExists = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!playerExists) {\r\n\t\t\t\tmissingPlayerIds.push(previousSnapshotPlayer.i);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//copy previous snapshot\r\n\t\tfor (const missingPlayerId of missingPlayerIds) {\r\n\t\t\tfor (const previousSnapshotPlayer of previousSnapshotPlayers) {\r\n\t\t\t\tif (missingPlayerId === previousSnapshotPlayer.i) {\r\n\t\t\t\t\tlastSnapshotPlayers.push(previousSnapshotPlayer);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//sort by id!\r\n\t\tlastSnapshotPlayers.sort((a: PlayerSnapshot, b: PlayerSnapshot) => {\r\n\t\t\treturn a.i - b.i;\r\n\t\t});\r\n\t}\r\n\r\n\t//1. urcime si cas pred nejakou dobou a budeme hledat snimky hry pred timto a za timto bodem (ServerClientSync class)\r\n\t//2. nemuzeme se spolehnout jen na cas klienta a musime nejperve synchronizovat (ServerClientSync class)\r\n\t//3. dopocitame stav mezi snimky\r\n\tcreateBetweenSnapshot(): void {\r\n\t\tif (this.snapshots.length && this.serverClientSync.ready()) {\r\n\t\t\tlet percentShift = 0;\r\n\t\t\tthis.sumaNewer = 0;\r\n\t\t\tthis.newerExists = false;\r\n\t\t\tthis.olderExists = false;\r\n\t\t\tlet newerSnapshot: Snapshot;\r\n\t\t\tlet olderSnapshot: Snapshot;\r\n\r\n\t\t\tconst wantedSnapshotTime = this.serverClientSync.getServerTime() - this.serverClientSync.getDrawDelay();\r\n\t\t\t//find last older (or same <=) snapshot\r\n\t\t\tfor (const snapshot of this.snapshots) {\r\n\t\t\t\tif (snapshot.t <= wantedSnapshotTime) {\r\n\t\t\t\t\tolderSnapshot = snapshot;\r\n\t\t\t\t\tthis.olderExists = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//find first newer (or same >=) snapshot\r\n\t\t\tfor (const snapshot of this.snapshots) {\r\n\t\t\t\tif (snapshot.t >= wantedSnapshotTime) {\r\n\t\t\t\t\tif (!newerSnapshot) {\r\n\t\t\t\t\t\tnewerSnapshot = snapshot;\r\n\t\t\t\t\t\tthis.newerExists = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.sumaNewer++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//if newerSnapshot is missing use older...\r\n\t\t\tif (!newerSnapshot) {\r\n\t\t\t\tnewerSnapshot = olderSnapshot;\r\n\t\t\t\tthis.serverClientSync.reset();\r\n\t\t\t}\r\n\r\n\t\t\t//change draw delay\r\n\t\t\tif (this.sumaNewer > 12) this.serverClientSync.changeDrawDelay(-5);\r\n\t\t\tif (this.sumaNewer > 11) this.serverClientSync.changeDrawDelay(-4);\r\n\t\t\tif (this.sumaNewer > 10) this.serverClientSync.changeDrawDelay(-3);\r\n\t\t\tif (this.sumaNewer > 9) this.serverClientSync.changeDrawDelay(-1);\r\n\t\t\telse if (this.sumaNewer > 8) this.serverClientSync.changeDrawDelay(-0.5);\r\n\t\t\telse if (this.sumaNewer > 7) this.serverClientSync.changeDrawDelay(-0.2);\r\n\t\t\telse if (this.sumaNewer > 6) this.serverClientSync.changeDrawDelay(-0.1);\r\n\t\t\telse if (this.sumaNewer < 6) this.serverClientSync.changeDrawDelay(0.1);\r\n\t\t\telse if (this.sumaNewer < 5) this.serverClientSync.changeDrawDelay(0.2);\r\n\t\t\telse if (this.sumaNewer < 4) this.serverClientSync.changeDrawDelay(0.5);\r\n\t\t\telse if (this.sumaNewer < 3) this.serverClientSync.changeDrawDelay(1);\r\n\t\t\telse if (this.sumaNewer < 2) this.serverClientSync.changeDrawDelay(2);\r\n\t\t\telse if (this.sumaNewer < 1) this.serverClientSync.changeDrawDelay(3);\r\n\r\n\t\t\tthis.addSumaNewer(this.sumaNewer);\r\n\r\n\t\t\t//calc positions\r\n\t\t\tif (olderSnapshot && newerSnapshot) {\r\n\t\t\t\tconst timeDistance = newerSnapshot.t - olderSnapshot.t;\r\n\r\n\t\t\t\tconst distanceOlderFromWantedTime = wantedSnapshotTime - olderSnapshot.t;\r\n\t\t\t\tif (timeDistance) {\r\n\t\t\t\t\tpercentShift = distanceOlderFromWantedTime / timeDistance;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//deep copy!\r\n\t\t\t\tconst copyFrom = newerSnapshot;\r\n\t\t\t\t//slow copy\r\n\t\t\t\t//this.betweenSnapshots = JSON.parse(JSON.stringify(copyFrom));\r\n\r\n\t\t\t\t//fast copy\r\n\t\t\t\tthis.betweenSnapshot = {\r\n\t\t\t\t\tt: copyFrom.t,\r\n\t\t\t\t\ti: { ...copyFrom.i },\r\n\t\t\t\t\tp: [],\r\n\t\t\t\t\tb: [],\r\n\t\t\t\t\tg: [],\r\n\t\t\t\t\ts: [],\r\n\t\t\t\t\tz: { ...copyFrom.z },\r\n\t\t\t\t\tl: [],\r\n\t\t\t\t\to: []\r\n\t\t\t\t};\r\n\r\n\t\t\t\tfor (const player of copyFrom.p) {\r\n\t\t\t\t\tthis.betweenSnapshot.p.push({ ...player });\r\n\t\t\t\t}\r\n\t\t\t\tfor (const bullet of copyFrom.b) {\r\n\t\t\t\t\tthis.betweenSnapshot.b.push({ ...bullet });\r\n\t\t\t\t}\r\n\t\t\t\tfor (const granade of copyFrom.g) {\r\n\t\t\t\t\tthis.betweenSnapshot.g.push({ ...granade });\r\n\t\t\t\t}\r\n\t\t\t\tfor (const smoke of copyFrom.s) {\r\n\t\t\t\t\tthis.betweenSnapshot.s.push({ ...smoke });\r\n\t\t\t\t}\r\n\t\t\t\tfor (const loot of copyFrom.l) {\r\n\t\t\t\t\tthis.betweenSnapshot.l.push({ ...loot });\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//players\r\n\t\t\t\tfor (let i = 0; i < this.betweenSnapshot.p.length; i++) {\r\n\t\t\t\t\tconst player = this.betweenSnapshot.p[i];\r\n\t\t\t\t\tplayer.x = this.positionBetweenSnapshots(olderSnapshot.p[i].x, newerSnapshot.p[i].x, percentShift);\r\n\t\t\t\t\tplayer.y = this.positionBetweenSnapshots(olderSnapshot.p[i].y, newerSnapshot.p[i].y, percentShift);\r\n\t\t\t\t\t//hands\r\n\t\t\t\t\t//deny between snapshot...\r\n\t\t\t\t\tif (!player.h) {\r\n\t\t\t\t\t\tplayer.lX = this.positionBetweenSnapshots(\r\n\t\t\t\t\t\t\tolderSnapshot.p[i].lX,\r\n\t\t\t\t\t\t\tnewerSnapshot.p[i].lX,\r\n\t\t\t\t\t\t\tpercentShift\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tplayer.lY = this.positionBetweenSnapshots(\r\n\t\t\t\t\t\t\tolderSnapshot.p[i].lY,\r\n\t\t\t\t\t\t\tnewerSnapshot.p[i].lY,\r\n\t\t\t\t\t\t\tpercentShift\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tplayer.rX = this.positionBetweenSnapshots(\r\n\t\t\t\t\t\t\tolderSnapshot.p[i].rX,\r\n\t\t\t\t\t\t\tnewerSnapshot.p[i].rX,\r\n\t\t\t\t\t\t\tpercentShift\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tplayer.rY = this.positionBetweenSnapshots(\r\n\t\t\t\t\t\t\tolderSnapshot.p[i].rY,\r\n\t\t\t\t\t\t\tnewerSnapshot.p[i].rY,\r\n\t\t\t\t\t\t\tpercentShift\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//loot\r\n\t\t\t\tfor (const loot of this.betweenSnapshot.l) {\r\n\t\t\t\t\tlet olderLoot, newerLoot;\r\n\t\t\t\t\tfor (const older of olderSnapshot.l) {\r\n\t\t\t\t\t\tif (loot.i === older.i) {\r\n\t\t\t\t\t\t\tolderLoot = older;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (const newer of newerSnapshot.l) {\r\n\t\t\t\t\t\tif (loot.i === newer.i) {\r\n\t\t\t\t\t\t\tnewerLoot = newer;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (olderLoot && newerLoot) {\r\n\t\t\t\t\t\tloot.x = this.positionBetweenSnapshots(olderLoot.x, newerLoot.x, percentShift);\r\n\t\t\t\t\t\tloot.y = this.positionBetweenSnapshots(olderLoot.y, newerLoot.y, percentShift);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//zone\r\n\t\t\t\tthis.betweenSnapshot.z.oR = this.positionBetweenSnapshots(\r\n\t\t\t\t\tolderSnapshot.z.oR,\r\n\t\t\t\t\tnewerSnapshot.z.oR,\r\n\t\t\t\t\tpercentShift\r\n\t\t\t\t);\r\n\t\t\t\tthis.betweenSnapshot.z.oX = this.positionBetweenSnapshots(\r\n\t\t\t\t\tolderSnapshot.z.oX,\r\n\t\t\t\t\tnewerSnapshot.z.oX,\r\n\t\t\t\t\tpercentShift\r\n\t\t\t\t);\r\n\t\t\t\tthis.betweenSnapshot.z.oY = this.positionBetweenSnapshots(\r\n\t\t\t\t\tolderSnapshot.z.oY,\r\n\t\t\t\t\tnewerSnapshot.z.oY,\r\n\t\t\t\t\tpercentShift\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.updatePlayers();\r\n\t\tthis.updateZone();\r\n\t}\r\n\r\n\tprivate updatePlayers(): void {\r\n\t\tif (!this.betweenSnapshot) return;\r\n\t\tfor (const playerSnapshot of this.betweenSnapshot.p) {\r\n\t\t\tlet playerExists = false;\r\n\t\t\tfor (const playerInstance of this.players) {\r\n\t\t\t\tif (playerInstance.id === playerSnapshot.i) {\r\n\t\t\t\t\t//update player\r\n\t\t\t\t\tplayerInstance.setX(playerSnapshot.x);\r\n\t\t\t\t\tplayerInstance.setY(playerSnapshot.y);\r\n\t\t\t\t\tplayerInstance.setAngle(playerSnapshot.a);\r\n\t\t\t\t\tplayerInstance.setWeapon(playerSnapshot.w);\r\n\t\t\t\t\tplayerInstance.setHammerAngle(playerSnapshot.m);\r\n\t\t\t\t\tif (playerSnapshot.l === 0) playerInstance.die();\r\n\t\t\t\t\t//hands\r\n\t\t\t\t\tplayerInstance.hands[0].setX(playerSnapshot.lX);\r\n\t\t\t\t\tplayerInstance.hands[0].setY(playerSnapshot.lY);\r\n\t\t\t\t\tplayerInstance.hands[1].setX(playerSnapshot.rX);\r\n\t\t\t\t\tplayerInstance.hands[1].setY(playerSnapshot.rY);\r\n\t\t\t\t\tplayerExists = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!playerExists) {\r\n\t\t\t\t//create player\r\n\t\t\t\tthis.players.push(new Player(playerSnapshot));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate positionBetweenSnapshots(olderPosition: number, newerPosition: number, percentShift: number): number {\r\n\t\tconst diference = Math.abs(newerPosition - olderPosition);\r\n\t\tlet direction = 1;\r\n\t\tif (newerPosition < olderPosition) direction = -1;\r\n\t\treturn olderPosition + diference * direction * percentShift;\r\n\t}\r\n}\r\n","import { Keys, Mouse } from './Controller';\r\nimport Socket from './Socket';\r\nimport View from './View';\r\nimport Player from './Player';\r\nimport Map from './Map';\r\nimport WaterTerrainData from './WaterTerrainData';\r\nimport Bullet from './Bullet';\r\nimport ServerClientSync from './ServerClientSync';\r\nimport { Snapshot } from './Snapshot';\r\nimport MyHtmlElements from './MyHtmlElements';\r\nimport Editor from './Editor';\r\nimport CollisionPoints from './CollisionPoints';\r\nimport SnapshotManager from './SnapshotManager';\r\n\r\nexport default class Model {\r\n\tprivate spectate: boolean = false;\r\n\tprivate gameRun: boolean = false;\r\n\tprivate gameId: number = -1;\r\n\tprivate playerId: number = -1;\r\n\tprivate name: string;\r\n\tview: View;\r\n\tprivate socket: Socket;\r\n\tprivate waterTerrainData: WaterTerrainData;\r\n\tprivate keys: Keys;\r\n\tprivate mouse: Mouse;\r\n\tmap: Map;\r\n\tprivate serverClientSync: ServerClientSync;\r\n\tsnapshotManager: SnapshotManager;\r\n\tprivate myHtmlElements: MyHtmlElements;\r\n\tprivate editor: Editor;\r\n\tcollisionPoints: CollisionPoints;\r\n\r\n\tconstructor(\r\n\t\tkeys: Keys,\r\n\t\tmouse: Mouse,\r\n\t\tsocket: Socket,\r\n\t\tserverClientSync: ServerClientSync,\r\n\t\tmyHtmlElements: MyHtmlElements,\r\n\t\teditor: Editor\r\n\t) {\r\n\t\tthis.socket = socket;\r\n\t\tthis.serverClientSync = serverClientSync;\r\n\t\tthis.waterTerrainData = new WaterTerrainData();\r\n\t\tthis.map = new Map(this.waterTerrainData);\r\n\t\tthis.snapshotManager = new SnapshotManager(serverClientSync, this.map);\r\n\t\tthis.keys = keys;\r\n\t\tthis.mouse = mouse;\r\n\t\tthis.myHtmlElements = myHtmlElements;\r\n\t\tthis.editor = editor;\r\n\t\tthis.collisionPoints = new CollisionPoints();\r\n\t\tthis.view = new View(\r\n\t\t\tthis.map,\r\n\t\t\tthis.mouse,\r\n\t\t\tthis.waterTerrainData,\r\n\t\t\tthis.serverClientSync,\r\n\t\t\tthis.myHtmlElements,\r\n\t\t\tthis.collisionPoints,\r\n\t\t\tthis.snapshotManager\r\n\t\t);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.loop();\r\n\t\t}, 200);\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\t\tel.close(el.gameOverMenu.main);\r\n\t\tel.open(el.mainMenu.main, el.hideGame);\r\n\t\tel.gameOverMenu.stats.innerHTML = '';\r\n\t\tthis.gameRun = false;\r\n\t\tthis.gameId = -1;\r\n\t\tthis.playerId = -1;\r\n\t\tthis.map.reset();\r\n\t\tthis.snapshotManager.reset();\r\n\t\tthis.view.reset();\r\n\t\tthis.spectate = false;\r\n\t}\r\n\r\n\tstop(): void {\r\n\t\tthis.gameRun = false;\r\n\t}\r\n\r\n\tisNameOk(name: string): boolean {\r\n\t\tlet state = false;\r\n\t\tconst allowedCharacters: string = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ';\r\n\t\tconst nameMaxLength: number = 20;\r\n\t\tif (typeof name === 'string') {\r\n\t\t\tif (name.length > 0 && name.length <= nameMaxLength) {\r\n\t\t\t\t//nepovolené znaky v jménu?\r\n\t\t\t\tlet notAllowedCharacter = false;\r\n\t\t\t\tfor (let i = 0; i < name.length; i++) {\r\n\t\t\t\t\tif (allowedCharacters.lastIndexOf(name[i]) === -1) {\r\n\t\t\t\t\t\tnotAllowedCharacter = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t//v jmenu nejsou nepovolene znaky\r\n\t\t\t\tif (!notAllowedCharacter) {\r\n\t\t\t\t\tstate = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn state;\r\n\t}\r\n\r\n\tstartSpectate(): void {\r\n\t\tthis.spectate = true;\r\n\t}\r\n\r\n\tgetSpectate(): boolean {\r\n\t\treturn this.spectate;\r\n\t}\r\n\r\n\tsetName(name: string): void {\r\n\t\tthis.name = name;\r\n\t}\r\n\r\n\tgetName(): string {\r\n\t\treturn this.name;\r\n\t}\r\n\r\n\tgetGameId(): number {\r\n\t\treturn this.gameId;\r\n\t}\r\n\r\n\tsetGameId(gameId: number): void {\r\n\t\tthis.gameId = gameId;\r\n\t}\r\n\r\n\tgetPlayerId(): number {\r\n\t\treturn this.playerId;\r\n\t}\r\n\r\n\tsetPlayerId(playerId: number): void {\r\n\t\tthis.playerId = playerId;\r\n\t\tconsole.log('playerId:', playerId);\r\n\t}\r\n\r\n\tgameStart(): void {\r\n\t\tthis.gameRun = true;\r\n\t}\r\n\r\n\tgameActive(): boolean {\r\n\t\treturn this.gameRun;\r\n\t}\r\n\tprivate loop(): void {\r\n\t\t//repeat\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tthis.loop();\r\n\t\t});\r\n\t\tif (this.editor.isActive()) {\r\n\t\t\tthis.view.drawEditor(this.editor);\r\n\t\t}\r\n\t\tif (!this.gameRun) return;\r\n\t\t//sync\r\n\t\tif (!this.serverClientSync.ready()) {\r\n\t\t\tthis.socket.emit('serverClientSync', Date.now());\r\n\t\t}\r\n\t\tthis.snapshotManager.createBetweenSnapshot();\r\n\t\tthis.view.drawGame(this.playerId);\r\n\t}\r\n}\r\n","export default class ServerClientSync {\r\n\tprivate ping: number = 0;\r\n\tprivate pings: number[] = [];\r\n\tprivate timeDiference: number = 0;\r\n\tprivate timeDiferences: number[] = [];\r\n\tprivate readonly attempts: number = 3;\r\n\tprivate readonly defaultDrawDelay: number = 100;\r\n\tprivate drawDelay: number = this.defaultDrawDelay;\r\n\r\n\tconstructor() {}\r\n\r\n\tgetPing(): number {\r\n\t\treturn this.ping;\r\n\t}\r\n\r\n\tgetTimeDiference(): number {\r\n\t\treturn this.timeDiference;\r\n\t}\r\n\r\n\tready(): boolean {\r\n\t\t//return this.ping != null && this.timeDiference != null;\r\n\t\treturn this.pings.length === this.attempts;\r\n\t}\r\n\r\n\treset(): void {\r\n\t\t//this.ping = null;\r\n\t\tthis.pings = [];\r\n\t\t//this.timeDiference = null;\r\n\t\tthis.timeDiferences = [];\r\n\t}\r\n\r\n\taddData(ping: number, timeDiference: number): void {\r\n\t\tif (!this.ready()) {\r\n\t\t\tthis.pings.push(ping);\r\n\t\t\tthis.timeDiferences.push(timeDiference);\r\n\t\t}\r\n\t\t//count average\r\n\t\tif (this.pings.length === this.attempts) {\r\n\t\t\tlet pingsSuma = 0;\r\n\t\t\tfor (const ping of this.pings) {\r\n\t\t\t\tpingsSuma += ping;\r\n\t\t\t}\r\n\t\t\tthis.ping = pingsSuma / this.attempts;\r\n\t\t\tlet timeDiferenceSuma = 0;\r\n\t\t\tfor (const timeDiference of this.timeDiferences) {\r\n\t\t\t\ttimeDiferenceSuma += timeDiference;\r\n\t\t\t}\r\n\t\t\tthis.timeDiference = timeDiferenceSuma / this.attempts;\r\n\t\t}\r\n\t}\r\n\r\n\tchangeDrawDelay(change: number): void {\r\n\t\tthis.drawDelay += change;\r\n\t\t//if (this.drawDelay < this.minDrawDelay) this.drawDelay = this.minDrawDelay;\r\n\t}\r\n\r\n\tgetDrawDelay(): number {\r\n\t\treturn this.drawDelay;\r\n\t}\r\n\r\n\tgetServerTime(): number {\r\n\t\tlet serverTime = Date.now();\r\n\t\tif (this.ready()) {\r\n\t\t\tserverTime += this.getTimeDiference();\r\n\t\t}\r\n\t\treturn serverTime;\r\n\t}\r\n}\r\n","export default class MyHtmlElements {\r\n\treadonly gameScreen: HTMLElement;\r\n\treadonly mapScreen: HTMLElement;\r\n\treadonly mapContainer: HTMLElement;\r\n\treadonly zoneTimer: HTMLElement;\r\n\treadonly helperScreen: HTMLElement;\r\n\treadonly zoneSVG: HTMLElement;\r\n\treadonly zoneCircle: HTMLElement;\r\n\treadonly zoneRect: HTMLElement;\r\n\treadonly mapZoneSVG: HTMLElement;\r\n\treadonly mapZoneCircle: HTMLElement;\r\n\treadonly takeLoot: HTMLElement;\r\n\treadonly transparentLayer: HTMLElement;\r\n\treadonly activeGunAmmo: HTMLElement;\r\n\treadonly alive: HTMLElement;\r\n\treadonly messages: HTMLElement;\r\n\treadonly spectate: HTMLElement;\r\n\treadonly spectateName: HTMLElement;\r\n\treadonly hideGame: HTMLElement;\r\n\r\n\t//<div id=\"healthBar\"><div id=\"healthBarIn\"></div></div>\r\n\treadonly healthBar = {\r\n\t\tmain: document.getElementById('healthBar'),\r\n\t\tin: document.getElementById('healthBarIn')\r\n\t};\r\n\r\n\treadonly items = {\r\n\t\tredAmmo: document.getElementById('redAmmo'),\r\n\t\tgreenAmmo: document.getElementById('greenAmmo'),\r\n\t\tblueAmmo: document.getElementById('blueAmmo'),\r\n\t\torangeAmmo: document.getElementById('orangeAmmo'),\r\n\t\titem1: document.getElementById('item1'),\r\n\t\titem2: document.getElementById('item2'),\r\n\t\titem3: document.getElementById('item3'),\r\n\t\titem4: document.getElementById('item4'),\r\n\t\titem5: document.getElementById('item5'),\r\n\t\titem1in: document.getElementById('item1').getElementsByTagName('span')[0],\r\n\t\titem2in: document.getElementById('item2').getElementsByTagName('span')[0],\r\n\t\titem3in: document.getElementById('item3').getElementsByTagName('span')[0],\r\n\t\titem4in: document.getElementById('item4').getElementsByTagName('span')[0],\r\n\t\titem5in: document.getElementById('item5').getElementsByTagName('span')[0],\r\n\t\titem1Ammo: document.getElementById('item1Ammo'),\r\n\t\titem2Ammo: document.getElementById('item2Ammo'),\r\n\t\tscope: document.getElementById('scope'),\r\n\t\tscope2: document.getElementById('scope2'),\r\n\t\tscope4: document.getElementById('scope4'),\r\n\t\tscope6: document.getElementById('scope6'),\r\n\t\tscopeSVG: document.getElementById('scope').getElementsByTagName('img')[0],\r\n\t\tvest: document.getElementById('vest')\r\n\t};\r\n\r\n\treadonly editor = {\r\n\t\tcoordinates: document.getElementById('editorCoordinates'),\r\n\t\tcontainer: document.getElementById('editorContainer'),\r\n\t\tscreen: document.getElementById('editorScreen'),\r\n\t\tterrainImgs: document.getElementById('editorTerrainImgs'),\r\n\t\tterrainWater: document.getElementById('terrainWater'),\r\n\t\tterrainGrass: document.getElementById('terrainGrass'),\r\n\t\tterrainWaterTriangle1: document.getElementById('terrainWaterTriangle1'),\r\n\t\tterrainWaterTriangle2: document.getElementById('terrainWaterTriangle2'),\r\n\t\tterrainWaterTriangle3: document.getElementById('terrainWaterTriangle3'),\r\n\t\tterrainWaterTriangle4: document.getElementById('terrainWaterTriangle4'),\r\n\t\tobjectImgs: document.getElementById('editorObjectImgs'),\r\n\t\tobjectBush: document.getElementById('editorObjectBush'),\r\n\t\tobjectRock: document.getElementById('editorObjectRock'),\r\n\t\tobjectTree: document.getElementById('editorObjectTree'),\r\n\t\tobjectRect: document.getElementById('editorObjectRect'),\r\n\t\tobjectDelete: document.getElementById('editorObjectDelete'),\r\n\t\topenMenu: document.getElementById('editorOpenMenu')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"saveMapMenu\">\r\n        <h1>Saved</h1>\r\n        <button id=\"saveMapMenuBack\">Back to main menu</button>\r\n\t</div>\r\n\t*/\r\n\treadonly saveMapMenu = {\r\n\t\tmain: document.getElementById('saveMapMenu'),\r\n\t\tback: document.getElementById('saveMapMenuBack')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"mapEditorMenu\">\r\n\t\t<h1>Map editor</h1>\r\n\t\t<input id=\"mapEditorMenuName\" type=\"text\" maxlength=\"20\" placeholder=\"Map name\" value=\"\" autocomplete=\"off\">\r\n\t\t<button id=\"mapEditorMenuSave\">Save</button>\r\n\t\t<button id=\"mapEditorMenuChangeSize\">Change map size</button>\r\n\t\t<button id=\"mapEditorMenuBack\">Back</button>\r\n\t\t<button id=\"mapEditorMenuClose\">Close editor</button>\r\n\t</div>\r\n\t*/\r\n\r\n\t/*\r\n\t\r\n\t<div class=\"menu\" id=\"gameOverMenu\">\r\n\t\t<h1 id=\"gameOverMenuH1\">You win!</h1>\r\n\t\t<div id=\"gameOverMenuStats\">\r\n\t\t\t\r\n\t\t</div>\r\n\t\t<button id=\"gameOverMenuspectate\">spectate</button>\r\n        <button id=\"gameOverMenuBack\">Main menu</button>\r\n\t</div>\r\n\t*/\r\n\r\n\treadonly gameOverMenu = {\r\n\t\tmain: document.getElementById('gameOverMenu'),\r\n\t\tback: document.getElementById('gameOverMenuBack'),\r\n\t\th1: document.getElementById('gameOverMenuH1'),\r\n\t\tstats: document.getElementById('gameOverMenuStats'),\r\n\t\tspectate: document.getElementById('gameOverMenuspectate')\r\n\t};\r\n\r\n\treadonly mapEditorMenu = {\r\n\t\tmain: document.getElementById('mapEditorMenu'),\r\n\t\tname: document.getElementById('mapEditorMenuName'),\r\n\t\tsave: document.getElementById('mapEditorMenuSave'),\r\n\t\tchangeSize: document.getElementById('mapEditorMenuChangeSize'),\r\n\t\tback: document.getElementById('mapEditorMenuBack'),\r\n\t\tclose: document.getElementById('mapEditorMenuClose')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"alertMenu\">\r\n\t\t<h1>Not allowed character!</h1>\r\n\t\t<p>Please change that name.</p>\r\n\t\t<p>Allowed characters:</p>\r\n\t\t<p><b>abcdefghijklmnopqrstuvwxyz</b><br /><b>ABCDEFGHIJKLMNOPQRSTUVWXYZ</b><br /><b>0123456789</b><br /> and <b>space</b></p>\r\n\t\t<button id=\"alertMenuOk\">OK</button>\r\n\t</div>\r\n\t*/\r\n\r\n\treadonly alertMenu = {\r\n\t\tmain: document.getElementById('alertMenu'),\r\n\t\tok: document.getElementById('alertMenuOk')\r\n\t};\r\n\r\n\t/*<div class=\"menu\" id=\"openMapMenu\">\r\n        <h1>Open map</h1>\r\n        <select id=\"openMapMenuMaps\"></select>\r\n        <button id=\"openMapMenuOk\">OK</button>\r\n        <button id=\"openMapMenuBack\">Back</button>\r\n\t</div>*/\r\n\r\n\treadonly openMapMenu = {\r\n\t\tmain: document.getElementById('openMapMenu'),\r\n\t\tmaps: document.getElementById('openMapMenuMaps'),\r\n\t\tok: document.getElementById('openMapMenuOk'),\r\n\t\tback: document.getElementById('openMapMenuBack')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"controlsMenu\">\r\n        <h1>Game controls</h1>\r\n        <p>Move: <b>A, W, S, D</b>.</p>\r\n        <p>Hit / Shoot: <b>Mouse</b>.</p>\r\n        <button id=\"controlsMenuBack\">Back</button>\r\n\t</div>\r\n\t*/\r\n\r\n\treadonly controlsMenu = {\r\n\t\tmain: document.getElementById('controlsMenu'),\r\n\t\tback: document.getElementById('controlsMenuBack')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"mainMenu\">\r\n\t\t<h1>Mini battle royale</h1>\r\n\t\t<!--<p id=\"mainMenuIp\">+</p>-->\r\n\t\t<input id=\"mainMenuName\" type=\"text\" maxlength=\"20\" placeholder=\"Your name\" value=\"\" autocomplete=\"off\" autofocus>\r\n\t\t<div class =\"join\">\r\n\t\t\t<h2>Join</h2>\r\n\t\t\t<select id=\"mainMenuGames\" disabled></select>\r\n\t\t\t<button id=\"mainMenuJoin\" disabled>Join</button>\r\n\t\t</div>\r\n\t\t<div class =\"create\">\r\n\t\t\t<h2>Create</h2>\r\n\t\t\t<select id=\"mainMenuMaps\"></select>\r\n\t\t\t<button id=\"mainMenuCreate\" disabled>Create</button>\r\n\t\t</div>\r\n\t\t<button id=\"mainMenuOpenEditor\">Map editor</button>\r\n\t\t<button id=\"mainMenuControls\">Game controls</button>\r\n\t</div>\r\n\t*/\r\n\r\n\treadonly mainMenu = {\r\n\t\tmain: document.getElementById('mainMenu'),\r\n\t\tip: document.getElementById('mainMenuIp'),\r\n\t\tname: document.getElementById('mainMenuName'),\r\n\t\tgames: document.getElementById('mainMenuGames'),\r\n\t\tjoin: document.getElementById('mainMenuJoin'),\r\n\t\tmaps: document.getElementById('mainMenuMaps'),\r\n\t\tcreate: document.getElementById('mainMenuCreate'),\r\n\t\topenEditor: document.getElementById('mainMenuOpenEditor'),\r\n\t\tcontrols: document.getElementById('mainMenuControls')\r\n\t};\r\n\t/*\r\n\t<div class=\"menu\" id=\"gameCanceledMenu\">\r\n\t\t<h1>Game canceled</h1>\r\n\t\t<p>Your game has been canceled.</p>\r\n\t\t<button id=\"gameCanceledMenuBack\">Back to main menu</button>\r\n\t</div>\r\n\t*/\r\n\treadonly gameCanceledMenu = {\r\n\t\tmain: document.getElementById('cancelLobbyMenu'),\r\n\t\tback: document.getElementById('cancelLobbyMenuBack')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"mapSizeMenu\">\r\n\t\t\t<h1>Map size</h1>\r\n\t\t\t<p>Size [blocks]</p>\r\n\t\t\t<select id=\"mapSizeValue\">\r\n\t\t\t\t<option value=\"1\">1</option>\r\n\t\t\t\t<option value=\"2\">2</option>\r\n\t\t\t\t<option value=\"3\">3</option>\r\n\t\t\t\t<option value=\"4\">4</option>\r\n\t\t\t\t<option value=\"5\" selected>5</option>\r\n\t\t\t\t<option value=\"6\">6</option>\r\n\t\t\t\t<option value=\"7\">7</option>\r\n\t\t\t\t<option value=\"8\">8</option>\r\n\t\t\t\t<option value=\"9\">9</option>\r\n\t\t\t\t<option value=\"10\">10</option>\r\n\t\t\t</select>\r\n\t\t\t<p>\r\n\t\t\t\t<button id=\"mapSizeOk\">OK</button>\r\n\t\t\t\t<button id=\"mapSizeBack\">Back</button>\r\n\t\t\t</p>\r\n\t</div>\r\n\t*/\r\n\treadonly mapSizeMenu = {\r\n\t\tmain: document.getElementById('mapSizeMenu'),\r\n\t\tvalue: document.getElementById('mapSizeValue'),\r\n\t\tok: document.getElementById('mapSizeOk'),\r\n\t\tback: document.getElementById('mapSizeBack')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"mapMenu\">\r\n        <h1>Map editor</h1>\r\n        <button id=\"mapMenuCreate\">Create a new map</button>\r\n        <button id=\"mapMenuOpenMap\">Open the created maps</button>\r\n        <button id=\"mapMenuBack\">Back</button>\r\n\t</div>\r\n\t*/\r\n\r\n\treadonly mapMenu = {\r\n\t\tmain: document.getElementById('mapMenu'),\r\n\t\tcreate: document.getElementById('mapMenuCreate'),\r\n\t\topen: document.getElementById('mapMenuOpenMap'),\r\n\t\tback: document.getElementById('mapMenuBack')\r\n\t};\r\n\r\n\t/**\r\n\t <div class=\"menu\" id=\"lobbyMenu\">\r\n\t\t<h1 id=\"lobbyMenuGameName\"></h1>\r\n\t\t<ul id=\"lobbyMenuPlayers\"></ul>\r\n\t\t<div id=\"lobbyMenuForJoinPlayer\">\r\n\t\t\t<p>Waiting for players...</p>\r\n\t\t\t<button id=\"lobbyMenuLeave\">Leave the game</button>\r\n\t\t</div>\r\n\t\t<div id=\"lobbyMenuForCreatePlayer\">\r\n\t\t\t<button id=\"lobbyMenuStart\">Launch the game</button>\r\n\t\t\t<button id=\"lobbyMenuCancel\">Cancel the game</button>\r\n\t\t</div>\r\n\t</div>\t\t\r\n\t*/\r\n\treadonly lobbyMenu = {\r\n\t\tmain: document.getElementById('lobbyMenu'),\r\n\t\tgameName: document.getElementById('lobbyMenuGameName'),\r\n\t\tplayers: document.getElementById('lobbyMenuPlayers'),\r\n\t\tforJoinPlayers: document.getElementById('lobbyMenuForJoinPlayer'),\r\n\t\tleave: document.getElementById('lobbyMenuLeave'),\r\n\t\tforCreatePlayer: document.getElementById('lobbyMenuForCreatePlayer'),\r\n\t\tstart: document.getElementById('lobbyMenuStart'),\r\n\t\tcancel: document.getElementById('lobbyMenuCancel')\r\n\t};\r\n\r\n\treadonly loading = {\r\n\t\tmain: document.getElementById('loading'),\r\n\t\tcounter: document.getElementById('loadingCounter'),\r\n\t\tcircle: document.getElementById('loadingCircle'),\r\n\t\ttext: document.getElementById('loadingText')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"escFromGame\">\r\n\t\t<h1>Leave game?</h1>\r\n\t\t<button id=\"escFromGameBack\">Back to the game</button>\r\n        <button id=\"escFromGameLeave\">Leave the game</button>\r\n\t</div>\r\n\t*/\r\n\treadonly escFromGameMenu = {\r\n\t\tmain: document.getElementById('escFromGame'),\r\n\t\tback: document.getElementById('escFromGameBack'),\r\n\t\tleave: document.getElementById('escFromGameLeave')\r\n\t};\r\n\r\n\tconstructor() {\r\n\t\tthis.gameScreen = document.getElementById('gameScreen');\r\n\t\tthis.mapScreen = document.getElementById('mapScreen');\r\n\t\tthis.helperScreen = document.getElementById('helperScreen');\r\n\t\tthis.zoneSVG = document.getElementById('zoneSVG');\r\n\t\tthis.zoneCircle = document.getElementById('zoneCircle');\r\n\t\tthis.zoneRect = document.getElementById('zoneRect');\r\n\t\tthis.mapZoneSVG = document.getElementById('mapZoneSVG');\r\n\t\tthis.mapZoneCircle = document.getElementById('mapZoneCircle');\r\n\t\tthis.takeLoot = document.getElementById('takeLoot');\r\n\t\tthis.transparentLayer = document.getElementById('transparentLayer');\r\n\t\tthis.activeGunAmmo = document.getElementById('activeGunAmmo');\r\n\t\tthis.mapContainer = document.getElementById('mapContainer');\r\n\t\tthis.alive = document.getElementById('alive');\r\n\t\tthis.messages = document.getElementById('messages');\r\n\t\tthis.zoneTimer = document.getElementById('zoneTimer');\r\n\t\tthis.spectate = document.getElementById('spectate');\r\n\t\tthis.spectateName = document.getElementById('spectateName');\r\n\t\tthis.hideGame = document.getElementById('hideGame');\r\n\t}\r\n\r\n\tclose(...elements: HTMLElement[]): void {\r\n\t\tfor (const element of elements) {\r\n\t\t\telement.style.display = 'none';\r\n\t\t}\r\n\t}\r\n\r\n\topen(...elements: HTMLElement[]): void {\r\n\t\tfor (const element of elements) {\r\n\t\t\telement.style.display = 'block';\r\n\t\t}\r\n\t}\r\n}\r\n","import { Terrain } from './Terrain';\r\nimport RectangleObstacle from './RectangleObstacle';\r\nimport Bush from './Bush';\r\nimport Rock from './Rock';\r\nimport Tree from './Tree';\r\n\r\nexport default class MapData {\r\n\tsize: number;\r\n\tblockSize: number;\r\n\tterrains: Terrain[];\r\n\trects: RectangleObstacle[];\r\n\tbushes: Bush[];\r\n\trocks: Rock[];\r\n\ttrees: Tree[];\r\n\r\n\tconstructor(\r\n\t\tsize: number,\r\n\t\tblockSize: number,\r\n\t\tterrains: Terrain[],\r\n\t\trects: RectangleObstacle[],\r\n\t\tbushes: Bush[],\r\n\t\trocks: Rock[],\r\n\t\ttrees: Tree[]\r\n\t) {\r\n\t\tthis.size = size;\r\n\t\tthis.blockSize = blockSize;\r\n\t\tthis.terrains = terrains;\r\n\t\tthis.rects = rects;\r\n\t\tthis.bushes = bushes;\r\n\t\tthis.rocks = rocks;\r\n\t\tthis.trees = trees;\r\n\t}\r\n}\r\n","import { Terrain, TerrainType } from './Terrain';\r\nimport MyHtmlElements from './MyHtmlElements';\r\nimport { Mouse } from './Controller';\r\nimport Bush from './Bush';\r\nimport Rock from './Rock';\r\nimport Tree from './Tree';\r\nimport Wall from './Wall';\r\nimport Socket from './Socket';\r\nimport Colors from './Colors';\r\nimport MapData from './MapData';\r\n\r\nexport default class Editor {\r\n\tprivate terrainType: TerrainType | null;\r\n\tprivate objectType: string | null;\r\n\tbush: Bush;\r\n\trock: Rock;\r\n\ttree: Tree;\r\n\tprivate x: number;\r\n\tprivate y: number;\r\n\tprivate active: boolean = false;\r\n\tprivate name: string;\r\n\tprivate size: number;\r\n\treadonly blockSize: number = 300;\r\n\tterrains: Terrain[] = [];\r\n\tbushes: Bush[] = [];\r\n\trocks: Rock[] = [];\r\n\ttrees: Tree[] = [];\r\n\twalls: Wall[] = [];\r\n\tprivate objects: any[] = [];\r\n\tprivate myHtmlElements: MyHtmlElements;\r\n\tprivate socket: Socket;\r\n\tprivate colors: Colors;\r\n\r\n\tconstructor(myHtmlElements: MyHtmlElements, socket: Socket) {\r\n\t\tthis.myHtmlElements = myHtmlElements;\r\n\t\tthis.socket = socket;\r\n\t\tthis.colors = new Colors();\r\n\t\tthis.bush = new Bush(0, 0, 0);\r\n\t\tthis.rock = new Rock(0, 0, 0);\r\n\t\tthis.tree = new Tree(0, 0, 0);\r\n\t\tthis.controller();\r\n\t}\r\n\r\n\tisActive(): boolean {\r\n\t\treturn this.active;\r\n\t}\r\n\r\n\tclose(): void {\r\n\t\tthis.active = false;\r\n\t}\r\n\r\n\tgetTerrainType(): TerrainType | null {\r\n\t\treturn this.terrainType;\r\n\t}\r\n\r\n\tgetObjectType(): string | null {\r\n\t\treturn this.objectType;\r\n\t}\r\n\r\n\tgetSize(): number {\r\n\t\treturn this.size;\r\n\t}\r\n\r\n\tgetX(): number {\r\n\t\treturn this.x;\r\n\t}\r\n\r\n\tgetY(): number {\r\n\t\treturn this.y;\r\n\t}\r\n\r\n\tgetMapData(): MapData {\r\n\t\treturn new MapData(this.size, this.blockSize, this.terrains, this.walls, this.bushes, this.rocks, this.trees);\r\n\t}\r\n\r\n\tcreate(): void {\r\n\t\tthis.cleanMap();\r\n\t}\r\n\r\n\tchangeSize(size: number): void {\r\n\t\tthis.active = true;\r\n\t\tconst el = this.myHtmlElements;\r\n\t\tthis.size = size;\r\n\t\t(<HTMLCanvasElement>el.editor.screen).width = size * this.blockSize;\r\n\t\t(<HTMLCanvasElement>el.editor.screen).height = size * this.blockSize;\r\n\t\tconst widthString = (size * this.blockSize).toString();\r\n\t\tel.editor.screen.style.width = widthString;\r\n\t\tconst heightString = (size * this.blockSize).toString();\r\n\t\tel.editor.screen.style.width = heightString;\r\n\t\tthis.cleanMapAfterChangeSize();\r\n\t}\r\n\r\n\tprivate cleanMap(): void {\r\n\t\tthis.terrains = [];\r\n\t\tthis.bushes = [];\r\n\t\tthis.rocks = [];\r\n\t\tthis.trees = [];\r\n\t\tthis.walls = [];\r\n\t}\r\n\r\n\tprivate cleanMapAfterChangeSize(): void {\r\n\t\tconst mapSize = this.size * this.blockSize;\r\n\t\tlet arr: any = this.terrains;\r\n\t\tfor (let i = arr.length - 1; i >= 0; i--) {\r\n\t\t\tconst item = arr[i];\r\n\t\t\tif (item.x >= mapSize || item.y >= mapSize) {\r\n\t\t\t\tarr.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tarr = this.trees;\r\n\t\tfor (let i = arr.length - 1; i >= 0; i--) {\r\n\t\t\tconst item = arr[i];\r\n\t\t\tif (item.x >= mapSize || item.y >= mapSize) {\r\n\t\t\t\tarr.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tarr = this.rocks;\r\n\t\tfor (let i = arr.length - 1; i >= 0; i--) {\r\n\t\t\tconst item = arr[i];\r\n\t\t\tif (item.x >= mapSize || item.y >= mapSize) {\r\n\t\t\t\tarr.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tarr = this.bushes;\r\n\t\tfor (let i = arr.length - 1; i >= 0; i--) {\r\n\t\t\tconst item = arr[i];\r\n\t\t\tif (item.x >= mapSize || item.y >= mapSize) {\r\n\t\t\t\tarr.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tarr = this.walls;\r\n\t\tfor (let i = arr.length - 1; i >= 0; i--) {\r\n\t\t\tconst item = arr[i];\r\n\t\t\tif (item.x >= mapSize || item.y >= mapSize) {\r\n\t\t\t\tarr.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate openMap(mapData: MapData): void {\r\n\t\tthis.create();\r\n\t\tthis.changeSize(mapData.size);\r\n\t\tlet id = 0;\r\n\t\tfor (const item of mapData.rocks) {\r\n\t\t\tthis.rocks.push(new Rock(id++, item.x, item.y));\r\n\t\t}\r\n\t\tfor (const item of mapData.trees) {\r\n\t\t\tthis.trees.push(new Tree(id++, item.x, item.y));\r\n\t\t}\r\n\t\tfor (const item of mapData.bushes) {\r\n\t\t\tthis.bushes.push(new Bush(id++, item.x, item.y));\r\n\t\t}\r\n\t\tfor (const item of mapData.rects) {\r\n\t\t\tthis.walls.push(new Wall(id++, item.x, item.y, item.width, item.height));\r\n\t\t}\r\n\t\tfor (const item of mapData.terrains) {\r\n\t\t\tthis.terrains.push(new Terrain(item.type, item.x, item.y, item.size));\r\n\t\t}\r\n\t\tthis.cleanMapAfterChangeSize();\r\n\t}\r\n\r\n\tcontroller(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\t\t//editorScreen mouse move\r\n\t\tel.editor.screen.addEventListener('mousemove', (e: MouseEvent) => {\r\n\t\t\tconst canvasRect = el.editor.screen.getBoundingClientRect();\r\n\t\t\tthis.x = e.clientX + el.editor.screen.scrollLeft - canvasRect.left;\r\n\t\t\tthis.y = e.clientY + el.editor.screen.scrollTop - canvasRect.top;\r\n\t\t\tel.editor.coordinates.innerText = `x: ${this.x} y: ${this.y}`;\r\n\t\t});\r\n\r\n\t\t//choose terrain type\r\n\t\tel.editor.terrainImgs.addEventListener('click', (e: MouseEvent) => {\r\n\t\t\tconst terrainImgs = el.editor.terrainImgs.children;\r\n\t\t\tfor (let i = 0; i < terrainImgs.length; i++) {\r\n\t\t\t\t(<HTMLElement>terrainImgs[i]).style.borderColor = this.colors.blockFrame;\r\n\t\t\t}\r\n\t\t\tconst objectImgs = el.editor.objectImgs.children;\r\n\t\t\tfor (let i = 0; i < objectImgs.length; i++) {\r\n\t\t\t\t(<HTMLElement>objectImgs[i]).style.borderColor = this.colors.blockFrame;\r\n\t\t\t}\r\n\t\t\t(<HTMLElement>e.target).style.borderColor = this.colors.blockFrameActive;\r\n\t\t\tthis.objectType = null;\r\n\t\t\tswitch (e.target) {\r\n\t\t\t\tcase el.editor.terrainWater:\r\n\t\t\t\t\tthis.terrainType = TerrainType.Water;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.terrainGrass:\r\n\t\t\t\t\tthis.terrainType = TerrainType.Grass;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.terrainWaterTriangle1:\r\n\t\t\t\t\tthis.terrainType = TerrainType.WaterTriangle1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.terrainWaterTriangle2:\r\n\t\t\t\t\tthis.terrainType = TerrainType.WaterTriangle2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.terrainWaterTriangle3:\r\n\t\t\t\t\tthis.terrainType = TerrainType.WaterTriangle3;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.terrainWaterTriangle4:\r\n\t\t\t\t\tthis.terrainType = TerrainType.WaterTriangle4;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//choose object\r\n\t\tel.editor.objectImgs.addEventListener('click', (e: MouseEvent) => {\r\n\t\t\tconst terrainImgs = el.editor.terrainImgs.children;\r\n\t\t\tfor (let i = 0; i < terrainImgs.length; i++) {\r\n\t\t\t\t(<HTMLElement>terrainImgs[i]).style.borderColor = this.colors.blockFrame;\r\n\t\t\t}\r\n\t\t\tconst objectImgs = el.editor.objectImgs.children;\r\n\t\t\tfor (let i = 0; i < objectImgs.length; i++) {\r\n\t\t\t\t(<HTMLElement>objectImgs[i]).style.borderColor = this.colors.blockFrame;\r\n\t\t\t}\r\n\t\t\t(<HTMLElement>e.target).style.borderColor = this.colors.blockFrameActive;\r\n\t\t\tthis.terrainType = null;\r\n\t\t\tswitch (e.target) {\r\n\t\t\t\tcase el.editor.objectBush:\r\n\t\t\t\t\tthis.objectType = 'bush';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.objectRock:\r\n\t\t\t\t\tthis.objectType = 'rock';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.objectTree:\r\n\t\t\t\t\tthis.objectType = 'tree';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.objectRect:\r\n\t\t\t\t\tthis.objectType = 'rect';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.objectDelete:\r\n\t\t\t\t\tthis.objectType = 'delete';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//editorScreenClick\r\n\t\tel.editor.screen.addEventListener('click', () => {\r\n\t\t\tif (this.getTerrainType() != null) {\r\n\t\t\t\tconst blockX = Math.floor(this.getX() / this.blockSize) * this.blockSize;\r\n\t\t\t\tconst blockY = Math.floor(this.getY() / this.blockSize) * this.blockSize;\r\n\t\t\t\t//find block on this position and delete\r\n\t\t\t\tlet deletePosition = -1;\r\n\t\t\t\tfor (let i = 0; i < this.terrains.length; i++) {\r\n\t\t\t\t\tconst terrain = this.terrains[i];\r\n\t\t\t\t\tif (terrain.x === blockX && terrain.y === blockY) {\r\n\t\t\t\t\t\tdeletePosition = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (deletePosition !== -1) {\r\n\t\t\t\t\tthis.terrains.splice(deletePosition, 1);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.getTerrainType() !== TerrainType.Grass) {\r\n\t\t\t\t\tthis.terrains.push(new Terrain(this.getTerrainType(), blockX, blockY, this.blockSize));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.getObjectType() != null) {\r\n\t\t\t\tswitch (this.getObjectType()) {\r\n\t\t\t\t\tcase 'bush':\r\n\t\t\t\t\t\tthis.bushes.push(new Bush(0, this.x - this.bush.size / 2, this.y - this.bush.size / 2));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'rock':\r\n\t\t\t\t\t\tthis.rocks.push(new Rock(0, this.x - this.rock.size / 2, this.y - this.rock.size / 2));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'tree':\r\n\t\t\t\t\t\tthis.trees.push(new Tree(0, this.x - this.tree.size / 2, this.y - this.tree.size / 2));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'rect':\r\n\t\t\t\t\t\tthis.walls.push(\r\n\t\t\t\t\t\t\tnew Wall(\r\n\t\t\t\t\t\t\t\t0,\r\n\t\t\t\t\t\t\t\tthis.x - this.bush.size / 2,\r\n\t\t\t\t\t\t\t\tthis.y - this.bush.size / 2,\r\n\t\t\t\t\t\t\t\tthis.bush.size,\r\n\t\t\t\t\t\t\t\tthis.bush.size\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'delete':\r\n\t\t\t\t\t\t//find delete object\r\n\t\t\t\t\t\tlet deleteObject;\r\n\t\t\t\t\t\tconst editor = this;\r\n\t\t\t\t\t\tfor (const rock of editor.rocks) {\r\n\t\t\t\t\t\t\tconst object = rock;\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.x + object.size >= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\t\t\t\tobject.y + object.size >= editor.getY()\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (const wall of editor.walls) {\r\n\t\t\t\t\t\t\tconst object = wall;\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.x + object.width >= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\t\t\t\tobject.y + object.height >= editor.getY()\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (const bush of editor.bushes) {\r\n\t\t\t\t\t\t\tconst object = bush;\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.x + object.size >= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\t\t\t\tobject.y + object.size >= editor.getY()\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (const tree of editor.trees) {\r\n\t\t\t\t\t\t\tconst object = tree;\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.x + object.size >= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\t\t\t\tobject.y + object.size >= editor.getY()\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t//delete\r\n\t\t\t\t\t\tlet deleteIndex = -1;\r\n\t\t\t\t\t\tfor (let i = 0; i < this.rocks.length; i++) {\r\n\t\t\t\t\t\t\tif (deleteObject == this.rocks[i]) deleteIndex = i;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (deleteIndex !== -1) {\r\n\t\t\t\t\t\t\tthis.rocks.splice(deleteIndex, 1);\r\n\t\t\t\t\t\t\tdeleteIndex = -1;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (let i = 0; i < this.bushes.length; i++) {\r\n\t\t\t\t\t\t\tif (deleteObject == this.bushes[i]) deleteIndex = i;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (deleteIndex !== -1) {\r\n\t\t\t\t\t\t\tthis.bushes.splice(deleteIndex, 1);\r\n\t\t\t\t\t\t\tdeleteIndex = -1;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (let i = 0; i < this.trees.length; i++) {\r\n\t\t\t\t\t\t\tif (deleteObject == this.trees[i]) deleteIndex = i;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (deleteIndex !== -1) {\r\n\t\t\t\t\t\t\tthis.trees.splice(deleteIndex, 1);\r\n\t\t\t\t\t\t\tdeleteIndex = -1;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (let i = 0; i < this.walls.length; i++) {\r\n\t\t\t\t\t\t\tif (deleteObject == this.walls[i]) deleteIndex = i;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (deleteIndex !== -1) {\r\n\t\t\t\t\t\t\tthis.walls.splice(deleteIndex, 1);\r\n\t\t\t\t\t\t\tdeleteIndex = -1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//socket openMapInEditor\r\n\t\tthis.socket.on('openMapInEditor', (mapData: MapData) => {\r\n\t\t\tthis.openMap(mapData);\r\n\t\t\tel.close(el.openMapMenu.main);\r\n\t\t\tel.open(el.editor.container);\r\n\t\t});\r\n\t}\r\n}\r\n","import Model from './Model';\r\nimport Socket from './Socket';\r\nimport ServerClientSync from './ServerClientSync';\r\nimport { Snapshot } from './Snapshot';\r\nimport MyHtmlElements from './MyHtmlElements';\r\nimport Editor from './Editor';\r\nimport CollisionPoints from './CollisionPoints';\r\nimport Point from './Point';\r\nimport { Weapon } from './Weapon';\r\nimport OpenGame from './OpenGame';\r\nimport MapData from './MapData';\r\nimport PlayerStats from './PlayerStats';\r\n\r\ndeclare const io: {\r\n\tconnect(url?: string): Socket;\r\n};\r\n\r\nexport type Keys = {\r\n\tw: boolean;\r\n\ta: boolean;\r\n\ts: boolean;\r\n\td: boolean;\r\n\te: boolean;\r\n\tr: boolean;\r\n};\r\n\r\nexport type Mouse = {\r\n\tx: number;\r\n\ty: number;\r\n\tleft: boolean;\r\n\tmiddle: boolean;\r\n\tright: boolean;\r\n};\r\n\r\nexport class Controller {\r\n\tprivate static instance: Controller;\r\n\tprivate myHtmlElements: MyHtmlElements;\r\n\tprivate model: Model;\r\n\tprivate editor: Editor;\r\n\tprivate socket: Socket;\r\n\tprivate serverClientSync: ServerClientSync;\r\n\tprivate canvas: HTMLCanvasElement;\r\n\tprivate keys: Keys = {\r\n\t\tw: false,\r\n\t\ta: false,\r\n\t\ts: false,\r\n\t\td: false,\r\n\t\te: false,\r\n\t\tr: false\r\n\t};\r\n\tprivate mouse: Mouse = {\r\n\t\tx: 0,\r\n\t\ty: 0,\r\n\t\tleft: false,\r\n\t\tmiddle: false,\r\n\t\tright: false\r\n\t};\r\n\r\n\tprivate playerAngle: number = 0;\r\n\r\n\tprivate constructor() {\r\n\t\tthis.myHtmlElements = new MyHtmlElements();\r\n\t\tthis.canvas = document.getElementsByTagName('canvas')[0];\r\n\t\t//http://192.168.0.2:8080 // 'http://mbr.rostiapp.cz'\r\n\t\tthis.socket = io.connect();\r\n\t\tthis.serverClientSync = new ServerClientSync();\r\n\t\tthis.editor = new Editor(this.myHtmlElements, this.socket);\r\n\t\tthis.model = new Model(\r\n\t\t\tthis.keys,\r\n\t\t\tthis.mouse,\r\n\t\t\tthis.socket,\r\n\t\t\tthis.serverClientSync,\r\n\t\t\tthis.myHtmlElements,\r\n\t\t\tthis.editor\r\n\t\t);\r\n\t\twindow.addEventListener('resize', () => {\r\n\t\t\tthis.model.view.screenResize();\r\n\t\t\tconst event = new Event('mousemove');\r\n\t\t\tthis.canvas.dispatchEvent(event);\r\n\t\t});\r\n\t\twindow.addEventListener('beforeunload', (e) => {\r\n\t\t\t// Cancel the event as stated by the standard.\r\n\t\t\te.preventDefault();\r\n\t\t\t// Chrome requires returnValue to be set.\r\n\t\t\te.returnValue = '';\r\n\t\t});\r\n\t\tthis.keysController();\r\n\t\tthis.mouseController();\r\n\t\tthis.socketController();\r\n\t\tthis.menuController();\r\n\t}\r\n\r\n\tstatic run(): void {\r\n\t\tif (!Controller.instance) {\r\n\t\t\tController.instance = new Controller();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('Only one controller!');\r\n\t\t}\r\n\t}\r\n\r\n\tprivate changePlayerName(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\t\tlet nameOk = false;\r\n\t\tif ((<HTMLInputElement>el.mainMenu.name).value.length) {\r\n\t\t\tnameOk = true;\r\n\t\t\t//save name\r\n\t\t\tlocalStorage.setItem('playerName', (<HTMLInputElement>el.mainMenu.name).value);\r\n\t\t}\r\n\t\t(<HTMLInputElement>el.mainMenu.create).disabled = !nameOk;\r\n\t\t(<HTMLInputElement>el.mainMenu.maps).disabled = !nameOk;\r\n\t\tlet gameExists = false;\r\n\t\tif ((<HTMLInputElement>el.mainMenu.games).value) gameExists = true;\r\n\t\tlet joinDisabled = true;\r\n\t\tif (nameOk && gameExists) joinDisabled = false;\r\n\t\t(<HTMLInputElement>el.mainMenu.join).disabled = joinDisabled;\r\n\t\t(<HTMLInputElement>el.mainMenu.games).disabled = joinDisabled;\r\n\t}\r\n\r\n\tprivate socketController(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\r\n\t\t//gameOver\r\n\t\tthis.socket.on('winner', (stats: PlayerStats) => {\r\n\t\t\tthis.model.view.gameOver(stats, true);\r\n\t\t});\r\n\r\n\t\tthis.socket.on('loser', (stats: PlayerStats) => {\r\n\t\t\tthis.model.view.gameOver(stats, false);\r\n\t\t});\r\n\r\n\t\tthis.socket.on('stopGame', () => {\r\n\t\t\tthis.model.stop();\r\n\t\t});\r\n\r\n\t\tthis.socket.on('stopSpectate', (stats: PlayerStats, winnerName) => {\r\n\t\t\tthis.model.view.gameOver(stats, true, winnerName);\r\n\t\t});\r\n\r\n\t\t//startGame\r\n\t\tthis.socket.on('startGame', (mapData: MapData) => {\r\n\t\t\tthis.model.map.openMap(mapData);\r\n\t\t\tthis.model.gameStart();\r\n\t\t\tel.close(el.lobbyMenu.main);\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tel.close(el.hideGame);\r\n\t\t\t}, 100);\r\n\t\t});\r\n\r\n\t\t//playerId\r\n\t\tthis.socket.on('playerId', (playerId: number) => {\r\n\t\t\tthis.model.setPlayerId(playerId);\r\n\t\t});\r\n\r\n\t\t//createGame\r\n\t\tthis.socket.on('createGame', (gameId: number, playerName: string) => {\r\n\t\t\tthis.model.setGameId(gameId);\r\n\t\t\tel.close(el.mainMenu.main, el.lobbyMenu.forJoinPlayers);\r\n\t\t\tel.open(el.lobbyMenu.main, el.lobbyMenu.forCreatePlayer);\r\n\t\t});\r\n\r\n\t\t//joinGame\r\n\t\tthis.socket.on('joinGame', (gameId: number, playerName: string) => {\r\n\t\t\tthis.model.setGameId(gameId);\r\n\t\t\tel.close(el.mainMenu.main, el.lobbyMenu.forCreatePlayer);\r\n\t\t\tel.open(el.lobbyMenu.main, el.lobbyMenu.forJoinPlayers);\r\n\t\t});\r\n\r\n\t\t//leave lobby\r\n\t\tthis.socket.on('leaveLobby', () => {\r\n\t\t\tthis.model.setGameId(-1);\r\n\t\t\tel.close(el.lobbyMenu.main);\r\n\t\t\tel.open(el.mainMenu.main);\r\n\t\t});\r\n\r\n\t\t//cancel lobby\r\n\t\tthis.socket.on('cancelLobby', () => {\r\n\t\t\tthis.model.setGameId(-1);\r\n\t\t\tel.close(el.lobbyMenu.main);\r\n\t\t\tel.open(el.gameCanceledMenu.main);\r\n\t\t});\r\n\r\n\t\t//updateListOpenGames\r\n\t\tthis.socket.on('updateListOpenGames', (openGames: OpenGame[]) => {\r\n\t\t\tel.mainMenu.games.innerHTML = '';\r\n\t\t\tfor (const openGame of openGames) {\r\n\t\t\t\tconst option = document.createElement('option');\r\n\t\t\t\toption.textContent = openGame.name + \"'s game\";\r\n\t\t\t\toption.setAttribute('value', openGame.index.toString());\r\n\t\t\t\tel.mainMenu.games.appendChild(option);\r\n\t\t\t}\r\n\r\n\t\t\tif (openGames.length && (<HTMLInputElement>el.mainMenu.name).value.length) {\r\n\t\t\t\t(<HTMLInputElement>el.mainMenu.games).disabled = false;\r\n\t\t\t\t(<HTMLInputElement>el.mainMenu.join).disabled = false;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t(<HTMLInputElement>el.mainMenu.games).disabled = true;\r\n\t\t\t\t(<HTMLInputElement>el.mainMenu.join).disabled = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//update listOfPlayers in lobby\r\n\t\tthis.socket.on('listOfPlayers', (playerNames: string[]) => {\r\n\t\t\t//title\r\n\t\t\tel.lobbyMenu.gameName.textContent = playerNames[0] + \"'s game\";\r\n\t\t\t//list\r\n\t\t\tel.lobbyMenu.players.innerHTML = '';\r\n\t\t\tfor (const playerName of playerNames) {\r\n\t\t\t\tconst li = document.createElement('li');\r\n\t\t\t\tli.textContent = playerName;\r\n\t\t\t\tel.lobbyMenu.players.appendChild(li);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.socket.on('collisionPoints', (body: Point[], hand: Point[], hammer: Point[][]) => {\r\n\t\t\tthis.model.collisionPoints.setData(body, hand, hammer);\r\n\t\t});\r\n\r\n\t\t//map\r\n\t\tthis.socket.on('sendMap', (map) => {\r\n\t\t\tthis.model.map.openMap(map);\r\n\t\t});\r\n\r\n\t\t//map saved\r\n\t\tthis.socket.on('mapSaved', () => {\r\n\t\t\tel.close(el.mapEditorMenu.main, el.editor.container);\r\n\t\t\tel.open(el.saveMapMenu.main);\r\n\t\t\tthis.editor.close();\r\n\t\t});\r\n\r\n\t\t//uodate listOfMaps\r\n\t\tthis.socket.on('listOfMaps', (maps: string[]) => {\r\n\t\t\tel.openMapMenu.maps.innerHTML = '';\r\n\t\t\tel.mainMenu.maps.innerHTML = '';\r\n\t\t\tfor (const map of maps) {\r\n\t\t\t\tconst option = document.createElement('option');\r\n\t\t\t\toption.setAttribute('value', map);\r\n\t\t\t\toption.textContent = map;\r\n\t\t\t\tel.mainMenu.maps.appendChild(option);\r\n\t\t\t\tconst optionCopy = option.cloneNode(true);\r\n\t\t\t\tel.openMapMenu.maps.appendChild(optionCopy);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.socket.on('createPlayer', (name: string) => {\r\n\t\t\tif (name) {\r\n\t\t\t\tthis.model.setName(name);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.log('error created player');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//sync\r\n\t\tthis.socket.on('serverClientSync', (clientDateNow, serverDateNow) => {\r\n\t\t\tconst timeNow = Date.now();\r\n\t\t\tconst ping = timeNow - clientDateNow;\r\n\t\t\tconst timeDiferenceClientServer = serverDateNow - (timeNow - ping / 2);\r\n\t\t\tthis.serverClientSync.addData(ping, timeDiferenceClientServer);\r\n\t\t});\r\n\r\n\t\t//u === update positions\r\n\t\tthis.socket.on('u', (snapshot: Snapshot) => {\r\n\t\t\tthis.model.snapshotManager.addSnapshot(snapshot);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate mouseController(): void {\r\n\t\t//deny right click menu\r\n\t\tdocument.addEventListener('contextmenu', function(e) {\r\n\t\t\te.preventDefault();\r\n\t\t});\r\n\t\t//deny middle button\r\n\t\tdocument.addEventListener('mousedown', function(e) {\r\n\t\t\tif (e.which === 2) e.preventDefault();\r\n\t\t});\r\n\r\n\t\t//player angle\r\n\t\tthis.myHtmlElements.transparentLayer.addEventListener('mousemove', (e: MouseEvent) => {\r\n\t\t\tif (!this.model.gameActive()) return;\r\n\t\t\tif (e.x == undefined) {\r\n\t\t\t\tthis.mouse.x = this.canvas.width / 2;\r\n\t\t\t\tthis.mouse.y = this.canvas.height / 2;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.mouse.x = e.x;\r\n\t\t\t\tthis.mouse.y = e.y;\r\n\t\t\t}\r\n\r\n\t\t\tconst previousPlayerAngle = this.playerAngle;\r\n\t\t\tthis.rotatePlayer(this.mouse.x, this.mouse.y);\r\n\t\t\t//change\r\n\t\t\tif (this.playerAngle !== previousPlayerAngle) {\r\n\t\t\t\tthis.socket.emit('a', this.model.getGameId(), this.playerAngle);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.myHtmlElements.transparentLayer.addEventListener('mousedown', (e: MouseEvent) => {\r\n\t\t\tif (!this.model.gameActive()) return;\r\n\t\t\tthis.mouse.left = true;\r\n\t\t\tconst clickPoint = new Point(e.clientX, e.clientY);\r\n\t\t\tconst serverPosition = this.model.view.calculateServerPosition(clickPoint);\r\n\t\t\tthis.socket.emit('m', this.model.getGameId(), 'l', serverPosition);\r\n\t\t});\r\n\t\tthis.myHtmlElements.transparentLayer.addEventListener('mouseup', (e: MouseEvent) => {\r\n\t\t\tif (!this.model.gameActive()) return;\r\n\t\t\tthis.mouse.left = false;\r\n\t\t\tthis.socket.emit('m', this.model.getGameId(), '-l');\r\n\t\t});\r\n\t}\r\n\r\n\tprivate rotatePlayer(mouseX: number, mouseY: number): void {\r\n\t\t//triangular sides\r\n\t\tconst centerX = this.canvas.width / 2;\r\n\t\tconst centerY = this.canvas.height / 2;\r\n\t\tlet x = centerX - mouseX;\r\n\t\tlet y = centerY - mouseY;\r\n\t\t//can not set x and y to 0 because angle\r\n\t\tif (x === 0) x = 0.1;\r\n\t\t//atangens\r\n\t\tlet angle = Math.abs(Math.atan(x / y) * 180 / Math.PI);\r\n\t\t//1..2..3..4.. Q; 0 - 90, 90 - 180...\r\n\t\t//1\r\n\t\tif (mouseX >= centerX && mouseY < centerY) {\r\n\t\t\tthis.playerAngle = angle;\r\n\t\t}\r\n\t\t//2\r\n\t\tif (mouseX >= centerX && mouseY >= centerY) {\r\n\t\t\tthis.playerAngle = 90 + 90 - angle;\r\n\t\t}\r\n\t\t//3\r\n\t\tif (mouseX < centerX && mouseY >= centerY) {\r\n\t\t\tthis.playerAngle = 180 + angle;\r\n\t\t}\r\n\t\t//4\r\n\t\tif (mouseX < centerX && mouseY < centerY) {\r\n\t\t\tthis.playerAngle = 270 + 90 - angle;\r\n\t\t}\r\n\t\tthis.playerAngle = Math.round(this.playerAngle);\r\n\t\tif (this.playerAngle === 360) this.playerAngle = 0;\r\n\t}\r\n\r\n\tprivate keysController(): void {\r\n\t\tdocument.addEventListener('keydown', (e: KeyboardEvent) => {\r\n\t\t\tif (e.code === 'Escape') {\r\n\t\t\t\tif (this.model.gameActive() || this.model.getSpectate()) {\r\n\t\t\t\t\tthis.myHtmlElements.escFromGameMenu.main.style.display = 'block';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!this.model.gameActive()) return;\r\n\t\t\tswitch (e.code) {\r\n\t\t\t\tcase 'KeyW':\r\n\t\t\t\t\tif (!this.keys.w) this.socket.emit('c', this.model.getGameId(), 'u');\r\n\t\t\t\t\tthis.keys.w = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'KeyA':\r\n\t\t\t\t\tif (!this.keys.a) this.socket.emit('c', this.model.getGameId(), 'l');\r\n\t\t\t\t\tthis.keys.a = true;\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'KeyS':\r\n\t\t\t\t\tif (!this.keys.s) this.socket.emit('c', this.model.getGameId(), 'd');\r\n\t\t\t\t\tthis.keys.s = true;\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'KeyD':\r\n\t\t\t\t\tif (!this.keys.d) this.socket.emit('c', this.model.getGameId(), 'r');\r\n\t\t\t\t\tthis.keys.d = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'KeyE':\r\n\t\t\t\t\tif (!this.keys.e) this.socket.emit('c', this.model.getGameId(), 'e');\r\n\t\t\t\t\tthis.keys.e = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'KeyR':\r\n\t\t\t\t\tif (!this.keys.e) this.socket.emit('c', this.model.getGameId(), 're');\r\n\t\t\t\t\tthis.keys.r = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Digit0':\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 0);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Digit1':\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Digit2':\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 2);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Digit3':\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 3);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Digit4':\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 4);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Digit5':\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 5);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Digit6':\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 6);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Digit7':\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 7);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'Digit8':\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 8);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdocument.addEventListener('keyup', (e: KeyboardEvent) => {\r\n\t\t\tif (!this.model.gameActive()) return;\r\n\t\t\tswitch (e.code) {\r\n\t\t\t\tcase 'KeyW':\r\n\t\t\t\t\tif (this.keys.w) this.socket.emit('c', this.model.getGameId(), '-u');\r\n\t\t\t\t\tthis.keys.w = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'KeyA':\r\n\t\t\t\t\tif (this.keys.a) this.socket.emit('c', this.model.getGameId(), '-l');\r\n\t\t\t\t\tthis.keys.a = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'KeyS':\r\n\t\t\t\t\tif (this.keys.s) this.socket.emit('c', this.model.getGameId(), '-d');\r\n\t\t\t\t\tthis.keys.s = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'KeyD':\r\n\t\t\t\t\tif (this.keys.d) this.socket.emit('c', this.model.getGameId(), '-r');\r\n\t\t\t\t\tthis.keys.d = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'KeyE':\r\n\t\t\t\t\tthis.keys.e = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'KeyR':\r\n\t\t\t\t\tthis.keys.r = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate menuController(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\r\n\t\t//load player name\r\n\t\tif (localStorage.getItem('playerName')) {\r\n\t\t\t(<HTMLInputElement>el.mainMenu.name).value = localStorage.getItem('playerName');\r\n\t\t\tthis.changePlayerName();\r\n\t\t}\r\n\r\n\t\t//+++++++++++++ ESC MENU\r\n\t\tel.escFromGameMenu.back.addEventListener('click', () => {\r\n\t\t\tel.escFromGameMenu.main.style.display = 'none';\r\n\t\t});\r\n\r\n\t\tel.escFromGameMenu.leave.addEventListener('click', () => {\r\n\t\t\tel.escFromGameMenu.main.style.display = 'none';\r\n\t\t\tthis.socket.emit('leaveGame', this.model.getGameId());\r\n\t\t\tthis.model.reset();\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ GAME OVER MENU\r\n\t\tel.gameOverMenu.back.addEventListener('click', () => {\r\n\t\t\tthis.socket.emit('leaveGame', this.model.getGameId());\r\n\t\t\tthis.model.reset();\r\n\t\t});\r\n\r\n\t\tel.gameOverMenu.spectate.addEventListener('click', () => {\r\n\t\t\tthis.socket.emit('spectate', this.model.getGameId());\r\n\t\t\tel.close(el.gameOverMenu.main);\r\n\t\t\tthis.model.startSpectate();\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ MAP SIZE MENU\r\n\t\t//mapSize ok button\r\n\t\tel.mapSizeMenu.ok.addEventListener('click', () => {\r\n\t\t\tthis.editor.changeSize(parseInt((<HTMLInputElement>document.getElementById('mapSizeValue')).value));\r\n\t\t\tel.open(el.editor.container);\r\n\t\t\tel.close(el.mapSizeMenu.main);\r\n\t\t});\r\n\t\t//mapSize back button\r\n\t\tel.mapSizeMenu.back.addEventListener('click', () => {\r\n\t\t\tel.close(el.mapSizeMenu.main);\r\n\t\t\tif (this.editor.isActive()) {\r\n\t\t\t\tel.open(el.mapEditorMenu.main);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tel.open(el.mapMenu.main);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ MAP EDITOR MAIN MENU\r\n\t\t//create a new map\r\n\t\tel.mapMenu.create.addEventListener('click', () => {\r\n\t\t\tthis.editor.create();\r\n\t\t\tel.close(el.mapMenu.main);\r\n\t\t\tel.open(el.mapSizeMenu.main);\r\n\t\t});\r\n\t\t//open maps\r\n\t\tel.mapMenu.open.addEventListener('click', () => {\r\n\t\t\tel.close(el.mapMenu.main);\r\n\t\t\tel.open(el.openMapMenu.main);\r\n\t\t});\r\n\t\t//close mapMenu\r\n\t\tel.mapMenu.back.addEventListener('click', () => {\r\n\t\t\tel.close(el.mapMenu.main);\r\n\t\t\tel.open(el.mainMenu.main);\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ OPEN MAP MENU\r\n\t\t//back\r\n\t\tel.openMapMenu.back.addEventListener('click', () => {\r\n\t\t\tel.close(el.openMapMenu.main);\r\n\t\t\tel.open(el.mapMenu.main);\r\n\t\t});\r\n\t\t//open\r\n\t\tel.openMapMenu.ok.addEventListener('click', () => {\r\n\t\t\tconst mapName = (<HTMLInputElement>el.openMapMenu.maps).value;\r\n\t\t\tthis.socket.emit('openMapInEditor', mapName);\r\n\t\t});\r\n\t\t//+++++++++++++ EDITOR MENU - from editor...\r\n\t\t//open menu\r\n\t\tel.editor.openMenu.addEventListener('click', () => {\r\n\t\t\tel.open(el.mapEditorMenu.main);\r\n\t\t});\r\n\t\t//back\r\n\t\tel.mapEditorMenu.back.addEventListener('click', () => {\r\n\t\t\tel.close(el.mapEditorMenu.main);\r\n\t\t});\r\n\t\t//close editor\r\n\t\tel.mapEditorMenu.close.addEventListener('click', () => {\r\n\t\t\tel.close(el.mapEditorMenu.main, el.editor.container);\r\n\t\t\tel.open(el.mainMenu.main);\r\n\t\t\tthis.editor.close();\r\n\t\t});\r\n\t\t//save\r\n\t\tel.mapEditorMenu.save.addEventListener('click', () => {\r\n\t\t\tconst mapData = this.editor.getMapData();\r\n\t\t\tconst mapName = (<HTMLInputElement>el.mapEditorMenu.name).value;\r\n\t\t\tif (this.model.isNameOk(mapName)) {\r\n\t\t\t\tthis.socket.emit('editorSaveMap', mapName, mapData);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tel.open(el.alertMenu.main);\r\n\t\t\t}\r\n\t\t});\r\n\t\t//change size\r\n\t\tel.mapEditorMenu.changeSize.addEventListener('click', () => {\r\n\t\t\tel.close(el.mapEditorMenu.main);\r\n\t\t\tel.open(el.mapSizeMenu.main);\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ SAVE MAP MENU\r\n\t\t//return to main menu\r\n\t\tel.saveMapMenu.back.addEventListener('click', () => {\r\n\t\t\tel.close(el.saveMapMenu.main);\r\n\t\t\tel.open(el.mainMenu.main);\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ MAIN MENU\r\n\t\t//open editor menu and close main menu\r\n\t\tel.mainMenu.openEditor.addEventListener('click', () => {\r\n\t\t\tel.open(el.mapMenu.main);\r\n\t\t\tel.close(el.mainMenu.main);\r\n\t\t});\r\n\t\t//change player name and allow create game\r\n\t\tel.mainMenu.name.addEventListener('input', () => {\r\n\t\t\tthis.changePlayerName();\r\n\t\t});\r\n\t\t//select game - allow join\r\n\t\t/*\r\n\t\tel.mainMenu.games.addEventListener('change', () => {\r\n\t\t\tlet disabled = true;\r\n\t\t\tif ((<HTMLInputElement>el.mainMenu.name).value.length) disabled = false;\r\n\t\t\tlet disabled2 = true;\r\n\t\t\tif ((<HTMLInputElement>el.mainMenu.games).value) disabled2 = false;\r\n\t\t\tif (!disabled && !disabled2) (<HTMLInputElement>el.mainMenu.join).disabled = false;\r\n\t\t});\r\n\t\t*/\r\n\t\t//create a new game\r\n\t\tel.mainMenu.create.addEventListener('click', () => {\r\n\t\t\tif ((<HTMLInputElement>el.mainMenu.name).value.length) {\r\n\t\t\t\tconst playerName = (<HTMLInputElement>el.mainMenu.name).value;\r\n\t\t\t\tconst selectedMap = (<HTMLInputElement>el.mainMenu.maps).value;\r\n\t\t\t\tif (this.model.isNameOk(playerName)) {\r\n\t\t\t\t\tthis.socket.emit('createGame', playerName, selectedMap);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tel.open(el.alertMenu.main);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t//join\r\n\t\tel.mainMenu.join.addEventListener('click', () => {\r\n\t\t\tif ((<HTMLInputElement>el.mainMenu.name).value.length && (<HTMLInputElement>el.mainMenu.games).value) {\r\n\t\t\t\tconst playerName = (<HTMLInputElement>el.mainMenu.name).value;\r\n\t\t\t\tconst gameIndex = parseInt((<HTMLInputElement>el.mainMenu.games).value);\r\n\t\t\t\tif (this.model.isNameOk(playerName)) {\r\n\t\t\t\t\tthis.socket.emit('joinGame', playerName, gameIndex);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tel.open(el.alertMenu.main);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t//cancel lobby\r\n\t\tel.gameCanceledMenu.back.addEventListener('click', () => {\r\n\t\t\tel.close(el.gameCanceledMenu.main);\r\n\t\t\tel.open(el.mainMenu.main);\r\n\t\t});\r\n\t\t//controls\r\n\t\tel.mainMenu.controls.addEventListener('click', () => {\r\n\t\t\tel.open(el.controlsMenu.main);\r\n\t\t\tel.close(el.mainMenu.main);\r\n\t\t});\r\n\t\t//+++++++++++++ ALERT MENU\r\n\t\tel.alertMenu.ok.addEventListener('click', () => {\r\n\t\t\tel.close(el.alertMenu.main);\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ LOBBY MENU\r\n\t\t//leave join in lobby\r\n\t\tel.lobbyMenu.leave.addEventListener('click', () => {\r\n\t\t\tthis.socket.emit('leaveLobby', this.model.getGameId());\r\n\t\t});\r\n\t\t//cancel game in lobby\r\n\t\tel.lobbyMenu.cancel.addEventListener('click', () => {\r\n\t\t\tthis.socket.emit('cancelLobby', this.model.getGameId());\r\n\t\t});\r\n\t\t//start game\r\n\t\tel.lobbyMenu.start.addEventListener('click', () => {\r\n\t\t\tel.close(el.lobbyMenu.main);\r\n\t\t\tthis.socket.emit('startGame', this.model.getGameId());\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ CONTROLS MENU\r\n\t\tel.controlsMenu.back.addEventListener('click', () => {\r\n\t\t\tel.open(el.mainMenu.main);\r\n\t\t\tel.close(el.controlsMenu.main);\r\n\t\t});\r\n\t}\r\n}\r\n","import { Controller } from './Controller';\r\nController.run();\r\nconsole.log('Version: 1.4');\r\n"],"sourceRoot":""}