!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([,function(t,e,i){"use strict";var s;i.r(e),function(t){t[t.Water=0]="Water",t[t.WaterTriangle1=1]="WaterTriangle1",t[t.WaterTriangle2=2]="WaterTriangle2",t[t.WaterTriangle3=3]="WaterTriangle3",t[t.WaterTriangle4=4]="WaterTriangle4"}(s||(s={}));var r,n=function(){return function(t,e,i,r,n){switch(this.angle=0,this.type=t,this.x=e,this.y=i,this.width=r,this.height=n,t){case s.WaterTriangle2:this.angle=90;break;case s.WaterTriangle3:this.angle=180;break;case s.WaterTriangle4:this.angle=270}}}(),a=function(){return function(t,e){this.x=t,this.y=e}}(),h=function(){function t(t,e,i,s){this.changed=!1,this.opacity=1,this.active=!0,this.hitAnimateTimer=0,this.hitAnimateShiftX=0,this.hitAnimateShiftY=0,this.id=t,this.x=e,this.y=i,this.size=s,this.radius=s/2}return t.prototype.getChanged=function(){return this.changed},t.prototype.nullChanged=function(){this.changed=!1},t.prototype.update=function(t){this.opacity=t},t.prototype.isPointIn=function(t){var e=this.x+this.radius-t.x,i=this.y+this.radius-t.y;return Math.sqrt(e*e+i*i)<=this.radius},t.prototype.getCenterX=function(){return this.x+this.size/2},t.prototype.getCenterY=function(){return this.y+this.size/2},t.prototype.getOpacity=function(){return this.opacity},t.prototype.isActive=function(){return this.active},t.prototype.acceptHit=function(t){this.opacity>.1&&(this.opacity-=.1),this.createAnimateHit(t),this.opacity<.1&&(this.active=!1)},t.prototype.createAnimateHit=function(t){var e=t.x-this.getCenterX(),i=t.y-this.getCenterY(),s=Math.abs(Math.atan(e/i)*(180/Math.PI));t.x>=this.getCenterX()&&t.y<this.getCenterY()&&(s=s),t.x>=this.getCenterX()&&t.y>=this.getCenterY()&&(s=180-s),t.x<this.getCenterX()&&t.y>=this.getCenterY()&&(s=180+s),t.x<this.getCenterX()&&t.y<this.getCenterY()&&(s=360-s),360===(s=Math.round(s))&&(s=0),this.hitAnimateTimer=10;this.hitAnimateShiftX=3*Math.sin(s*Math.PI/180)*-1,this.hitAnimateShiftY=3*Math.cos(s*Math.PI/180)},t.prototype.animate=function(){var t=0,e=0;switch(this.hitAnimateTimer>0&&this.hitAnimateTimer--,this.hitAnimateTimer){case 1:t=this.hitAnimateShiftX,e=this.hitAnimateShiftY;break;case 2:t=2*this.hitAnimateShiftX,e=2*this.hitAnimateShiftY;break;case 3:t=3*this.hitAnimateShiftX,e=3*this.hitAnimateShiftY;break;case 4:t=4*this.hitAnimateShiftX,e=4*this.hitAnimateShiftY;break;case 5:t=5*this.hitAnimateShiftX,e=5*this.hitAnimateShiftY;break;case 6:t=4*this.hitAnimateShiftX,e=4*this.hitAnimateShiftY;break;case 7:t=3*this.hitAnimateShiftX,e=3*this.hitAnimateShiftY;break;case 8:t=2*this.hitAnimateShiftX,e=2*this.hitAnimateShiftY;break;case 9:t=1*this.hitAnimateShiftX,e=1*this.hitAnimateShiftY}return new a(t,e)},t}(),o=function(){function t(t,e,i,r,n,a,h){var o=this;this.resolutionAdjustment=1,this.myPlayerCenterX=0,this.myPlayerCenterY=0,this.startDraw=!1,this.playersTicks=[],this.serverClientSync=h,this.map=t,this.player=e,this.playersTicks=i,this.bullets=r,this.mouse=n,this.canvas=document.getElementById("gameScreen"),this.helperCanvas=document.getElementById("helper"),this.ctx=this.canvas.getContext("2d"),this.playerSVG=new Image,this.playerSVG.src="img/player.svg",this.playerHandSVG=new Image,this.playerHandSVG.src="img/hand.svg",this.bushSVG=new Image,this.bushSVG.src="img/bush.svg",this.rockSVG=new Image,this.rockSVG.src="img/rock.svg",this.treeSVG=new Image,this.treeSVG.src="img/tree.svg",this.cursorSVG=new Image,this.cursorSVG.src="img/cursor.svg",this.loadingProgresSVG=new Image,this.loadingProgresSVG.src="img/loadingProgres.svg",this.loadingCircleSVG=new Image,this.loadingCircleSVG.src="img/loadingCircle.svg",this.pistolSVG=new Image,this.pistolSVG.src="img/pistol.svg",this.waterTrianglePNG=new Image,this.waterTrianglePNG.src="img/waterTriangle.png",this.waterTerrainData=a,this.waterTrianglePNG.onload=function(){o.saveWaterPixels(s.WaterTriangle1),o.saveWaterPixels(s.WaterTriangle2),o.saveWaterPixels(s.WaterTriangle3),o.saveWaterPixels(s.WaterTriangle4)},this.screenResize()}return t.prototype.screenResize=function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.screenCenterX=window.innerWidth/2,this.screenCenterY=window.innerHeight/2,this.changeResolutionAdjustment()},t.prototype.changeResolutionAdjustment=function(){var t=(this.canvas.width/1920+this.canvas.height/1050)/2;this.resolutionAdjustment=t},t.prototype.saveWaterPixels=function(t){var e=this,i=this.helperCanvas.getContext("2d");this.helperCanvas.width=this.waterTrianglePNG.width,this.helperCanvas.height=this.waterTrianglePNG.height,i.fillStyle="#FFFFFF",i.fillRect(0,0,this.helperCanvas.width,this.helperCanvas.height);var r=this.waterTrianglePNG.width/2;switch(i.save(),i.translate(r,r),t){case s.WaterTriangle1:i.rotate(0*Math.PI/180);break;case s.WaterTriangle2:i.rotate(90*Math.PI/180);break;case s.WaterTriangle3:i.rotate(180*Math.PI/180);break;case s.WaterTriangle4:i.rotate(270*Math.PI/180)}if(i.drawImage(this.waterTrianglePNG,-r,-r),i.restore(),"undefined"!=typeof Worker){var n=new Worker("workerFindWater.js");n.onmessage=function(t){e.waterTerrainData.setData(t.data.type,t.data.data)};var a=i.getImageData(0,0,this.waterTrianglePNG.width,this.waterTrianglePNG.height).data;n.postMessage({data:a,size:this.waterTrianglePNG.width,type:t,time:(new Date).getTime()})}else console.log("Your browser doesn't support web workers.")},t.prototype.draw=function(){var t=this.ctx;if(t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="#69A2E0",t.fillRect(0,0,this.canvas.width,this.canvas.height),this.playersTicks.length>0&&(this.playersTicks.sort(function(t,e){return t.t-e.t}),this.serverClientSync.ready())){for(var e=this.serverClientSync.getServerTime()-this.serverClientSync.getDrawDelay(),i=void 0,r=0,n=this.playersTicks;r<n.length;r++){(it=n[r]).t<=e&&(i=it)}for(var a=void 0,h=0,o=this.playersTicks.length-1;o>=0;o--){(it=this.playersTicks[o]).t>=e&&(a=it,h++)}if(i&&a){var l=a.t-i.t,c=e-i.t,g=0;l&&(g=c/l);var u=Math.abs(a.p[0].x-i.p[0].x),p=Math.abs(a.p[0].y-i.p[0].y),y=1,f=1;a.p[0].x<i.p[0].x&&(y=-1),a.p[0].y<i.p[0].y&&(f=-1);var d=i.p[0].x+u*g*y,m=i.p[0].y+p*g*f;this.myPlayerCenterX=d+this.player.size/2,this.myPlayerCenterY=m+this.player.size/2}}t.fillStyle="#A2CB69";for(var v=this.map.blocks[1].x,w=0,b=this.map.blocks;w<b.length;w++){var x=b[w],C=this.howToDraw({x:x.x,y:x.y,size:v}),T=C.x,k=C.y,A=C.size;C.isOnScreen&&t.fillRect(T,k,A,A)}t.fillStyle="#69A2E0";for(var P=0,S=this.map.terrain;P<S.length;P++){var O=S[P],D=this.howToDraw({x:O.x,y:O.y,width:O.width,height:O.height}),M=D.x,z=(k=D.y,D.width),Y=D.height;if(D.isOnScreen)if(O.type===s.Water)t.fillRect(M,k,z,Y);else if(O.type===s.WaterTriangle1)t.drawImage(this.waterTrianglePNG,M,k,z,Y);else if(O.type===s.WaterTriangle2||O.type===s.WaterTriangle3||O.type===s.WaterTriangle4){var X=z/2;this.ctx.save(),this.ctx.translate(M+X,k+X),this.ctx.rotate(O.angle*Math.PI/180),this.ctx.drawImage(this.waterTrianglePNG,-X,-X,z,Y),this.ctx.restore()}}t.fillStyle="gray";for(var I=0,W=this.map.blocks;I<W.length;I++){if(0===(x=W[I]).y){var G=this.howToDraw({x:x.x,y:x.y,size:v}),R=G.x;k=G.y,A=G.size;G.isOnScreen&&t.fillRect(R,k,A,1)}var _=this.howToDraw({x:x.x,y:x.y+v,size:v}),j=_.x;k=_.y,A=_.size;if(_.isOnScreen&&t.fillRect(j,k,A,1),0===x.x){var V=this.howToDraw({x:x.x,y:x.y,size:v}),H=V.x;k=V.y,A=V.size;V.isOnScreen&&t.fillRect(H,k,1,A)}var E=this.howToDraw({x:x.x+v,y:x.y,size:v}),N=E.x;k=E.y,A=E.size;E.isOnScreen&&t.fillRect(N,k,1,A)}for(var F=0,K=this.map.rocks;F<K.length;F++){var L=K[F];if(L.isActive()){var q=this.howToDraw(L),B=q.x;k=q.y,A=q.size;q.isOnScreen&&(t.save(),t.globalAlpha=L.getOpacity(),t.drawImage(this.rockSVG,B,k,A,A),t.restore())}}t.fillStyle="black";for(var U=0,J=this.map.rectangleObstacles;U<J.length;U++){var Q=J[U];if(Q.isActive()){var Z=this.howToDraw(Q),$=Z.x;k=Z.y,z=Z.width,Y=Z.height;Z.isOnScreen&&(t.save(),t.globalAlpha=Q.getOpacity(),t.fillRect($,k,z,Y),t.restore())}}if(this.playersTicks.length>0&&(this.playersTicks.sort(function(t,e){return t.t-e.t}),this.serverClientSync.ready())){e=this.serverClientSync.getServerTime()-this.serverClientSync.getDrawDelay(),i=void 0;for(var tt=0,et=this.playersTicks;tt<et.length;tt++){(it=et[tt]).t<=e&&(i=it)}for(a=void 0,h=0,o=this.playersTicks.length-1;o>=0;o--){var it;(it=this.playersTicks[o]).t>=e&&(a=it,h++)}if(h>3&&this.serverClientSync.changeDrawDelay(-.1),h<3&&this.serverClientSync.changeDrawDelay(.1),t.fillStyle="white",i||(console.log("olderFrame is missing"),t.fillText("olderframe missing",20,300)),a||(console.log("newerFrame is missing"),t.fillText("newerframe missing",20,350),this.serverClientSync.reset()),i&&a){l=a.t-i.t,c=e-i.t,g=0;l&&(g=c/l);for(o=0;o<a.p.length;o++)if(a.p[o]&&i.p[o]){var st=a.p[o],rt=i.p[o];u=Math.abs(st.x-rt.x),p=Math.abs(st.y-rt.y),y=1,f=1;st.x<rt.x&&(y=-1),st.y<rt.y&&(f=-1);d=rt.x+u*g*y,m=rt.y+p*g*f;var nt=this.howToDraw({x:d,y:m,size:this.player.size}),at=nt.x;k=nt.y,A=nt.size;t.drawImage(this.playerSVG,at,k,A,A),t.fillStyle="blue";for(var ht=0,ot=this.player.collisionPoints;ht<ot.length;ht++){var lt=ot[ht],ct=this.howToDraw({x:d+this.player.size/2+lt.x,y:m+this.player.size/2+lt.y,size:1}),gt=ct.x,ut=ct.y,pt=ct.size;t.fillRect(gt,ut,pt,pt)}for(var yt=0;yt<2;yt++){u=Math.abs(st.h[yt].x-rt.h[yt].x),p=Math.abs(st.h[yt].y-rt.h[yt].y),y=1,f=1,st.h[yt].x<rt.h[yt].x&&(y=-1),st.h[yt].y<rt.h[yt].y&&(f=-1),d=rt.h[yt].x+u*g*y,m=rt.h[yt].y+p*g*f;var ft=this.howToDraw({x:d,y:m,size:this.player.hands[yt].size}),dt=ft.x,mt=ft.y,vt=ft.size;t.drawImage(this.playerHandSVG,dt,mt,vt,vt);for(var wt=0,bt=this.player.hands[0].collisionPoints;wt<bt.length;wt++){lt=bt[wt];var xt=this.howToDraw({x:d+this.player.hands[0].size/2+lt.x,y:m+this.player.hands[0].size/2+lt.y,size:1}),Ct=xt.x,Tt=xt.y,kt=xt.size;t.fillRect(Ct,Tt,kt,kt)}}}}}for(var At=0,Pt=this.map.bushes;At<Pt.length;At++){var St=Pt[At];if(St.isActive()){var Ot=this.howToDraw(St),Dt=Ot.x;k=Ot.y,A=Ot.size;Ot.isOnScreen&&(t.save(),t.globalAlpha=St.getOpacity(),t.drawImage(this.bushSVG,Dt,k,A,A),t.restore())}}for(var Mt=0,zt=this.map.trees;Mt<zt.length;Mt++){var Yt=zt[Mt];if(Yt.isActive()){var Xt=this.howToDraw(Yt),It=Xt.x;k=Xt.y,A=Xt.size;Xt.isOnScreen&&(t.save(),t.globalAlpha=Yt.getOpacity(),t.drawImage(this.treeSVG,It,k,A,A),t.restore())}}t.fillStyle="red";for(var Wt=0,Gt=this.bullets;Wt<Gt.length;Wt++){var Rt=Gt[Wt],_t=this.howToDraw({x:Rt.getX(),y:Rt.getY(),size:Rt.size}),jt=_t.x;k=_t.y,A=_t.size;_t.isOnScreen&&t.fillRect(jt,k,A,A)}var Vt=this.player.loading(),Ht=Vt.time,Et=Vt.max;if(Ht<Et){var Nt=360/(Et/Ht),Ft=100*this.resolutionAdjustment,Kt=(X=Ft/2,this.screenCenterX-X),Lt=(k=this.screenCenterY-X-150*this.resolutionAdjustment,Math.round((Et-Ht)/60*10)/10);t.save(),t.globalAlpha=.2,t.drawImage(this.loadingCircleSVG,Kt,k,Ft,Ft),t.restore();for(o=0;o<Nt;o+=10)this.ctx.save(),this.ctx.translate(Kt+X,k+X),this.ctx.rotate(o*Math.PI/180),t.drawImage(this.loadingProgresSVG,-X,-X,Ft,Ft),this.ctx.restore();var qt=Math.floor(31*this.resolutionAdjustment);t.font=qt+"px Arial",t.fillStyle="white",t.fillText(Lt.toString(),Kt+28*this.resolutionAdjustment,k+59*this.resolutionAdjustment)}t.font="20px Arial",t.fillStyle="white";var Bt=0;t.fillText("snapshots: "+this.playersTicks.length,15,30*++Bt),t.fillText("ping: "+this.serverClientSync.getPing(),15,30*++Bt),t.fillText("timeDiference: "+this.serverClientSync.getTimeDiference(),15,30*++Bt),t.fillText("drawDelay: "+this.serverClientSync.getDrawDelay(),15,30*++Bt);t.drawImage(this.cursorSVG,this.mouse.x-25*this.resolutionAdjustment/2,this.mouse.y-25*this.resolutionAdjustment/2,25*this.resolutionAdjustment,25*this.resolutionAdjustment)},t.prototype.howToDraw=function(t){var e=0,i=0,s=0;t.size?(i=e=t.size*this.resolutionAdjustment,s=e):(i=t.width*this.resolutionAdjustment,s=t.height*this.resolutionAdjustment);var r=0,n=0;if(t instanceof h){var a=t.animate();r=a.x,n=a.y}var o=this.screenCenterX+(t.x+r-this.myPlayerCenterX)*this.resolutionAdjustment,l=this.screenCenterY+(t.y+n-this.myPlayerCenterY)*this.resolutionAdjustment,c=!0;return(o>this.canvas.width||o<-i||l>this.canvas.height||l<-s)&&(c=!1),{x:o,y:l,size:e,width:i,height:s,isOnScreen:c}},t}(),l=function(){function t(t){this.size=40,this.x=0,this.y=0,this.radius=this.size/2,this.shiftAngle=40,this.hitTimer=0,this.inAction=!1,this.collisionPoints=[],this.playerRadius=t/2,this.calculateCollisionsPoints()}return t.prototype.calculateCollisionsPoints=function(){for(var t=0;t<360;t+=20){var e=Math.sin(t*Math.PI/180)*this.radius,i=Math.cos(t*Math.PI/180)*this.radius;this.collisionPoints.push(new a(e,i))}},t.prototype.ready=function(){return 0===this.hitTimer},t.prototype.getCenterX=function(){return this.x+this.radius},t.prototype.getCenterY=function(){return this.y+this.radius},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.moveHand=function(t,e,i,s,r,n){var h=this.shiftAngle,o=this.playerRadius;if(this.hitTimer>0){switch(this.hitTimer){case 20:h-=4,o+=2;break;case 19:h-=8,o+=4;break;case 18:h-=12,o+=6;break;case 17:h-=16,o+=8;break;case 16:h-=20,o+=10;break;case 15:h-=24,o+=12;break;case 14:h-=28,o+=14;break;case 13:h-=32,o+=16;break;case 12:h-=36,o+=18;break;case 11:h-=40,o+=20;break;case 10:h-=36,o+=18;break;case 9:h-=32,o+=16;break;case 8:h-=28,o+=14;break;case 7:h-=24,o+=12;break;case 6:h-=20,o+=10;break;case 5:h-=16,o+=8;break;case 4:h-=12,o+=6;break;case 3:h-=8,o+=4;break;case 2:h-=4,o+=2;break;case 1:h-=0,o+=0}if(this.inAction)for(var l=0;l<n.bushes.length;l++){if((m=n.bushes[l]).isActive()){var c=m.radius+this.radius,g=this.getCenterX()-m.getCenterX(),u=this.getCenterY()-m.getCenterY();if(Math.sqrt(g*g+u*u)<c){m.acceptHit(new a(this.getCenterX(),this.getCenterY())),this.inAction=!1;break}}}if(this.inAction)for(l=0;l<n.rocks.length;l++){if((m=n.rocks[l]).isActive()){c=m.radius+this.radius;var p=this.getCenterX()-m.getCenterX(),y=this.getCenterY()-m.getCenterY();if(Math.sqrt(p*p+y*y)<c){m.acceptHit(new a(this.getCenterX(),this.getCenterY())),this.inAction=!1;break}}}if(this.inAction)for(l=0;l<n.trees.length;l++){if((m=n.trees[l]).isActive()){c=m.radius+this.radius;var f=this.getCenterX()-m.getCenterX(),d=this.getCenterY()-m.getCenterY();if(Math.sqrt(f*f+d*d)<c){m.acceptHit(new a(this.getCenterX(),this.getCenterY())),this.inAction=!1;break}}}if(this.inAction)for(l=0;l<n.rectangleObstacles.length;l++){var m;if((m=n.rectangleObstacles[l]).isActive()&&this.x<=m.x+m.width&&this.x+this.size>=m.x&&this.y<=m.y+m.height&&this.y+this.size>=m.y)for(var v=0;v<this.collisionPoints.length;v++){var w=this.collisionPoints[v];if(m.isPointIn(new a(this.getCenterX()+w.x,this.getCenterY()+w.y))){m.acceptHit(),this.inAction=!1,console.log("hit");break}}}this.hitTimer--}var b=t+h*e;b<0&&(b=359+b),b>359&&(b-=359);var x=Math.sin(b*Math.PI/180)*o,C=Math.cos(b*Math.PI/180)*o;this.x=s+i/2+x-this.size/2,this.y=r+i/2-C-this.size/2},t.prototype.hit=function(){this.hitTimer=20,this.inAction=!0},t}(),c=function(){function t(t,e){this.size=70,this.x=0,this.y=0,this.angle=0,this.playerRadius=t/2,this.range=e}return t.prototype.move=function(t,e,i){this.angle=t;var s=Math.sin(this.angle*Math.PI/180)*this.playerRadius,r=Math.cos(this.angle*Math.PI/180)*this.playerRadius;this.x=e+s-this.size/2,this.y=i-r-this.size/2},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.getAngle=function(){return this.angle},t.prototype.ready=function(){return!0},t}(),g=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),u=function(t){function e(e,i,s){var r=this;return(r=t.call(this,e,i,s,200)||this).treeTrankRadius=35,r.opacity=.9,r}return g(e,t),e}(h),p=function(){function t(t){this.size=80,this.radius=this.size/2,this.speed=6,this.angle=0,this.hands=[],this.collisionPoints=[],this.slowAroundObstacle=!1,this.loadingTime=0,this.loadingMaxTime=180,this.x=550,this.y=700,this.canvas=document.getElementById("gameScreen"),this.hands.push(new l(this.size)),this.hands.push(new l(this.size)),this.gun=new c(this.size,20),this.map=t,this.calculateCollisionsPoints()}return t.prototype.calculateCollisionsPoints=function(){for(var t=0;t<360;t+=10){var e=Math.sin(t*Math.PI/180)*this.radius,i=Math.cos(t*Math.PI/180)*this.radius;this.collisionPoints.push(new a(e,i))}},t.prototype.loading=function(){return this.loadingTime<this.loadingMaxTime&&this.loadingTime++,{time:this.loadingTime,max:this.loadingMaxTime}},t.prototype.getCenterX=function(){return this.x+this.radius},t.prototype.getCenterY=function(){return this.y+this.radius},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.getAngle=function(){return this.angle},t.prototype.setAngle=function(t){this.angle=t},t.prototype.hit=function(){if(this.hands[0].ready()&&this.hands[1].ready()){var t=Math.round(Math.random());this.hands[t].hit()}},t.prototype.playerMove=function(t,e,i,r,n,a){if(t||i||e||r){var h=this.speed;(t&&e||t&&r||i&&e||i&&r||this.slowAroundObstacle)&&(h/=Math.sqrt(2),this.slowAroundObstacle=!1);for(var o=0;o<this.map.terrain.length;o++)if(this.getCenterX()<this.map.terrain[o].x+this.map.terrain[o].width&&this.getCenterX()>=this.map.terrain[o].x&&this.getCenterY()<this.map.terrain[o].y+this.map.terrain[o].height&&this.getCenterY()>=this.map.terrain[o].y&&(this.map.terrain[o].type===s.Water&&(h/=2),this.map.terrain[o].type===s.WaterTriangle1||this.map.terrain[o].type===s.WaterTriangle2||this.map.terrain[o].type===s.WaterTriangle3||this.map.terrain[o].type===s.WaterTriangle4)){var l=Math.floor(this.getCenterX()-this.map.terrain[o].x),c=Math.floor(this.getCenterY()-this.map.terrain[o].y);this.map.waterTerrainData.includeWater(this.map.terrain[o].type,l,c)&&(h/=2)}var g=0,u=0;t&&(u+=-h),i&&(u+=h),e&&(g+=-h),r&&(g+=h),this.shiftOnPosition(g,u)}this.rotatePlayer(n,a),this.gun.move(this.angle,this.getCenterX(),this.getCenterY()),this.changeHandsPosition()},t.prototype.changeHandsPosition=function(){this.hands[0].moveHand(this.angle,-1,this.size,this.x,this.y,this.map),this.hands[1].moveHand(this.angle,1,this.size,this.x,this.y,this.map)},t.prototype.shiftOnPosition=function(t,e){var i=0;0!==t&&i++,0!==e&&i++;var s=1;e<0&&(s=-1);for(var r=0;r<Math.abs(e);r++)if(this.canIshift(0,e-r*s,i)){this.y+=e-r*s;break}s=1,t<0&&(s=-1);for(r=0;r<Math.abs(t);r++)if(this.canIshift(t-r*s,0,i)){this.x+=t-r*s;break}this.x+this.size>this.map.width&&(this.x=this.map.width-this.size),this.x<0&&(this.x=0),this.y+this.size>this.map.height&&(this.y=this.map.height-this.size),this.y<0&&(this.y=0)},t.prototype.canIshift=function(t,e,i){for(var s=0;s<this.map.rectangleObstacles.length;s++){var r=this.map.rectangleObstacles[s];if(r.isActive()&&this.x+t+this.size>=r.x&&this.x+t<=r.x+r.width&&this.y+e<=r.y+r.height&&this.y+e+this.size>=r.y)for(var n=0;n<this.collisionPoints.length;n++){var h=this.collisionPoints[n],o=new a(this.getCenterX()+t+h.x,this.getCenterY()+e+h.y);if(r.isPointIn(o))return this.goAroundRectangleObstacle(t,e,i,r),!1}}for(s=0;s<this.map.impassableRoundObstacles.length;s++){var l=this.map.impassableRoundObstacles[s];if(l.isActive()){var c=l.radius;l instanceof u&&(c=l.treeTrankRadius);var g=c+this.radius,p=this.getCenterX()+t-l.getCenterX(),y=this.getCenterY()+e-l.getCenterY();if(Math.sqrt(p*p+y*y)<g)return this.goAroundRoundObstacle(t,e,i,l),!1}}return!0},t.prototype.goAroundRectangleObstacle=function(t,e,i,s){this.slowAroundObstacle=!0;var r=.75*this.size;if(1===i&&(0!==t&&(this.getCenterY()<=s.y+s.height/2?this.y+this.size-s.y<r&&this.shiftOnPosition(0,-1):s.y+s.height-this.y<r&&this.shiftOnPosition(0,1)),0!==e&&(this.getCenterX()<=s.x+s.width/2?this.x+this.size-s.x<r&&this.shiftOnPosition(-1,0):s.x+s.width-this.x<r&&this.shiftOnPosition(1,0))),2===i)if(this.slowAroundObstacle=!1,this.getCenterX()<s.x+s.width/2&&this.getCenterY()>s.y+s.height/2)Math.abs(this.getCenterX()-s.x)<=Math.abs(this.getCenterY()-(s.y+s.height))?this.shiftOnPosition(.1,0):this.shiftOnPosition(0,-.1);else if(this.getCenterX()>s.x+s.width/2&&this.getCenterY()>s.y+s.height/2){Math.abs(this.getCenterX()-(s.x+s.width))<=Math.abs(this.getCenterY()-(s.y+s.height))?this.shiftOnPosition(-.1,0):this.shiftOnPosition(0,-.1)}else if(this.getCenterX()>s.x+s.width/2&&this.getCenterY()<s.y+s.height/2){Math.abs(this.getCenterX()-(s.x+s.width))<=Math.abs(this.getCenterY()-s.y)?this.shiftOnPosition(-.1,0):this.shiftOnPosition(0,.1)}else if(this.getCenterX()<s.x+s.width/2&&this.getCenterY()<s.y+s.height/2){Math.abs(this.getCenterX()-s.x)<=Math.abs(this.getCenterY()-s.y)?this.shiftOnPosition(.1,0):this.shiftOnPosition(0,.1)}},t.prototype.goAroundRoundObstacle=function(t,e,i,s){(this.slowAroundObstacle=!0,1===i&&(0!==t&&(this.getCenterY()>=s.getCenterY()&&this.shiftOnPosition(0,1),this.getCenterY()<s.getCenterY()&&this.shiftOnPosition(0,-1)),0!==e&&(this.getCenterX()>=s.getCenterX()&&this.shiftOnPosition(1,0),this.getCenterX()<s.getCenterX()&&this.shiftOnPosition(-1,0))),2===i)&&(Math.abs(this.getCenterX()-s.getCenterX())<=Math.abs(this.getCenterY()-s.getCenterY())?(this.getCenterX()<=s.getCenterX()&&this.shiftOnPosition(.5,0),this.getCenterX()>s.getCenterX()&&this.shiftOnPosition(-.5,0)):(this.getCenterY()<=s.getCenterY()&&this.shiftOnPosition(0,.5),this.getCenterY()>s.getCenterY()&&this.shiftOnPosition(0,-.5)))},t.prototype.rotatePlayer=function(t,e){var i=this.canvas.width/2,s=this.canvas.height/2,r=i-t,n=s-e;0===r&&(r=.1);var a=Math.abs(180*Math.atan(r/n)/Math.PI);t>=i&&e<s&&(this.angle=a),t>=i&&e>=s&&(this.angle=180-a),t<i&&e>=s&&(this.angle=180+a),t<i&&e<s&&(this.angle=360-a),this.angle=Math.round(this.angle),360===this.angle&&(this.angle=0)},t}(),y=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),f=function(t){function e(e,i,s){var r=this;return(r=t.call(this,e,i,s,100)||this).opacity=.9,r}return y(e,t),e}(h),d=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),m=function(t){function e(e,i,s){var r=this;return(r=t.call(this,e,i,s,100)||this).opacity=1,r}return d(e,t),e}(h),v=function(){function t(t,e,i,s,r){this.changed=!1,this.opacity=1,this.active=!0,this.id=t,this.x=e,this.y=i,this.width=s,this.height=r}return t.prototype.getChanged=function(){return this.changed},t.prototype.nullChanged=function(){this.changed=!1},t.prototype.getChangedData=function(){return{id:this.id,opacity:this.opacity}},t.prototype.update=function(t){this.opacity=t},t.prototype.isPointIn=function(t){var e=t.x,i=t.y;return e<this.x+this.width&&e>=this.x&&i>=this.y&&i<this.y+this.height},t.prototype.getOpacity=function(){return this.opacity},t.prototype.isActive=function(){return this.active},t.prototype.acceptHit=function(){this.active&&(this.opacity>.1&&(this.opacity-=.1),this.opacity<.1&&(this.active=!1),this.changed=!0)},t}(),w=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),b=function(t){function e(e,i,s,r,n){return t.call(this,e,i,s,r,n)||this}return w(e,t),e}(v),x=function(){return function(t){this.blocks=[],this.terrain=[],this.impassableRoundObstacles=[],this.bushes=[],this.trees=[],this.rocks=[],this.rectangleObstacles=[],this.waterTerrainData=t,this.width=1500,this.height=1500;for(var e=0;e<this.height/300;e++)for(var i=0;i<this.width/300;i++)this.blocks.push({x:300*i,y:300*e});this.terrain.push(new n(s.Water,0,0,this.width,300)),this.terrain.push(new n(s.Water,0,this.height-300,this.width,300)),this.terrain.push(new n(s.Water,0,300,300,this.height-600)),this.terrain.push(new n(s.Water,this.width-300,300,300,this.height-600)),this.terrain.push(new n(s.WaterTriangle1,300,300,300,300)),this.terrain.push(new n(s.WaterTriangle2,900,300,300,300)),this.terrain.push(new n(s.WaterTriangle3,900,900,300,300)),this.terrain.push(new n(s.WaterTriangle4,300,900,300,300));var r=0;this.bushes.push(new f(++r,600,600)),this.bushes.push(new f(++r,300,400));var a=new m(++r,100,100);this.rocks.push(a),this.impassableRoundObstacles.push(a);var h=new m(++r,550,550);this.rocks.push(h),this.impassableRoundObstacles.push(h);var o=new m(++r,700,550);this.rocks.push(o),this.impassableRoundObstacles.push(o);var l=new u(++r,800,800);this.trees.push(l),this.impassableRoundObstacles.push(l);var c=new u(++r,0,0);this.trees.push(c),this.impassableRoundObstacles.push(c),this.rectangleObstacles.push(new b(++r,600,800,20,200)),this.rectangleObstacles.push(new b(++r,500,900,200,20)),this.rectangleObstacles.push(new b(++r,500,350,300,100))}}(),C=function(){function t(){this.waterTriangle1=[],this.waterTriangle2=[],this.waterTriangle3=[],this.waterTriangle4=[]}return t.prototype.setData=function(t,e){switch(t){case s.WaterTriangle1:this.waterTriangle1=e;break;case s.WaterTriangle2:this.waterTriangle2=e;break;case s.WaterTriangle3:this.waterTriangle3=e;break;case s.WaterTriangle4:this.waterTriangle4=e;break;default:throw new Error("Unknown water type")}},t.prototype.includeWater=function(t,e,i){var r,n=!1;switch(t){case s.WaterTriangle1:r=this.waterTriangle1;break;case s.WaterTriangle2:r=this.waterTriangle2;break;case s.WaterTriangle3:r=this.waterTriangle3;break;case s.WaterTriangle4:r=this.waterTriangle4;break;default:throw new Error("Unknown water type")}if(e<r.length&&i<r[e].length)r[e][i]&&(n=!0);else{if(0!==r.length)throw new Error("Out of range on water type");n=!0}return n},t}(),T=function(){function t(t,e,i,s){var r=this;this.game=0,this.playersTicks=[],this.bullets=[],this.socket=i,this.serverClientSync=s,this.waterTerrainData=new C,this.map=new x(this.waterTerrainData),this.player=new p(this.map),this.keys=t,this.mouse=e,this.view=new o(this.map,this.player,this.playersTicks,this.bullets,this.mouse,this.waterTerrainData,this.serverClientSync),setTimeout(function(){r.gameLoop()},200)}return t.prototype.setID=function(t){this.id=t},t.prototype.setName=function(t){this.name=t},t.prototype.getID=function(){return this.id},t.prototype.getName=function(){return this.name},t.prototype.getGame=function(){return this.game},t.prototype.gameLoop=function(){var t=this;requestAnimationFrame(function(){t.gameLoop()}),this.serverClientSync.ready()||this.socket.emit("serverClientSync",Date.now()),this.view.draw()},t.prototype.screenResize=function(){this.view.screenResize()},t}(),k=function(){function t(){this.ping=null,this.pings=[],this.timeDiference=null,this.timeDiferences=[],this.attempts=5,this.defaultDrawDelay=100,this.drawDelay=this.defaultDrawDelay}return t.prototype.getPing=function(){return this.ping},t.prototype.getTimeDiference=function(){return this.timeDiference},t.prototype.ready=function(){return null!=this.ping&&null!=this.timeDiference},t.prototype.reset=function(){this.ping=null,this.pings=[],this.timeDiference=null,this.timeDiferences=[]},t.prototype.addData=function(t,e){if(this.ready()||(this.pings.push(t),this.timeDiferences.push(e)),this.pings.length===this.attempts){for(var i=0,s=0,r=this.pings;s<r.length;s++){i+=r[s]}this.ping=i/this.attempts;for(var n=0,a=0,h=this.timeDiferences;a<h.length;a++){n+=h[a]}this.timeDiference=n/this.attempts}},t.prototype.changeDrawDelay=function(t){this.drawDelay+=t,this.drawDelay<0&&(this.drawDelay=0)},t.prototype.getDrawDelay=function(){return this.drawDelay},t.prototype.getServerTime=function(){var t=0;return this.ready()&&(t=Date.now()+this.getTimeDiference()),t},t}();(function(){function t(){var t=this;this.keys={w:!1,a:!1,s:!1,d:!1},this.mouse={x:0,y:0,left:!1,middle:!1,right:!1},this.playerAngle=0,this.canvas=document.getElementsByTagName("canvas")[0],this.socket=io.connect("http://192.168.0.2:8888"),this.serverClientSync=new k,this.model=new T(this.keys,this.mouse,this.socket,this.serverClientSync),window.addEventListener("resize",function(){t.model.screenResize();var e=new Event("mousemove");t.canvas.dispatchEvent(e)}),this.keysController(),this.mouseController(),this.socketController()}return t.run=function(){if(t.instance)throw new Error("Only one controller!");t.instance=new t},t.prototype.socketController=function(){var t=this;this.socket.emit("createPlayer","playerName",this.model.getGame()),this.socket.on("createPlayer",function(e,i){e&&i?(t.model.setID(e),t.model.setName(i),console.log("player created",e)):console.log("error created player",e,i)}),this.socket.on("serverClientSync",function(e,i){var s=Date.now(),r=s-e,n=i-(s-r/2);t.serverClientSync.addData(r,n)}),this.socket.on("u",function(e){var i=Math.round(50*Math.random());setTimeout(function(){t.model.playersTicks.push(e),t.model.playersTicks.length>50&&t.model.playersTicks.splice(0,1)},i)}),this.socket.on("u",function(e,i){if("w"===e)for(var s=0,r=t.model.map.rectangleObstacles;s<r.length;s++){var n=r[s];if(n.id===i.id){n.update(i.opacity);break}}if("r"===e)for(var a=0,h=t.model.map.impassableRoundObstacles;a<h.length;a++){if((c=h[a]).id===i.id){c.update(i.opacity);break}}if("b"===e)for(var o=0,l=t.model.map.bushes;o<l.length;o++){var c;if((c=l[o]).id===i.id){c.update(i.opacity);break}}})},t.prototype.mouseController=function(){var t=this;this.canvas.addEventListener("mousemove",function(e){null==e.x?(t.mouse.x=t.canvas.width/2,t.mouse.y=t.canvas.height/2):(t.mouse.x=e.x,t.mouse.y=e.y);var i=t.playerAngle;t.rotatePlayer(t.mouse.x,t.mouse.y),t.playerAngle!==i&&t.socket.emit("a",t.model.getGame(),t.model.getID(),t.playerAngle)}),this.canvas.addEventListener("click",function(e){t.mouse.left=!0,t.socket.emit("m",t.model.getGame(),t.model.getID(),"l")})},t.prototype.rotatePlayer=function(t,e){var i=this.canvas.width/2,s=this.canvas.height/2,r=i-t,n=s-e;0===r&&(r=.1);var a=Math.abs(180*Math.atan(r/n)/Math.PI);t>=i&&e<s&&(this.playerAngle=a),t>=i&&e>=s&&(this.playerAngle=180-a),t<i&&e>=s&&(this.playerAngle=180+a),t<i&&e<s&&(this.playerAngle=360-a),this.playerAngle=Math.round(this.playerAngle),360===this.playerAngle&&(this.playerAngle=0)},t.prototype.keysController=function(){var t=this;document.addEventListener("keydown",function(e){switch(e.code){case"KeyW":t.keys.w||t.socket.emit("c",t.model.getGame(),t.model.getID(),"u"),t.keys.w=!0;break;case"KeyA":t.keys.a||t.socket.emit("c",t.model.getGame(),t.model.getID(),"l"),t.keys.a=!0;break;case"KeyS":t.keys.s||t.socket.emit("c",t.model.getGame(),t.model.getID(),"d"),t.keys.s=!0;break;case"KeyD":t.keys.d||t.socket.emit("c",t.model.getGame(),t.model.getID(),"r"),t.keys.d=!0}}),document.addEventListener("keyup",function(e){switch(e.code){case"KeyW":t.keys.w&&t.socket.emit("c",t.model.getGame(),t.model.getID(),"-u"),t.keys.w=!1;break;case"KeyA":t.keys.a&&t.socket.emit("c",t.model.getGame(),t.model.getID(),"-l"),t.keys.a=!1;break;case"KeyS":t.keys.s&&t.socket.emit("c",t.model.getGame(),t.model.getID(),"-d"),t.keys.s=!1;break;case"KeyD":t.keys.d&&t.socket.emit("c",t.model.getGame(),t.model.getID(),"-r"),t.keys.d=!1}})},t})().run()}]);
//# sourceMappingURL=app.js.map