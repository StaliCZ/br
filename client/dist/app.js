!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([,function(t,e,i){"use strict";var s;i.r(e),function(t){t[t.Water=0]="Water",t[t.WaterTriangle1=1]="WaterTriangle1",t[t.WaterTriangle2=2]="WaterTriangle2",t[t.WaterTriangle3=3]="WaterTriangle3",t[t.WaterTriangle4=4]="WaterTriangle4"}(s||(s={}));var r,n=function(){return function(t,e,i,r,n){switch(this.angle=0,this.type=t,this.x=e,this.y=i,this.width=r,this.height=n,t){case s.WaterTriangle2:this.angle=90;break;case s.WaterTriangle3:this.angle=180;break;case s.WaterTriangle4:this.angle=270}}}(),a=function(){return function(t,e){this.x=t,this.y=e}}(),h=function(){function t(t,e,i){this.opacity=1,this.active=!0,this.hitAnimateTimer=0,this.x=t,this.y=e,this.size=i,this.radius=i/2}return t.prototype.isPointIn=function(t){var e=this.x+this.radius-t.x,i=this.y+this.radius-t.y;return Math.sqrt(e*e+i*i)<=this.radius},t.prototype.getCenterX=function(){return this.x+this.size/2},t.prototype.getCenterY=function(){return this.y+this.size/2},t.prototype.getOpacity=function(){return this.opacity},t.prototype.isActive=function(){return this.active},t.prototype.acceptHit=function(t){this.opacity>.1&&(this.opacity-=.1),this.createAnimateHit(t),this.opacity<.1&&(this.active=!1)},t.prototype.createAnimateHit=function(t){var e=t.x-this.getCenterX(),i=t.y-this.getCenterY(),s=Math.abs(Math.atan(e/i)*(180/Math.PI));t.x>=this.getCenterX()&&t.y<this.getCenterY()&&(s=s),t.x>=this.getCenterX()&&t.y>=this.getCenterY()&&(s=180-s),t.x<this.getCenterX()&&t.y>=this.getCenterY()&&(s=180+s),t.x<this.getCenterX()&&t.y<this.getCenterY()&&(s=360-s),360===(s=Math.round(s))&&(s=0),this.hitAnimateTimer=10;this.hitAnimateShiftX=3*Math.sin(s*Math.PI/180)*-1,this.hitAnimateShiftY=3*Math.cos(s*Math.PI/180)},t.prototype.animate=function(){var t=0,e=0;switch(this.hitAnimateTimer>0&&this.hitAnimateTimer--,this.hitAnimateTimer){case 1:t=this.hitAnimateShiftX,e=this.hitAnimateShiftY;break;case 2:t=2*this.hitAnimateShiftX,e=2*this.hitAnimateShiftY;break;case 3:t=3*this.hitAnimateShiftX,e=3*this.hitAnimateShiftY;break;case 4:t=4*this.hitAnimateShiftX,e=4*this.hitAnimateShiftY;break;case 5:t=5*this.hitAnimateShiftX,e=5*this.hitAnimateShiftY;break;case 6:t=4*this.hitAnimateShiftX,e=4*this.hitAnimateShiftY;break;case 7:t=3*this.hitAnimateShiftX,e=3*this.hitAnimateShiftY;break;case 8:t=2*this.hitAnimateShiftX,e=2*this.hitAnimateShiftY;break;case 9:t=1*this.hitAnimateShiftX,e=1*this.hitAnimateShiftY}return new a(t,e)},t}(),o=function(){function t(t,e,i,r,n,a){var h=this;this.resolutionAdjustment=1,this.startDraw=!1,this.serverClientSync=a,this.map=t,this.player=e,this.bullets=i,this.mouse=r,this.canvas=document.getElementById("gameScreen"),this.helperCanvas=document.getElementById("helper"),this.ctx=this.canvas.getContext("2d"),this.playerSVG=new Image,this.playerSVG.src="img/player.svg",this.playerHandSVG=new Image,this.playerHandSVG.src="img/hand.svg",this.bushSVG=new Image,this.bushSVG.src="img/bush.svg",this.rockSVG=new Image,this.rockSVG.src="img/rock.svg",this.treeSVG=new Image,this.treeSVG.src="img/tree.svg",this.cursorSVG=new Image,this.cursorSVG.src="img/cursor.svg",this.loadingProgresSVG=new Image,this.loadingProgresSVG.src="img/loadingProgres.svg",this.loadingCircleSVG=new Image,this.loadingCircleSVG.src="img/loadingCircle.svg",this.pistolSVG=new Image,this.pistolSVG.src="img/pistol.svg",this.waterTrianglePNG=new Image,this.waterTrianglePNG.src="img/waterTriangle.png",this.waterTerrainData=n,this.waterTrianglePNG.onload=function(){h.saveWaterPixels(s.WaterTriangle1),h.saveWaterPixels(s.WaterTriangle2),h.saveWaterPixels(s.WaterTriangle3),h.saveWaterPixels(s.WaterTriangle4)},this.screenResize()}return t.prototype.screenResize=function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.screenCenterX=window.innerWidth/2,this.screenCenterY=window.innerHeight/2,this.changeResolutionAdjustment()},t.prototype.changeResolutionAdjustment=function(){var t=(this.canvas.width/1920+this.canvas.height/1050)/2;this.resolutionAdjustment=t},t.prototype.saveWaterPixels=function(t){var e=this,i=this.helperCanvas.getContext("2d");this.helperCanvas.width=this.waterTrianglePNG.width,this.helperCanvas.height=this.waterTrianglePNG.height,i.fillStyle="#FFFFFF",i.fillRect(0,0,this.helperCanvas.width,this.helperCanvas.height);var r=this.waterTrianglePNG.width/2;switch(i.save(),i.translate(r,r),t){case s.WaterTriangle1:i.rotate(0*Math.PI/180);break;case s.WaterTriangle2:i.rotate(90*Math.PI/180);break;case s.WaterTriangle3:i.rotate(180*Math.PI/180);break;case s.WaterTriangle4:i.rotate(270*Math.PI/180)}if(i.drawImage(this.waterTrianglePNG,-r,-r),i.restore(),"undefined"!=typeof Worker){var n=new Worker("workerFindWater.js");n.onmessage=function(t){e.waterTerrainData.setData(t.data.type,t.data.data)};var a=i.getImageData(0,0,this.waterTrianglePNG.width,this.waterTrianglePNG.height).data;n.postMessage({data:a,size:this.waterTrianglePNG.width,type:t,time:(new Date).getTime()})}else console.log("Your browser doesn't support web workers.")},t.prototype.draw=function(){var t=this.ctx;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="#69A2E0",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="#A2CB69";for(var e=this.map.blocks[1].x,i=0,r=this.map.blocks;i<r.length;i++){var n=r[i],a=this.howToDraw({x:n.x,y:n.y,size:e}),h=a.x,o=a.y,c=a.size;a.isOnScreen&&t.fillRect(h,o,c,c)}t.fillStyle="#69A2E0";for(var l=0,u=this.map.terrain;l<u.length;l++){var g=u[l],p=this.howToDraw({x:g.x,y:g.y,width:g.width,height:g.height}),y=(h=p.x,o=p.y,p.width),f=p.height;if(p.isOnScreen)if(g.type===s.Water)t.fillRect(h,o,y,f);else if(g.type===s.WaterTriangle1)t.drawImage(this.waterTrianglePNG,h,o,y,f);else if(g.type===s.WaterTriangle2||g.type===s.WaterTriangle3||g.type===s.WaterTriangle4){var d=y/2;this.ctx.save(),this.ctx.translate(h+d,o+d),this.ctx.rotate(g.angle*Math.PI/180),this.ctx.drawImage(this.waterTrianglePNG,-d,-d,y,f),this.ctx.restore()}}t.fillStyle="gray";for(var m=0,v=this.map.blocks;m<v.length;m++){if(0===(n=v[m]).y){var w=this.howToDraw({x:n.x,y:n.y,size:e});h=w.x,o=w.y,c=w.size;w.isOnScreen&&t.fillRect(h,o,c,1)}var b=this.howToDraw({x:n.x,y:n.y+e,size:e});h=b.x,o=b.y,c=b.size;if(b.isOnScreen&&t.fillRect(h,o,c,1),0===n.x){var x=this.howToDraw({x:n.x,y:n.y,size:e});h=x.x,o=x.y,c=x.size;x.isOnScreen&&t.fillRect(h,o,1,c)}var C=this.howToDraw({x:n.x+e,y:n.y,size:e});h=C.x,o=C.y,c=C.size;C.isOnScreen&&t.fillRect(h,o,1,c)}for(var T=0,k=this.map.rocks;T<k.length;T++){var A=k[T];if(A.isActive()){var S=this.howToDraw(A);h=S.x,o=S.y,c=S.size;S.isOnScreen&&(t.save(),t.globalAlpha=A.getOpacity(),t.drawImage(this.rockSVG,h,o,c,c),t.restore())}}t.fillStyle="black";for(var O=0,D=this.map.rectangleObstacles;O<D.length;O++){var Y=D[O];if(Y.isActive()){var M=this.howToDraw(Y);h=M.x,o=M.y,y=M.width,f=M.height;M.isOnScreen&&(t.save(),t.globalAlpha=Y.getOpacity(),t.fillRect(h,o,y,f),t.restore())}}var X=this.howToDraw({x:this.player.gun.getX(),y:this.player.gun.getY(),size:this.player.gun.size});h=X.x,o=X.y,d=(c=X.size)/2;this.ctx.save(),this.ctx.translate(h+d,o+d),this.ctx.rotate(this.player.gun.getAngle()*Math.PI/180),t.drawImage(this.pistolSVG,-d,-d,c,c),this.ctx.restore();for(var z=0,W=this.player.hands;z<W.length;z++){var I=W[z],R=this.howToDraw({x:I.getX(),y:I.getY(),size:I.size});h=R.x,o=R.y,c=R.size;t.drawImage(this.playerHandSVG,h,o,c,c);for(var G=0,_=I.collisionPoints;G<_.length;G++){var j=_[G],V=this.howToDraw({x:I.getCenterX()+j.x,y:I.getCenterY()+j.y,size:1}),H=V.x,E=V.y,N=V.size;t.fillRect(H,E,N,N)}}if(P.playerData.sort(function(t,e){return t.tick-e.tick}),P.playerData.length>50&&P.playerData.splice(0,5),this.serverClientSync.ready()){t.fillStyle="white",t.fillText("Count frames: "+P.playerData.length,20,40),t.fillText("Time Diference: "+this.serverClientSync.getTimeDiference(),20,80),t.fillText("Draw delay "+this.serverClientSync.getDrawDelay(),20,120);var F=1;this.serverClientSync.getTimeDiference()<0&&(F=-1);for(var K=Date.now()+this.serverClientSync.getTimeDiference()*F-this.serverClientSync.getDrawDelay(),L=void 0,q=0,B=P.playerData;q<B.length;q++){(Z=B[q]).time<=K&&(L=Z)}for(var U=void 0,J=0,Q=P.playerData.length-1;Q>=0;Q--){var Z;(Z=P.playerData[Q]).time>=K&&(U=Z,J++)}if(J>2&&this.serverClientSync.changeDrawDelay(-.1),J<2&&this.serverClientSync.changeDrawDelay(.1),L||console.log("olderFrame is missing"),U||console.log("newerFrame is missing"),L&&U||(this.serverClientSync.reset(),t.fillStyle="white",t.fillText("frame missing",20,300)),L&&U){var $=U.time-L.time,tt=K-L.time,et=0;$&&(et=tt/$);var it=Math.abs(U.x-L.x),st=1;U.x<L.x&&(st=-1);var rt=L.x+it*et*st,nt=this.howToDraw({x:rt,y:300,size:this.player.size});h=nt.x,o=nt.y,c=nt.size;t.drawImage(this.playerSVG,h,o,c,c)}}t.fillStyle="blue";for(var at=0,ht=this.player.collisionPoints;at<ht.length;at++){j=ht[at];var ot=this.howToDraw({x:this.player.getCenterX()+j.x,y:this.player.getCenterY()+j.y,size:1});h=ot.x,o=ot.y,c=ot.size;t.fillRect(h,o,c,c)}for(var ct=0,lt=this.map.bushes;ct<lt.length;ct++){var ut=lt[ct];if(ut.isActive()){var gt=this.howToDraw(ut);h=gt.x,o=gt.y,c=gt.size;gt.isOnScreen&&(t.save(),t.globalAlpha=ut.getOpacity(),t.drawImage(this.bushSVG,h,o,c,c),t.restore())}}for(var pt=0,yt=this.map.trees;pt<yt.length;pt++){var ft=yt[pt];if(ft.isActive()){var dt=this.howToDraw(ft);h=dt.x,o=dt.y,c=dt.size;dt.isOnScreen&&(t.save(),t.globalAlpha=ft.getOpacity(),t.drawImage(this.treeSVG,h,o,c,c),t.restore())}}t.fillStyle="red";for(var mt=0,vt=this.bullets;mt<vt.length;mt++){var wt=vt[mt],bt=this.howToDraw({x:wt.getX(),y:wt.getY(),size:wt.size});h=bt.x,o=bt.y,c=bt.size;bt.isOnScreen&&t.fillRect(h,o,c,c)}var xt=this.player.loading(),Ct=xt.time,Tt=xt.max;if(Ct<Tt){var kt=360/(Tt/Ct),At=100*this.resolutionAdjustment,Pt=(d=At/2,h=this.screenCenterX-d,o=this.screenCenterY-d-150*this.resolutionAdjustment,Math.round((Tt-Ct)/60*10)/10);t.save(),t.globalAlpha=.2,t.drawImage(this.loadingCircleSVG,h,o,At,At),t.restore();for(Q=0;Q<kt;Q+=10)this.ctx.save(),this.ctx.translate(h+d,o+d),this.ctx.rotate(Q*Math.PI/180),t.drawImage(this.loadingProgresSVG,-d,-d,At,At),this.ctx.restore();var St=31*this.resolutionAdjustment;t.font=St+"px Arial",t.fillStyle="white",t.fillText(Pt.toString(),h+28*this.resolutionAdjustment,o+59*this.resolutionAdjustment)}t.drawImage(this.cursorSVG,this.mouse.x-25*this.resolutionAdjustment/2,this.mouse.y-25*this.resolutionAdjustment/2,25*this.resolutionAdjustment,25*this.resolutionAdjustment)},t.prototype.howToDraw=function(t){var e=0,i=0,s=0;t.size?(i=e=t.size*this.resolutionAdjustment,s=e):(i=t.width*this.resolutionAdjustment,s=t.height*this.resolutionAdjustment);var r=0,n=0;if(t instanceof h){var a=t.animate();r=a.x,n=a.y}var o=this.screenCenterX+(t.x+r-this.player.getCenterX())*this.resolutionAdjustment,c=this.screenCenterY+(t.y+n-this.player.getCenterY())*this.resolutionAdjustment,l=!0;return(o>this.canvas.width||o<-i||c>this.canvas.height||c<-s)&&(l=!1),{x:o,y:c,size:e,width:i,height:s,isOnScreen:l}},t}(),c=function(){function t(t){this.size=40,this.x=0,this.y=0,this.radius=this.size/2,this.shiftAngle=40,this.hitTimer=0,this.inAction=!1,this.collisionPoints=[],this.playerRadius=t/2,this.calculateCollisionsPoints()}return t.prototype.calculateCollisionsPoints=function(){for(var t=0;t<360;t+=20){var e=Math.sin(t*Math.PI/180)*this.radius,i=Math.cos(t*Math.PI/180)*this.radius;this.collisionPoints.push(new a(e,i))}},t.prototype.ready=function(){return 0===this.hitTimer},t.prototype.getCenterX=function(){return this.x+this.radius},t.prototype.getCenterY=function(){return this.y+this.radius},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.moveHand=function(t,e,i,s,r,n){var h=this.shiftAngle,o=this.playerRadius;if(this.hitTimer>0){switch(this.hitTimer){case 20:h-=4,o+=2;break;case 19:h-=8,o+=4;break;case 18:h-=12,o+=6;break;case 17:h-=16,o+=8;break;case 16:h-=20,o+=10;break;case 15:h-=24,o+=12;break;case 14:h-=28,o+=14;break;case 13:h-=32,o+=16;break;case 12:h-=36,o+=18;break;case 11:h-=40,o+=20;break;case 10:h-=36,o+=18;break;case 9:h-=32,o+=16;break;case 8:h-=28,o+=14;break;case 7:h-=24,o+=12;break;case 6:h-=20,o+=10;break;case 5:h-=16,o+=8;break;case 4:h-=12,o+=6;break;case 3:h-=8,o+=4;break;case 2:h-=4,o+=2;break;case 1:h-=0,o+=0}if(this.inAction)for(var c=0;c<n.bushes.length;c++){if((m=n.bushes[c]).isActive()){var l=m.radius+this.radius,u=this.getCenterX()-m.getCenterX(),g=this.getCenterY()-m.getCenterY();if(Math.sqrt(u*u+g*g)<l){m.acceptHit(new a(this.getCenterX(),this.getCenterY())),this.inAction=!1;break}}}if(this.inAction)for(c=0;c<n.rocks.length;c++){if((m=n.rocks[c]).isActive()){l=m.radius+this.radius;var p=this.getCenterX()-m.getCenterX(),y=this.getCenterY()-m.getCenterY();if(Math.sqrt(p*p+y*y)<l){m.acceptHit(new a(this.getCenterX(),this.getCenterY())),this.inAction=!1;break}}}if(this.inAction)for(c=0;c<n.trees.length;c++){if((m=n.trees[c]).isActive()){l=m.radius+this.radius;var f=this.getCenterX()-m.getCenterX(),d=this.getCenterY()-m.getCenterY();if(Math.sqrt(f*f+d*d)<l){m.acceptHit(new a(this.getCenterX(),this.getCenterY())),this.inAction=!1;break}}}if(this.inAction)for(c=0;c<n.rectangleObstacles.length;c++){var m;if((m=n.rectangleObstacles[c]).isActive()&&this.x<=m.x+m.width&&this.x+this.size>=m.x&&this.y<=m.y+m.height&&this.y+this.size>=m.y)for(var v=0;v<this.collisionPoints.length;v++){var w=this.collisionPoints[v];if(m.isPointIn(new a(this.getCenterX()+w.x,this.getCenterY()+w.y))){m.acceptHit(),this.inAction=!1,console.log("hit");break}}}this.hitTimer--}var b=t+h*e;b<0&&(b=359+b),b>359&&(b-=359);var x=Math.sin(b*Math.PI/180)*o,C=Math.cos(b*Math.PI/180)*o;this.x=s+i/2+x-this.size/2,this.y=r+i/2-C-this.size/2},t.prototype.hit=function(){this.hitTimer=20,this.inAction=!0},t}(),l=function(){function t(t,e){this.size=70,this.x=0,this.y=0,this.angle=0,this.playerRadius=t/2,this.range=e}return t.prototype.move=function(t,e,i){this.angle=t;var s=Math.sin(this.angle*Math.PI/180)*this.playerRadius,r=Math.cos(this.angle*Math.PI/180)*this.playerRadius;this.x=e+s-this.size/2,this.y=i-r-this.size/2},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.getAngle=function(){return this.angle},t.prototype.ready=function(){return!0},t}(),u=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),g=function(t){function e(e,i){var s=this;return(s=t.call(this,e,i,200)||this).treeTrankRadius=35,s.opacity=.9,s}return u(e,t),e}(h),p=function(){function t(t){this.size=80,this.radius=this.size/2,this.speed=6,this.angle=0,this.hands=[],this.collisionPoints=[],this.slowAroundObstacle=!1,this.loadingTime=0,this.loadingMaxTime=180,this.x=550,this.y=700,this.canvas=document.getElementById("gameScreen"),this.hands.push(new c(this.size)),this.hands.push(new c(this.size)),this.gun=new l(this.size,20),this.map=t,this.calculateCollisionsPoints()}return t.prototype.calculateCollisionsPoints=function(){for(var t=0;t<360;t+=10){var e=Math.sin(t*Math.PI/180)*this.radius,i=Math.cos(t*Math.PI/180)*this.radius;this.collisionPoints.push(new a(e,i))}},t.prototype.loading=function(){return this.loadingTime<this.loadingMaxTime&&this.loadingTime++,{time:this.loadingTime,max:this.loadingMaxTime}},t.prototype.getCenterX=function(){return this.x+this.radius},t.prototype.getCenterY=function(){return this.y+this.radius},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.getAngle=function(){return this.angle},t.prototype.setAngle=function(t){this.angle=t},t.prototype.hit=function(){if(this.hands[0].ready()&&this.hands[1].ready()){var t=Math.round(Math.random());this.hands[t].hit()}},t.prototype.playerMove=function(t,e,i,r,n,a){if(t||i||e||r){var h=this.speed;(t&&e||t&&r||i&&e||i&&r||this.slowAroundObstacle)&&(h/=Math.sqrt(2),this.slowAroundObstacle=!1);for(var o=0;o<this.map.terrain.length;o++)if(this.getCenterX()<this.map.terrain[o].x+this.map.terrain[o].width&&this.getCenterX()>=this.map.terrain[o].x&&this.getCenterY()<this.map.terrain[o].y+this.map.terrain[o].height&&this.getCenterY()>=this.map.terrain[o].y&&(this.map.terrain[o].type===s.Water&&(h/=2),this.map.terrain[o].type===s.WaterTriangle1||this.map.terrain[o].type===s.WaterTriangle2||this.map.terrain[o].type===s.WaterTriangle3||this.map.terrain[o].type===s.WaterTriangle4)){var c=Math.floor(this.getCenterX()-this.map.terrain[o].x),l=Math.floor(this.getCenterY()-this.map.terrain[o].y);this.map.waterTerrainData.includeWater(this.map.terrain[o].type,c,l)&&(h/=2)}var u=0,g=0;t&&(g+=-h),i&&(g+=h),e&&(u+=-h),r&&(u+=h),this.shiftOnPosition(u,g)}this.rotatePlayer(n,a),this.gun.move(this.angle,this.getCenterX(),this.getCenterY()),this.changeHandsPosition()},t.prototype.changeHandsPosition=function(){this.hands[0].moveHand(this.angle,-1,this.size,this.x,this.y,this.map),this.hands[1].moveHand(this.angle,1,this.size,this.x,this.y,this.map)},t.prototype.shiftOnPosition=function(t,e){var i=0;0!==t&&i++,0!==e&&i++;var s=1;e<0&&(s=-1);for(var r=0;r<Math.abs(e);r++)if(this.canIshift(0,e-r*s,i)){this.y+=e-r*s;break}s=1,t<0&&(s=-1);for(r=0;r<Math.abs(t);r++)if(this.canIshift(t-r*s,0,i)){this.x+=t-r*s;break}this.x+this.size>this.map.width&&(this.x=this.map.width-this.size),this.x<0&&(this.x=0),this.y+this.size>this.map.height&&(this.y=this.map.height-this.size),this.y<0&&(this.y=0)},t.prototype.canIshift=function(t,e,i){for(var s=0;s<this.map.rectangleObstacles.length;s++){var r=this.map.rectangleObstacles[s];if(r.isActive()&&this.x+t+this.size>=r.x&&this.x+t<=r.x+r.width&&this.y+e<=r.y+r.height&&this.y+e+this.size>=r.y)for(var n=0;n<this.collisionPoints.length;n++){var h=this.collisionPoints[n],o=new a(this.getCenterX()+t+h.x,this.getCenterY()+e+h.y);if(r.isPointIn(o))return this.goAroundRectangleObstacle(t,e,i,r),!1}}for(s=0;s<this.map.impassableRoundObstacles.length;s++){var c=this.map.impassableRoundObstacles[s];if(c.isActive()){var l=c.radius;c instanceof g&&(l=c.treeTrankRadius);var u=l+this.radius,p=this.getCenterX()+t-c.getCenterX(),y=this.getCenterY()+e-c.getCenterY();if(Math.sqrt(p*p+y*y)<u)return this.goAroundRoundObstacle(t,e,i,c),!1}}return!0},t.prototype.goAroundRectangleObstacle=function(t,e,i,s){this.slowAroundObstacle=!0;var r=.75*this.size;if(1===i&&(0!==t&&(this.getCenterY()<=s.y+s.height/2?this.y+this.size-s.y<r&&this.shiftOnPosition(0,-1):s.y+s.height-this.y<r&&this.shiftOnPosition(0,1)),0!==e&&(this.getCenterX()<=s.x+s.width/2?this.x+this.size-s.x<r&&this.shiftOnPosition(-1,0):s.x+s.width-this.x<r&&this.shiftOnPosition(1,0))),2===i)if(this.slowAroundObstacle=!1,this.getCenterX()<s.x+s.width/2&&this.getCenterY()>s.y+s.height/2)Math.abs(this.getCenterX()-s.x)<=Math.abs(this.getCenterY()-(s.y+s.height))?this.shiftOnPosition(.1,0):this.shiftOnPosition(0,-.1);else if(this.getCenterX()>s.x+s.width/2&&this.getCenterY()>s.y+s.height/2){Math.abs(this.getCenterX()-(s.x+s.width))<=Math.abs(this.getCenterY()-(s.y+s.height))?this.shiftOnPosition(-.1,0):this.shiftOnPosition(0,-.1)}else if(this.getCenterX()>s.x+s.width/2&&this.getCenterY()<s.y+s.height/2){Math.abs(this.getCenterX()-(s.x+s.width))<=Math.abs(this.getCenterY()-s.y)?this.shiftOnPosition(-.1,0):this.shiftOnPosition(0,.1)}else if(this.getCenterX()<s.x+s.width/2&&this.getCenterY()<s.y+s.height/2){Math.abs(this.getCenterX()-s.x)<=Math.abs(this.getCenterY()-s.y)?this.shiftOnPosition(.1,0):this.shiftOnPosition(0,.1)}},t.prototype.goAroundRoundObstacle=function(t,e,i,s){(this.slowAroundObstacle=!0,1===i&&(0!==t&&(this.getCenterY()>=s.getCenterY()&&this.shiftOnPosition(0,1),this.getCenterY()<s.getCenterY()&&this.shiftOnPosition(0,-1)),0!==e&&(this.getCenterX()>=s.getCenterX()&&this.shiftOnPosition(1,0),this.getCenterX()<s.getCenterX()&&this.shiftOnPosition(-1,0))),2===i)&&(Math.abs(this.getCenterX()-s.getCenterX())<=Math.abs(this.getCenterY()-s.getCenterY())?(this.getCenterX()<=s.getCenterX()&&this.shiftOnPosition(.5,0),this.getCenterX()>s.getCenterX()&&this.shiftOnPosition(-.5,0)):(this.getCenterY()<=s.getCenterY()&&this.shiftOnPosition(0,.5),this.getCenterY()>s.getCenterY()&&this.shiftOnPosition(0,-.5)))},t.prototype.rotatePlayer=function(t,e){var i=this.canvas.width/2,s=this.canvas.height/2,r=i-t,n=s-e;0===r&&(r=.1);var a=Math.abs(180*Math.atan(r/n)/Math.PI);t>=i&&e<s&&(this.angle=a),t>=i&&e>=s&&(this.angle=180-a),t<i&&e>=s&&(this.angle=180+a),t<i&&e<s&&(this.angle=360-a),this.angle=Math.round(this.angle),360===this.angle&&(this.angle=0)},t}(),y=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),f=function(t){function e(e,i){var s=this;return(s=t.call(this,e,i,100)||this).opacity=.9,s}return y(e,t),e}(h),d=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),m=function(t){function e(e,i){var s=this;return(s=t.call(this,e,i,100)||this).opacity=1,s}return d(e,t),e}(h),v=function(){function t(t,e,i,s){this.opacity=1,this.active=!0,this.x=t,this.y=e,this.width=i,this.height=s}return t.prototype.isPointIn=function(t){var e=t.x,i=t.y;return e<this.x+this.width&&e>=this.x&&i>=this.y&&i<this.y+this.height},t.prototype.getOpacity=function(){return this.opacity},t.prototype.isActive=function(){return this.active},t.prototype.acceptHit=function(){this.opacity>.1&&(this.opacity-=.1),this.opacity<.1&&(this.active=!1)},t}(),w=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),b=function(t){function e(e,i,s,r){return t.call(this,e,i,s,r)||this}return w(e,t),e}(v),x=function(){return function(t){this.blocks=[],this.terrain=[],this.impassableRoundObstacles=[],this.bushes=[],this.trees=[],this.rocks=[],this.rectangleObstacles=[],this.waterTerrainData=t,this.width=1500,this.height=1500;for(var e=0;e<this.height/300;e++)for(var i=0;i<this.width/300;i++)this.blocks.push({x:300*i,y:300*e});this.terrain.push(new n(s.Water,0,0,this.width,300)),this.terrain.push(new n(s.Water,0,this.height-300,this.width,300)),this.terrain.push(new n(s.Water,0,300,300,this.height-600)),this.terrain.push(new n(s.Water,this.width-300,300,300,this.height-600)),this.terrain.push(new n(s.WaterTriangle1,300,300,300,300)),this.terrain.push(new n(s.WaterTriangle2,900,300,300,300)),this.terrain.push(new n(s.WaterTriangle3,900,900,300,300)),this.terrain.push(new n(s.WaterTriangle4,300,900,300,300)),this.bushes.push(new f(600,600)),this.bushes.push(new f(300,400));var r=new m(100,100);this.rocks.push(r),this.impassableRoundObstacles.push(r);var a=new m(550,550);this.rocks.push(a),this.impassableRoundObstacles.push(a);var h=new m(700,550);this.rocks.push(h),this.impassableRoundObstacles.push(h);var o=new g(800,800);this.trees.push(o),this.impassableRoundObstacles.push(o);var c=new g(0,0);this.trees.push(c),this.impassableRoundObstacles.push(c),this.rectangleObstacles.push(new b(600,800,20,200)),this.rectangleObstacles.push(new b(500,900,200,20)),this.rectangleObstacles.push(new b(500,350,300,100))}}(),C=function(){function t(){this.waterTriangle1=[],this.waterTriangle2=[],this.waterTriangle3=[],this.waterTriangle4=[]}return t.prototype.setData=function(t,e){switch(t){case s.WaterTriangle1:this.waterTriangle1=e;break;case s.WaterTriangle2:this.waterTriangle2=e;break;case s.WaterTriangle3:this.waterTriangle3=e;break;case s.WaterTriangle4:this.waterTriangle4=e;break;default:throw new Error("Unknown water type")}},t.prototype.includeWater=function(t,e,i){var r,n=!1;switch(t){case s.WaterTriangle1:r=this.waterTriangle1;break;case s.WaterTriangle2:r=this.waterTriangle2;break;case s.WaterTriangle3:r=this.waterTriangle3;break;case s.WaterTriangle4:r=this.waterTriangle4;break;default:throw new Error("Unknown water type")}if(e<r.length&&i<r[e].length)r[e][i]&&(n=!0);else{if(0!==r.length)throw new Error("Out of range on water type");n=!0}return n},t}(),T=function(){function t(t,e,i,s){this.size=5,this.x=0,this.y=0,this.angle=0,this.shiftX=0,this.shiftY=0,this.distance=0,this.active=!0,this.x=t-this.size/2,this.y=e-this.size/2,this.angle=i,this.range=s;this.shiftX=30*Math.sin(i*Math.PI/180),this.shiftY=30*Math.cos(i*Math.PI/180);this.x+=1.5*this.shiftX,this.y-=1.5*this.shiftY}return t.prototype.move=function(t){this.collisions(t)||(this.x+=this.shiftX,this.y-=this.shiftY)},t.prototype.collisions=function(t){for(var e=new a(this.getCenterX(),this.getCenterY()),i=0,s=t.impassableRoundObstacles;i<s.length;i++){if((h=s[i]).isActive()&&h.isPointIn(e))return h.acceptHit(e),this.active=!1,!0}if(this.active)for(var r=0,n=t.rectangleObstacles;r<n.length;r++){var h;if((h=n[r]).isActive()&&h.isPointIn(e))return h.acceptHit(),this.active=!1,!0}return!1},t.prototype.getX=function(){return this.x},t.prototype.getY=function(){return this.y},t.prototype.getCenterX=function(){return this.x+this.size/2},t.prototype.getCenterY=function(){return this.y+this.size/2},t.prototype.getAngle=function(){return this.angle},t.prototype.flying=function(){var t=!0;return this.distance++,this.distance>this.range&&(t=!1),this.active||(t=!1),t},t}(),k=function(){function t(t,e,i,s){var r=this;this.bullets=[],this.halfFPS=!0,this.time=Date.now(),this.socket=i,this.serverClientSync=s,this.waterTerrainData=new C,this.map=new x(this.waterTerrainData),this.player=new p(this.map),this.keys=t,this.mouse=e,this.view=new o(this.map,this.player,this.bullets,this.mouse,this.waterTerrainData,this.serverClientSync),setTimeout(function(){r.gameLoop()},200)}return t.prototype.gameLoop=function(){var t=this;requestAnimationFrame(function(){t.gameLoop()}),this.serverClientSync.ready()||this.socket.emit("serverClientSync",Date.now()),this.player.playerMove(this.keys.w,this.keys.a,this.keys.s,this.keys.d,this.mouse.x,this.mouse.y);this.player.getX(),this.player.getY();for(var e=this.bullets.length-1;e>=0;e--){var i=this.bullets[e];i.flying()?i.move(this.map):this.bullets.splice(e,1)}this.mouse.left&&(this.player.hit(),this.player.gun.ready()&&this.bullets.push(new T(this.player.getCenterX(),this.player.getCenterY(),this.player.getAngle(),this.player.gun.range)),this.mouse.left=!1),this.view.draw()},t.prototype.screenResize=function(){this.view.screenResize()},t}(),A=function(){function t(){this.ping=null,this.pings=[],this.timeDiference=null,this.timeDiferences=[],this.attempts=10,this.defaultDrawDelay=50,this.drawDelay=this.defaultDrawDelay}return t.prototype.getPing=function(){return this.ping},t.prototype.getTimeDiference=function(){return this.timeDiference},t.prototype.ready=function(){return null!=this.ping&&null!=this.timeDiference},t.prototype.reset=function(){this.ping=null,this.pings=[],this.timeDiference=null,this.timeDiferences=[]},t.prototype.addData=function(t,e){if(this.ready()||(this.pings.push(t),this.timeDiferences.push(e)),this.pings.length===this.attempts){for(var i=0,s=0,r=this.pings;s<r.length;s++){i+=r[s]}this.ping=i/this.attempts;for(var n=0,a=0,h=this.timeDiferences;a<h.length;a++){n+=h[a]}this.timeDiference=n/this.attempts}},t.prototype.changeDrawDelay=function(t){this.drawDelay+=t,this.drawDelay<0&&(this.drawDelay=0)},t.prototype.getDrawDelay=function(){return this.drawDelay},t}(),P=function(){function t(){var e=this;this.keys={w:!1,a:!1,s:!1,d:!1},this.mouse={x:0,y:0,left:!1,middle:!1,right:!1},this.canvas=document.getElementsByTagName("canvas")[0],this.socket=io.connect("http://192.168.0.2:8888"),this.serverClientSync=new A,t._socket=this.socket,this.model=new k(this.keys,this.mouse,this.socket,this.serverClientSync),window.addEventListener("resize",function(){e.model.screenResize();var t=new Event("mousemove");e.canvas.dispatchEvent(t)}),this.keysController(),this.mouseController(),this.socketController()}return t.run=function(){if(t.instance)throw new Error("Only one controller!");t.instance=new t},t.prototype.socketController=function(){var e=this;this.socket.emit("syncTime",0),this.socket.on("serverClientSync",function(t,i){var s=Date.now(),r=s-t,n=s-i;e.serverClientSync.addData(r,n),console.log(e.serverClientSync)}),this.socket.on("socketEvent",function(t){console.log(t)}),this.socket.on("syncTime",function(e){t.timeDiference=Date.now()-e,console.log("syncTime",t.timeDiference)}),this.socket.on("p",function(e,i,s,r){var n=Math.round(25*Math.random());setTimeout(function(){if(t.playerData.length)t.playerData[t.playerData.length-1].tick;t.playerData.push({x:e,y:i,time:s,tick:r})},n)})},t.prototype.mouseController=function(){var t=this;this.canvas.addEventListener("mousemove",function(e){null==e.x?(t.mouse.x=t.canvas.width/2,t.mouse.y=t.canvas.height/2):(t.mouse.x=e.x,t.mouse.y=e.y)}),this.canvas.addEventListener("click",function(e){t.mouse.left=!0})},t.prototype.keysController=function(){var t=this;document.addEventListener("keydown",function(e){switch(e.code){case"KeyW":t.keys.w=!0;break;case"KeyA":t.keys.a=!0;break;case"KeyS":t.keys.s=!0;break;case"KeyD":t.keys.d=!0}}),document.addEventListener("keyup",function(e){switch(e.code){case"KeyW":t.keys.w=!1;break;case"KeyA":t.keys.a=!1;break;case"KeyS":t.keys.s=!1;break;case"KeyD":t.keys.d=!1}})},t.playerData=[],t}();P.run()}]);
//# sourceMappingURL=app.js.map