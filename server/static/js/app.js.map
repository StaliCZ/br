{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/Weapon.ts","webpack:///./src/Terrain.ts","webpack:///./src/LootType.ts","webpack:///./src/RoundObstacle.ts","webpack:///./src/Tree.ts","webpack:///./src/Rock.ts","webpack:///./src/Bush.ts","webpack:///./src/RectangleObstacle.ts","webpack:///./src/Wall.ts","webpack:///./src/Colors.ts","webpack:///./src/PartBulletLine.ts","webpack:///./src/BulletLine.ts","webpack:///./src/Point.ts","webpack:///./src/Scope.ts","webpack:///./src/View.ts","webpack:///./src/Map.ts","webpack:///./src/WaterTerrainData.ts","webpack:///./src/CollisionPoints.ts","webpack:///./src/Hand.ts","webpack:///./src/Blood.ts","webpack:///./src/Player.ts","webpack:///./src/ZoneCircle.ts","webpack:///./src/Zone.ts","webpack:///./src/Message.ts","webpack:///./src/WaterCircle.ts","webpack:///./src/SnapshotManager.ts","webpack:///./src/Model.ts","webpack:///./src/ServerClientSync.ts","webpack:///./src/MyHtmlElements.ts","webpack:///./src/MapData.ts","webpack:///./src/Editor.ts","webpack:///./src/Controller.ts","webpack:///./src/app.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Weapon","TerrainType","LootType","Terrain","type","x","y","size","angle","this","WaterTriangle2","WaterTriangle3","WaterTriangle4","RoundObstacle","id","changed","opacity","active","radius","point","Math","sqrt","super","treeTrankRadius","RectangleObstacle","width","height","Colors","water","grass","blockFrame","blockFrameActive","bullet","text","collisionPoint","player","hand","handBorder","vest","waterCircle","PartBulletLine","startX","startY","endX","endY","age","maxAge","parts","length","push","isActive","Point","Scope","loadingMax","loading","scope","scopeLoadingChange","scopeResolutionAdjustment","newScope","oldScope","resolutionAdjustment","map","mouse","waterTerrainData","myHtmlElements","collisionPoints","snapshotManager","finalResolutionAdjustment","bulletLines","colors","gameScreen","editorScreen","editor","screen","mapScreen","helperScreen","ctxGame","getContext","ctxMap","ctxEditor","horizontalWallSVG","Image","src","verticalWallSVG","bushSVG","rockSVG","treeSVG","cursorSVG","loadingProgresSVG","loadingCircleSVG","pistolSVG","machinegunSVG","rifleSVG","shotgunSVG","hammerSVG","granadeSVG","smokeSVG","medkitSVG","smokeCloudSVG","rifleLootSVG","pistolLootSVG","shotgunLootSVG","machinegunLootSVG","hammerLootSVG","granadeLootSVG","smokeLootSVG","redAmmoLootSVG","greenAmmoLootSVG","blueAmmoLootSVG","orangeAmmoLootSVG","medkitLootSVG","vestLootSVG","scope2LootSVG","scope4LootSVG","scope6LootSVG","deadPlayer","waterTrianglePNG","screenResize","myPlayer","el","window","innerWidth","innerHeight","zoneSVG","setAttribute","toString","mapSize","floor","mapZoneSVG","mapContainer","style","screenCenterX","screenCenterY","changeResolutionAdjustment","drawGame","getCenterX","getCenterY","finalAdjustment","waterType","ctx","fillStyle","fillRect","middleImage","save","translate","WaterTriangle1","rotate","PI","drawImage","restore","Worker","worker","onmessage","e","setData","data","getImageData","postMessage","time","Date","getTime","console","log","clearRect","blockSize","getSize","getBlockSize","sizeReduction","biggerBlockSize","terrain","Water","playerSize","beginPath","arc","fill","zone","innerCircle","getRadius","strokeStyle","stroke","outerCircle","mapZoneCircle","terrains","blockX","blockY","getTerrainType","getX","getY","Grass","getObjectType","globalAlpha","rock","rocks","wall","walls","svgSource","bush","bushes","tree","trees","deleteObject","wallSVG","verticalWall","horizontalWall","myPlayerId","betweenSnapshot","players","spectate","setScope","getFinalResolutionAdjustment","drawMap","block","blocks","isOnScreen","howToDraw","waterCircles","flow","getOpacity","size2","rectangleObstacle","rectangleObstacles","alive","loot","lootSVG","Pistol","Machinegun","Shotgun","Rifle","Smoke","Granade","Hammer","RedAmmo","BlueAmmo","GreenAmmo","OrangeAmmo","Vest","Medkit","Scope2","Scope4","Scope6","colorVest","getVest","bodyRadius","gunSize","getWeapon","gunX","gunY","getAngle","getHammerAngle","Hand","hands","radiusHand","playerAngle","percentSize","shiftZ","shiftX","sin","shiftY","cos","granadeShiftAngle","SVG","drawHandOnWeapon","bloods","blood","getTimer","timerMax","shift","bloodX","bloodY","alpha","splice","granade","g","granadeSize","b","a","createBulletLines","line","partCounter","partLine","baseAlpha","finalAlpha","getAge","abs","moveTo","lineTo","lineWidth","increaseAge","smoke","outerRadius","zoneCircle","healthBar","in","h","progres","round","lE","seconds","takeLoot","display","main","visibility","textContent","lT","secondsString","counter","circle","takeLootInfo","items","redAmmo","greenAmmo","blueAmmo","orangeAmmo","item1in","itemName","i1","item2in","i2","itemAmmoColor","item3in","i3","item4Text","i4","item4Count","s4","item4in","item5Text","i5","item5Count","s5","item5in","activeItem","ai","ammo","activeGunAmmo","count","scope2","scope4","scope6","v","messageManager","messages","innerHTML","message","element","document","createElement","appendChild","z","zoneTimer","innerText","spectateName","shiftHandZ","shiftHandAngle","finalAngle","shiftHandX","shiftHandY","handX","handY","thereIsLine","setEnd","item1","classList","remove","item2","item3","item4","item5","add","item","weapon","item1Ammo","item2Ammo","background","weaponName","takeLootText","lootName","quantity","gameObject","stats","win","winnerName","setTimeout","gameOverMenu","h1","open","kills","damageDealt","damageTaken","survive","minutes","surviveTime","impassableRoundObstacles","yy","xx","newRock","newTree","rects","waterTriangle1","waterTriangle2","waterTriangle3","waterTriangle4","Error","waterData","state","CollisionPoints","body","hammer","ready","Blood","timer","random","playerSnapshot","live","hammerAngle","w","lX","lY","hSize","rX","rY","power","ZoneCircle","centerX","centerY","Message","WaterCircle","waterCircleSnapshot","serverClientSync","snapshots","newerExists","olderExists","sumaNewer","averageSumaNewer","totalSuma","suma","beforeSnapshotForTestBullets","now","cut","snapshot","updateDelay","getDrawDelay","getServerTime","createInjury","setVest","completeSnapshot","updateMap","obsacleSnapshots","obstacleSnapshot","obstacle","update","zoneSnapshot","setRadius","iR","setCenterX","iX","setCenterY","iY","oR","oX","oY","previousSnapshot","lastSnapshot","completePlayerSnapshots","completeMyPlayerSnapshot","completeLootSnapshots","completeZoneSnapshot","previousMyPlayerSnapshot","lastMyPlayerSnapshot","aM","previousZoneSnapshot","lastZoneSnapshot","previousSnapshotLoots","lastSnapshotLoots","lastSnapshotLoot","previousSnapshotLoot","missingLoots","previous","lootExists","last","missingLoot","previousSnapshotPlayers","lastSnapshotPlayers","lastSnapshotPlayer","previousSnapshotPlayer","missingPlayerIds","playerExists","missingPlayerId","sort","newerSnapshot","olderSnapshot","percentShift","wantedSnapshotTime","changeSumaNewer","timeDistance","distanceOlderFromWantedTime","copyFrom","positionBetweenSnapshots","olderLoot","newerLoot","older","newer","updatePlayers","updateZone","playerInstance","setX","setY","setAngle","setWeapon","setHammerAngle","die","olderPosition","newerPosition","direction","socket","gameRun","gameId","playerId","view","loop","close","mainMenu","hideGame","reset","notAllowedCharacter","lastIndexOf","requestAnimationFrame","drawEditor","emit","createBetweenSnapshot","ServerClientSync","ping","pings","timeDiference","timeDiferences","pingAttempts","defaultDrawDelay","drawDelay","minWantedSumaNewerSnapshots","defaultWantedNewerSnapshots","wantedSumaNewerSnapshots","maxWantedSumaNewerSnapshots","lags","maxLags","lastLagTime","changeDrawDelay","pingsSuma","timeDiferenceSuma","change","serverTime","getTimeDiference","MyHtmlElements","getElementById","getElementsByTagName","scopeSVG","coordinates","container","terrainImgs","terrainWater","terrainGrass","terrainWaterTriangle1","terrainWaterTriangle2","terrainWaterTriangle3","terrainWaterTriangle4","objectImgs","objectBush","objectRock","objectTree","objectRect","objectHorizontalWall","objectVerticalWall","objectDelete","openMenu","saveMapMenu","back","mapEditorMenu","changeSize","alertMenu","ok","openMapMenu","maps","controlsMenu","ip","games","join","openEditor","controls","gameCanceledMenu","mapSizeMenu","mapMenu","lobbyMenu","gameName","forJoinPlayers","leave","forCreatePlayer","start","cancel","escFromGameMenu","zoneRect","transparentLayer","itNetwork","elements","MapData","controller","terrainType","objectType","cleanMap","widthString","heightString","cleanMapAfterChangeSize","arr","mapData","addEventListener","canvasRect","getBoundingClientRect","clientX","scrollLeft","left","clientY","scrollTop","top","children","borderColor","target","deletePosition","randomAngle","deleteIndex","on","openMap","keys","middle","right","canvas","io","connect","model","event","Event","dispatchEvent","preventDefault","returnValue","keysController","mouseController","socketController","menuController","instance","nameOk","localStorage","setItem","disabled","gameExists","joinDisabled","gameOver","stop","gameStart","setPlayerId","playerName","setGameId","openGames","openGame","option","index","playerNames","li","optionCopy","cloneNode","setName","clientDateNow","serverDateNow","timeNow","timeDiferenceClientServer","addData","addSnapshot","which","gameActive","undefined","previousPlayerAngle","rotatePlayer","getGameId","clickPoint","serverPosition","calculateServerPosition","mouseX","mouseY","atan","getSpectate","getItem","changePlayerName","startSpectate","parseInt","mapName","getMapData","isNameOk","selectedMap","gameIndex","run"],"mappings":"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","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","export enum Weapon {\r\n\tEmpty,\r\n\tHand,\r\n\tPistol,\r\n    Machinegun,\r\n    Shotgun,\r\n    Rifle,\r\n    Hammer,\r\n    Granade,\r\n    Smoke,\r\n    Medkit\r\n}","export enum TerrainType {\r\n\tGrass,\r\n\tWater,\r\n\tWaterTriangle1,\r\n\tWaterTriangle2,\r\n\tWaterTriangle3,\r\n\tWaterTriangle4\r\n}\r\n\r\nexport class Terrain {\r\n\treadonly type: TerrainType;\r\n\treadonly x: number;\r\n\treadonly y: number;\r\n\treadonly size: number;\r\n\treadonly angle: number = 0;\r\n\r\n\tconstructor(type: TerrainType, x: number, y: number, size: number) {\r\n\t\tthis.type = type;\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.size = size;\r\n\r\n\t\tswitch (type) {\r\n\t\t\tcase TerrainType.WaterTriangle2:\r\n\t\t\t\tthis.angle = 90;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle3:\r\n\t\t\t\tthis.angle = 180;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle4:\r\n\t\t\t\tthis.angle = 270;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n","export enum LootType {\r\n\tPistol,\r\n\tMachinegun,\r\n\tShotgun,\r\n\tRifle,\r\n\tHammer,\r\n\tRedAmmo,\r\n\tGreenAmmo,\r\n\tBlueAmmo,\r\n\tOrangeAmmo,\r\n\tVest,\r\n\tMedkit,\r\n\tGranade,\r\n\tSmoke,\r\n\tScope2,\r\n\tScope4,\r\n\tScope6\r\n}\r\n","import Point from './Point';\r\n\r\nexport default abstract class RoundObstacle {\r\n\treadonly id: number;\r\n\tprotected changed: boolean = false;\r\n\treadonly x: number;\r\n\treadonly y: number;\r\n\tprotected opacity: number = 1;\r\n\treadonly size: number;\r\n\treadonly radius: number;\r\n\tprivate active: boolean = true;\r\n\r\n\r\n\tconstructor(id: number, x: number, y: number, size: number) {\r\n\t\tthis.id = id;\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.size = size;\r\n\t\tthis.radius = size / 2;\r\n\t}\r\n\r\n\tgetChanged(): boolean {\r\n\t\treturn this.changed;\r\n\t}\r\n\r\n\tnullChanged(): void {\r\n\t\tthis.changed = false;\r\n\t}\r\n\r\n\tupdate(opacity: number): void {\r\n\t\tthis.opacity = opacity;\r\n\t}\r\n\r\n\tisPointIn(point: Point): boolean {\r\n\t\t//triangle\r\n\t\tconst x = this.x + this.radius - point.x;\r\n\t\tconst y = this.y + this.radius - point.y;\r\n\t\tconst radius = Math.sqrt(x * x + y * y);\r\n\t\tif (radius <= this.radius) return true;\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetCenterX(): number {\r\n\t\treturn this.x + this.size / 2;\r\n\t}\r\n\r\n\tgetCenterY(): number {\r\n\t\treturn this.y + this.size / 2;\r\n\t}\r\n\r\n\tgetOpacity(): number {\r\n\t\treturn this.opacity;\r\n\t}\r\n\r\n\tisActive(): boolean {\r\n\t\treturn this.active;\r\n\t}\r\n}\r\n","import RoundObstacle from './RoundObstacle';\r\n\r\nexport default class Tree extends RoundObstacle {\r\n\treadonly treeTrankRadius: number;\r\n\treadonly angle: number;\r\n\r\n\tconstructor(id: number, x: number, y: number, angle: number) {\r\n\t\tconst size = 500;\r\n\t\tsuper(id, x, y, size);\r\n\t\tthis.treeTrankRadius = 35;\r\n\t\t//this.opacity = 1;\r\n\t\tthis.angle = angle;\r\n\t}\r\n}\r\n","import RoundObstacle from './RoundObstacle';\r\n\r\nexport default class Rock extends RoundObstacle {\r\n\tconstructor(id: number,x: number, y: number) {\r\n\t\tconst size = 100;\r\n\t\tsuper(id, x, y, size);\r\n\t\tthis.opacity = 1;\r\n\t}\r\n}\r\n","import RoundObstacle from './RoundObstacle';\r\n\r\nexport default class Bush extends RoundObstacle {\r\n\treadonly angle: number;\r\n\r\n\tconstructor(id: number, x: number, y: number, angle: number) {\r\n\t\tconst size = 350;\r\n\t\tsuper(id, x, y, size);\r\n\t\t//this.opacity = 1;\r\n\t\tthis.angle = angle;\r\n\t}\r\n}\r\n","import Point from './Point';\r\n\r\nexport default abstract class RectangleObstacle {\r\n\treadonly id: number;\r\n\tprotected changed: boolean = false;\r\n\treadonly x: number;\r\n\treadonly y: number;\r\n\tprotected opacity: number = 1;\r\n\treadonly width: number;\r\n\treadonly height: number;\r\n\tprivate active: boolean = true;\r\n\r\n\tconstructor(id: number, x: number, y: number, width: number, height: number) {\r\n\t\tthis.id = id;\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t}\r\n\r\n\tgetChanged(): boolean {\r\n\t\treturn this.changed;\r\n\t}\r\n\r\n\tnullChanged(): void {\r\n\t\tthis.changed = false;\r\n\t}\r\n\r\n\tgetChangedData(): any {\r\n\t\treturn { id: this.id, opacity: this.opacity };\r\n\t}\r\n\r\n\tupdate(opacity: number): void {\r\n\t\tthis.opacity = opacity;\r\n\t}\r\n\r\n\tisPointIn(point: Point): boolean {\r\n\t\tconst { x, y } = point;\r\n\t\tif (x < this.x + this.width && x >= this.x && y >= this.y && y < this.y + this.height) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetOpacity(): number {\r\n\t\treturn this.opacity;\r\n\t}\r\n\r\n\tisActive(): boolean {\r\n\t\treturn this.active;\r\n\t}\r\n\r\n\tacceptHit(): void {\r\n\t\tif (this.active) {\r\n\t\t\tif (this.opacity > 0.1) this.opacity -= 0.1;\r\n\t\t\tif (this.opacity < 0.1) {\r\n\t\t\t\tthis.active = false;\r\n\t\t\t}\r\n\t\t\tthis.changed = true;\r\n\t\t}\r\n\t}\r\n}\r\n","import RectangleObstacle from './RectangleObstacle';\r\n\r\nexport default class Wall extends RectangleObstacle {\r\n\tconstructor(id: number, x: number, y: number, width: number, height: number) {\r\n\t\tsuper(id, x, y, width, height);\r\n\t}\r\n}\r\n","export default class Colors {\r\n\treadonly water: string = '#69A2E0';\r\n\treadonly grass: string = '#A2CB69';\r\n\treadonly blockFrame: string = 'gray';\r\n\treadonly blockFrameActive: string = 'red';\r\n\treadonly bullet: string = 'red';\r\n\treadonly text: string = 'white';\r\n\treadonly collisionPoint: string = 'red';\r\n\treadonly player: string = '#FFC878';\r\n\treadonly hand: string = '#FFC878';\r\n\treadonly handBorder: string = '#424242';\r\n\treadonly vest: string = '#424242';\r\n\treadonly waterCircle: string = '#2871C1';\r\n}\r\n","export default class PartBulletLine {\r\n\treadonly startX: number;\r\n\treadonly startY: number;\r\n\treadonly endX: number;\r\n\treadonly endY: number;\r\n\tprivate active: boolean = true;\r\n\tprivate age: number = 0;\r\n\tprivate maxAge: number = 10;\r\n\r\n\tconstructor(startX: number, startY: number, endX: number, endY: number) {\r\n\t\tthis.startX = startX;\r\n\t\tthis.startY = startY;\r\n\t\tthis.endX = endX;\r\n\t\tthis.endY = endY;\r\n\t}\r\n\r\n\tincreaseAge(): void {\r\n\t\tif (this.age++ === this.maxAge) {\r\n\t\t\tthis.active = false;\r\n\t\t}\r\n\t}\r\n\r\n\tisActive(): boolean {\r\n\t\treturn this.active;\r\n\t}\r\n\r\n\tgetAge(): number {\r\n\t\treturn this.age;\r\n\t}\r\n}\r\n","import PartBulletLine from './PartBulletLine';\r\n\r\nexport default class BulletLine {\r\n\treadonly id: number;\r\n\tprivate startX: number;\r\n\tprivate startY: number;\r\n\tparts: PartBulletLine[] = [];\r\n\r\n\tconstructor(id: number, startX: number, startY: number) {\r\n\t\tthis.id = id;\r\n\t\tthis.startX = startX;\r\n\t\tthis.startY = startY;\r\n\t}\r\n\r\n\tsetEnd(endX: number, endY: number): void {\r\n\t\t//part line\r\n\t\tlet startX = this.startX;\r\n\t\tlet startY = this.startY;\r\n\t\tif (this.parts.length) {\r\n\t\t\tstartX = this.parts[this.parts.length - 1].endX;\r\n\t\t\tstartY = this.parts[this.parts.length - 1].endY;\r\n\t\t}\r\n\t\tthis.parts.push(new PartBulletLine(startX, startY, endX, endY));\r\n\t}\r\n\r\n\tisActive(): boolean {\r\n\t\tif (this.parts.length) {\r\n\t\t\treturn this.parts[this.parts.length - 1].isActive();\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n}\r\n","export default class Point {\r\n\treadonly x: number;\r\n\treadonly y: number;\r\n\r\n\tconstructor(x: number, y: number) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n}\r\n","export default class Scope {\r\n\tprivate loadingMax: number = 40;\r\n\tprivate loading: number = this.loadingMax;\r\n\tprivate scope: number = 0.3; //1\r\n\tprivate scopeLoadingChange: number = 0;\r\n\tprivate scopeResolutionAdjustment: number = 0.3; //1\r\n\r\n\tsetScope(newScope: number): void {\r\n\t\tswitch (newScope) {\r\n\t\t\tcase 2:\r\n\t\t\t\tnewScope = 1.2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tnewScope = 1.4;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\tnewScope = 1.6;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tconst oldScope = this.scope;\r\n\t\tthis.scope = newScope;\r\n\t\tif (newScope !== oldScope) {\r\n\t\t\tthis.scopeLoadingChange = (newScope - oldScope) / this.loadingMax;\r\n\t\t\tthis.loading = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tgetFinalResolutionAdjustment(resolutionAdjustment: number): number {\r\n\t\tif (this.loading !== this.loadingMax) {\r\n\t\t\tthis.scopeResolutionAdjustment += this.scopeLoadingChange;\r\n\t\t\tthis.loading++;\r\n\t\t}\r\n\t\treturn resolutionAdjustment / this.scopeResolutionAdjustment;\r\n\t}\r\n}\r\n","import Player from './Player';\r\nimport { Weapon } from './Weapon';\r\nimport Map from './Map';\r\nimport { Mouse } from './Controller';\r\nimport WaterTerrainData from './WaterTerrainData';\r\nimport { TerrainType } from './Terrain';\r\nimport RoundObstacle from './RoundObstacle';\r\nimport RectangleObstacle from './RectangleObstacle';\r\nimport Tree from './Tree';\r\nimport Rock from './Rock';\r\nimport Bush from './Bush';\r\nimport Wall from './Wall';\r\nimport ServerClientSync from './ServerClientSync';\r\nimport MyHtmlElements from './MyHtmlElements';\r\nimport Editor from './Editor';\r\nimport Colors from './Colors';\r\nimport BulletLine from './BulletLine';\r\nimport CollisionPoints from './CollisionPoints';\r\nimport Point from './Point';\r\nimport SnapshotManager from './SnapshotManager';\r\nimport { LootType } from './LootType';\r\nimport Scope from './Scope';\r\nimport PlayerStats from './PlayerStats';\r\n\r\ntype DrawData = {\r\n\tx: number;\r\n\ty: number;\r\n\tsize: number;\r\n\twidth: number;\r\n\theight: number;\r\n\tisOnScreen: boolean;\r\n};\r\n\r\ninterface RoundObject {\r\n\tx: number;\r\n\ty: number;\r\n\tsize: number;\r\n}\r\n\r\ninterface RectObject {\r\n\tx: number;\r\n\ty: number;\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\nexport default class View {\r\n\tprivate scope: Scope;\r\n\tprivate snapshotManager: SnapshotManager;\r\n\tprivate gameScreen: HTMLCanvasElement;\r\n\tprivate editorScreen: HTMLCanvasElement;\r\n\tprivate mapScreen: HTMLCanvasElement;\r\n\tprivate helperScreen: HTMLCanvasElement;\r\n\tprivate ctxGame: CanvasRenderingContext2D;\r\n\tprivate ctxMap: CanvasRenderingContext2D;\r\n\tprivate ctxEditor: CanvasRenderingContext2D;\r\n\tprivate bushSVG: HTMLImageElement;\r\n\tprivate rockSVG: HTMLImageElement;\r\n\tprivate treeSVG: HTMLImageElement;\r\n\tprivate horizontalWallSVG: HTMLImageElement;\r\n\tprivate verticalWallSVG: HTMLImageElement;\r\n\tprivate pistolSVG: HTMLImageElement;\r\n\tprivate machinegunSVG: HTMLImageElement;\r\n\tprivate shotgunSVG: HTMLImageElement;\r\n\tprivate rifleSVG: HTMLImageElement;\r\n\tprivate hammerSVG: HTMLImageElement;\r\n\tprivate cursorSVG: HTMLImageElement;\r\n\tprivate granadeSVG: HTMLImageElement;\r\n\tprivate smokeSVG: HTMLImageElement;\r\n\tprivate medkitSVG: HTMLImageElement;\r\n\tprivate smokeCloudSVG: HTMLImageElement;\r\n\tprivate loadingProgresSVG: HTMLImageElement;\r\n\tprivate loadingCircleSVG: HTMLImageElement;\r\n\tprivate waterTrianglePNG: HTMLImageElement;\r\n\tprivate pistolLootSVG: HTMLImageElement;\r\n\tprivate shotgunLootSVG: HTMLImageElement;\r\n\tprivate machinegunLootSVG: HTMLImageElement;\r\n\tprivate rifleLootSVG: HTMLImageElement;\r\n\tprivate hammerLootSVG: HTMLImageElement;\r\n\tprivate granadeLootSVG: HTMLImageElement;\r\n\tprivate smokeLootSVG: HTMLImageElement;\r\n\tprivate redAmmoLootSVG: HTMLImageElement;\r\n\tprivate greenAmmoLootSVG: HTMLImageElement;\r\n\tprivate blueAmmoLootSVG: HTMLImageElement;\r\n\tprivate orangeAmmoLootSVG: HTMLImageElement;\r\n\tprivate medkitLootSVG: HTMLImageElement;\r\n\tprivate vestLootSVG: HTMLImageElement;\r\n\tprivate scope2LootSVG: HTMLImageElement;\r\n\tprivate scope4LootSVG: HTMLImageElement;\r\n\tprivate scope6LootSVG: HTMLImageElement;\r\n\tprivate deadPlayer: HTMLImageElement;\r\n\tprivate waterTerrainData: WaterTerrainData;\r\n\tprivate resolutionAdjustment: number = 1;\r\n\tprivate finalResolutionAdjustment: number = 1;\r\n\tprivate screenCenterX: number;\r\n\tprivate screenCenterY: number;\r\n\tprivate map: Map;\r\n\tprivate mouse: Mouse;\r\n\tmyPlayer: Player;\r\n\tprivate myHtmlElements: MyHtmlElements;\r\n\tprivate colors: Colors;\r\n\tprivate bulletLines: BulletLine[] = [];\r\n\tprivate collisionPoints: CollisionPoints;\r\n\r\n\tconstructor(\r\n\t\tmap: Map,\r\n\t\tmouse: Mouse,\r\n\t\twaterTerrainData: WaterTerrainData,\r\n\t\tmyHtmlElements: MyHtmlElements,\r\n\t\tcollisionPoints: CollisionPoints,\r\n\t\tsnapshotManager: SnapshotManager\r\n\t) {\r\n\t\tthis.scope = new Scope();\r\n\t\tthis.snapshotManager = snapshotManager;\r\n\t\tthis.colors = new Colors();\r\n\t\tthis.myHtmlElements = myHtmlElements;\r\n\t\tthis.map = map;\r\n\t\tthis.collisionPoints = collisionPoints;\r\n\t\tthis.mouse = mouse;\r\n\t\tthis.gameScreen = <HTMLCanvasElement>this.myHtmlElements.gameScreen;\r\n\t\tthis.editorScreen = <HTMLCanvasElement>this.myHtmlElements.editor.screen;\r\n\t\tthis.mapScreen = <HTMLCanvasElement>this.myHtmlElements.mapScreen;\r\n\t\tthis.helperScreen = <HTMLCanvasElement>this.myHtmlElements.helperScreen;\r\n\t\tthis.ctxGame = this.gameScreen.getContext('2d');\r\n\t\tthis.ctxMap = this.mapScreen.getContext('2d');\r\n\t\tthis.ctxEditor = this.editorScreen.getContext('2d');\r\n\r\n\t\tthis.horizontalWallSVG = new Image();\r\n\t\tthis.horizontalWallSVG.src = 'img/horizontalWall.svg';\r\n\r\n\t\tthis.verticalWallSVG = new Image();\r\n\t\tthis.verticalWallSVG.src = 'img/verticalWall.svg';\r\n\r\n\t\tthis.bushSVG = new Image();\r\n\t\tthis.bushSVG.src = 'img/bush.svg';\r\n\r\n\t\tthis.rockSVG = new Image();\r\n\t\tthis.rockSVG.src = 'img/rock.svg';\r\n\r\n\t\tthis.treeSVG = new Image();\r\n\t\tthis.treeSVG.src = 'img/tree.svg';\r\n\r\n\t\tthis.cursorSVG = new Image();\r\n\t\tthis.cursorSVG.src = 'img/cursor.svg';\r\n\r\n\t\tthis.loadingProgresSVG = new Image();\r\n\t\tthis.loadingProgresSVG.src = 'img/loadingProgres.svg';\r\n\r\n\t\tthis.loadingCircleSVG = new Image();\r\n\t\tthis.loadingCircleSVG.src = 'img/loadingCircle.svg';\r\n\r\n\t\tthis.pistolSVG = new Image();\r\n\t\tthis.pistolSVG.src = 'img/pistol.svg';\r\n\r\n\t\tthis.machinegunSVG = new Image();\r\n\t\tthis.machinegunSVG.src = 'img/machinegun.svg';\r\n\r\n\t\tthis.rifleSVG = new Image();\r\n\t\tthis.rifleSVG.src = 'img/rifle.svg';\r\n\r\n\t\tthis.shotgunSVG = new Image();\r\n\t\tthis.shotgunSVG.src = 'img/shotgun.svg';\r\n\r\n\t\tthis.hammerSVG = new Image();\r\n\t\tthis.hammerSVG.src = 'img/hammer.svg';\r\n\r\n\t\tthis.granadeSVG = new Image();\r\n\t\tthis.granadeSVG.src = 'img/granade.svg';\r\n\r\n\t\tthis.smokeSVG = new Image();\r\n\t\tthis.smokeSVG.src = 'img/smoke.svg';\r\n\r\n\t\tthis.medkitSVG = new Image();\r\n\t\tthis.medkitSVG.src = 'img/medkit.svg';\r\n\r\n\t\tthis.smokeCloudSVG = new Image();\r\n\t\tthis.smokeCloudSVG.src = 'img/smokeCloud.svg';\r\n\r\n\t\tthis.rifleLootSVG = new Image();\r\n\t\tthis.rifleLootSVG.src = 'img/rifleLoot.svg';\r\n\r\n\t\tthis.pistolLootSVG = new Image();\r\n\t\tthis.pistolLootSVG.src = 'img/pistolLoot.svg';\r\n\r\n\t\tthis.shotgunLootSVG = new Image();\r\n\t\tthis.shotgunLootSVG.src = 'img/shotgunLoot.svg';\r\n\r\n\t\tthis.machinegunLootSVG = new Image();\r\n\t\tthis.machinegunLootSVG.src = 'img/machinegunLoot.svg';\r\n\r\n\t\tthis.hammerLootSVG = new Image();\r\n\t\tthis.hammerLootSVG.src = 'img/hammerLoot.svg';\r\n\r\n\t\tthis.granadeLootSVG = new Image();\r\n\t\tthis.granadeLootSVG.src = 'img/granadeLoot.svg';\r\n\r\n\t\tthis.smokeLootSVG = new Image();\r\n\t\tthis.smokeLootSVG.src = 'img/smokeLoot.svg';\r\n\r\n\t\tthis.redAmmoLootSVG = new Image();\r\n\t\tthis.redAmmoLootSVG.src = 'img/redAmmoLoot.svg';\r\n\r\n\t\tthis.greenAmmoLootSVG = new Image();\r\n\t\tthis.greenAmmoLootSVG.src = 'img/greenAmmoLoot.svg';\r\n\r\n\t\tthis.blueAmmoLootSVG = new Image();\r\n\t\tthis.blueAmmoLootSVG.src = 'img/blueAmmoLoot.svg';\r\n\r\n\t\tthis.orangeAmmoLootSVG = new Image();\r\n\t\tthis.orangeAmmoLootSVG.src = 'img/orangeAmmoLoot.svg';\r\n\r\n\t\tthis.medkitLootSVG = new Image();\r\n\t\tthis.medkitLootSVG.src = 'img/medkitLoot.svg';\r\n\t\tthis.vestLootSVG = new Image();\r\n\t\tthis.vestLootSVG.src = 'img/vestLoot.svg';\r\n\t\tthis.scope2LootSVG = new Image();\r\n\t\tthis.scope2LootSVG.src = 'img/scope2Loot.svg';\r\n\t\tthis.scope4LootSVG = new Image();\r\n\t\tthis.scope4LootSVG.src = 'img/scope4Loot.svg';\r\n\t\tthis.scope6LootSVG = new Image();\r\n\t\tthis.scope6LootSVG.src = 'img/scope6Loot.svg';\r\n\r\n\t\tthis.deadPlayer = new Image();\r\n\t\tthis.deadPlayer.src = 'img/deadPlayer.svg';\r\n\r\n\t\tthis.waterTrianglePNG = new Image();\r\n\t\tthis.waterTrianglePNG.src = 'img/waterTriangle.png';\r\n\r\n\t\tthis.waterTerrainData = waterTerrainData;\r\n\r\n\t\t/*\r\n\t\t//water data\r\n\t\tthis.waterTrianglePNG.onload = () => {\r\n\t\t\tthis.saveWaterPixels(TerrainType.WaterTriangle1);\r\n\t\t\tthis.saveWaterPixels(TerrainType.WaterTriangle2);\r\n\t\t\tthis.saveWaterPixels(TerrainType.WaterTriangle3);\r\n\t\t\tthis.saveWaterPixels(TerrainType.WaterTriangle4);\r\n\t\t\tthis.waterTerrainData.write();\r\n\t\t};\r\n\t\t*/\r\n\r\n\t\tthis.screenResize();\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tthis.myPlayer = null;\r\n\t\tthis.scope = new Scope();\r\n\t}\r\n\r\n\tscreenResize(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\t\t//gameScreen\r\n\t\tthis.gameScreen.width = window.innerWidth;\r\n\t\tthis.gameScreen.height = window.innerHeight;\r\n\t\tel.zoneSVG.setAttribute('width', window.innerWidth.toString());\r\n\t\tel.zoneSVG.setAttribute('height', window.innerHeight.toString());\r\n\t\t//mapScreen\r\n\t\tconst mapSize = Math.floor((window.innerWidth / 5 + window.innerHeight / 5) / 2);\r\n\t\tthis.mapScreen.width = mapSize;\r\n\t\tthis.mapScreen.height = mapSize;\r\n\t\tel.mapZoneSVG.setAttribute('width', mapSize.toString());\r\n\t\tel.mapZoneSVG.setAttribute('height', mapSize.toString());\r\n\t\tel.mapContainer.style.width = (mapSize + 10).toString() + 'px';\r\n\t\tel.mapContainer.style.height = (mapSize + 10).toString() + 'px';\r\n\t\t//center\r\n\t\tthis.screenCenterX = window.innerWidth / 2;\r\n\t\tthis.screenCenterY = window.innerHeight / 2;\r\n\t\tthis.changeResolutionAdjustment();\r\n\t\tif (this.myPlayer) {\r\n\t\t\tthis.drawGame(this.myPlayer.id);\r\n\t\t}\r\n\t}\r\n\r\n\tcalculateServerPosition(point: Point): Point {\r\n\t\tlet x, y;\r\n\t\tif (this.screenCenterX > point.x) {\r\n\t\t\tx = (this.screenCenterX - point.x) * -1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tx = point.x - this.screenCenterX;\r\n\t\t}\r\n\t\tif (this.screenCenterY > point.y) {\r\n\t\t\ty = (this.screenCenterY - point.y) * -1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\ty = point.y - this.screenCenterY;\r\n\t\t}\r\n\t\tx /= this.finalResolutionAdjustment;\r\n\t\ty /= this.finalResolutionAdjustment;\r\n\t\tx += this.myPlayer.getCenterX();\r\n\t\ty += this.myPlayer.getCenterY();\r\n\t\treturn new Point(x, y);\r\n\t}\r\n\r\n\t/*\r\n\tprivate isPointInZone(serverPoint: Point, zoneSnapshot: ZoneSnapshot): boolean {\r\n\t\t//triangle\r\n\t\tconst x = zoneSnapshot.oX - serverPoint.x;\r\n\t\tconst y = zoneSnapshot.oY - serverPoint.y;\r\n\t\tconst radius = Math.sqrt(x * x + y * y);\r\n\t\tif (radius <= zoneSnapshot.oR) return true;\r\n\t\treturn false;\r\n\t}\r\n\t*/\r\n\r\n\tprivate changeResolutionAdjustment(): void {\r\n\t\tconst defaultWidth = 1920;\r\n\t\tconst defaultHeight = 1050;\r\n\t\tconst width = this.gameScreen.width / defaultWidth;\r\n\t\tconst height = this.gameScreen.height / defaultHeight;\r\n\t\tconst finalAdjustment = (width + height) / 2;\r\n\t\tthis.resolutionAdjustment = finalAdjustment;\r\n\t}\r\n\r\n\tprivate saveWaterPixels(waterType: TerrainType): void {\r\n\t\tconst ctx = this.helperScreen.getContext('2d');\r\n\t\tthis.helperScreen.width = this.waterTrianglePNG.width;\r\n\t\tthis.helperScreen.height = this.waterTrianglePNG.height;\r\n\t\t//white background\r\n\t\tctx.fillStyle = '#FFFFFF';\r\n\t\tctx.fillRect(0, 0, this.helperScreen.width, this.helperScreen.height);\r\n\t\tlet middleImage = this.waterTrianglePNG.width / 2;\r\n\t\tctx.save();\r\n\t\tctx.translate(middleImage, middleImage);\r\n\t\tswitch (waterType) {\r\n\t\t\tcase TerrainType.WaterTriangle1:\r\n\t\t\t\tctx.rotate(0 * Math.PI / 180);\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle2:\r\n\t\t\t\tctx.rotate(90 * Math.PI / 180);\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle3:\r\n\t\t\t\tctx.rotate(180 * Math.PI / 180);\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle4:\r\n\t\t\t\tctx.rotate(270 * Math.PI / 180);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tctx.drawImage(this.waterTrianglePNG, -middleImage, -middleImage);\r\n\t\tctx.restore();\r\n\r\n\t\t//worker\r\n\t\tif (typeof Worker !== 'undefined') {\r\n\t\t\tconst worker = new Worker('js/workerFindWater.js');\r\n\t\t\tworker.onmessage = (e) => {\r\n\t\t\t\tthis.waterTerrainData.setData(e.data.type, e.data.data);\r\n\t\t\t};\r\n\t\t\tconst data = ctx.getImageData(0, 0, this.waterTrianglePNG.width, this.waterTrianglePNG.height).data;\r\n\t\t\tworker.postMessage({\r\n\t\t\t\tdata,\r\n\t\t\t\tsize: this.waterTrianglePNG.width,\r\n\t\t\t\ttype: waterType,\r\n\t\t\t\ttime: new Date().getTime()\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log(\"err: Your browser doesn't support web workers.\");\r\n\t\t}\r\n\t}\r\n\r\n\tprivate drawMap(): void {\r\n\t\tconst ctx = this.ctxMap;\r\n\t\tconst el = this.myHtmlElements;\r\n\t\t//clear canvas\r\n\t\tctx.clearRect(0, 0, this.mapScreen.width, this.mapScreen.height);\r\n\t\t//background\r\n\t\tctx.fillStyle = this.colors.grass;\r\n\t\tctx.fillRect(0, 0, this.mapScreen.width, this.mapScreen.height);\r\n\t\tconst blockSize = this.mapScreen.width / (this.map.getSize() / this.map.getBlockSize());\r\n\t\tconst sizeReduction = blockSize / this.map.getBlockSize();\r\n\t\tconst biggerBlockSize = blockSize + blockSize / 50;\r\n\t\t//terrain\r\n\t\tfor (const terrain of this.map.terrain) {\r\n\t\t\tconst x = terrain.x * sizeReduction;\r\n\t\t\tconst y = terrain.y * sizeReduction;\r\n\t\t\tif (terrain.type === TerrainType.Water) {\r\n\t\t\t\tctx.fillStyle = this.colors.water;\r\n\t\t\t\tctx.fillRect(x, y, biggerBlockSize, biggerBlockSize);\r\n\t\t\t}\r\n\t\t\tif (terrain.type !== TerrainType.Water) {\r\n\t\t\t\tconst middleImage = biggerBlockSize / 2;\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\tctx.rotate(terrain.angle * Math.PI / 180);\r\n\t\t\t\tctx.drawImage(this.waterTrianglePNG, -middleImage, -middleImage, blockSize, blockSize);\r\n\t\t\t\tctx.restore();\r\n\t\t\t}\r\n\t\t}\r\n\t\t//player\r\n\t\t{\r\n\t\t\tconst playerSize = this.mapScreen.width / 30;\r\n\t\t\tconst x = this.myPlayer.getCenterX() * sizeReduction;\r\n\t\t\tconst y = this.myPlayer.getCenterY() * sizeReduction;\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.arc(x, y, playerSize / 2, 0, 2 * Math.PI);\r\n\t\t\tctx.fillStyle = 'red';\r\n\t\t\tctx.fill();\r\n\t\t}\r\n\t\t//zone\r\n\t\t//inner\r\n\t\t{\r\n\t\t\tconst x = this.snapshotManager.zone.innerCircle.getCenterX() * sizeReduction;\r\n\t\t\tconst y = this.snapshotManager.zone.innerCircle.getCenterY() * sizeReduction;\r\n\t\t\tconst radius = this.snapshotManager.zone.innerCircle.getRadius() * sizeReduction;\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.arc(x, y, radius, 0, 2 * Math.PI);\r\n\t\t\tctx.strokeStyle = 'green';\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\t\t//outer\r\n\t\t{\r\n\t\t\tconst x = this.snapshotManager.zone.outerCircle.getCenterX() * sizeReduction;\r\n\t\t\tconst y = this.snapshotManager.zone.outerCircle.getCenterY() * sizeReduction;\r\n\t\t\tconst radius = this.snapshotManager.zone.outerCircle.getRadius() * sizeReduction;\r\n\t\t\t//SVG change\r\n\t\t\tel.mapZoneCircle.setAttribute('r', radius.toString());\r\n\t\t\tel.mapZoneCircle.setAttribute('cx', x.toString());\r\n\t\t\tel.mapZoneCircle.setAttribute('cy', y.toString());\r\n\t\t}\r\n\t}\r\n\r\n\tdrawEditor(editor: Editor): void {\r\n\t\tconst ctx = this.ctxEditor;\r\n\t\t//clear canvas\r\n\t\tctx.clearRect(0, 0, this.editorScreen.width, this.editorScreen.height);\r\n\r\n\t\t//grass\r\n\t\tctx.fillStyle = this.colors.grass;\r\n\t\tctx.fillRect(0, 0, this.editorScreen.width, this.editorScreen.height);\r\n\r\n\t\t//terrain blocks\r\n\t\tctx.fillStyle = this.colors.water;\r\n\t\tfor (const terrain of editor.terrains) {\r\n\t\t\tswitch (terrain.type) {\r\n\t\t\t\tcase TerrainType.Water:\r\n\t\t\t\t\tctx.fillRect(terrain.x, terrain.y, editor.blockSize, editor.blockSize);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.WaterTriangle1:\r\n\t\t\t\t\tctx.drawImage(this.waterTrianglePNG, terrain.x, terrain.y, editor.blockSize, editor.blockSize);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.WaterTriangle2:\r\n\t\t\t\tcase TerrainType.WaterTriangle3:\r\n\t\t\t\tcase TerrainType.WaterTriangle4:\r\n\t\t\t\t\tlet middleImage = editor.blockSize / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(terrain.x + middleImage, terrain.y + middleImage);\r\n\t\t\t\t\tctx.rotate(terrain.angle * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(\r\n\t\t\t\t\t\tthis.waterTrianglePNG,\r\n\t\t\t\t\t\t-middleImage,\r\n\t\t\t\t\t\t-middleImage,\r\n\t\t\t\t\t\teditor.blockSize,\r\n\t\t\t\t\t\teditor.blockSize\r\n\t\t\t\t\t);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//terrain blocks under mouse\r\n\t\tlet blockX, blockY;\r\n\t\tif (editor.getTerrainType() != null) {\r\n\t\t\t//x, y to [blocks]\r\n\t\t\tblockX = Math.floor(editor.getX() / editor.blockSize) * editor.blockSize;\r\n\t\t\tblockY = Math.floor(editor.getY() / editor.blockSize) * editor.blockSize;\r\n\t\t\tlet angle = -1;\r\n\t\t\tswitch (editor.getTerrainType()) {\r\n\t\t\t\tcase TerrainType.Water:\r\n\t\t\t\t\tctx.fillStyle = this.colors.water;\r\n\t\t\t\t\tctx.fillRect(blockX, blockY, editor.blockSize, editor.blockSize);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.Grass:\r\n\t\t\t\t\tctx.fillStyle = this.colors.grass;\r\n\t\t\t\t\tctx.fillRect(blockX, blockY, editor.blockSize, editor.blockSize);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.WaterTriangle1:\r\n\t\t\t\t\tangle = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.WaterTriangle2:\r\n\t\t\t\t\tangle = 90;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.WaterTriangle3:\r\n\t\t\t\t\tangle = 180;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase TerrainType.WaterTriangle4:\r\n\t\t\t\t\tangle = 270;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (angle !== -1) {\r\n\t\t\t\t//grass\r\n\t\t\t\tctx.fillStyle = this.colors.grass;\r\n\t\t\t\tctx.fillRect(blockX, blockY, editor.blockSize, editor.blockSize);\r\n\t\t\t\tlet middleImage = editor.blockSize / 2;\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.translate(blockX + middleImage, blockY + middleImage);\r\n\t\t\t\tctx.rotate(angle * Math.PI / 180);\r\n\t\t\t\tctx.drawImage(this.waterTrianglePNG, -middleImage, -middleImage, editor.blockSize, editor.blockSize);\r\n\t\t\t\tctx.restore();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//mapGrid\r\n\t\tctx.fillStyle = this.colors.blockFrame;\r\n\t\tfor (let i = 0; i < editor.getSize(); i++) {\r\n\t\t\tctx.fillRect(i * editor.blockSize, 0, 1, editor.getSize() * editor.blockSize);\r\n\t\t}\r\n\t\tfor (let i = 0; i < editor.getSize(); i++) {\r\n\t\t\tctx.fillRect(0, i * editor.blockSize, editor.getSize() * editor.blockSize, 1);\r\n\t\t}\r\n\r\n\t\tif (editor.getTerrainType() != null) {\r\n\t\t\t//frame\r\n\t\t\tctx.fillStyle = this.colors.blockFrameActive;\r\n\t\t\tctx.fillRect(blockX, blockY, editor.blockSize, 1);\r\n\t\t\tctx.fillRect(blockX, blockY + editor.blockSize, editor.blockSize, 1);\r\n\r\n\t\t\tctx.fillRect(blockX, blockY, 1, editor.blockSize);\r\n\t\t\tctx.fillRect(blockX + editor.blockSize, blockY, 1, editor.blockSize);\r\n\t\t}\r\n\r\n\t\t//objects\r\n\t\tctx.save();\r\n\t\tif (editor.getObjectType() === 'delete') ctx.globalAlpha = 0.6;\r\n\r\n\t\tfor (const rock of editor.rocks) {\r\n\t\t\tctx.drawImage(this.rockSVG, rock.x, rock.y, rock.size, rock.size);\r\n\t\t}\r\n\r\n\t\tfor (const wall of editor.walls) {\r\n\t\t\tlet svgSource = this.horizontalWallSVG;\r\n\t\t\tif (wall.width < wall.height) svgSource = this.verticalWallSVG;\r\n\t\t\tif (wall.width < wall.height || wall.width > wall.height) {\r\n\t\t\t\tctx.drawImage(svgSource, wall.x, wall.y, wall.width, wall.height);\r\n\t\t\t}\r\n\t\t\tif (wall.width === wall.height) {\r\n\t\t\t\tctx.fillStyle = 'black';\r\n\t\t\t\tctx.fillRect(wall.x, wall.y, wall.width, wall.height);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (const bush of editor.bushes) {\r\n\t\t\tctx.drawImage(this.bushSVG, bush.x, bush.y, bush.size, bush.size);\r\n\t\t}\r\n\t\tfor (const tree of editor.trees) {\r\n\t\t\tctx.drawImage(this.treeSVG, tree.x, tree.y, tree.size, tree.size);\r\n\t\t}\r\n\t\tctx.restore();\r\n\r\n\t\tif (editor.getObjectType() === 'delete') {\r\n\t\t\t//delete object\r\n\t\t\tlet deleteObject;\r\n\t\t\tfor (const rock of editor.rocks) {\r\n\t\t\t\tconst object = rock;\r\n\t\t\t\tif (\r\n\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\tobject.x + object.size >= editor.getX() &&\r\n\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\tobject.y + object.size >= editor.getY()\r\n\t\t\t\t) {\r\n\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (const wall of editor.walls) {\r\n\t\t\t\tconst object = wall;\r\n\t\t\t\tif (\r\n\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\tobject.x + object.width >= editor.getX() &&\r\n\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\tobject.y + object.height >= editor.getY()\r\n\t\t\t\t) {\r\n\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (const bush of editor.bushes) {\r\n\t\t\t\tconst object = bush;\r\n\t\t\t\tif (\r\n\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\tobject.x + object.size >= editor.getX() &&\r\n\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\tobject.y + object.size >= editor.getY()\r\n\t\t\t\t) {\r\n\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (const tree of editor.trees) {\r\n\t\t\t\tconst object = tree;\r\n\t\t\t\tif (\r\n\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\tobject.x + object.size >= editor.getX() &&\r\n\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\tobject.y + object.size >= editor.getY()\r\n\t\t\t\t) {\r\n\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (deleteObject instanceof Rock) {\r\n\t\t\t\tctx.drawImage(this.rockSVG, deleteObject.x, deleteObject.y, deleteObject.size, deleteObject.size);\r\n\t\t\t}\r\n\t\t\tif (deleteObject instanceof Bush) {\r\n\t\t\t\tctx.drawImage(this.bushSVG, deleteObject.x, deleteObject.y, deleteObject.size, deleteObject.size);\r\n\t\t\t}\r\n\t\t\tif (deleteObject instanceof Tree) {\r\n\t\t\t\tctx.drawImage(this.treeSVG, deleteObject.x, deleteObject.y, deleteObject.size, deleteObject.size);\r\n\t\t\t}\r\n\t\t\tif (deleteObject instanceof Wall) {\r\n\t\t\t\tctx.fillRect(deleteObject.x, deleteObject.y, deleteObject.width, deleteObject.height);\r\n\t\t\t\tlet wallSVG = this.verticalWallSVG;\r\n\t\t\t\tif (deleteObject.width > deleteObject.height) {\r\n\t\t\t\t\twallSVG = this.horizontalWallSVG;\r\n\t\t\t\t}\r\n\t\t\t\tctx.drawImage(wallSVG, deleteObject.x, deleteObject.y, deleteObject.width, deleteObject.height);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//objects under mouse\r\n\t\tif (editor.getObjectType()) {\r\n\t\t\tlet size;\r\n\t\t\tswitch (editor.getObjectType()) {\r\n\t\t\t\tcase 'bush':\r\n\t\t\t\t\tsize = editor.bush.size;\r\n\t\t\t\t\tctx.drawImage(this.bushSVG, editor.getX() - size / 2, editor.getY() - size / 2, size, size);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'rock':\r\n\t\t\t\t\tsize = editor.rock.size;\r\n\t\t\t\t\tctx.drawImage(this.rockSVG, editor.getX() - size / 2, editor.getY() - size / 2, size, size);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'tree':\r\n\t\t\t\t\tsize = editor.tree.size;\r\n\t\t\t\t\tctx.drawImage(this.treeSVG, editor.getX() - size / 2, editor.getY() - size / 2, size, size);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'rect':\r\n\t\t\t\t\tsize = editor.rock.size;\r\n\t\t\t\t\tctx.fillStyle = 'black';\r\n\t\t\t\t\tctx.fillRect(editor.getX() - size / 2, editor.getY() - size / 2, size, size);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'verticalWall':\r\n\t\t\t\t\tctx.drawImage(\r\n\t\t\t\t\t\tthis.verticalWallSVG,\r\n\t\t\t\t\t\teditor.getX() - editor.verticalWall.width / 2,\r\n\t\t\t\t\t\teditor.getY() - editor.verticalWall.height / 2,\r\n\t\t\t\t\t\teditor.verticalWall.width,\r\n\t\t\t\t\t\teditor.verticalWall.height\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'horizontalWall':\r\n\t\t\t\t\tctx.drawImage(\r\n\t\t\t\t\t\tthis.horizontalWallSVG,\r\n\t\t\t\t\t\teditor.getX() - editor.horizontalWall.width / 2,\r\n\t\t\t\t\t\teditor.getY() - editor.horizontalWall.height / 2,\r\n\t\t\t\t\t\teditor.horizontalWall.width,\r\n\t\t\t\t\t\teditor.horizontalWall.height\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdrawGame(myPlayerId: number): void {\r\n\t\tconst betweenSnapshot = this.snapshotManager.betweenSnapshot;\r\n\t\tconst players = this.snapshotManager.players;\r\n\t\tif (!betweenSnapshot) return;\r\n\r\n\t\t//spectate\r\n\t\tif (betweenSnapshot.i.spectate !== -1) {\r\n\t\t\tmyPlayerId = betweenSnapshot.i.spectate;\r\n\t\t}\r\n\r\n\t\t//my player or spectate\r\n\t\tfor (const player of players) {\r\n\t\t\tif (player.id === myPlayerId) {\r\n\t\t\t\tthis.myPlayer = player;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!this.myPlayer) return;\r\n\r\n\t\t//scope\r\n\t\tthis.scope.setScope(this.snapshotManager.betweenSnapshot.i.s);\r\n\t\tthis.finalResolutionAdjustment = this.scope.getFinalResolutionAdjustment(this.resolutionAdjustment);\r\n\r\n\t\tthis.drawMap();\r\n\r\n\t\tconst ctx = this.ctxGame;\r\n\t\tconst el = this.myHtmlElements;\r\n\r\n\t\t//clear canvas\r\n\t\tctx.clearRect(0, 0, this.gameScreen.width, this.gameScreen.height);\r\n\r\n\t\t//water\r\n\t\tctx.fillStyle = this.colors.water;\r\n\t\tctx.fillRect(0, 0, this.gameScreen.width, this.gameScreen.height);\r\n\r\n\t\t//grass blocks\r\n\t\tctx.fillStyle = this.colors.grass;\r\n\t\tconst blockSize = 300;\r\n\t\tfor (const block of this.map.blocks) {\r\n\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({ x: block.x, y: block.y, size: blockSize });\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\tctx.fillRect(x, y, size, size);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//water terrain blocks\r\n\t\tctx.fillStyle = this.colors.water;\r\n\t\tfor (const terrain of this.map.terrain) {\r\n\t\t\tconst { x, y, width, height, isOnScreen } = this.howToDraw({\r\n\t\t\t\tx: terrain.x,\r\n\t\t\t\ty: terrain.y,\r\n\t\t\t\tsize: terrain.size\r\n\t\t\t});\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\tif (terrain.type === TerrainType.Water) {\r\n\t\t\t\t\tctx.fillRect(x, y, width, height);\r\n\t\t\t\t}\r\n\t\t\t\telse if (terrain.type === TerrainType.WaterTriangle1) {\r\n\t\t\t\t\tctx.drawImage(this.waterTrianglePNG, x, y, width, height);\r\n\t\t\t\t}\r\n\t\t\t\telse if (\r\n\t\t\t\t\tterrain.type === TerrainType.WaterTriangle2 ||\r\n\t\t\t\t\tterrain.type === TerrainType.WaterTriangle3 ||\r\n\t\t\t\t\tterrain.type === TerrainType.WaterTriangle4\r\n\t\t\t\t) {\r\n\t\t\t\t\tlet middleImage = width / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(terrain.angle * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(this.waterTrianglePNG, -middleImage, -middleImage, width, height);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//water circles\r\n\t\tctx.fillStyle = this.colors.waterCircle;\r\n\t\tfor (const waterCircle of this.snapshotManager.waterCircles) {\r\n\t\t\tif (!waterCircle.isActive()) continue;\r\n\t\t\twaterCircle.flow();\r\n\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\tx: waterCircle.getX(),\r\n\t\t\t\ty: waterCircle.getY(),\r\n\t\t\t\tsize: waterCircle.getSize()\r\n\t\t\t});\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\tconst radius = size / 2;\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.globalAlpha = waterCircle.getOpacity();\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(x + radius, y + radius, radius, 0, 2 * Math.PI);\r\n\t\t\t\tctx.fill();\r\n\t\t\t\tctx.restore();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//mapGrid\r\n\t\tctx.fillStyle = this.colors.blockFrame;\r\n\t\tconst size2 = 1 * this.resolutionAdjustment;\r\n\t\tfor (const block of this.map.blocks) {\r\n\t\t\t//top\r\n\t\t\tif (block.y === 0) {\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: block.x,\r\n\t\t\t\t\ty: block.y,\r\n\t\t\t\t\tsize: blockSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) ctx.fillRect(x, y, size, size2);\r\n\t\t\t}\r\n\t\t\t//bottom\r\n\t\t\t{\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: block.x,\r\n\t\t\t\t\ty: block.y + blockSize,\r\n\t\t\t\t\tsize: blockSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) ctx.fillRect(x, y, size, size2);\r\n\t\t\t}\r\n\t\t\t//left\r\n\t\t\tif (block.x === 0) {\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: block.x,\r\n\t\t\t\t\ty: block.y,\r\n\t\t\t\t\tsize: blockSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) ctx.fillRect(x, y, size2, size);\r\n\t\t\t}\r\n\t\t\t//right\r\n\t\t\t{\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: block.x + blockSize,\r\n\t\t\t\t\ty: block.y,\r\n\t\t\t\t\tsize: blockSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) ctx.fillRect(x, y, size2, size);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//rocks\r\n\t\tfor (const rock of this.map.rocks) {\r\n\t\t\tif (rock.isActive()) {\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw(rock);\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.globalAlpha = rock.getOpacity();\r\n\t\t\t\t\tctx.drawImage(this.rockSVG, x, y, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//walls\r\n\t\tctx.fillStyle = 'black';\r\n\t\tfor (const rectangleObstacle of this.map.rectangleObstacles) {\r\n\t\t\tif (rectangleObstacle.isActive()) {\r\n\t\t\t\tconst { x, y, width, height, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: rectangleObstacle.x,\r\n\t\t\t\t\ty: rectangleObstacle.y,\r\n\t\t\t\t\twidth: rectangleObstacle.width,\r\n\t\t\t\t\theight: rectangleObstacle.height\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tlet svgSource = this.horizontalWallSVG;\r\n\t\t\t\t\tif (rectangleObstacle.width < rectangleObstacle.height) svgSource = this.verticalWallSVG;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.globalAlpha = rectangleObstacle.getOpacity();\r\n\t\t\t\t\tctx.drawImage(svgSource, x, y, width, height);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t/*\r\n\t\t\tif (rectangleObstacle.isActive()) {\r\n\t\t\t\tconst { x, y, width, height, isOnScreen } = this.howToDraw(rectangleObstacle);\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.globalAlpha = rectangleObstacle.getOpacity();\r\n\t\t\t\t\tctx.fillRect(x, y, width, height);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t}\r\n\r\n\t\t//dead players\r\n\t\tfor (const player of players) {\r\n\t\t\tif (player.alive()) continue;\r\n\t\t\tconst { x, y, width, height, isOnScreen } = this.howToDraw({\r\n\t\t\t\tx: player.getX(),\r\n\t\t\t\ty: player.getY(),\r\n\t\t\t\tsize: player.size\r\n\t\t\t});\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\tctx.drawImage(this.deadPlayer, x, y, width, height);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//loot\r\n\t\tfor (const loot of betweenSnapshot.l) {\r\n\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw(loot);\r\n\t\t\tlet lootSVG;\r\n\t\t\tswitch (loot.type) {\r\n\t\t\t\tcase LootType.Pistol:\r\n\t\t\t\t\tlootSVG = this.pistolLootSVG;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LootType.Machinegun:\r\n\t\t\t\t\tlootSVG = this.machinegunLootSVG;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LootType.Shotgun:\r\n\t\t\t\t\tlootSVG = this.shotgunLootSVG;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase LootType.Rifle:\r\n\t\t\t\t\tlootSVG = this.rifleLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Smoke:\r\n\t\t\t\t\tlootSVG = this.smokeLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Granade:\r\n\t\t\t\t\tlootSVG = this.granadeLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Hammer:\r\n\t\t\t\t\tlootSVG = this.hammerLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.RedAmmo:\r\n\t\t\t\t\tlootSVG = this.redAmmoLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.BlueAmmo:\r\n\t\t\t\t\tlootSVG = this.blueAmmoLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.GreenAmmo:\r\n\t\t\t\t\tlootSVG = this.greenAmmoLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.OrangeAmmo:\r\n\t\t\t\t\tlootSVG = this.orangeAmmoLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Vest:\r\n\t\t\t\t\tlootSVG = this.vestLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Medkit:\r\n\t\t\t\t\tlootSVG = this.medkitLootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Scope2:\r\n\t\t\t\t\tlootSVG = this.scope2LootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Scope4:\r\n\t\t\t\t\tlootSVG = this.scope4LootSVG;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase LootType.Scope6:\r\n\t\t\t\t\tlootSVG = this.scope6LootSVG;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tctx.drawImage(lootSVG, x, y, size, size);\r\n\t\t}\r\n\r\n\t\t//players\r\n\t\tfor (const player of players) {\r\n\t\t\tif (!player.alive()) continue;\r\n\r\n\t\t\t//player body\r\n\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\tx: player.getX(),\r\n\t\t\t\ty: player.getY(),\r\n\t\t\t\tsize: player.size\r\n\t\t\t});\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\t//vest\r\n\t\t\t\tconst radius = size / 2;\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(x + radius, y + radius, radius, 0, 2 * Math.PI);\r\n\t\t\t\tlet colorVest = this.colors.player;\r\n\t\t\t\tif (player.getVest()) colorVest = this.colors.vest;\r\n\t\t\t\tctx.fillStyle = colorVest;\r\n\t\t\t\tctx.fill();\r\n\t\t\t\t//body\r\n\t\t\t\tlet bodyRadius = radius * 0.92;\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(x + radius, y + radius, bodyRadius, 0, 2 * Math.PI);\r\n\t\t\t\tctx.fillStyle = this.colors.player;\r\n\t\t\t\tctx.fill();\r\n\t\t\t\t/*\r\n\t\t\t\t//collisionPoints\r\n\t\t\t\tif (this.collisionPoints.isReady()){\r\n\t\t\t\t\tctx.fillStyle = this.colors.collisionPoint;\r\n\t\t\t\t\tfor (const point of this.collisionPoints.body) {\r\n\t\t\t\t\t\tconst { x, y, size } = this.howToDraw({\r\n\t\t\t\t\t\t\tx: player.getCenterX() + point.x,\r\n\t\t\t\t\t\t\ty: player.getCenterY() + point.y,\r\n\t\t\t\t\t\t\tsize: 1\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tctx.fillRect(x, y, size, size);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t}\r\n\r\n\t\t\tconst gunSize = 280;\r\n\t\t\t//pistol\r\n\t\t\tif (player.getWeapon() === Weapon.Pistol) {\r\n\t\t\t\t//draw pistol\r\n\t\t\t\tconst gunX = player.getCenterX() - gunSize / 2;\r\n\t\t\t\tconst gunY = player.getCenterY() - gunSize / 2;\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: gunX,\r\n\t\t\t\t\ty: gunY,\r\n\t\t\t\t\tsize: gunSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(player.getAngle() * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(this.pistolSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//machinegun\r\n\t\t\tif (player.getWeapon() === Weapon.Machinegun) {\r\n\t\t\t\tconst gunX = player.getCenterX() - gunSize / 2;\r\n\t\t\t\tconst gunY = player.getCenterY() - gunSize / 2;\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: gunX,\r\n\t\t\t\t\ty: gunY,\r\n\t\t\t\t\tsize: gunSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(player.getAngle() * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(this.machinegunSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//shotgun\r\n\t\t\tif (player.getWeapon() === Weapon.Shotgun) {\r\n\t\t\t\tconst gunX = player.getCenterX() - gunSize / 2;\r\n\t\t\t\tconst gunY = player.getCenterY() - gunSize / 2;\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: gunX,\r\n\t\t\t\t\ty: gunY,\r\n\t\t\t\t\tsize: gunSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(player.getAngle() * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(this.shotgunSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//rifle\r\n\t\t\tif (player.getWeapon() === Weapon.Rifle) {\r\n\t\t\t\tconst gunX = player.getCenterX() - gunSize / 2;\r\n\t\t\t\tconst gunY = player.getCenterY() - gunSize / 2;\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: gunX,\r\n\t\t\t\t\ty: gunY,\r\n\t\t\t\t\tsize: gunSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(player.getAngle() * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(this.rifleSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//hammer\r\n\t\t\tif (player.getWeapon() === Weapon.Hammer) {\r\n\t\t\t\tconst gunX = player.getCenterX() - gunSize / 2;\r\n\t\t\t\tconst gunY = player.getCenterY() - gunSize / 2;\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\tx: gunX,\r\n\t\t\t\t\ty: gunY,\r\n\t\t\t\t\tsize: gunSize\r\n\t\t\t\t});\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(player.getHammerAngle() * Math.PI / 180);\r\n\t\t\t\t\tctx.drawImage(this.hammerSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tif (this.collisionPoints.isReady()) {\r\n\t\t\t\t\t\t//collisionPoints\r\n\t\t\t\t\t\tctx.fillStyle = this.colors.collisionPoint;\r\n\t\t\t\t\t\tfor (const point of this.collisionPoints.hammer[player.getHammerAngle()]) {\r\n\t\t\t\t\t\t\tconst { x, y, size } = this.howToDraw({\r\n\t\t\t\t\t\t\t\tx: player.getCenterX() - gunSize / 2 + point.x,\r\n\t\t\t\t\t\t\t\ty: player.getCenterY() - gunSize / 2 + point.y,\r\n\t\t\t\t\t\t\t\tsize: 1\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tctx.fillRect(x, y, size, size);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t*/\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//player hands\r\n\t\t\tif (\r\n\t\t\t\tplayer.getWeapon() === Weapon.Hand ||\r\n\t\t\t\tplayer.getWeapon() === Weapon.Granade ||\r\n\t\t\t\tplayer.getWeapon() === Weapon.Smoke ||\r\n\t\t\t\tplayer.getWeapon() === Weapon.Medkit\r\n\t\t\t) {\r\n\t\t\t\tfor (let i = 0; i < 2; i++) {\r\n\t\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\t\tx: player.hands[i].getX(),\r\n\t\t\t\t\t\ty: player.hands[i].getY(),\r\n\t\t\t\t\t\tsize: player.hands[i].size\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\t\tconst radius = size / 2;\r\n\t\t\t\t\t\t//hand border\r\n\t\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\t\tctx.arc(x + radius, y + radius, radius, 0, 2 * Math.PI);\r\n\t\t\t\t\t\tctx.fillStyle = this.colors.handBorder;\r\n\t\t\t\t\t\tctx.fill();\r\n\t\t\t\t\t\t//hand\r\n\t\t\t\t\t\tconst radiusHand = radius * 0.8;\r\n\t\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\t\tctx.arc(x + radius, y + radius, radiusHand, 0, 2 * Math.PI);\r\n\t\t\t\t\t\tctx.fillStyle = this.colors.hand;\r\n\t\t\t\t\t\tctx.fill();\r\n\t\t\t\t\t\t//hand collisionPoints\r\n\t\t\t\t\t\t/*\r\n\t\t\t\t\t\tif (this.collisionPoints.isReady()){\r\n\t\t\t\t\t\t\tctx.fillStyle = this.colors.collisionPoint;\r\n\t\t\t\t\t\t\tfor (const point of this.collisionPoints.hand) {\r\n\t\t\t\t\t\t\t\tconst { x, y, size } = this.howToDraw({\r\n\t\t\t\t\t\t\t\t\tx: player.hands[i].getCenterX() + point.x,\r\n\t\t\t\t\t\t\t\t\ty: player.hands[i].getCenterY() + point.y,\r\n\t\t\t\t\t\t\t\t\tsize: 1\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tctx.fillRect(x, y, size, size);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t*/\r\n\r\n\t\t\t\t\t\t//granade || smoke || medkit in hand\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t(player.getWeapon() === Weapon.Granade ||\r\n\t\t\t\t\t\t\t\tplayer.getWeapon() === Weapon.Smoke ||\r\n\t\t\t\t\t\t\t\tplayer.getWeapon() === Weapon.Medkit) &&\r\n\t\t\t\t\t\t\ti === 1\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tconst playerAngle = player.getAngle();\r\n\t\t\t\t\t\t\tconst percentSize = 1.2;\r\n\t\t\t\t\t\t\tconst shiftZ = player.hands[i].radius * percentSize;\r\n\t\t\t\t\t\t\t//triangle\r\n\t\t\t\t\t\t\tconst shiftX = Math.sin(playerAngle * Math.PI / 180) * shiftZ;\r\n\t\t\t\t\t\t\tconst shiftY = Math.cos(playerAngle * Math.PI / 180) * shiftZ;\r\n\r\n\t\t\t\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\t\t\t\tx: player.hands[i].getCenterX() + shiftX - player.hands[i].radius * percentSize,\r\n\t\t\t\t\t\t\t\ty: player.hands[i].getCenterY() - shiftY - player.hands[i].radius * percentSize,\r\n\t\t\t\t\t\t\t\tsize: player.hands[i].size * percentSize\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\t\t\t\tconst granadeShiftAngle = 30;\r\n\t\t\t\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\t\t\t\tctx.save();\r\n\t\t\t\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\t\t\t\tctx.rotate((playerAngle - granadeShiftAngle) * Math.PI / 180);\r\n\t\t\t\t\t\t\t\tlet SVG;\r\n\t\t\t\t\t\t\t\tif (player.getWeapon() === Weapon.Granade) SVG = this.granadeSVG;\r\n\t\t\t\t\t\t\t\tif (player.getWeapon() === Weapon.Smoke) SVG = this.smokeSVG;\r\n\t\t\t\t\t\t\t\tif (player.getWeapon() === Weapon.Medkit) SVG = this.medkitSVG;\r\n\t\t\t\t\t\t\t\tctx.drawImage(SVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\t\t\t\tctx.restore();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//hand on weapon\r\n\t\t\tif (player.getWeapon() === Weapon.Pistol) {\r\n\t\t\t\tthis.drawHandOnWeapon(player, 27, 0);\r\n\t\t\t\tthis.drawHandOnWeapon(player, 60, 12);\r\n\t\t\t}\r\n\t\t\tif (player.getWeapon() === Weapon.Machinegun) {\r\n\t\t\t\tthis.drawHandOnWeapon(player, 27, 0);\r\n\t\t\t\tthis.drawHandOnWeapon(player, 75, 10);\r\n\t\t\t}\r\n\t\t\tif (player.getWeapon() === Weapon.Shotgun) {\r\n\t\t\t\tthis.drawHandOnWeapon(player, 27, 0);\r\n\t\t\t\tthis.drawHandOnWeapon(player, 75, 10);\r\n\t\t\t}\r\n\t\t\tif (player.getWeapon() === Weapon.Rifle) {\r\n\t\t\t\tthis.drawHandOnWeapon(player, 27, 0);\r\n\t\t\t\tthis.drawHandOnWeapon(player, 80, 9);\r\n\t\t\t}\r\n\t\t\tif (player.getWeapon() === Weapon.Hammer) {\r\n\t\t\t\tthis.drawHandOnWeapon(player, 40, 30);\r\n\t\t\t\tthis.drawHandOnWeapon(player, 40, -30);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//blood\r\n\t\tfor (const player of this.snapshotManager.players) {\r\n\t\t\tctx.fillStyle = this.colors.collisionPoint;\r\n\t\t\tfor (let i = player.bloods.length - 1; i >= 0; i--) {\r\n\t\t\t\tconst blood = player.bloods[i];\r\n\t\t\t\tif (blood.getTimer() < blood.timerMax) {\r\n\t\t\t\t\tblood.shift();\r\n\t\t\t\t\tconst bloodX = player.getCenterX() + blood.getX();\r\n\t\t\t\t\tconst bloodY = player.getCenterY() + blood.getY();\r\n\t\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\t\t\tx: bloodX,\r\n\t\t\t\t\t\ty: bloodY,\r\n\t\t\t\t\t\tsize: blood.size\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\t\tconst alpha = 1 - blood.getTimer() / blood.timerMax;\r\n\t\t\t\t\t\tctx.save();\r\n\t\t\t\t\t\tctx.globalAlpha = alpha;\r\n\t\t\t\t\t\tctx.fillRect(x, y, size, size);\r\n\t\t\t\t\t\tctx.restore();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tplayer.bloods.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//granades\r\n\t\tfor (const granade of betweenSnapshot.g) {\r\n\t\t\tconst granadeSize = 40 * granade.b;\r\n\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\tx: granade.x - granadeSize / 2,\r\n\t\t\t\ty: granade.y - granadeSize / 2,\r\n\t\t\t\tsize: granadeSize\r\n\t\t\t});\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\tctx.rotate(granade.a * Math.PI / 180);\r\n\t\t\t\tif (granade.t === 'g') {\r\n\t\t\t\t\tctx.drawImage(this.granadeSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t}\r\n\t\t\t\tif (granade.t === 's') {\r\n\t\t\t\t\tctx.drawImage(this.smokeSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t}\r\n\t\t\t\tctx.restore();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//bullet points\r\n\t\t/*\r\n\t\tctx.fillStyle = 'red';\r\n\t\tfor (const bullet of betweenSnapshot.b) {\r\n\t\t\t//bullet point\r\n\t\t\tconst bulletRadius = 2;\r\n\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\tx: bullet.x - bulletRadius,\r\n\t\t\t\ty: bullet.y - bulletRadius,\r\n\t\t\t\tsize: bulletRadius * 2\r\n\t\t\t});\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\tctx.fillRect(x, y, size, size);\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\tthis.createBulletLines();\r\n\t\t//draw bullet lines\r\n\t\tfor (const line of this.bulletLines) {\r\n\t\t\tlet partCounter = 0;\r\n\t\t\tfor (const partLine of line.parts) {\r\n\t\t\t\tpartCounter++;\r\n\t\t\t\tlet baseAlpha = partCounter * 0.05 + 0.1;\r\n\t\t\t\tif (baseAlpha > 0.8) baseAlpha = 0.8;\r\n\t\t\t\tif (partLine.isActive()) {\r\n\t\t\t\t\tlet finalAlpha = baseAlpha - partLine.getAge() / 14.3;\r\n\t\t\t\t\tif (finalAlpha < 0) finalAlpha = 0;\r\n\t\t\t\t\tconst { x: startX, y: startY } = this.howToDraw({\r\n\t\t\t\t\t\tx: partLine.startX,\r\n\t\t\t\t\t\ty: partLine.startY,\r\n\t\t\t\t\t\tsize: 1\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconst { x: endX, y: endY } = this.howToDraw({\r\n\t\t\t\t\t\tx: partLine.endX,\r\n\t\t\t\t\t\ty: partLine.endY,\r\n\t\t\t\t\t\tsize: 1\r\n\t\t\t\t\t});\r\n\t\t\t\t\t//bug long bullet lines\r\n\t\t\t\t\tif (Math.abs(startX - endX) > 100 || Math.abs(startY - endY) > 100) {\r\n\t\t\t\t\t\tconsole.log('err: bullet lines');\r\n\t\t\t\t\t\tconsole.log('partLine', partLine);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t//draw part\r\n\t\t\t\t\t\tctx.save();\r\n\t\t\t\t\t\tctx.globalAlpha = finalAlpha;\r\n\t\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\t\tctx.moveTo(startX, startY);\r\n\t\t\t\t\t\tctx.lineTo(endX, endY);\r\n\t\t\t\t\t\tctx.lineWidth = (6 - partLine.getAge() / 3.33) * this.finalResolutionAdjustment;\r\n\t\t\t\t\t\tctx.strokeStyle = 'white';\r\n\t\t\t\t\t\tctx.stroke();\r\n\t\t\t\t\t\tctx.restore();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpartLine.increaseAge();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//bushes\r\n\t\tfor (const bush of this.map.bushes) {\r\n\t\t\tif (bush.isActive()) {\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw(bush);\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(bush.angle * Math.PI / 180);\r\n\t\t\t\t\tctx.globalAlpha = bush.getOpacity();\r\n\t\t\t\t\tctx.drawImage(this.bushSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//trees\r\n\t\tfor (const tree of this.map.trees) {\r\n\t\t\tif (tree.isActive()) {\r\n\t\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw(tree);\r\n\t\t\t\tif (isOnScreen) {\r\n\t\t\t\t\tlet middleImage = size / 2;\r\n\t\t\t\t\tctx.save();\r\n\t\t\t\t\tctx.translate(x + middleImage, y + middleImage);\r\n\t\t\t\t\tctx.rotate(tree.angle * Math.PI / 180);\r\n\t\t\t\t\tctx.globalAlpha = tree.getOpacity();\r\n\t\t\t\t\tctx.drawImage(this.treeSVG, -middleImage, -middleImage, size, size);\r\n\t\t\t\t\tctx.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//smokes\r\n\t\tfor (const smoke of betweenSnapshot.s) {\r\n\t\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\t\tx: smoke.x - smoke.s / 2,\r\n\t\t\t\ty: smoke.y - smoke.s / 2,\r\n\t\t\t\tsize: smoke.s\r\n\t\t\t});\r\n\t\t\tif (isOnScreen) {\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.globalAlpha = smoke.o;\r\n\t\t\t\tctx.drawImage(this.smokeCloudSVG, x, y, size, size);\r\n\t\t\t\tctx.restore();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//zone\r\n\t\tconst { x, y, size: outerRadius } = this.howToDraw({\r\n\t\t\tx: this.snapshotManager.zone.outerCircle.getCenterX(),\r\n\t\t\ty: this.snapshotManager.zone.outerCircle.getCenterY(),\r\n\t\t\tsize: this.snapshotManager.zone.outerCircle.getRadius()\r\n\t\t});\r\n\r\n\t\tel.zoneCircle.setAttribute('r', outerRadius.toString());\r\n\t\tel.zoneCircle.setAttribute('cx', x.toString());\r\n\t\tel.zoneCircle.setAttribute('cy', y.toString());\r\n\r\n\t\t//info\r\n\t\t/*\r\n\t\t{\r\n\t\t\tctx.font = '20px Arial';\r\n\t\t\tctx.fillStyle = this.colors.text;\r\n\t\t\tconst x = 15;\r\n\t\t\tlet row = 30;\r\n\t\t\tlet rowMultiple = 8;\r\n\t\t\t//ctx.fillText('snapshots: ' + this.snapshots.length, x, row * ++rowMultiple);\r\n\t\t\tctx.fillText('newerSnapshots: ' + this.snapshotManager.sumaNewer, x, row * ++rowMultiple);\r\n\t\t\tctx.fillText('ping: ' + this.serverClientSync.getPing(), x, row * ++rowMultiple);\r\n\t\t\tctx.fillText('timeDiference: ' + this.serverClientSync.getTimeDiference(), x, row * ++rowMultiple);\r\n\t\t\tctx.fillText('drawDelay: ' + this.serverClientSync.getDrawDelay(), x, row * ++rowMultiple);\r\n\t\t\tif (!this.snapshotManager.olderExists) {\r\n\t\t\t\tctx.fillText('olderSnapshot missing', x, row * ++rowMultiple);\r\n\t\t\t}\r\n\t\t\tif (!this.snapshotManager.newerExists) {\r\n\t\t\t\tctx.fillText('newerSnapshot missing', x, row * ++rowMultiple);\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\t//healthBar\r\n\t\tel.healthBar.in.style.width = betweenSnapshot.i.h + '%';\r\n\r\n\t\t//loading\r\n\t\tconst progres = Math.round(betweenSnapshot.i.l / betweenSnapshot.i.lE * 100);\r\n\t\tconst seconds = Math.round((betweenSnapshot.i.lE - betweenSnapshot.i.l) / 1000 * 10) / 10;\r\n\t\tif (seconds && this.myPlayer.alive()) {\r\n\t\t\tel.takeLoot.style.display = 'none';\r\n\t\t\tel.loading.main.style.visibility = 'visible';\r\n\t\t\tel.loading.text.style.display = 'block';\r\n\t\t\tel.loading.text.textContent = betweenSnapshot.i.lT;\r\n\t\t\tlet secondsString = seconds.toString();\r\n\t\t\tswitch (secondsString) {\r\n\t\t\t\tcase '0':\r\n\t\t\t\t\tsecondsString = ' 0.0';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '1':\r\n\t\t\t\t\tsecondsString = ' 1.0';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '2':\r\n\t\t\t\t\tsecondsString = ' 2.0';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '3':\r\n\t\t\t\t\tsecondsString = ' 3.0';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '4':\r\n\t\t\t\t\tsecondsString = ' 4.0';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase '5':\r\n\t\t\t\t\tsecondsString = ' 5.0';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tel.loading.counter.textContent = secondsString;\r\n\t\t\tel.loading.circle.setAttribute('stroke-dasharray', progres + ', 100');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tel.loading.main.style.visibility = 'hidden';\r\n\t\t\tel.loading.text.style.display = 'none';\r\n\t\t\t//take loot info\r\n\t\t\tel.takeLoot.style.display = 'block';\r\n\t\t\tthis.takeLootInfo();\r\n\t\t}\r\n\r\n\t\t//items\r\n\t\tel.items.redAmmo.textContent = this.snapshotManager.betweenSnapshot.i.r.toString();\r\n\t\tel.items.greenAmmo.textContent = this.snapshotManager.betweenSnapshot.i.g.toString();\r\n\t\tel.items.blueAmmo.textContent = this.snapshotManager.betweenSnapshot.i.b.toString();\r\n\t\tel.items.orangeAmmo.textContent = this.snapshotManager.betweenSnapshot.i.o.toString();\r\n\r\n\t\tel.items.item1in.textContent = this.itemName(this.snapshotManager.betweenSnapshot.i.i1);\r\n\t\tel.items.item2in.textContent = this.itemName(this.snapshotManager.betweenSnapshot.i.i2);\r\n\t\t//ammo color\r\n\t\tthis.itemAmmoColor(1, this.snapshotManager.betweenSnapshot.i.i1);\r\n\t\tthis.itemAmmoColor(2, this.snapshotManager.betweenSnapshot.i.i2);\r\n\t\tel.items.item3in.textContent = this.itemName(this.snapshotManager.betweenSnapshot.i.i3);\r\n\t\tlet item4Text = this.itemName(this.snapshotManager.betweenSnapshot.i.i4);\r\n\t\tconst item4Count = this.snapshotManager.betweenSnapshot.i.s4;\r\n\t\tif (item4Text) item4Text += ' ' + item4Count;\r\n\t\tel.items.item4in.textContent = item4Text;\r\n\r\n\t\tlet item5Text = this.itemName(this.snapshotManager.betweenSnapshot.i.i5);\r\n\t\tconst item5Count = this.snapshotManager.betweenSnapshot.i.s5;\r\n\t\tif (item5Text) item5Text += ' ' + item5Count;\r\n\t\tel.items.item5in.textContent = item5Text;\r\n\r\n\t\t//active item\r\n\t\tthis.activeItem(betweenSnapshot.i.ai);\r\n\r\n\t\t//activeGunAmmo\r\n\t\tlet ammo = '';\r\n\t\tif (\r\n\t\t\tthis.myPlayer.getWeapon() === Weapon.Pistol ||\r\n\t\t\tthis.myPlayer.getWeapon() === Weapon.Rifle ||\r\n\t\t\tthis.myPlayer.getWeapon() === Weapon.Machinegun ||\r\n\t\t\tthis.myPlayer.getWeapon() === Weapon.Shotgun\r\n\t\t) {\r\n\t\t\tammo = betweenSnapshot.i.a.toString();\r\n\t\t}\r\n\t\telse if (this.myPlayer.getWeapon() === Weapon.Hand || this.myPlayer.getWeapon() === Weapon.Hammer) {\r\n\t\t\tammo = '∞';\r\n\t\t}\r\n\t\telse if (this.myPlayer.getWeapon() === Weapon.Granade || this.myPlayer.getWeapon() === Weapon.Smoke) {\r\n\t\t\tammo = item4Count.toString();\r\n\t\t}\r\n\t\telse if (this.myPlayer.getWeapon() === Weapon.Medkit) {\r\n\t\t\tammo = item5Count.toString();\r\n\t\t}\r\n\t\tel.activeGunAmmo.textContent = ammo;\r\n\r\n\t\t//alive\r\n\t\tlet count = 0;\r\n\t\tfor (const player of this.snapshotManager.players) {\r\n\t\t\tif (player.alive()) count++;\r\n\t\t}\r\n\t\tel.alive.textContent = count.toString();\r\n\r\n\t\t//top items\r\n\t\tlet display = 'none';\r\n\t\tif (this.snapshotManager.betweenSnapshot.i.s !== 1) {\r\n\t\t\tdisplay = 'block';\r\n\t\t\tswitch (this.snapshotManager.betweenSnapshot.i.s) {\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tel.items.scope2.style.display = 'block';\r\n\t\t\t\t\tel.items.scope4.style.display = 'none';\r\n\t\t\t\t\tel.items.scope6.style.display = 'none';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\tel.items.scope2.style.display = 'none';\r\n\t\t\t\t\tel.items.scope4.style.display = 'block';\r\n\t\t\t\t\tel.items.scope6.style.display = 'none';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 6:\r\n\t\t\t\t\tel.items.scope2.style.display = 'none';\r\n\t\t\t\t\tel.items.scope4.style.display = 'none';\r\n\t\t\t\t\tel.items.scope6.style.display = 'block';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tel.items.scope.style.display = display;\r\n\t\tdisplay = 'none';\r\n\t\tif (this.snapshotManager.betweenSnapshot.i.v) display = 'block';\r\n\t\tel.items.vest.style.display = display;\r\n\r\n\t\t//messages\r\n\t\tthis.snapshotManager.messageManager();\r\n\t\tel.messages.innerHTML = '';\r\n\t\tfor (let i = this.snapshotManager.messages.length - 1; i >= 0; i--) {\r\n\t\t\tconst message = this.snapshotManager.messages[i];\r\n\t\t\tconst element = document.createElement('p');\r\n\t\t\telement.textContent = message.text;\r\n\t\t\tel.messages.appendChild(element);\r\n\t\t}\r\n\r\n\t\t//zone time\r\n\t\tif (this.snapshotManager.betweenSnapshot.z.hasOwnProperty('d')) {\r\n\t\t\tlet text = '';\r\n\t\t\tif (this.snapshotManager.betweenSnapshot.z.d > 0) {\r\n\t\t\t\ttext += this.snapshotManager.betweenSnapshot.z.d;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttext = 'Zone is moving!';\r\n\t\t\t}\r\n\t\t\tel.zoneTimer.innerText = text;\r\n\t\t}\r\n\r\n\t\t//spectate text\r\n\t\tel.spectate.style.display = 'none';\r\n\t\tif (betweenSnapshot.i.spectateName) {\r\n\t\t\tel.spectateName.innerText = betweenSnapshot.i.spectateName;\r\n\t\t\tel.spectate.style.display = 'block';\r\n\t\t}\r\n\t}\r\n\r\n\tprivate drawHandOnWeapon(player: Player, shiftHandZ: number, shiftHandAngle: number): void {\r\n\t\tconst ctx = this.ctxGame;\r\n\t\tlet finalAngle = shiftHandAngle + player.getAngle();\r\n\t\tif (player.getWeapon() === Weapon.Hammer) finalAngle = shiftHandAngle + player.getHammerAngle();\r\n\t\tif (finalAngle >= 360) finalAngle -= 360;\r\n\t\tconst shiftHandX = Math.sin(finalAngle * Math.PI / 180) * shiftHandZ;\r\n\t\tconst shiftHandY = Math.cos(finalAngle * Math.PI / 180) * shiftHandZ;\r\n\t\tconst handX = player.getCenterX() + shiftHandX - player.hands[0].radius;\r\n\t\tconst handY = player.getCenterY() - shiftHandY - player.hands[0].radius;\r\n\t\tconst { x, y, size, isOnScreen } = this.howToDraw({\r\n\t\t\tx: handX,\r\n\t\t\ty: handY,\r\n\t\t\tsize: player.hands[0].size\r\n\t\t});\r\n\t\tif (isOnScreen) {\r\n\t\t\tconst radius = size / 2;\r\n\t\t\t//hand border\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.arc(x + radius, y + radius, radius, 0, 2 * Math.PI);\r\n\t\t\tctx.fillStyle = this.colors.handBorder;\r\n\t\t\tctx.fill();\r\n\t\t\t//hand\r\n\t\t\tconst radiusHand = radius * 0.8;\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.arc(x + radius, y + radius, radiusHand, 0, 2 * Math.PI);\r\n\t\t\tctx.fillStyle = this.colors.hand;\r\n\t\t\tctx.fill();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate createBulletLines(): void {\r\n\t\tfor (const bullet of this.snapshotManager.betweenSnapshot.b) {\r\n\t\t\tlet thereIsLine = false;\r\n\t\t\t//set end in line\r\n\t\t\tfor (const line of this.bulletLines) {\r\n\t\t\t\tif (line.id === bullet.id) {\r\n\t\t\t\t\tline.setEnd(bullet.x, bullet.y);\r\n\t\t\t\t\tthereIsLine = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//create new line\r\n\t\t\tif (!thereIsLine) this.bulletLines.push(new BulletLine(bullet.id, bullet.x, bullet.y));\r\n\t\t}\r\n\t\t//delete old bullet lines\r\n\t\tfor (let i = this.bulletLines.length - 1; i >= 0; i--) {\r\n\t\t\tif (!this.bulletLines[i].isActive()) {\r\n\t\t\t\tthis.bulletLines.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate activeItem(activeItem: number): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\t\tel.items.item1.classList.remove('active');\r\n\t\tel.items.item2.classList.remove('active');\r\n\t\tel.items.item3.classList.remove('active');\r\n\t\tel.items.item4.classList.remove('active');\r\n\t\tel.items.item5.classList.remove('active');\r\n\r\n\t\tswitch (activeItem) {\r\n\t\t\tcase 1:\r\n\t\t\t\tel.items.item1.classList.add('active');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tel.items.item2.classList.add('active');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 3:\r\n\t\t\t\tel.items.item3.classList.add('active');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\tel.items.item4.classList.add('active');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tel.items.item5.classList.add('active');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate itemAmmoColor(item: number, weapon: Weapon): void {\r\n\t\tlet el;\r\n\t\tif (item === 1) {\r\n\t\t\tel = this.myHtmlElements.items.item1Ammo;\r\n\t\t}\r\n\t\telse if (item === 2) {\r\n\t\t\tel = this.myHtmlElements.items.item2Ammo;\r\n\t\t}\r\n\t\tlet background = 'transparent';\r\n\t\tswitch (weapon) {\r\n\t\t\tcase Weapon.Pistol:\r\n\t\t\t\tbackground = 'orange';\r\n\t\t\t\tbreak;\r\n\t\t\tcase Weapon.Machinegun:\r\n\t\t\t\tbackground = 'blue';\r\n\t\t\t\tbreak;\r\n\t\t\tcase Weapon.Rifle:\r\n\t\t\t\tbackground = 'Green';\r\n\t\t\t\tbreak;\r\n\t\t\tcase Weapon.Shotgun:\r\n\t\t\t\tbackground = 'red';\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tif (el) el.style.background = background;\r\n\t}\r\n\r\n\tprivate itemName(item: any): string {\r\n\t\tlet weaponName: string = '';\r\n\t\tif (item === Weapon.Pistol) weaponName = 'Pistol';\r\n\t\tif (item === Weapon.Rifle) weaponName = 'Rifle';\r\n\t\tif (item === Weapon.Machinegun) weaponName = 'Machinegun';\r\n\t\tif (item === Weapon.Shotgun) weaponName = 'Shotgun';\r\n\t\tif (item === Weapon.Granade) weaponName = 'Granade';\r\n\t\tif (item === Weapon.Smoke) weaponName = 'Smoke';\r\n\t\tif (item === Weapon.Hand) weaponName = 'Hands';\r\n\t\tif (item === Weapon.Hammer) weaponName = 'Hammer';\r\n\t\tif (item === Weapon.Medkit) weaponName = 'Medkit';\r\n\t\treturn weaponName;\r\n\t}\r\n\r\n\tprivate takeLootInfo(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\t\tlet takeLootText = '';\r\n\t\tif (!this.snapshotManager.betweenSnapshot || !this.myPlayer.alive()) {\r\n\t\t\tel.takeLoot.innerText = takeLootText;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (const loot of this.snapshotManager.betweenSnapshot.l) {\r\n\t\t\tconst x = this.myPlayer.getCenterX() - (loot.x + loot.size / 2);\r\n\t\t\tconst y = this.myPlayer.getCenterY() - (loot.y + loot.size / 2);\r\n\t\t\tconst distance = Math.sqrt(x * x + y * y);\r\n\t\t\tconst lootAndPlayerRadius = this.snapshotManager.players[0].radius + loot.size / 2;\r\n\t\t\tif (distance < lootAndPlayerRadius) {\r\n\t\t\t\tlet lootName = '';\r\n\t\t\t\tswitch (loot.type) {\r\n\t\t\t\t\tcase LootType.BlueAmmo:\r\n\t\t\t\t\tcase LootType.RedAmmo:\r\n\t\t\t\t\tcase LootType.GreenAmmo:\r\n\t\t\t\t\tcase LootType.OrangeAmmo:\r\n\t\t\t\t\t\tlootName = 'Ammo';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Pistol:\r\n\t\t\t\t\t\tlootName = 'Pistol';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Rifle:\r\n\t\t\t\t\t\tlootName = 'Rifle';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Machinegun:\r\n\t\t\t\t\t\tlootName = 'Machinegun';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Shotgun:\r\n\t\t\t\t\t\tlootName = 'Shotgun';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Scope2:\r\n\t\t\t\t\t\tlootName = '2X scope';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Scope4:\r\n\t\t\t\t\t\tlootName = '4X scope';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Scope6:\r\n\t\t\t\t\t\tlootName = '6X scope';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Granade:\r\n\t\t\t\t\t\tlootName = 'Granade';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Smoke:\r\n\t\t\t\t\t\tlootName = 'Smoke';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Medkit:\r\n\t\t\t\t\t\tlootName = 'Medkit';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Vest:\r\n\t\t\t\t\t\tlootName = 'Vest';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase LootType.Hammer:\r\n\t\t\t\t\t\tlootName = 'Hammer';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet quantity = '';\r\n\t\t\t\tif (loot.quantity) quantity += loot.quantity;\r\n\t\t\t\ttakeLootText = lootName + ' ' + quantity + ' (E)';\r\n\t\t\t\tel.takeLoot.innerText = takeLootText;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tel.takeLoot.innerText = takeLootText;\r\n\t}\r\n\r\n\tprivate howToDraw(gameObject: RoundObject | RectObject | RectangleObstacle | RoundObstacle): DrawData {\r\n\t\t//size\r\n\t\tlet size = 0;\r\n\t\tlet width = 0;\r\n\t\tlet height = 0;\r\n\t\t//round or square\r\n\t\tif ((<RoundObject>gameObject).size) {\r\n\t\t\tsize = (<RoundObject>gameObject).size * this.finalResolutionAdjustment;\r\n\t\t\twidth = size;\r\n\t\t\theight = size;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//rect\r\n\t\t\twidth = (<RectObject>gameObject).width * this.finalResolutionAdjustment;\r\n\t\t\theight = (<RectObject>gameObject).height * this.finalResolutionAdjustment;\r\n\t\t}\r\n\r\n\t\t//positions on screen\r\n\t\tconst x = this.screenCenterX + (gameObject.x - this.myPlayer.getCenterX()) * this.finalResolutionAdjustment;\r\n\t\tconst y = this.screenCenterY + (gameObject.y - this.myPlayer.getCenterY()) * this.finalResolutionAdjustment;\r\n\t\t//Is is on the screen?\r\n\t\tlet isOnScreen = true;\r\n\t\tif (x > this.gameScreen.width || x < -width || y > this.gameScreen.height || y < -height) {\r\n\t\t\tisOnScreen = false;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tx,\r\n\t\t\ty,\r\n\t\t\tsize,\r\n\t\t\twidth,\r\n\t\t\theight,\r\n\t\t\tisOnScreen\r\n\t\t};\r\n\t}\r\n\r\n\tgameOver(stats: PlayerStats, win: boolean, winnerName?: string): void {\r\n\t\tsetTimeout(() => {\r\n\t\t\tconst el = this.myHtmlElements;\r\n\t\t\tif (win || winnerName) {\r\n\t\t\t\tel.gameOverMenu.h1.textContent = 'Winner!';\r\n\t\t\t\tif (winnerName) el.gameOverMenu.h1.textContent = winnerName + ' win';\r\n\t\t\t\tel.gameOverMenu.spectate.style.display = 'none';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tel.gameOverMenu.h1.textContent = 'You died';\r\n\t\t\t\tel.gameOverMenu.spectate.style.display = 'block';\r\n\t\t\t}\r\n\t\t\tel.open(el.gameOverMenu.main);\r\n\t\t\t//remove stats\r\n\t\t\tel.gameOverMenu.stats.innerHTML = '';\r\n\t\t\tconst kills = document.createElement('p');\r\n\t\t\tkills.textContent = 'Kills: ' + stats.kills.toString();\r\n\t\t\tconst damageDealt = document.createElement('p');\r\n\t\t\tdamageDealt.textContent = 'Damage dealt: ' + stats.damageDealt.toString();\r\n\t\t\tconst damageTaken = document.createElement('p');\r\n\t\t\tdamageTaken.textContent = 'Damage taken: ' + stats.damageTaken.toString();\r\n\t\t\tconst survive = document.createElement('p');\r\n\t\t\tconst minutes = Math.floor(stats.survive / 60);\r\n\t\t\tconst seconds = stats.survive - minutes * 60;\r\n\t\t\tconst surviveTime = minutes + 'm ' + seconds + 's';\r\n\t\t\tsurvive.textContent = 'Survive: ' + surviveTime;\r\n\t\t\tel.gameOverMenu.stats.appendChild(kills);\r\n\t\t\tel.gameOverMenu.stats.appendChild(damageDealt);\r\n\t\t\tel.gameOverMenu.stats.appendChild(damageTaken);\r\n\t\t\tif (!win) el.gameOverMenu.stats.appendChild(survive);\r\n\t\t}, 2000);\r\n\t}\r\n}\r\n","import { Terrain } from './Terrain';\r\nimport Bush from './Bush';\r\nimport Tree from './Tree';\r\nimport Rock from './Rock';\r\nimport Wall from './Wall';\r\nimport WaterTerrainData from './WaterTerrainData';\r\nimport RoundObstacle from './RoundObstacle';\r\nimport RectangleObstacle from './RectangleObstacle';\r\nimport MapData from './MapData';\r\n\r\ntype Block = {\r\n\tx: number;\r\n\ty: number;\r\n};\r\n\r\nexport default class Map {\r\n\tprivate size: number;\r\n\tprivate blockSize: number;\r\n\treadonly blocks: Block[] = [];\r\n\treadonly terrain: Terrain[] = [];\r\n\treadonly impassableRoundObstacles: RoundObstacle[] = [];\r\n\treadonly bushes: Bush[] = [];\r\n\treadonly trees: Tree[] = [];\r\n\treadonly rocks: Rock[] = [];\r\n\treadonly rectangleObstacles: RectangleObstacle[] = [];\r\n\treadonly waterTerrainData: WaterTerrainData;\r\n\r\n\tconstructor(waterTerrainData: WaterTerrainData) {\r\n\t\tthis.waterTerrainData = waterTerrainData;\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tthis.blocks.splice(0, this.blocks.length);\r\n\t\tthis.terrain.splice(0, this.terrain.length);\r\n\t\tthis.impassableRoundObstacles.splice(0, this.impassableRoundObstacles.length);\r\n\t\tthis.bushes.splice(0, this.bushes.length);\r\n\t\tthis.trees.splice(0, this.trees.length);\r\n\t\tthis.rocks.splice(0, this.rocks.length);\r\n\t\tthis.rectangleObstacles.splice(0, this.rectangleObstacles.length);\r\n\t}\r\n\r\n\tgetSize(): number {\r\n\t\treturn this.size;\r\n\t}\r\n\r\n\tgetBlockSize(): number {\r\n\t\treturn this.blockSize;\r\n\t}\r\n\r\n\topenMap(map: MapData): void {\r\n\t\tthis.size = map.size * map.blockSize;\r\n\t\tthis.blockSize = map.blockSize;\r\n\t\t//Create blocks\r\n\t\tfor (let yy = 0; yy < map.size; yy++) {\r\n\t\t\tfor (let xx = 0; xx < map.size; xx++) {\r\n\t\t\t\tthis.blocks.push({ x: xx * map.blockSize, y: yy * map.blockSize });\r\n\t\t\t}\r\n\t\t}\r\n\t\t//terrains\r\n\t\tfor (const terrain of map.terrains) {\r\n\t\t\tthis.terrain.push(new Terrain(terrain.type, terrain.x, terrain.y, terrain.size));\r\n\t\t}\r\n\t\t//rocks\r\n\t\tlet id = 0;\r\n\t\tfor (const rock of map.rocks) {\r\n\t\t\tconst newRock = new Rock(id++, rock.x, rock.y);\r\n\t\t\tthis.rocks.push(newRock);\r\n\t\t\tthis.impassableRoundObstacles.push(newRock);\r\n\t\t}\r\n\t\t//bushes\r\n\t\tfor (const bush of map.bushes) {\r\n\t\t\tthis.bushes.push(new Bush(id++, bush.x, bush.y, bush.angle));\r\n\t\t}\r\n\t\t//trees\r\n\t\tfor (const tree of map.trees) {\r\n\t\t\tconst newTree = new Tree(id++, tree.x, tree.y, tree.angle);\r\n\t\t\tthis.trees.push(newTree);\r\n\t\t\tthis.impassableRoundObstacles.push(newTree);\r\n\t\t}\r\n\t\t//walls\r\n\t\tfor (const wall of map.rects) {\r\n\t\t\tthis.rectangleObstacles.push(new Wall(id++, wall.x, wall.y, wall.width, wall.height));\r\n\t\t}\r\n\t}\r\n}\r\n","import { TerrainType } from './Terrain';\r\n\r\n/*\r\nimport { triangel1 } from './triangel1Data';\r\nimport { triangel2 } from './triangel2Data';\r\nimport { triangel3 } from './triangel3Data';\r\nimport { triangel4 } from './triangel4Data';\r\n*/\r\n\r\nexport default class WaterTerrainData {\r\n\tprivate waterTriangle1: boolean[][] = [];\r\n\tprivate waterTriangle2: boolean[][] = [];\r\n\tprivate waterTriangle3: boolean[][] = [];\r\n\tprivate waterTriangle4: boolean[][] = [];\r\n\r\n\t/*\r\n\tprivate waterTriangle1: number[][] = triangel1;\r\n\tprivate waterTriangle2: number[][] = triangel2;\r\n\tprivate waterTriangle3: number[][] = triangel3;\r\n\tprivate waterTriangle4: number[][] = triangel4;\r\n\t*/\r\n\r\n\tconstructor() {}\r\n\r\n\tsetData(type: TerrainType, data: boolean[][]): void {\r\n\t\tswitch (type) {\r\n\t\t\tcase TerrainType.WaterTriangle1:\r\n\t\t\t\tthis.waterTriangle1 = data;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle2:\r\n\t\t\t\tthis.waterTriangle2 = data;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle3:\r\n\t\t\t\tthis.waterTriangle3 = data;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle4:\r\n\t\t\t\tthis.waterTriangle4 = data;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error('Unknown water type');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tincludeWater(type: TerrainType, x: number, y: number): boolean {\r\n\t\tlet state = false;\r\n\t\tlet waterData;\r\n\t\tswitch (type) {\r\n\t\t\tcase TerrainType.WaterTriangle1:\r\n\t\t\t\twaterData = this.waterTriangle1;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle2:\r\n\t\t\t\twaterData = this.waterTriangle2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle3:\r\n\t\t\t\twaterData = this.waterTriangle3;\r\n\t\t\t\tbreak;\r\n\t\t\tcase TerrainType.WaterTriangle4:\r\n\t\t\t\twaterData = this.waterTriangle4;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error('Unknown water type');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tif (x < waterData.length && y < waterData[x].length) {\r\n\t\t\tif (waterData[x][y]) state = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//no water data yet\r\n\t\t\t//no water data == we are in water\r\n\t\t\tif (waterData.length === 0) {\r\n\t\t\t\tstate = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthrow new Error('Out of range on water type');\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn state;\r\n\t}\r\n\r\n\t/*\r\n\twrite(): void {\r\n\t\tconst el = document.createElement('p');\r\n\t\tel.style.position = 'absolute';\r\n\t\tel.style.top = '0';\r\n\t\tel.style.left = '0';\r\n\r\n\t\tel.textContent = JSON.stringify(this.waterTriangle4);\r\n\t\tdocument.body.appendChild(el);\r\n\t}\r\n\t*/\r\n}\r\n","import Point from './Point';\r\n\r\nexport default class CollisionPoints {\r\n\tbody: Point[] = [];\r\n\thand: Point[] = [];\r\n\thammer: Point[][] = [];\r\n\tready: boolean = false;\r\n\r\n\tsetData(body: Point[], hand: Point[], hammer: Point[][]) {\r\n\t\tthis.body = body;\r\n\t\tthis.hand = hand;\r\n        this.hammer = hammer;\r\n        this.ready = true;\r\n    }\r\n    \r\n    isReady(): boolean{\r\n        return this.ready;\r\n    }\r\n}\r\n","export default class Hand {\r\n\treadonly size: number;\r\n\treadonly radius: number;\r\n\tprivate x: number;\r\n\tprivate y: number;\r\n\r\n\tconstructor(x: number, y: number, size: number) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.size = size;\r\n\t\tthis.radius = size / 2;\r\n\t}\r\n\r\n\tsetX(x: number): void {\r\n\t\tthis.x = x;\r\n\t}\r\n\r\n\tsetY(y: number): void {\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\tgetX(): number {\r\n\t\treturn this.x;\r\n\t}\r\n\r\n\tgetY(): number {\r\n\t\treturn this.y;\r\n\t}\r\n\r\n\tgetCenterX(): number {\r\n\t\treturn this.x + this.radius;\r\n\t}\r\n\r\n\tgetCenterY(): number {\r\n\t\treturn this.y + this.radius;\r\n\t}\r\n}\r\n","export default class Blood {\r\n\treadonly size: number = 8;\r\n\tprivate x: number;\r\n\tprivate y: number;\r\n\tprivate timer: number = 0;\r\n\treadonly timerMax: number = 60;\r\n\r\n\tconstructor() {\r\n\t\tthis.x = Math.round(Math.random() * 30) * -1;\r\n\t\tthis.y = Math.round(Math.random() * 30);\r\n\t}\r\n\r\n\tshift(): void {\r\n\t\tthis.x += 0.7;\r\n\t\tthis.y -= 0.7;\r\n\t\tthis.timer++;\r\n\t}\r\n\r\n\tgetX(): number {\r\n\t\treturn this.x;\r\n\t}\r\n\r\n\tgetY(): number {\r\n\t\treturn this.y;\r\n\t}\r\n\r\n\tgetTimer(): number {\r\n\t\treturn this.timer;\r\n\t}\r\n}\r\n","import Hand from './Hand';\r\nimport { Weapon } from './Weapon';\r\nimport PlayerSnapshot from './PlayerSnapshot';\r\nimport Blood from './Blood';\r\n\r\nexport default class Player {\r\n\treadonly id: number;\r\n\treadonly size: number;\r\n\treadonly radius: number;\r\n\tprivate live: boolean = true;\r\n\tprivate x: number;\r\n\tprivate y: number;\r\n\tprivate angle: number;\r\n\tprivate hammerAngle: number;\r\n\treadonly hands: Hand[] = [];\r\n\tprivate weapon: Weapon;\r\n\treadonly bloods: Blood[] = [];\r\n\tprivate vest: boolean = false;\r\n\r\n\tconstructor(playerSnapshot: PlayerSnapshot) {\r\n\t\tthis.id = playerSnapshot.i;\r\n\t\tthis.x = playerSnapshot.x;\r\n\t\tthis.y = playerSnapshot.y;\r\n\t\tthis.angle = playerSnapshot.a;\r\n\t\tthis.hammerAngle = playerSnapshot.m;\r\n\t\tthis.weapon = playerSnapshot.w;\r\n\t\tthis.size = playerSnapshot.size;\r\n\t\tthis.radius = this.size / 2;\r\n\t\tthis.hands.push(new Hand(playerSnapshot.lX, playerSnapshot.lY, playerSnapshot.hSize));\r\n\t\tthis.hands.push(new Hand(playerSnapshot.rX, playerSnapshot.rY, playerSnapshot.hSize));\r\n\t}\r\n\r\n\tcreateInjury(power: number): void {\r\n\t\tconst powerToBlood = 2;\r\n\t\tfor (let i = 0; i < power / powerToBlood; i++) {\r\n\t\t\tthis.bloods.push(new Blood());\r\n\t\t}\r\n\t}\r\n\r\n\tgetVest(): boolean {\r\n\t\treturn this.vest;\r\n\t}\r\n\t\r\n\tsetVest(vest: boolean): void {\r\n\t\tthis.vest = vest;\r\n\t}\r\n\r\n\tdie(): void {\r\n\t\tthis.live = false;\r\n\t}\r\n\r\n\talive(): boolean {\r\n\t\treturn this.live;\r\n\t}\r\n\r\n\tsetX(x: number): void {\r\n\t\tthis.x = x;\r\n\t}\r\n\r\n\tsetY(y: number): void {\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\tsetAngle(angle: number): void {\r\n\t\tthis.angle = angle;\r\n\t}\r\n\r\n\tsetHammerAngle(hammerAngle: number): void {\r\n\t\tthis.hammerAngle = hammerAngle;\r\n\t}\r\n\r\n\tsetWeapon(weapon: Weapon): void {\r\n\t\tthis.weapon = weapon;\r\n\t}\r\n\r\n\tgetX(): number {\r\n\t\treturn this.x;\r\n\t}\r\n\r\n\tgetY(): number {\r\n\t\treturn this.y;\r\n\t}\r\n\r\n\tgetAngle(): number {\r\n\t\treturn this.angle;\r\n\t}\r\n\r\n\tgetHammerAngle(): number {\r\n\t\treturn this.hammerAngle;\r\n\t}\r\n\r\n\tgetWeapon(): Weapon {\r\n\t\treturn this.weapon;\r\n\t}\r\n\r\n\tgetCenterX(): number {\r\n\t\treturn this.x + this.radius;\r\n\t}\r\n\r\n\tgetCenterY(): number {\r\n\t\treturn this.y + this.radius;\r\n\t}\r\n}\r\n","export default class ZoneCircle {\r\n\tprivate centerX: number;\r\n\tprivate centerY: number;\r\n\tprivate radius: number;\r\n\r\n\tconstructor(centerX: number, centerY: number, radius: number) {\r\n\t\tthis.centerX = centerX;\r\n\t\tthis.centerY = centerY;\r\n\t\tthis.radius = radius;\r\n\t}\r\n\r\n\tsetCenterX(x: number): void {\r\n\t\tthis.centerX = x;\r\n\t}\r\n\r\n\tsetCenterY(y: number): void {\r\n\t\tthis.centerY = y;\r\n\t}\r\n\r\n\tsetRadius(radius: number): void {\r\n\t\tthis.radius = radius;\r\n\t}\r\n\r\n\tgetCenterX(): number {\r\n\t\treturn this.centerX;\r\n\t}\r\n\r\n\tgetCenterY(): number {\r\n\t\treturn this.centerY;\r\n\t}\r\n\r\n\tgetRadius(): number {\r\n\t\treturn this.radius;\r\n\t}\r\n}\r\n","import ZoneCircle from './ZoneCircle';\r\n\r\nexport default class Zone {\r\n\tinnerCircle: ZoneCircle;\r\n\touterCircle: ZoneCircle;\r\n\r\n\tconstructor() {\r\n        this.innerCircle = new ZoneCircle(0, 0, 0);\r\n        this.outerCircle = new ZoneCircle(0, 0, 0);\r\n    }\r\n    \r\n}\r\n","export default class Message{\r\n    readonly text: string;\r\n    readonly time: number;\r\n\r\n    constructor(time: number, text: string){\r\n        this.time = time;\r\n        this.text = text;\r\n    }\r\n}","import WaterCircleSnapshot from './WaterCircleSnapshot';\r\n\r\nexport default class WaterCircle {\r\n\tprivate centerX: number;\r\n\tprivate centerY: number;\r\n\tprivate size: number = 30;\r\n\tprivate opacity: number = 1;\r\n\r\n\tconstructor(waterCircleSnapshot: WaterCircleSnapshot) {\r\n\t\tthis.centerX = waterCircleSnapshot.x;\r\n\t\tthis.centerY = waterCircleSnapshot.y;\r\n\t}\r\n\r\n\tgetX(): number {\r\n\t\treturn this.centerX - this.size / 2;\r\n\t}\r\n\r\n\tgetY(): number {\r\n\t\treturn this.centerY - this.size / 2;\r\n\t}\r\n\r\n\tgetSize(): number {\r\n\t\treturn this.size;\r\n\t}\r\n\r\n\tgetOpacity(): number {\r\n\t\treturn this.opacity;\r\n\t}\r\n\r\n\tflow() {\r\n\t\tthis.size += 2;\r\n\t\tthis.opacity -= 0.02;\r\n\t}\r\n\r\n\tisActive(): boolean {\r\n\t\treturn this.opacity > 0.04;\r\n\t}\r\n}\r\n","import { Snapshot } from './Snapshot';\r\nimport ServerClientSync from './ServerClientSync';\r\nimport Player from './Player';\r\nimport PlayerSnapshot from './PlayerSnapshot';\r\nimport Zone from './Zone';\r\nimport ZoneSnapshot from './ZoneSnapshot';\r\nimport LootSnapshot from './LootSnapshot';\r\nimport Map from './Map';\r\nimport MyPlayerSnapshot from './MyPlayerSnapshot';\r\nimport Message from './Message';\r\nimport WaterCircle from './WaterCircle';\r\n\r\nexport default class SnapshotManager {\r\n\tprivate serverClientSync: ServerClientSync;\r\n\tprivate snapshots: Snapshot[] = [];\r\n\tprivate map: Map;\r\n\tmessages: Message[] = [];\r\n\tbetweenSnapshot: Snapshot | null;\r\n\tplayers: Player[] = [];\r\n\tzone: Zone;\r\n\twaterCircles: WaterCircle[] = [];\r\n\tnewerExists: boolean = false;\r\n\tolderExists: boolean = false;\r\n\tsumaNewer: number = 0;\r\n\tprivate averageSumaNewer: number[] = [];\r\n\tprivate beforeSnapshotForTestBullets: Snapshot;\r\n\r\n\tconstructor(serverClientSync: ServerClientSync, map: Map) {\r\n\t\tthis.serverClientSync = serverClientSync;\r\n\t\tthis.zone = new Zone();\r\n\t\tthis.map = map;\r\n\t}\r\n\r\n\tprivate addSumaNewer(sumaNewer: number): void {\r\n\t\tconst max = 100;\r\n\t\tthis.averageSumaNewer.push(sumaNewer);\r\n\t\tif (this.averageSumaNewer.length > max) {\r\n\t\t\tthis.averageSumaNewer.splice(0, 1);\r\n\t\t\tlet totalSuma = 0;\r\n\t\t\tfor (const suma of this.averageSumaNewer) {\r\n\t\t\t\ttotalSuma += suma;\r\n\t\t\t}\r\n\t\t\tconsole.log('averageSumaNewer: ', totalSuma / max);\r\n\t\t}\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tthis.snapshots.splice(0, this.snapshots.length);\r\n\t\tthis.players.splice(0, this.players.length);\r\n\t\tthis.betweenSnapshot = null;\r\n\t\tthis.beforeSnapshotForTestBullets = null;\r\n\t}\r\n\r\n\tmessageManager(): void {\r\n\t\t//delete old messages\r\n\t\tconst viewTime = 1000 * 5;\r\n\t\tfor (let i = this.messages.length - 1; i >= 0; i--) {\r\n\t\t\tconst message = this.messages[i];\r\n\t\t\tif (message.time + viewTime < Date.now()) this.messages.splice(i, 1);\r\n\t\t}\r\n\t\t//max 5 messages\r\n\t\tif (this.messages.length > 5) {\r\n\t\t\tconst cut = this.messages.length - 5;\r\n\t\t\tthis.messages.splice(0, cut);\r\n\t\t}\r\n\t}\r\n\r\n\taddSnapshot(snapshot: Snapshot): void {\r\n\t\t/*\r\n\t\t//bullet test\r\n\t\tif (this.beforeSnapshotForTestBullets && snapshot.b) {\r\n\t\t\tconst shift = 400;\r\n\t\t\t//test\r\n\t\t\tfor (const bulletNow of snapshot.b) {\r\n\t\t\t\tfor (const bulletBefore of this.beforeSnapshotForTestBullets.b) {\r\n\t\t\t\t\tif (bulletNow.id === bulletBefore.id) {\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tMath.abs(bulletNow.x - bulletBefore.x) > shift ||\r\n\t\t\t\t\t\t\tMath.abs(bulletNow.y - bulletBefore.y) > shift\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tconsole.log('err: bullet shift');\r\n\t\t\t\t\t\t\tconsole.log('before:', this.beforeSnapshotForTestBullets);\r\n\t\t\t\t\t\t\tconsole.log('now:', snapshot);\r\n\t\t\t\t\t\t\tdebugger;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//save snapshot\r\n\t\tif (this.beforeSnapshotForTestBullets && this.beforeSnapshotForTestBullets.b) {\r\n\t\t\tthis.beforeSnapshotForTestBullets = snapshot;\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\tlet updateDelay = this.serverClientSync.getDrawDelay() - (this.serverClientSync.getServerTime() - snapshot.t);\r\n\t\tif (updateDelay < 0) updateDelay = 0;\r\n\r\n\t\t//water circles\r\n\t\tif (snapshot.w) {\r\n\t\t\tfor (const waterCircleSnapshot of snapshot.w) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.waterCircles.push(new WaterCircle(waterCircleSnapshot));\r\n\t\t\t\t}, updateDelay);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//delete old water circles\r\n\t\tfor (let i = this.waterCircles.length - 1; i >= 0; i--) {\r\n\t\t\tconst waterCircle = this.waterCircles[i];\r\n\t\t\tif (!waterCircle.isActive()) this.waterCircles.splice(i, 1);\r\n\t\t}\r\n\r\n\t\t//blood animate + vest\r\n\t\tif (snapshot.p) {\r\n\t\t\tfor (const playerSnapshot of snapshot.p) {\r\n\t\t\t\tif (playerSnapshot.d) {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tfor (const player of this.players) {\r\n\t\t\t\t\t\t\tif (player.id === playerSnapshot.i) {\r\n\t\t\t\t\t\t\t\tplayer.createInjury(playerSnapshot.d);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, updateDelay);\r\n\t\t\t\t}\r\n\t\t\t\tif (playerSnapshot.hasOwnProperty('v')) {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tfor (const player of this.players) {\r\n\t\t\t\t\t\t\tif (player.id === playerSnapshot.i) {\r\n\t\t\t\t\t\t\t\tlet vest = false;\r\n\t\t\t\t\t\t\t\tif (playerSnapshot.v === 1) vest = true;\r\n\t\t\t\t\t\t\t\tplayer.setVest(vest);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, updateDelay);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.snapshots.push(snapshot);\r\n\t\tif (this.snapshots.length > 1) {\r\n\t\t\tthis.completeSnapshot(this.snapshots[this.snapshots.length - 2], snapshot);\r\n\t\t}\r\n\t\t//add message\r\n\t\tif (snapshot.m) {\r\n\t\t\tfor (const message of snapshot.m) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.messages.push(new Message(Date.now(), message));\r\n\t\t\t\t}, updateDelay);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//update map\r\n\t\tthis.updateMap(snapshot, updateDelay);\r\n\r\n\t\t//delete old snapshots\r\n\t\tif (this.snapshots.length > 50) {\r\n\t\t\tthis.snapshots.splice(0, 1);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateMap(snapshot: Snapshot, updateDelay: number): void {\r\n\t\tconst obsacleSnapshots = snapshot.o;\r\n\t\tfor (const obstacleSnapshot of obsacleSnapshots) {\r\n\t\t\tswitch (obstacleSnapshot.t) {\r\n\t\t\t\tcase 'w':\r\n\t\t\t\t\tfor (const obstacle of this.map.rectangleObstacles) {\r\n\t\t\t\t\t\tif (obstacle.id === obstacleSnapshot.i) {\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tobstacle.update(obstacleSnapshot.o);\r\n\t\t\t\t\t\t\t}, updateDelay);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'r':\r\n\t\t\t\t\tfor (const obstacle of this.map.rocks) {\r\n\t\t\t\t\t\tif (obstacle.id === obstacleSnapshot.i) {\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tobstacle.update(obstacleSnapshot.o);\r\n\t\t\t\t\t\t\t}, updateDelay);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 't':\r\n\t\t\t\t\tfor (const obstacle of this.map.trees) {\r\n\t\t\t\t\t\tif (obstacle.id === obstacleSnapshot.i) {\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tobstacle.update(obstacleSnapshot.o);\r\n\t\t\t\t\t\t\t}, updateDelay);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'b':\r\n\t\t\t\t\tfor (const obstacle of this.map.bushes) {\r\n\t\t\t\t\t\tif (obstacle.id === obstacleSnapshot.i) {\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tobstacle.update(obstacleSnapshot.o);\r\n\t\t\t\t\t\t\t}, updateDelay);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateZone(): void {\r\n\t\tif (!this.betweenSnapshot) return;\r\n\t\tconst zoneSnapshot = this.betweenSnapshot.z;\r\n\t\t//inner\r\n\t\tthis.zone.innerCircle.setRadius(zoneSnapshot.iR);\r\n\t\tthis.zone.innerCircle.setCenterX(zoneSnapshot.iX);\r\n\t\tthis.zone.innerCircle.setCenterY(zoneSnapshot.iY);\r\n\t\t//outer\r\n\t\tthis.zone.outerCircle.setRadius(zoneSnapshot.oR);\r\n\t\tthis.zone.outerCircle.setCenterX(zoneSnapshot.oX);\r\n\t\tthis.zone.outerCircle.setCenterY(zoneSnapshot.oY);\r\n\t}\r\n\r\n\tprivate completeSnapshot(previousSnapshot: Snapshot, lastSnapshot: Snapshot): void {\r\n\t\tthis.completePlayerSnapshots(previousSnapshot.p, lastSnapshot.p);\r\n\t\tthis.completeMyPlayerSnapshot(previousSnapshot.i, lastSnapshot.i);\r\n\t\tthis.completeLootSnapshots(previousSnapshot.l, lastSnapshot.l);\r\n\t\tthis.completeZoneSnapshot(previousSnapshot.z, lastSnapshot.z);\r\n\t\t//zone delay\r\n\t\tif (!lastSnapshot.z.hasOwnProperty('d')) lastSnapshot.z.d = previousSnapshot.z.d;\r\n\t}\r\n\r\n\tprivate completeMyPlayerSnapshot(\r\n\t\tpreviousMyPlayerSnapshot: MyPlayerSnapshot,\r\n\t\tlastMyPlayerSnapshot: MyPlayerSnapshot\r\n\t): void {\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('h')) lastMyPlayerSnapshot.h = previousMyPlayerSnapshot.h;\r\n\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('i1')) lastMyPlayerSnapshot.i1 = previousMyPlayerSnapshot.i1;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('i2')) lastMyPlayerSnapshot.i2 = previousMyPlayerSnapshot.i2;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('i3')) lastMyPlayerSnapshot.i3 = previousMyPlayerSnapshot.i3;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('i4')) lastMyPlayerSnapshot.i4 = previousMyPlayerSnapshot.i4;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('i5')) lastMyPlayerSnapshot.i5 = previousMyPlayerSnapshot.i5;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('s4')) lastMyPlayerSnapshot.s4 = previousMyPlayerSnapshot.s4;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('s5')) lastMyPlayerSnapshot.s5 = previousMyPlayerSnapshot.s5;\r\n\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('a')) lastMyPlayerSnapshot.a = previousMyPlayerSnapshot.a;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('aM')) lastMyPlayerSnapshot.aM = previousMyPlayerSnapshot.aM;\r\n\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('r')) lastMyPlayerSnapshot.r = previousMyPlayerSnapshot.r;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('g')) lastMyPlayerSnapshot.g = previousMyPlayerSnapshot.g;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('b')) lastMyPlayerSnapshot.b = previousMyPlayerSnapshot.b;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('o')) lastMyPlayerSnapshot.o = previousMyPlayerSnapshot.o;\r\n\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('s')) lastMyPlayerSnapshot.s = previousMyPlayerSnapshot.s;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('v')) lastMyPlayerSnapshot.v = previousMyPlayerSnapshot.v;\r\n\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('l')) lastMyPlayerSnapshot.l = previousMyPlayerSnapshot.l;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('lE')) lastMyPlayerSnapshot.lE = previousMyPlayerSnapshot.lE;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('lT')) lastMyPlayerSnapshot.lT = previousMyPlayerSnapshot.lT;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('spectate'))\r\n\t\t\tlastMyPlayerSnapshot.spectate = previousMyPlayerSnapshot.spectate;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('spectateName'))\r\n\t\t\tlastMyPlayerSnapshot.spectateName = previousMyPlayerSnapshot.spectateName;\r\n\t\tif (!lastMyPlayerSnapshot.hasOwnProperty('ai')) lastMyPlayerSnapshot.ai = previousMyPlayerSnapshot.ai;\r\n\t}\r\n\r\n\tprivate completeZoneSnapshot(previousZoneSnapshot: ZoneSnapshot, lastZoneSnapshot: ZoneSnapshot): void {\r\n\t\tif (!lastZoneSnapshot.hasOwnProperty('iX')) lastZoneSnapshot.iX = previousZoneSnapshot.iX;\r\n\t\tif (!lastZoneSnapshot.hasOwnProperty('iY')) lastZoneSnapshot.iY = previousZoneSnapshot.iY;\r\n\t\tif (!lastZoneSnapshot.hasOwnProperty('iR')) lastZoneSnapshot.iR = previousZoneSnapshot.iR;\r\n\t\tif (!lastZoneSnapshot.hasOwnProperty('oX')) lastZoneSnapshot.oX = previousZoneSnapshot.oX;\r\n\t\tif (!lastZoneSnapshot.hasOwnProperty('oY')) lastZoneSnapshot.oY = previousZoneSnapshot.oY;\r\n\t\tif (!lastZoneSnapshot.hasOwnProperty('oR')) lastZoneSnapshot.oR = previousZoneSnapshot.oR;\r\n\t}\r\n\r\n\tprivate completeLootSnapshots(previousSnapshotLoots: LootSnapshot[], lastSnapshotLoots: LootSnapshot[]): void {\r\n\t\t//copy missing values\r\n\t\tfor (const lastSnapshotLoot of lastSnapshotLoots) {\r\n\t\t\tlet previousSnapshotLoot;\r\n\t\t\tfor (const loot of previousSnapshotLoots) {\r\n\t\t\t\tif (loot.i === lastSnapshotLoot.i) previousSnapshotLoot = loot;\r\n\t\t\t}\r\n\t\t\tif (previousSnapshotLoot) {\r\n\t\t\t\tif (!lastSnapshotLoot.hasOwnProperty('size')) lastSnapshotLoot.size = previousSnapshotLoot.size;\r\n\t\t\t\tif (!lastSnapshotLoot.hasOwnProperty('type')) lastSnapshotLoot.type = previousSnapshotLoot.type;\r\n\t\t\t\tif (!lastSnapshotLoot.hasOwnProperty('x')) lastSnapshotLoot.x = previousSnapshotLoot.x;\r\n\t\t\t\tif (!lastSnapshotLoot.hasOwnProperty('y')) lastSnapshotLoot.y = previousSnapshotLoot.y;\r\n\t\t\t\tif (!lastSnapshotLoot.hasOwnProperty('quantity') && previousSnapshotLoot.hasOwnProperty('quantity'))\r\n\t\t\t\t\tlastSnapshotLoot.quantity = previousSnapshotLoot.quantity;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//find missing objects and copy previous values\r\n\t\tconst missingLoots = [];\r\n\t\tfor (const previous of previousSnapshotLoots) {\r\n\t\t\tlet lootExists = false;\r\n\t\t\tfor (const last of lastSnapshotLoots) {\r\n\t\t\t\tif (previous.i === last.i) {\r\n\t\t\t\t\tlootExists = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!lootExists) {\r\n\t\t\t\tmissingLoots.push(previous);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (const missingLoot of missingLoots) {\r\n\t\t\tlastSnapshotLoots.push(missingLoot);\r\n\t\t}\r\n\r\n\t\t//delete !active loot\r\n\t\tfor (let i = lastSnapshotLoots.length - 1; i >= 0; i--) {\r\n\t\t\tif (lastSnapshotLoots[i].hasOwnProperty('del')) {\r\n\t\t\t\tlastSnapshotLoots.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate completePlayerSnapshots(\r\n\t\tpreviousSnapshotPlayers: PlayerSnapshot[],\r\n\t\tlastSnapshotPlayers: PlayerSnapshot[]\r\n\t): void {\r\n\t\t//copy missing values\r\n\t\tfor (const lastSnapshotPlayer of lastSnapshotPlayers) {\r\n\t\t\tlet previousSnapshotPlayer;\r\n\t\t\tfor (const player of previousSnapshotPlayers) {\r\n\t\t\t\tif (player.i === lastSnapshotPlayer.i) previousSnapshotPlayer = player;\r\n\t\t\t}\r\n\t\t\tif (previousSnapshotPlayer) {\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('a')) lastSnapshotPlayer.a = previousSnapshotPlayer.a;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('m')) lastSnapshotPlayer.m = previousSnapshotPlayer.m;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('size')) lastSnapshotPlayer.size = previousSnapshotPlayer.size;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('w')) lastSnapshotPlayer.w = previousSnapshotPlayer.w;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('x')) lastSnapshotPlayer.x = previousSnapshotPlayer.x;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('y')) lastSnapshotPlayer.y = previousSnapshotPlayer.y;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('l')) lastSnapshotPlayer.l = previousSnapshotPlayer.l;\r\n\t\t\t\t//hands\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('hSize'))\r\n\t\t\t\t\tlastSnapshotPlayer.hSize = previousSnapshotPlayer.hSize;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('lX')) lastSnapshotPlayer.lX = previousSnapshotPlayer.lX;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('lY')) lastSnapshotPlayer.lY = previousSnapshotPlayer.lY;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('rX')) lastSnapshotPlayer.rX = previousSnapshotPlayer.rX;\r\n\t\t\t\tif (!lastSnapshotPlayer.hasOwnProperty('rY')) lastSnapshotPlayer.rY = previousSnapshotPlayer.rY;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//find missing players and copy previous values\r\n\t\tconst missingPlayerIds = [];\r\n\t\tfor (const previousSnapshotPlayer of previousSnapshotPlayers) {\r\n\t\t\tlet playerExists = false;\r\n\t\t\tfor (const lastSnapshotPlayer of lastSnapshotPlayers) {\r\n\t\t\t\tif (previousSnapshotPlayer.i === lastSnapshotPlayer.i) {\r\n\t\t\t\t\tplayerExists = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!playerExists) {\r\n\t\t\t\tmissingPlayerIds.push(previousSnapshotPlayer.i);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//copy previous snapshot\r\n\t\tfor (const missingPlayerId of missingPlayerIds) {\r\n\t\t\tfor (const previousSnapshotPlayer of previousSnapshotPlayers) {\r\n\t\t\t\tif (missingPlayerId === previousSnapshotPlayer.i) {\r\n\t\t\t\t\tlastSnapshotPlayers.push(previousSnapshotPlayer);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//sort by id!\r\n\t\tlastSnapshotPlayers.sort((a: PlayerSnapshot, b: PlayerSnapshot) => {\r\n\t\t\treturn a.i - b.i;\r\n\t\t});\r\n\t}\r\n\r\n\t//1. urcime si cas pred nejakou dobou a budeme hledat snimky hry pred timto a za timto bodem (ServerClientSync class)\r\n\t//2. nemuzeme se spolehnout jen na cas klienta a musime nejperve synchronizovat (ServerClientSync class)\r\n\t//3. dopocitame stav mezi snimky\r\n\tcreateBetweenSnapshot(): void {\r\n\t\tif (this.snapshots.length && this.serverClientSync.ready()) {\r\n\t\t\tlet percentShift = 0;\r\n\t\t\tthis.sumaNewer = 0;\r\n\t\t\tthis.newerExists = false;\r\n\t\t\tthis.olderExists = false;\r\n\t\t\tlet newerSnapshot: Snapshot;\r\n\t\t\tlet olderSnapshot: Snapshot;\r\n\r\n\t\t\tconst wantedSnapshotTime = this.serverClientSync.getServerTime() - this.serverClientSync.getDrawDelay();\r\n\t\t\t//find last older (or same <=) snapshot\r\n\t\t\tfor (const snapshot of this.snapshots) {\r\n\t\t\t\tif (snapshot.t <= wantedSnapshotTime) {\r\n\t\t\t\t\tolderSnapshot = snapshot;\r\n\t\t\t\t\tthis.olderExists = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//find first newer (or same >=) snapshot\r\n\t\t\tfor (const snapshot of this.snapshots) {\r\n\t\t\t\tif (snapshot.t >= wantedSnapshotTime) {\r\n\t\t\t\t\tif (!newerSnapshot) {\r\n\t\t\t\t\t\tnewerSnapshot = snapshot;\r\n\t\t\t\t\t\tthis.newerExists = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.sumaNewer++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//if newerSnapshot is missing use older...\r\n\t\t\tif (!newerSnapshot) {\r\n\t\t\t\tnewerSnapshot = olderSnapshot;\r\n\t\t\t}\r\n\r\n\t\t\t//change draw delay\r\n\t\t\tthis.serverClientSync.changeSumaNewer(this.sumaNewer);\r\n\r\n\t\t\t//this.addSumaNewer(this.sumaNewer);\r\n\r\n\t\t\t//calc positions\r\n\t\t\tif (olderSnapshot && newerSnapshot) {\r\n\t\t\t\tconst timeDistance = newerSnapshot.t - olderSnapshot.t;\r\n\r\n\t\t\t\tconst distanceOlderFromWantedTime = wantedSnapshotTime - olderSnapshot.t;\r\n\t\t\t\tif (timeDistance) {\r\n\t\t\t\t\tpercentShift = distanceOlderFromWantedTime / timeDistance;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//deep copy!\r\n\t\t\t\tconst copyFrom = newerSnapshot;\r\n\t\t\t\t//slow copy\r\n\t\t\t\t//this.betweenSnapshots = JSON.parse(JSON.stringify(copyFrom));\r\n\r\n\t\t\t\t//fast copy\r\n\t\t\t\tthis.betweenSnapshot = {\r\n\t\t\t\t\tt: copyFrom.t,\r\n\t\t\t\t\ti: { ...copyFrom.i },\r\n\t\t\t\t\tp: [],\r\n\t\t\t\t\tb: [],\r\n\t\t\t\t\tg: [],\r\n\t\t\t\t\ts: [],\r\n\t\t\t\t\tz: { ...copyFrom.z },\r\n\t\t\t\t\tl: [],\r\n\t\t\t\t\to: []\r\n\t\t\t\t};\r\n\r\n\t\t\t\tfor (const player of copyFrom.p) {\r\n\t\t\t\t\tthis.betweenSnapshot.p.push({ ...player });\r\n\t\t\t\t}\r\n\t\t\t\tfor (const bullet of copyFrom.b) {\r\n\t\t\t\t\tthis.betweenSnapshot.b.push({ ...bullet });\r\n\t\t\t\t}\r\n\t\t\t\tfor (const granade of copyFrom.g) {\r\n\t\t\t\t\tthis.betweenSnapshot.g.push({ ...granade });\r\n\t\t\t\t}\r\n\t\t\t\tfor (const smoke of copyFrom.s) {\r\n\t\t\t\t\tthis.betweenSnapshot.s.push({ ...smoke });\r\n\t\t\t\t}\r\n\t\t\t\tfor (const loot of copyFrom.l) {\r\n\t\t\t\t\tthis.betweenSnapshot.l.push({ ...loot });\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//players\r\n\t\t\t\tfor (let i = 0; i < this.betweenSnapshot.p.length; i++) {\r\n\t\t\t\t\tconst player = this.betweenSnapshot.p[i];\r\n\t\t\t\t\tplayer.x = this.positionBetweenSnapshots(olderSnapshot.p[i].x, newerSnapshot.p[i].x, percentShift);\r\n\t\t\t\t\tplayer.y = this.positionBetweenSnapshots(olderSnapshot.p[i].y, newerSnapshot.p[i].y, percentShift);\r\n\t\t\t\t\t//hands\r\n\t\t\t\t\t//deny between snapshot...\r\n\t\t\t\t\tif (!player.h) {\r\n\t\t\t\t\t\tplayer.lX = this.positionBetweenSnapshots(\r\n\t\t\t\t\t\t\tolderSnapshot.p[i].lX,\r\n\t\t\t\t\t\t\tnewerSnapshot.p[i].lX,\r\n\t\t\t\t\t\t\tpercentShift\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tplayer.lY = this.positionBetweenSnapshots(\r\n\t\t\t\t\t\t\tolderSnapshot.p[i].lY,\r\n\t\t\t\t\t\t\tnewerSnapshot.p[i].lY,\r\n\t\t\t\t\t\t\tpercentShift\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tplayer.rX = this.positionBetweenSnapshots(\r\n\t\t\t\t\t\t\tolderSnapshot.p[i].rX,\r\n\t\t\t\t\t\t\tnewerSnapshot.p[i].rX,\r\n\t\t\t\t\t\t\tpercentShift\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tplayer.rY = this.positionBetweenSnapshots(\r\n\t\t\t\t\t\t\tolderSnapshot.p[i].rY,\r\n\t\t\t\t\t\t\tnewerSnapshot.p[i].rY,\r\n\t\t\t\t\t\t\tpercentShift\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//loot\r\n\t\t\t\tfor (const loot of this.betweenSnapshot.l) {\r\n\t\t\t\t\tlet olderLoot, newerLoot;\r\n\t\t\t\t\tfor (const older of olderSnapshot.l) {\r\n\t\t\t\t\t\tif (loot.i === older.i) {\r\n\t\t\t\t\t\t\tolderLoot = older;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (const newer of newerSnapshot.l) {\r\n\t\t\t\t\t\tif (loot.i === newer.i) {\r\n\t\t\t\t\t\t\tnewerLoot = newer;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (olderLoot && newerLoot) {\r\n\t\t\t\t\t\tloot.x = this.positionBetweenSnapshots(olderLoot.x, newerLoot.x, percentShift);\r\n\t\t\t\t\t\tloot.y = this.positionBetweenSnapshots(olderLoot.y, newerLoot.y, percentShift);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//zone\r\n\t\t\t\tthis.betweenSnapshot.z.oR = this.positionBetweenSnapshots(\r\n\t\t\t\t\tolderSnapshot.z.oR,\r\n\t\t\t\t\tnewerSnapshot.z.oR,\r\n\t\t\t\t\tpercentShift\r\n\t\t\t\t);\r\n\t\t\t\tthis.betweenSnapshot.z.oX = this.positionBetweenSnapshots(\r\n\t\t\t\t\tolderSnapshot.z.oX,\r\n\t\t\t\t\tnewerSnapshot.z.oX,\r\n\t\t\t\t\tpercentShift\r\n\t\t\t\t);\r\n\t\t\t\tthis.betweenSnapshot.z.oY = this.positionBetweenSnapshots(\r\n\t\t\t\t\tolderSnapshot.z.oY,\r\n\t\t\t\t\tnewerSnapshot.z.oY,\r\n\t\t\t\t\tpercentShift\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.updatePlayers();\r\n\t\tthis.updateZone();\r\n\t}\r\n\r\n\tprivate updatePlayers(): void {\r\n\t\tif (!this.betweenSnapshot) return;\r\n\t\tfor (const playerSnapshot of this.betweenSnapshot.p) {\r\n\t\t\tlet playerExists = false;\r\n\t\t\tfor (const playerInstance of this.players) {\r\n\t\t\t\tif (playerInstance.id === playerSnapshot.i) {\r\n\t\t\t\t\t//update player\r\n\t\t\t\t\tplayerInstance.setX(playerSnapshot.x);\r\n\t\t\t\t\tplayerInstance.setY(playerSnapshot.y);\r\n\t\t\t\t\tplayerInstance.setAngle(playerSnapshot.a);\r\n\t\t\t\t\tplayerInstance.setWeapon(playerSnapshot.w);\r\n\t\t\t\t\tplayerInstance.setHammerAngle(playerSnapshot.m);\r\n\t\t\t\t\tif (playerSnapshot.l === 0) playerInstance.die();\r\n\t\t\t\t\t//hands\r\n\t\t\t\t\tplayerInstance.hands[0].setX(playerSnapshot.lX);\r\n\t\t\t\t\tplayerInstance.hands[0].setY(playerSnapshot.lY);\r\n\t\t\t\t\tplayerInstance.hands[1].setX(playerSnapshot.rX);\r\n\t\t\t\t\tplayerInstance.hands[1].setY(playerSnapshot.rY);\r\n\t\t\t\t\tplayerExists = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!playerExists) {\r\n\t\t\t\t//create player\r\n\t\t\t\tthis.players.push(new Player(playerSnapshot));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate positionBetweenSnapshots(olderPosition: number, newerPosition: number, percentShift: number): number {\r\n\t\tconst diference = Math.abs(newerPosition - olderPosition);\r\n\t\tlet direction = 1;\r\n\t\tif (newerPosition < olderPosition) direction = -1;\r\n\t\treturn olderPosition + diference * direction * percentShift;\r\n\t}\r\n}\r\n","import { Mouse } from './Controller';\r\nimport Socket from './Socket';\r\nimport View from './View';\r\nimport Map from './Map';\r\nimport WaterTerrainData from './WaterTerrainData';\r\nimport ServerClientSync from './ServerClientSync';\r\nimport MyHtmlElements from './MyHtmlElements';\r\nimport Editor from './Editor';\r\nimport CollisionPoints from './CollisionPoints';\r\nimport SnapshotManager from './SnapshotManager';\r\n\r\nexport default class Model {\r\n\tprivate spectate: boolean = false;\r\n\tprivate gameRun: boolean = false;\r\n\tprivate gameId: number = -1;\r\n\tprivate playerId: number = -1;\r\n\tprivate name: string;\r\n\tview: View;\r\n\tprivate socket: Socket;\r\n\tprivate waterTerrainData: WaterTerrainData;\r\n\tprivate mouse: Mouse;\r\n\tmap: Map;\r\n\tprivate serverClientSync: ServerClientSync;\r\n\tsnapshotManager: SnapshotManager;\r\n\tprivate myHtmlElements: MyHtmlElements;\r\n\tprivate editor: Editor;\r\n\tcollisionPoints: CollisionPoints;\r\n\r\n\tconstructor(\r\n\t\tmouse: Mouse,\r\n\t\tsocket: Socket,\r\n\t\tserverClientSync: ServerClientSync,\r\n\t\tmyHtmlElements: MyHtmlElements,\r\n\t\teditor: Editor\r\n\t) {\r\n\t\tthis.socket = socket;\r\n\t\tthis.serverClientSync = serverClientSync;\r\n\t\tthis.waterTerrainData = new WaterTerrainData();\r\n\t\tthis.map = new Map(this.waterTerrainData);\r\n\t\tthis.snapshotManager = new SnapshotManager(serverClientSync, this.map);\r\n\t\tthis.mouse = mouse;\r\n\t\tthis.myHtmlElements = myHtmlElements;\r\n\t\tthis.editor = editor;\r\n\t\tthis.collisionPoints = new CollisionPoints();\r\n\t\tthis.view = new View(\r\n\t\t\tthis.map,\r\n\t\t\tthis.mouse,\r\n\t\t\tthis.waterTerrainData,\r\n\t\t\tthis.myHtmlElements,\r\n\t\t\tthis.collisionPoints,\r\n\t\t\tthis.snapshotManager\r\n\t\t);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.loop();\r\n\t\t}, 200);\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\t\tel.close(el.gameOverMenu.main);\r\n\t\tel.open(el.mainMenu.main, el.hideGame);\r\n\t\tel.gameOverMenu.stats.innerHTML = '';\r\n\t\tthis.gameRun = false;\r\n\t\tthis.gameId = -1;\r\n\t\tthis.playerId = -1;\r\n\t\tthis.map.reset();\r\n\t\tthis.snapshotManager.reset();\r\n\t\tthis.view.reset();\r\n\t\tthis.spectate = false;\r\n\t\tthis.serverClientSync.reset();\r\n\t}\r\n\r\n\tstop(): void {\r\n\t\tthis.gameRun = false;\r\n\t}\r\n\r\n\tisNameOk(name: string): boolean {\r\n\t\tlet state = false;\r\n\t\tconst allowedCharacters: string = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ';\r\n\t\tconst nameMaxLength: number = 20;\r\n\t\tif (typeof name === 'string') {\r\n\t\t\tif (name.length > 0 && name.length <= nameMaxLength) {\r\n\t\t\t\t//nepovolené znaky v jménu?\r\n\t\t\t\tlet notAllowedCharacter = false;\r\n\t\t\t\tfor (let i = 0; i < name.length; i++) {\r\n\t\t\t\t\tif (allowedCharacters.lastIndexOf(name[i]) === -1) {\r\n\t\t\t\t\t\tnotAllowedCharacter = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t//v jmenu nejsou nepovolene znaky\r\n\t\t\t\tif (!notAllowedCharacter) {\r\n\t\t\t\t\tstate = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn state;\r\n\t}\r\n\r\n\tstartSpectate(): void {\r\n\t\tthis.spectate = true;\r\n\t}\r\n\r\n\tgetSpectate(): boolean {\r\n\t\treturn this.spectate;\r\n\t}\r\n\r\n\tsetName(name: string): void {\r\n\t\tthis.name = name;\r\n\t}\r\n\r\n\tgetName(): string {\r\n\t\treturn this.name;\r\n\t}\r\n\r\n\tgetGameId(): number {\r\n\t\treturn this.gameId;\r\n\t}\r\n\r\n\tsetGameId(gameId: number): void {\r\n\t\tthis.gameId = gameId;\r\n\t}\r\n\r\n\tgetPlayerId(): number {\r\n\t\treturn this.playerId;\r\n\t}\r\n\r\n\tsetPlayerId(playerId: number): void {\r\n\t\tthis.playerId = playerId;\r\n\t}\r\n\r\n\tgameStart(): void {\r\n\t\tthis.gameRun = true;\r\n\t\tthis.snapshotManager.reset();\r\n\t}\r\n\r\n\tgameActive(): boolean {\r\n\t\treturn this.gameRun;\r\n\t}\r\n\tprivate loop(): void {\r\n\t\t//repeat\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tthis.loop();\r\n\t\t});\r\n\t\tif (this.editor.isActive()) {\r\n\t\t\tthis.view.drawEditor(this.editor);\r\n\t\t}\r\n\t\t//sync\r\n\t\tif (!this.serverClientSync.ready()) {\r\n\t\t\tif (Math.random() > 0.8) this.socket.emit('serverClientSync', Date.now());\r\n\t\t}\r\n\t\tif (!this.gameRun) return;\r\n\t\tthis.snapshotManager.createBetweenSnapshot();\r\n\t\tthis.view.drawGame(this.playerId);\r\n\t}\r\n}\r\n","export default class ServerClientSync {\r\n\tprivate ping: number = 0;\r\n\tprivate pings: number[] = [];\r\n\tprivate timeDiference: number = 0;\r\n\tprivate timeDiferences: number[] = [];\r\n\tprivate readonly pingAttempts: number = 5;\r\n\tprivate readonly defaultDrawDelay: number = 70;\r\n\tprivate drawDelay: number = this.defaultDrawDelay;\r\n\tprivate minWantedSumaNewerSnapshots: number = 3;\r\n\tprivate defaultWantedNewerSnapshots: number = 5;\r\n\tprivate wantedSumaNewerSnapshots: number = this.defaultWantedNewerSnapshots;\r\n\tprivate maxWantedSumaNewerSnapshots: number = 11;\r\n\tprivate lags: number = 0;\r\n\tprivate readonly maxLags: number = 10;\r\n\tprivate lastLagTime: number = 0;\r\n\r\n\tconstructor() {}\r\n\r\n\tgetPing(): number {\r\n\t\treturn this.ping;\r\n\t}\r\n\r\n\tgetTimeDiference(): number {\r\n\t\treturn this.timeDiference;\r\n\t}\r\n\r\n\tchangeSumaNewer(sumaNewer: number): void {\r\n\t\t//lag\r\n\t\tif (sumaNewer === 0) {\r\n\t\t\tthis.lags++;\r\n\t\t\tthis.lastLagTime = Date.now();\r\n\t\t\t//console.log('lag');\r\n\t\t}\r\n\t\t//more NewerSnapshots\r\n\t\tif (this.lags === this.maxLags) {\r\n\t\t\tif (this.wantedSumaNewerSnapshots < this.maxWantedSumaNewerSnapshots) {\r\n\t\t\t\tthis.wantedSumaNewerSnapshots++;\r\n\t\t\t\t//console.clear();\r\n\t\t\t\t//console.log('wantedSumaNewerSnapshots', this.wantedSumaNewerSnapshots);\r\n\t\t\t\tthis.lags = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//less newerSnapshots\r\n\t\tconst gap = 1000 * 5;\r\n\t\tif (this.lastLagTime && this.lastLagTime + gap < Date.now()) {\r\n\t\t\tif (this.wantedSumaNewerSnapshots > this.minWantedSumaNewerSnapshots) {\r\n\t\t\t\tthis.wantedSumaNewerSnapshots--;\r\n\t\t\t\tthis.lags = 0;\r\n\t\t\t\tthis.lastLagTime = Date.now();\r\n\t\t\t\t//console.clear();\r\n\t\t\t\t//console.log('wantedSumaNewerSnapshots', this.wantedSumaNewerSnapshots);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tswitch (this.wantedSumaNewerSnapshots) {\r\n\t\t\tcase 3:\r\n\t\t\t\tif (sumaNewer === 0) this.changeDrawDelay(5);\r\n\t\t\t\tif (sumaNewer === 1) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 2) this.changeDrawDelay(0.2);\r\n\r\n\t\t\t\tif (sumaNewer === 4) this.changeDrawDelay(-0.2);\r\n\t\t\t\tif (sumaNewer === 5) this.changeDrawDelay(-0.5);\r\n\t\t\t\tif (sumaNewer === 6) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 7) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 8) this.changeDrawDelay(-5);\r\n\r\n\t\t\t\tif (sumaNewer > 8) this.changeDrawDelay(-10);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 4:\r\n\t\t\t\tif (sumaNewer === 0) this.changeDrawDelay(5);\r\n\t\t\t\tif (sumaNewer === 1) this.changeDrawDelay(2);\r\n\t\t\t\tif (sumaNewer === 2) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 3) this.changeDrawDelay(0.2);\r\n\r\n\t\t\t\tif (sumaNewer === 5) this.changeDrawDelay(-0.2);\r\n\t\t\t\tif (sumaNewer === 6) this.changeDrawDelay(-0.5);\r\n\t\t\t\tif (sumaNewer === 7) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 8) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 9) this.changeDrawDelay(-5);\r\n\r\n\t\t\t\tif (sumaNewer > 9) this.changeDrawDelay(-10);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 5:\r\n\t\t\t\tif (sumaNewer === 0) this.changeDrawDelay(5);\r\n\t\t\t\tif (sumaNewer === 1) this.changeDrawDelay(2);\r\n\t\t\t\tif (sumaNewer === 2) this.changeDrawDelay(1);\r\n\t\t\t\tif (sumaNewer === 3) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 4) this.changeDrawDelay(0.2);\r\n\r\n\t\t\t\tif (sumaNewer === 6) this.changeDrawDelay(-0.2);\r\n\t\t\t\tif (sumaNewer === 7) this.changeDrawDelay(-0.5);\r\n\t\t\t\tif (sumaNewer === 8) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 9) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 10) this.changeDrawDelay(-5);\r\n\r\n\t\t\t\tif (sumaNewer > 10) this.changeDrawDelay(-10);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 6:\r\n\t\t\t\tif (sumaNewer === 0) this.changeDrawDelay(5);\r\n\t\t\t\tif (sumaNewer === 1) this.changeDrawDelay(2);\r\n\t\t\t\tif (sumaNewer === 2) this.changeDrawDelay(1);\r\n\t\t\t\tif (sumaNewer === 3) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 4) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 5) this.changeDrawDelay(0.2);\r\n\r\n\t\t\t\tif (sumaNewer === 7) this.changeDrawDelay(-0.2);\r\n\t\t\t\tif (sumaNewer === 8) this.changeDrawDelay(-0.5);\r\n\t\t\t\tif (sumaNewer === 9) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 10) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 11) this.changeDrawDelay(-5);\r\n\r\n\t\t\t\tif (sumaNewer > 11) this.changeDrawDelay(-10);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 7:\r\n\t\t\t\tif (sumaNewer === 0) this.changeDrawDelay(5);\r\n\t\t\t\tif (sumaNewer === 1) this.changeDrawDelay(2);\r\n\t\t\t\tif (sumaNewer === 2) this.changeDrawDelay(1);\r\n\t\t\t\tif (sumaNewer === 3) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 4) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 5) this.changeDrawDelay(0.2);\r\n\t\t\t\tif (sumaNewer === 6) this.changeDrawDelay(0.2);\r\n\r\n\t\t\t\tif (sumaNewer === 8) this.changeDrawDelay(-0.2);\r\n\t\t\t\tif (sumaNewer === 9) this.changeDrawDelay(-0.5);\r\n\t\t\t\tif (sumaNewer === 10) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 11) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 12) this.changeDrawDelay(-5);\r\n\r\n\t\t\t\tif (sumaNewer > 12) this.changeDrawDelay(-10);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 8:\r\n\t\t\t\tif (sumaNewer === 0) this.changeDrawDelay(5);\r\n\t\t\t\tif (sumaNewer === 1) this.changeDrawDelay(2);\r\n\t\t\t\tif (sumaNewer === 2) this.changeDrawDelay(1);\r\n\t\t\t\tif (sumaNewer === 3) this.changeDrawDelay(1);\r\n\t\t\t\tif (sumaNewer === 4) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 5) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 6) this.changeDrawDelay(0.2);\r\n\t\t\t\tif (sumaNewer === 7) this.changeDrawDelay(0.2);\r\n\r\n\t\t\t\tif (sumaNewer === 9) this.changeDrawDelay(-0.2);\r\n\t\t\t\tif (sumaNewer === 10) this.changeDrawDelay(-0.5);\r\n\t\t\t\tif (sumaNewer === 11) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 12) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 13) this.changeDrawDelay(-5);\r\n\r\n\t\t\t\tif (sumaNewer > 13) this.changeDrawDelay(-10);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 9:\r\n\t\t\t\tif (sumaNewer === 0) this.changeDrawDelay(5);\r\n\t\t\t\tif (sumaNewer === 1) this.changeDrawDelay(2);\r\n\t\t\t\tif (sumaNewer === 2) this.changeDrawDelay(2);\r\n\t\t\t\tif (sumaNewer === 3) this.changeDrawDelay(1);\r\n\t\t\t\tif (sumaNewer === 4) this.changeDrawDelay(1);\r\n\t\t\t\tif (sumaNewer === 5) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 6) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 7) this.changeDrawDelay(0.2);\r\n\t\t\t\tif (sumaNewer === 8) this.changeDrawDelay(0.2);\r\n\r\n\t\t\t\tif (sumaNewer === 10) this.changeDrawDelay(-0.2);\r\n\t\t\t\tif (sumaNewer === 11) this.changeDrawDelay(-0.5);\r\n\t\t\t\tif (sumaNewer === 12) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 13) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 14) this.changeDrawDelay(-5);\r\n\r\n\t\t\t\tif (sumaNewer > 14) this.changeDrawDelay(-10);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 10:\r\n\t\t\t\tif (sumaNewer === 0) this.changeDrawDelay(5);\r\n\t\t\t\tif (sumaNewer === 1) this.changeDrawDelay(5);\r\n\t\t\t\tif (sumaNewer === 2) this.changeDrawDelay(2);\r\n\t\t\t\tif (sumaNewer === 3) this.changeDrawDelay(2);\r\n\t\t\t\tif (sumaNewer === 4) this.changeDrawDelay(1);\r\n\t\t\t\tif (sumaNewer === 5) this.changeDrawDelay(1);\r\n\t\t\t\tif (sumaNewer === 6) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 7) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 8) this.changeDrawDelay(0.2);\r\n\t\t\t\tif (sumaNewer === 9) this.changeDrawDelay(0.2);\r\n\r\n\t\t\t\tif (sumaNewer === 11) this.changeDrawDelay(-0.2);\r\n\t\t\t\tif (sumaNewer === 12) this.changeDrawDelay(-0.5);\r\n\t\t\t\tif (sumaNewer === 13) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 14) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 15) this.changeDrawDelay(-5);\r\n\r\n\t\t\t\tif (sumaNewer > 5) this.changeDrawDelay(-10);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 11:\r\n\t\t\t\tif (sumaNewer === 0) this.changeDrawDelay(10);\r\n\t\t\t\tif (sumaNewer === 1) this.changeDrawDelay(5);\r\n\t\t\t\tif (sumaNewer === 2) this.changeDrawDelay(2);\r\n\t\t\t\tif (sumaNewer === 3) this.changeDrawDelay(2);\r\n\t\t\t\tif (sumaNewer === 4) this.changeDrawDelay(2);\r\n\t\t\t\tif (sumaNewer === 5) this.changeDrawDelay(1);\r\n\t\t\t\tif (sumaNewer === 6) this.changeDrawDelay(1);\r\n\t\t\t\tif (sumaNewer === 7) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 8) this.changeDrawDelay(0.5);\r\n\t\t\t\tif (sumaNewer === 9) this.changeDrawDelay(0.2);\r\n\t\t\t\tif (sumaNewer === 10) this.changeDrawDelay(0.2);\r\n\r\n\t\t\t\tif (sumaNewer === 12) this.changeDrawDelay(-0.2);\r\n\t\t\t\tif (sumaNewer === 13) this.changeDrawDelay(-0.5);\r\n\t\t\t\tif (sumaNewer === 14) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 15) this.changeDrawDelay(-2);\r\n\t\t\t\tif (sumaNewer === 16) this.changeDrawDelay(-5);\r\n\t\t\t\tif (sumaNewer > 16) this.changeDrawDelay(-10);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tready(): boolean {\r\n\t\treturn this.pings.length === this.pingAttempts;\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tthis.pings = [];\r\n\t\tthis.timeDiferences = [];\r\n\t\tthis.ping = 0;\r\n\t\tthis.timeDiference = 0;\r\n\t\tthis.drawDelay = this.defaultDrawDelay;\r\n\t\tthis.wantedSumaNewerSnapshots = this.defaultWantedNewerSnapshots;\r\n\t\tthis.lags = 0;\r\n\t\tthis.lastLagTime = 0;\r\n\t}\r\n\r\n\taddData(ping: number, timeDiference: number): void {\r\n\t\tif (!this.ready()) {\r\n\t\t\tthis.pings.push(ping);\r\n\t\t\tthis.timeDiferences.push(timeDiference);\r\n\t\t}\r\n\t\t//count average\r\n\t\tif (this.pings.length === this.pingAttempts) {\r\n\t\t\tlet pingsSuma = 0;\r\n\t\t\tfor (const ping of this.pings) {\r\n\t\t\t\tpingsSuma += ping;\r\n\t\t\t}\r\n\t\t\tthis.ping = pingsSuma / this.pingAttempts;\r\n\t\t\tlet timeDiferenceSuma = 0;\r\n\t\t\tfor (const timeDiference of this.timeDiferences) {\r\n\t\t\t\ttimeDiferenceSuma += timeDiference;\r\n\t\t\t}\r\n\t\t\tthis.timeDiference = timeDiferenceSuma / this.pingAttempts;\r\n\t\t}\r\n\t}\r\n\r\n\tchangeDrawDelay(change: number): void {\r\n\t\tthis.drawDelay += change;\r\n\t}\r\n\r\n\tgetDrawDelay(): number {\r\n\t\treturn this.drawDelay;\r\n\t}\r\n\r\n\tgetServerTime(): number {\r\n\t\tlet serverTime = Date.now();\r\n\t\tif (this.ready()) {\r\n\t\t\tserverTime += this.getTimeDiference();\r\n\t\t}\r\n\t\treturn serverTime;\r\n\t}\r\n}\r\n","export default class MyHtmlElements {\r\n\treadonly gameScreen: HTMLElement;\r\n\treadonly mapScreen: HTMLElement;\r\n\treadonly mapContainer: HTMLElement;\r\n\treadonly zoneTimer: HTMLElement;\r\n\treadonly helperScreen: HTMLElement;\r\n\treadonly zoneSVG: HTMLElement;\r\n\treadonly zoneCircle: HTMLElement;\r\n\treadonly zoneRect: HTMLElement;\r\n\treadonly mapZoneSVG: HTMLElement;\r\n\treadonly mapZoneCircle: HTMLElement;\r\n\treadonly takeLoot: HTMLElement;\r\n\treadonly transparentLayer: HTMLElement;\r\n\treadonly activeGunAmmo: HTMLElement;\r\n\treadonly alive: HTMLElement;\r\n\treadonly messages: HTMLElement;\r\n\treadonly spectate: HTMLElement;\r\n\treadonly spectateName: HTMLElement;\r\n\treadonly hideGame: HTMLElement;\r\n\treadonly itNetwork: HTMLElement;\r\n\r\n\t//<div id=\"healthBar\"><div id=\"healthBarIn\"></div></div>\r\n\treadonly healthBar = {\r\n\t\tmain: document.getElementById('healthBar'),\r\n\t\tin: document.getElementById('healthBarIn')\r\n\t};\r\n\r\n\treadonly items = {\r\n\t\tredAmmo: document.getElementById('redAmmo'),\r\n\t\tgreenAmmo: document.getElementById('greenAmmo'),\r\n\t\tblueAmmo: document.getElementById('blueAmmo'),\r\n\t\torangeAmmo: document.getElementById('orangeAmmo'),\r\n\t\titem1: document.getElementById('item1'),\r\n\t\titem2: document.getElementById('item2'),\r\n\t\titem3: document.getElementById('item3'),\r\n\t\titem4: document.getElementById('item4'),\r\n\t\titem5: document.getElementById('item5'),\r\n\t\titem1in: document.getElementById('item1').getElementsByTagName('span')[0],\r\n\t\titem2in: document.getElementById('item2').getElementsByTagName('span')[0],\r\n\t\titem3in: document.getElementById('item3').getElementsByTagName('span')[0],\r\n\t\titem4in: document.getElementById('item4').getElementsByTagName('span')[0],\r\n\t\titem5in: document.getElementById('item5').getElementsByTagName('span')[0],\r\n\t\titem1Ammo: document.getElementById('item1Ammo'),\r\n\t\titem2Ammo: document.getElementById('item2Ammo'),\r\n\t\tscope: document.getElementById('scope'),\r\n\t\tscope2: document.getElementById('scope2'),\r\n\t\tscope4: document.getElementById('scope4'),\r\n\t\tscope6: document.getElementById('scope6'),\r\n\t\tscopeSVG: document.getElementById('scope').getElementsByTagName('img')[0],\r\n\t\tvest: document.getElementById('vest')\r\n\t};\r\n\r\n\treadonly editor = {\r\n\t\tcoordinates: document.getElementById('editorCoordinates'),\r\n\t\tcontainer: document.getElementById('editorContainer'),\r\n\t\tscreen: document.getElementById('editorScreen'),\r\n\t\tterrainImgs: document.getElementById('editorTerrainImgs'),\r\n\t\tterrainWater: document.getElementById('terrainWater'),\r\n\t\tterrainGrass: document.getElementById('terrainGrass'),\r\n\t\tterrainWaterTriangle1: document.getElementById('terrainWaterTriangle1'),\r\n\t\tterrainWaterTriangle2: document.getElementById('terrainWaterTriangle2'),\r\n\t\tterrainWaterTriangle3: document.getElementById('terrainWaterTriangle3'),\r\n\t\tterrainWaterTriangle4: document.getElementById('terrainWaterTriangle4'),\r\n\t\tobjectImgs: document.getElementById('editorObjectImgs'),\r\n\t\tobjectBush: document.getElementById('editorObjectBush'),\r\n\t\tobjectRock: document.getElementById('editorObjectRock'),\r\n\t\tobjectTree: document.getElementById('editorObjectTree'),\r\n\t\tobjectRect: document.getElementById('editorObjectRect'),\r\n\t\tobjectHorizontalWall: document.getElementById('editorObjectHorizontalWall'),\r\n\t\tobjectVerticalWall: document.getElementById('editorObjectVerticalWall'),\r\n\t\tobjectDelete: document.getElementById('editorObjectDelete'),\r\n\t\topenMenu: document.getElementById('editorOpenMenu')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"saveMapMenu\">\r\n        <h1>Saved</h1>\r\n        <button id=\"saveMapMenuBack\">Back to main menu</button>\r\n\t</div>\r\n\t*/\r\n\treadonly saveMapMenu = {\r\n\t\tmain: document.getElementById('saveMapMenu'),\r\n\t\tback: document.getElementById('saveMapMenuBack')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"mapEditorMenu\">\r\n\t\t<h1>Map editor</h1>\r\n\t\t<input id=\"mapEditorMenuName\" type=\"text\" maxlength=\"20\" placeholder=\"Map name\" value=\"\" autocomplete=\"off\">\r\n\t\t<button id=\"mapEditorMenuSave\">Save</button>\r\n\t\t<button id=\"mapEditorMenuChangeSize\">Change map size</button>\r\n\t\t<button id=\"mapEditorMenuBack\">Back</button>\r\n\t\t<button id=\"mapEditorMenuClose\">Close editor</button>\r\n\t</div>\r\n\t*/\r\n\r\n\t/*\r\n\t\r\n\t<div class=\"menu\" id=\"gameOverMenu\">\r\n\t\t<h1 id=\"gameOverMenuH1\">You win!</h1>\r\n\t\t<div id=\"gameOverMenuStats\">\r\n\t\t\t\r\n\t\t</div>\r\n\t\t<button id=\"gameOverMenuspectate\">spectate</button>\r\n        <button id=\"gameOverMenuBack\">Main menu</button>\r\n\t</div>\r\n\t*/\r\n\r\n\treadonly gameOverMenu = {\r\n\t\tmain: document.getElementById('gameOverMenu'),\r\n\t\tback: document.getElementById('gameOverMenuBack'),\r\n\t\th1: document.getElementById('gameOverMenuH1'),\r\n\t\tstats: document.getElementById('gameOverMenuStats'),\r\n\t\tspectate: document.getElementById('gameOverMenuspectate')\r\n\t};\r\n\r\n\treadonly mapEditorMenu = {\r\n\t\tmain: document.getElementById('mapEditorMenu'),\r\n\t\tname: document.getElementById('mapEditorMenuName'),\r\n\t\tsave: document.getElementById('mapEditorMenuSave'),\r\n\t\tchangeSize: document.getElementById('mapEditorMenuChangeSize'),\r\n\t\tback: document.getElementById('mapEditorMenuBack'),\r\n\t\tclose: document.getElementById('mapEditorMenuClose')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"alertMenu\">\r\n\t\t<h1>Not allowed character!</h1>\r\n\t\t<p>Please change that name.</p>\r\n\t\t<p>Allowed characters:</p>\r\n\t\t<p><b>abcdefghijklmnopqrstuvwxyz</b><br /><b>ABCDEFGHIJKLMNOPQRSTUVWXYZ</b><br /><b>0123456789</b><br /> and <b>space</b></p>\r\n\t\t<button id=\"alertMenuOk\">OK</button>\r\n\t</div>\r\n\t*/\r\n\r\n\treadonly alertMenu = {\r\n\t\tmain: document.getElementById('alertMenu'),\r\n\t\tok: document.getElementById('alertMenuOk')\r\n\t};\r\n\r\n\t/*<div class=\"menu\" id=\"openMapMenu\">\r\n        <h1>Open map</h1>\r\n        <select id=\"openMapMenuMaps\"></select>\r\n        <button id=\"openMapMenuOk\">OK</button>\r\n        <button id=\"openMapMenuBack\">Back</button>\r\n\t</div>*/\r\n\r\n\treadonly openMapMenu = {\r\n\t\tmain: document.getElementById('openMapMenu'),\r\n\t\tmaps: document.getElementById('openMapMenuMaps'),\r\n\t\tok: document.getElementById('openMapMenuOk'),\r\n\t\tback: document.getElementById('openMapMenuBack')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"controlsMenu\">\r\n        <h1>Game controls</h1>\r\n        <p>Move: <b>A, W, S, D</b>.</p>\r\n        <p>Hit / Shoot: <b>Mouse</b>.</p>\r\n        <button id=\"controlsMenuBack\">Back</button>\r\n\t</div>\r\n\t*/\r\n\r\n\treadonly controlsMenu = {\r\n\t\tmain: document.getElementById('controlsMenu'),\r\n\t\tback: document.getElementById('controlsMenuBack')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"mainMenu\">\r\n\t\t<h1>Mini battle royale</h1>\r\n\t\t<!--<p id=\"mainMenuIp\">+</p>-->\r\n\t\t<input id=\"mainMenuName\" type=\"text\" maxlength=\"20\" placeholder=\"Your name\" value=\"\" autocomplete=\"off\" autofocus>\r\n\t\t<div class =\"join\">\r\n\t\t\t<h2>Join</h2>\r\n\t\t\t<select id=\"mainMenuGames\" disabled></select>\r\n\t\t\t<button id=\"mainMenuJoin\" disabled>Join</button>\r\n\t\t</div>\r\n\t\t<div class =\"create\">\r\n\t\t\t<h2>Create</h2>\r\n\t\t\t<select id=\"mainMenuMaps\"></select>\r\n\t\t\t<button id=\"mainMenuCreate\" disabled>Create</button>\r\n\t\t</div>\r\n\t\t<button id=\"mainMenuOpenEditor\">Map editor</button>\r\n\t\t<button id=\"mainMenuControls\">Game controls</button>\r\n\t</div>\r\n\t*/\r\n\r\n\treadonly mainMenu = {\r\n\t\tmain: document.getElementById('mainMenu'),\r\n\t\tip: document.getElementById('mainMenuIp'),\r\n\t\tname: document.getElementById('mainMenuName'),\r\n\t\tgames: document.getElementById('mainMenuGames'),\r\n\t\tjoin: document.getElementById('mainMenuJoin'),\r\n\t\tmaps: document.getElementById('mainMenuMaps'),\r\n\t\tcreate: document.getElementById('mainMenuCreate'),\r\n\t\topenEditor: document.getElementById('mainMenuOpenEditor'),\r\n\t\tcontrols: document.getElementById('mainMenuControls')\r\n\t};\r\n\t/*\r\n\t<div class=\"menu\" id=\"gameCanceledMenu\">\r\n\t\t<h1>Game canceled</h1>\r\n\t\t<p>Your game has been canceled.</p>\r\n\t\t<button id=\"gameCanceledMenuBack\">Back to main menu</button>\r\n\t</div>\r\n\t*/\r\n\treadonly gameCanceledMenu = {\r\n\t\tmain: document.getElementById('cancelLobbyMenu'),\r\n\t\tback: document.getElementById('cancelLobbyMenuBack')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"mapSizeMenu\">\r\n\t\t\t<h1>Map size</h1>\r\n\t\t\t<p>Size [blocks]</p>\r\n\t\t\t<select id=\"mapSizeValue\">\r\n\t\t\t\t<option value=\"1\">1</option>\r\n\t\t\t\t<option value=\"2\">2</option>\r\n\t\t\t\t<option value=\"3\">3</option>\r\n\t\t\t\t<option value=\"4\">4</option>\r\n\t\t\t\t<option value=\"5\" selected>5</option>\r\n\t\t\t\t<option value=\"6\">6</option>\r\n\t\t\t\t<option value=\"7\">7</option>\r\n\t\t\t\t<option value=\"8\">8</option>\r\n\t\t\t\t<option value=\"9\">9</option>\r\n\t\t\t\t<option value=\"10\">10</option>\r\n\t\t\t</select>\r\n\t\t\t<p>\r\n\t\t\t\t<button id=\"mapSizeOk\">OK</button>\r\n\t\t\t\t<button id=\"mapSizeBack\">Back</button>\r\n\t\t\t</p>\r\n\t</div>\r\n\t*/\r\n\treadonly mapSizeMenu = {\r\n\t\tmain: document.getElementById('mapSizeMenu'),\r\n\t\tvalue: document.getElementById('mapSizeValue'),\r\n\t\tok: document.getElementById('mapSizeOk'),\r\n\t\tback: document.getElementById('mapSizeBack')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"mapMenu\">\r\n        <h1>Map editor</h1>\r\n        <button id=\"mapMenuCreate\">Create a new map</button>\r\n        <button id=\"mapMenuOpenMap\">Open the created maps</button>\r\n        <button id=\"mapMenuBack\">Back</button>\r\n\t</div>\r\n\t*/\r\n\r\n\treadonly mapMenu = {\r\n\t\tmain: document.getElementById('mapMenu'),\r\n\t\tcreate: document.getElementById('mapMenuCreate'),\r\n\t\topen: document.getElementById('mapMenuOpenMap'),\r\n\t\tback: document.getElementById('mapMenuBack')\r\n\t};\r\n\r\n\t/**\r\n\t <div class=\"menu\" id=\"lobbyMenu\">\r\n\t\t<h1 id=\"lobbyMenuGameName\"></h1>\r\n\t\t<ul id=\"lobbyMenuPlayers\"></ul>\r\n\t\t<div id=\"lobbyMenuForJoinPlayer\">\r\n\t\t\t<p>Waiting for players...</p>\r\n\t\t\t<button id=\"lobbyMenuLeave\">Leave the game</button>\r\n\t\t</div>\r\n\t\t<div id=\"lobbyMenuForCreatePlayer\">\r\n\t\t\t<button id=\"lobbyMenuStart\">Launch the game</button>\r\n\t\t\t<button id=\"lobbyMenuCancel\">Cancel the game</button>\r\n\t\t</div>\r\n\t</div>\t\t\r\n\t*/\r\n\treadonly lobbyMenu = {\r\n\t\tmain: document.getElementById('lobbyMenu'),\r\n\t\tgameName: document.getElementById('lobbyMenuGameName'),\r\n\t\tplayers: document.getElementById('lobbyMenuPlayers'),\r\n\t\tforJoinPlayers: document.getElementById('lobbyMenuForJoinPlayer'),\r\n\t\tleave: document.getElementById('lobbyMenuLeave'),\r\n\t\tforCreatePlayer: document.getElementById('lobbyMenuForCreatePlayer'),\r\n\t\tstart: document.getElementById('lobbyMenuStart'),\r\n\t\tcancel: document.getElementById('lobbyMenuCancel')\r\n\t};\r\n\r\n\treadonly loading = {\r\n\t\tmain: document.getElementById('loading'),\r\n\t\tcounter: document.getElementById('loadingCounter'),\r\n\t\tcircle: document.getElementById('loadingCircle'),\r\n\t\ttext: document.getElementById('loadingText')\r\n\t};\r\n\r\n\t/*\r\n\t<div class=\"menu\" id=\"escFromGame\">\r\n\t\t<h1>Leave game?</h1>\r\n\t\t<button id=\"escFromGameBack\">Back to the game</button>\r\n        <button id=\"escFromGameLeave\">Leave the game</button>\r\n\t</div>\r\n\t*/\r\n\treadonly escFromGameMenu = {\r\n\t\tmain: document.getElementById('escFromGame'),\r\n\t\tback: document.getElementById('escFromGameBack'),\r\n\t\tleave: document.getElementById('escFromGameLeave')\r\n\t};\r\n\r\n\tconstructor() {\r\n\t\tthis.gameScreen = document.getElementById('gameScreen');\r\n\t\tthis.mapScreen = document.getElementById('mapScreen');\r\n\t\tthis.helperScreen = document.getElementById('helperScreen');\r\n\t\tthis.zoneSVG = document.getElementById('zoneSVG');\r\n\t\tthis.zoneCircle = document.getElementById('zoneCircle');\r\n\t\tthis.zoneRect = document.getElementById('zoneRect');\r\n\t\tthis.mapZoneSVG = document.getElementById('mapZoneSVG');\r\n\t\tthis.mapZoneCircle = document.getElementById('mapZoneCircle');\r\n\t\tthis.takeLoot = document.getElementById('takeLoot');\r\n\t\tthis.transparentLayer = document.getElementById('transparentLayer');\r\n\t\tthis.activeGunAmmo = document.getElementById('activeGunAmmo');\r\n\t\tthis.mapContainer = document.getElementById('mapContainer');\r\n\t\tthis.alive = document.getElementById('alive');\r\n\t\tthis.messages = document.getElementById('messages');\r\n\t\tthis.zoneTimer = document.getElementById('zoneTimer');\r\n\t\tthis.spectate = document.getElementById('spectate');\r\n\t\tthis.spectateName = document.getElementById('spectateName');\r\n\t\tthis.hideGame = document.getElementById('hideGame');\r\n\t\tthis.itNetwork = document.getElementById('itnetwork');\r\n\t}\r\n\r\n\tclose(...elements: HTMLElement[]): void {\r\n\t\tfor (const element of elements) {\r\n\t\t\telement.style.display = 'none';\r\n\t\t}\r\n\t}\r\n\r\n\topen(...elements: HTMLElement[]): void {\r\n\t\tfor (const element of elements) {\r\n\t\t\telement.style.display = 'block';\r\n\t\t}\r\n\t}\r\n}\r\n","import { Terrain } from './Terrain';\r\nimport RectangleObstacle from './RectangleObstacle';\r\nimport Bush from './Bush';\r\nimport Rock from './Rock';\r\nimport Tree from './Tree';\r\n\r\nexport default class MapData {\r\n\tsize: number;\r\n\tblockSize: number;\r\n\tterrains: Terrain[];\r\n\trects: RectangleObstacle[];\r\n\tbushes: Bush[];\r\n\trocks: Rock[];\r\n\ttrees: Tree[];\r\n\r\n\tconstructor(\r\n\t\tsize: number,\r\n\t\tblockSize: number,\r\n\t\tterrains: Terrain[],\r\n\t\trects: RectangleObstacle[],\r\n\t\tbushes: Bush[],\r\n\t\trocks: Rock[],\r\n\t\ttrees: Tree[]\r\n\t) {\r\n\t\tthis.size = size;\r\n\t\tthis.blockSize = blockSize;\r\n\t\tthis.terrains = terrains;\r\n\t\tthis.rects = rects;\r\n\t\tthis.bushes = bushes;\r\n\t\tthis.rocks = rocks;\r\n\t\tthis.trees = trees;\r\n\t}\r\n}\r\n","import { Terrain, TerrainType } from './Terrain';\r\nimport MyHtmlElements from './MyHtmlElements';\r\nimport Bush from './Bush';\r\nimport Rock from './Rock';\r\nimport Tree from './Tree';\r\nimport Wall from './Wall';\r\nimport Socket from './Socket';\r\nimport Colors from './Colors';\r\nimport MapData from './MapData';\r\n\r\nexport default class Editor {\r\n\tprivate terrainType: TerrainType | null;\r\n\tprivate objectType: string | null;\r\n\tbush: Bush;\r\n\trock: Rock;\r\n\ttree: Tree;\r\n\thorizontalWall: Wall;\r\n\tverticalWall: Wall;\r\n\tprivate x: number;\r\n\tprivate y: number;\r\n\tprivate active: boolean = false;\r\n\tprivate size: number;\r\n\treadonly blockSize: number = 300;\r\n\tterrains: Terrain[] = [];\r\n\tbushes: Bush[] = [];\r\n\trocks: Rock[] = [];\r\n\ttrees: Tree[] = [];\r\n\twalls: Wall[] = [];\r\n\tprivate myHtmlElements: MyHtmlElements;\r\n\tprivate socket: Socket;\r\n\tprivate colors: Colors;\r\n\r\n\tconstructor(myHtmlElements: MyHtmlElements, socket: Socket) {\r\n\t\tthis.myHtmlElements = myHtmlElements;\r\n\t\tthis.socket = socket;\r\n\t\tthis.colors = new Colors();\r\n\t\tthis.bush = new Bush(0, 0, 0, 0);\r\n\t\tthis.rock = new Rock(0, 0, 0);\r\n\t\tthis.tree = new Tree(0, 0, 0, 0);\r\n\t\tthis.horizontalWall = new Wall(0, 0, 0, 612 / 2, 145 / 2);\r\n\t\tthis.verticalWall = new Wall(0, 0, 0, 145 / 2, 612 / 2);\r\n\t\tthis.controller();\r\n\t}\r\n\r\n\tisActive(): boolean {\r\n\t\treturn this.active;\r\n\t}\r\n\r\n\tclose(): void {\r\n\t\tthis.active = false;\r\n\t}\r\n\r\n\tgetTerrainType(): TerrainType | null {\r\n\t\treturn this.terrainType;\r\n\t}\r\n\r\n\tgetObjectType(): string | null {\r\n\t\treturn this.objectType;\r\n\t}\r\n\r\n\tgetSize(): number {\r\n\t\treturn this.size;\r\n\t}\r\n\r\n\tgetX(): number {\r\n\t\treturn this.x;\r\n\t}\r\n\r\n\tgetY(): number {\r\n\t\treturn this.y;\r\n\t}\r\n\r\n\tgetMapData(): MapData {\r\n\t\treturn new MapData(this.size, this.blockSize, this.terrains, this.walls, this.bushes, this.rocks, this.trees);\r\n\t}\r\n\r\n\tcreate(): void {\r\n\t\tthis.cleanMap();\r\n\t}\r\n\r\n\tchangeSize(size: number): void {\r\n\t\tthis.active = true;\r\n\t\tconst el = this.myHtmlElements;\r\n\t\tthis.size = size;\r\n\t\t(<HTMLCanvasElement>el.editor.screen).width = size * this.blockSize;\r\n\t\t(<HTMLCanvasElement>el.editor.screen).height = size * this.blockSize;\r\n\t\tconst widthString = (size * this.blockSize).toString();\r\n\t\tel.editor.screen.style.width = widthString;\r\n\t\tconst heightString = (size * this.blockSize).toString();\r\n\t\tel.editor.screen.style.width = heightString;\r\n\t\tthis.cleanMapAfterChangeSize();\r\n\t}\r\n\r\n\tprivate cleanMap(): void {\r\n\t\tthis.terrains = [];\r\n\t\tthis.bushes = [];\r\n\t\tthis.rocks = [];\r\n\t\tthis.trees = [];\r\n\t\tthis.walls = [];\r\n\t}\r\n\r\n\tprivate cleanMapAfterChangeSize(): void {\r\n\t\tconst mapSize = this.size * this.blockSize;\r\n\t\tlet arr: any = this.terrains;\r\n\t\tfor (let i = arr.length - 1; i >= 0; i--) {\r\n\t\t\tconst item = arr[i];\r\n\t\t\tif (item.x >= mapSize || item.y >= mapSize) {\r\n\t\t\t\tarr.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tarr = this.trees;\r\n\t\tfor (let i = arr.length - 1; i >= 0; i--) {\r\n\t\t\tconst item = arr[i];\r\n\t\t\tif (item.x >= mapSize || item.y >= mapSize) {\r\n\t\t\t\tarr.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tarr = this.rocks;\r\n\t\tfor (let i = arr.length - 1; i >= 0; i--) {\r\n\t\t\tconst item = arr[i];\r\n\t\t\tif (item.x >= mapSize || item.y >= mapSize) {\r\n\t\t\t\tarr.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tarr = this.bushes;\r\n\t\tfor (let i = arr.length - 1; i >= 0; i--) {\r\n\t\t\tconst item = arr[i];\r\n\t\t\tif (item.x >= mapSize || item.y >= mapSize) {\r\n\t\t\t\tarr.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tarr = this.walls;\r\n\t\tfor (let i = arr.length - 1; i >= 0; i--) {\r\n\t\t\tconst item = arr[i];\r\n\t\t\tif (item.x >= mapSize || item.y >= mapSize) {\r\n\t\t\t\tarr.splice(i, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate openMap(mapData: MapData): void {\r\n\t\tthis.create();\r\n\t\tthis.changeSize(mapData.size);\r\n\t\tlet id = 0;\r\n\t\tfor (const item of mapData.rocks) {\r\n\t\t\tthis.rocks.push(new Rock(id++, item.x, item.y));\r\n\t\t}\r\n\t\tfor (const item of mapData.trees) {\r\n\t\t\tthis.trees.push(new Tree(id++, item.x, item.y, item.angle));\r\n\t\t}\r\n\t\tfor (const item of mapData.bushes) {\r\n\t\t\tthis.bushes.push(new Bush(id++, item.x, item.y, item.angle));\r\n\t\t}\r\n\t\tfor (const item of mapData.rects) {\r\n\t\t\tthis.walls.push(new Wall(id++, item.x, item.y, item.width, item.height));\r\n\t\t}\r\n\t\tfor (const item of mapData.terrains) {\r\n\t\t\tthis.terrains.push(new Terrain(item.type, item.x, item.y, item.size));\r\n\t\t}\r\n\t\tthis.cleanMapAfterChangeSize();\r\n\t}\r\n\r\n\tcontroller(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\t\t//editorScreen mouse move\r\n\t\tel.editor.screen.addEventListener('mousemove', (e: MouseEvent) => {\r\n\t\t\tconst canvasRect = el.editor.screen.getBoundingClientRect();\r\n\t\t\tthis.x = e.clientX + el.editor.screen.scrollLeft - canvasRect.left;\r\n\t\t\tthis.y = e.clientY + el.editor.screen.scrollTop - canvasRect.top;\r\n\t\t\tel.editor.coordinates.innerText = `x: ${this.x} y: ${this.y}`;\r\n\t\t});\r\n\r\n\t\t//choose terrain type\r\n\t\tel.editor.terrainImgs.addEventListener('click', (e: MouseEvent) => {\r\n\t\t\tconst terrainImgs = el.editor.terrainImgs.children;\r\n\t\t\tfor (let i = 0; i < terrainImgs.length; i++) {\r\n\t\t\t\t(<HTMLElement>terrainImgs[i]).style.borderColor = this.colors.blockFrame;\r\n\t\t\t}\r\n\t\t\tconst objectImgs = el.editor.objectImgs.children;\r\n\t\t\tfor (let i = 0; i < objectImgs.length; i++) {\r\n\t\t\t\t(<HTMLElement>objectImgs[i]).style.borderColor = this.colors.blockFrame;\r\n\t\t\t}\r\n\t\t\t(<HTMLElement>e.target).style.borderColor = this.colors.blockFrameActive;\r\n\t\t\tthis.objectType = null;\r\n\t\t\tswitch (e.target) {\r\n\t\t\t\tcase el.editor.terrainWater:\r\n\t\t\t\t\tthis.terrainType = TerrainType.Water;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.terrainGrass:\r\n\t\t\t\t\tthis.terrainType = TerrainType.Grass;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.terrainWaterTriangle1:\r\n\t\t\t\t\tthis.terrainType = TerrainType.WaterTriangle1;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.terrainWaterTriangle2:\r\n\t\t\t\t\tthis.terrainType = TerrainType.WaterTriangle2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.terrainWaterTriangle3:\r\n\t\t\t\t\tthis.terrainType = TerrainType.WaterTriangle3;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.terrainWaterTriangle4:\r\n\t\t\t\t\tthis.terrainType = TerrainType.WaterTriangle4;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//choose object\r\n\t\tel.editor.objectImgs.addEventListener('click', (e: MouseEvent) => {\r\n\t\t\tconst terrainImgs = el.editor.terrainImgs.children;\r\n\t\t\tfor (let i = 0; i < terrainImgs.length; i++) {\r\n\t\t\t\t(<HTMLElement>terrainImgs[i]).style.borderColor = this.colors.blockFrame;\r\n\t\t\t}\r\n\t\t\tconst objectImgs = el.editor.objectImgs.children;\r\n\t\t\tfor (let i = 0; i < objectImgs.length; i++) {\r\n\t\t\t\t(<HTMLElement>objectImgs[i]).style.borderColor = this.colors.blockFrame;\r\n\t\t\t}\r\n\t\t\t(<HTMLElement>e.target).style.borderColor = this.colors.blockFrameActive;\r\n\t\t\tthis.terrainType = null;\r\n\t\t\tswitch (e.target) {\r\n\t\t\t\tcase el.editor.objectBush:\r\n\t\t\t\t\tthis.objectType = 'bush';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.objectRock:\r\n\t\t\t\t\tthis.objectType = 'rock';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.objectTree:\r\n\t\t\t\t\tthis.objectType = 'tree';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.objectRect:\r\n\t\t\t\t\tthis.objectType = 'rect';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.objectHorizontalWall:\r\n\t\t\t\t\tthis.objectType = 'horizontalWall';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.objectVerticalWall:\r\n\t\t\t\t\tthis.objectType = 'verticalWall';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase el.editor.objectDelete:\r\n\t\t\t\t\tthis.objectType = 'delete';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//editorScreenClick\r\n\t\tel.editor.screen.addEventListener('click', () => {\r\n\t\t\tif (this.getTerrainType() != null) {\r\n\t\t\t\tconst blockX = Math.floor(this.getX() / this.blockSize) * this.blockSize;\r\n\t\t\t\tconst blockY = Math.floor(this.getY() / this.blockSize) * this.blockSize;\r\n\t\t\t\t//find block on this position and delete\r\n\t\t\t\tlet deletePosition = -1;\r\n\t\t\t\tfor (let i = 0; i < this.terrains.length; i++) {\r\n\t\t\t\t\tconst terrain = this.terrains[i];\r\n\t\t\t\t\tif (terrain.x === blockX && terrain.y === blockY) {\r\n\t\t\t\t\t\tdeletePosition = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (deletePosition !== -1) {\r\n\t\t\t\t\tthis.terrains.splice(deletePosition, 1);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.getTerrainType() !== TerrainType.Grass) {\r\n\t\t\t\t\tthis.terrains.push(new Terrain(this.getTerrainType(), blockX, blockY, this.blockSize));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.getObjectType() != null) {\r\n\t\t\t\tconst randomAngle = Math.floor(Math.random() * 360);\r\n\t\t\t\tswitch (this.getObjectType()) {\r\n\t\t\t\t\tcase 'bush':\r\n\t\t\t\t\t\tthis.bushes.push(\r\n\t\t\t\t\t\t\tnew Bush(0, this.x - this.bush.size / 2, this.y - this.bush.size / 2, randomAngle)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'rock':\r\n\t\t\t\t\t\tthis.rocks.push(new Rock(0, this.x - this.rock.size / 2, this.y - this.rock.size / 2));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'tree':\r\n\t\t\t\t\t\tthis.trees.push(\r\n\t\t\t\t\t\t\tnew Tree(0, this.x - this.tree.size / 2, this.y - this.tree.size / 2, randomAngle)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'rect':\r\n\t\t\t\t\t\tthis.walls.push(\r\n\t\t\t\t\t\t\tnew Wall(0, this.x - this.bush.size / 2, this.y - this.bush.size / 2, 100, 100)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'horizontalWall':\r\n\t\t\t\t\t\tthis.walls.push(\r\n\t\t\t\t\t\t\tnew Wall(\r\n\t\t\t\t\t\t\t\t0,\r\n\t\t\t\t\t\t\t\tthis.x - this.horizontalWall.width / 2,\r\n\t\t\t\t\t\t\t\tthis.y - this.horizontalWall.height / 2,\r\n\t\t\t\t\t\t\t\tthis.horizontalWall.width,\r\n\t\t\t\t\t\t\t\tthis.horizontalWall.height\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'verticalWall':\r\n\t\t\t\t\t\tthis.walls.push(\r\n\t\t\t\t\t\t\tnew Wall(\r\n\t\t\t\t\t\t\t\t0,\r\n\t\t\t\t\t\t\t\tthis.x - this.verticalWall.width / 2,\r\n\t\t\t\t\t\t\t\tthis.y - this.verticalWall.height / 2,\r\n\t\t\t\t\t\t\t\tthis.verticalWall.width,\r\n\t\t\t\t\t\t\t\tthis.verticalWall.height\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'delete':\r\n\t\t\t\t\t\t//find delete object\r\n\t\t\t\t\t\tlet deleteObject;\r\n\t\t\t\t\t\tconst editor = this;\r\n\t\t\t\t\t\tfor (const rock of editor.rocks) {\r\n\t\t\t\t\t\t\tconst object = rock;\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.x + object.size >= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\t\t\t\tobject.y + object.size >= editor.getY()\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (const wall of editor.walls) {\r\n\t\t\t\t\t\t\tconst object = wall;\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.x + object.width >= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\t\t\t\tobject.y + object.height >= editor.getY()\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (const bush of editor.bushes) {\r\n\t\t\t\t\t\t\tconst object = bush;\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.x + object.size >= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\t\t\t\tobject.y + object.size >= editor.getY()\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (const tree of editor.trees) {\r\n\t\t\t\t\t\t\tconst object = tree;\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tobject.x <= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.x + object.size >= editor.getX() &&\r\n\t\t\t\t\t\t\t\tobject.y <= editor.getY() &&\r\n\t\t\t\t\t\t\t\tobject.y + object.size >= editor.getY()\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tdeleteObject = object;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t//delete\r\n\t\t\t\t\t\tlet deleteIndex = -1;\r\n\t\t\t\t\t\tfor (let i = 0; i < this.rocks.length; i++) {\r\n\t\t\t\t\t\t\tif (deleteObject == this.rocks[i]) deleteIndex = i;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (deleteIndex !== -1) {\r\n\t\t\t\t\t\t\tthis.rocks.splice(deleteIndex, 1);\r\n\t\t\t\t\t\t\tdeleteIndex = -1;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (let i = 0; i < this.bushes.length; i++) {\r\n\t\t\t\t\t\t\tif (deleteObject == this.bushes[i]) deleteIndex = i;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (deleteIndex !== -1) {\r\n\t\t\t\t\t\t\tthis.bushes.splice(deleteIndex, 1);\r\n\t\t\t\t\t\t\tdeleteIndex = -1;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (let i = 0; i < this.trees.length; i++) {\r\n\t\t\t\t\t\t\tif (deleteObject == this.trees[i]) deleteIndex = i;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (deleteIndex !== -1) {\r\n\t\t\t\t\t\t\tthis.trees.splice(deleteIndex, 1);\r\n\t\t\t\t\t\t\tdeleteIndex = -1;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfor (let i = 0; i < this.walls.length; i++) {\r\n\t\t\t\t\t\t\tif (deleteObject == this.walls[i]) deleteIndex = i;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (deleteIndex !== -1) {\r\n\t\t\t\t\t\t\tthis.walls.splice(deleteIndex, 1);\r\n\t\t\t\t\t\t\tdeleteIndex = -1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//socket openMapInEditor\r\n\t\tthis.socket.on('openMapInEditor', (mapData: MapData) => {\r\n\t\t\tthis.openMap(mapData);\r\n\t\t\tel.close(el.openMapMenu.main);\r\n\t\t\tel.open(el.editor.container);\r\n\t\t});\r\n\t}\r\n}\r\n","import Model from './Model';\r\nimport Socket from './Socket';\r\nimport ServerClientSync from './ServerClientSync';\r\nimport { Snapshot } from './Snapshot';\r\nimport MyHtmlElements from './MyHtmlElements';\r\nimport Editor from './Editor';\r\nimport Point from './Point';\r\nimport OpenGame from './OpenGame';\r\nimport MapData from './MapData';\r\nimport PlayerStats from './PlayerStats';\r\n\r\ndeclare const io: {\r\n\tconnect(url?: string): Socket;\r\n};\r\n\r\nexport type Keys = {\r\n\tw: boolean;\r\n\ta: boolean;\r\n\ts: boolean;\r\n\td: boolean;\r\n\te: boolean;\r\n\tr: boolean;\r\n};\r\n\r\nexport type Mouse = {\r\n\tx: number;\r\n\ty: number;\r\n\tleft: boolean;\r\n\tmiddle: boolean;\r\n\tright: boolean;\r\n};\r\n\r\nexport class Controller {\r\n\tprivate static instance: Controller;\r\n\tprivate myHtmlElements: MyHtmlElements;\r\n\tprivate model: Model;\r\n\tprivate editor: Editor;\r\n\tprivate socket: Socket;\r\n\tprivate serverClientSync: ServerClientSync;\r\n\tprivate canvas: HTMLCanvasElement;\r\n\tprivate keys: Keys = {\r\n\t\tw: false,\r\n\t\ta: false,\r\n\t\ts: false,\r\n\t\td: false,\r\n\t\te: false,\r\n\t\tr: false,\r\n\t};\r\n\tprivate mouse: Mouse = {\r\n\t\tx: 0,\r\n\t\ty: 0,\r\n\t\tleft: false,\r\n\t\tmiddle: false,\r\n\t\tright: false,\r\n\t};\r\n\r\n\tprivate playerAngle: number = 0;\r\n\r\n\tprivate constructor() {\r\n\t\tthis.myHtmlElements = new MyHtmlElements();\r\n\t\tthis.canvas = document.getElementsByTagName('canvas')[0];\r\n\t\tthis.socket = io.connect('http://localhost:8080');\r\n\t\tthis.serverClientSync = new ServerClientSync();\r\n\t\tthis.editor = new Editor(this.myHtmlElements, this.socket);\r\n\t\tthis.model = new Model(this.mouse, this.socket, this.serverClientSync, this.myHtmlElements, this.editor);\r\n\t\twindow.addEventListener('resize', () => {\r\n\t\t\tthis.model.view.screenResize();\r\n\t\t\tconst event = new Event('mousemove');\r\n\t\t\tthis.canvas.dispatchEvent(event);\r\n\t\t});\r\n\t\twindow.addEventListener('beforeunload', (e) => {\r\n\t\t\t// Cancel the event as stated by the standard.\r\n\t\t\te.preventDefault();\r\n\t\t\t// Chrome requires returnValue to be set.\r\n\t\t\te.returnValue = '';\r\n\t\t});\r\n\t\tthis.keysController();\r\n\t\tthis.mouseController();\r\n\t\tthis.socketController();\r\n\t\tthis.menuController();\r\n\t}\r\n\r\n\tstatic run(): void {\r\n\t\tif (!Controller.instance) {\r\n\t\t\tController.instance = new Controller();\r\n\t\t} else {\r\n\t\t\tthrow new Error('Only one controller!');\r\n\t\t}\r\n\t}\r\n\r\n\tprivate changePlayerName(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\t\tlet nameOk = false;\r\n\t\tif ((<HTMLInputElement>el.mainMenu.name).value.length) {\r\n\t\t\tnameOk = true;\r\n\t\t\t//save name\r\n\t\t\tlocalStorage.setItem('playerName', (<HTMLInputElement>el.mainMenu.name).value);\r\n\t\t}\r\n\t\t(<HTMLInputElement>el.mainMenu.create).disabled = !nameOk;\r\n\t\t(<HTMLInputElement>el.mainMenu.maps).disabled = !nameOk;\r\n\t\tlet gameExists = false;\r\n\t\tif ((<HTMLInputElement>el.mainMenu.games).value) gameExists = true;\r\n\t\tlet joinDisabled = true;\r\n\t\tif (nameOk && gameExists) joinDisabled = false;\r\n\t\t(<HTMLInputElement>el.mainMenu.join).disabled = joinDisabled;\r\n\t\t(<HTMLInputElement>el.mainMenu.games).disabled = joinDisabled;\r\n\t}\r\n\r\n\tprivate socketController(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\r\n\t\t//gameOver\r\n\t\tthis.socket.on('winner', (stats: PlayerStats) => {\r\n\t\t\tthis.model.view.gameOver(stats, true);\r\n\t\t});\r\n\r\n\t\tthis.socket.on('loser', (stats: PlayerStats) => {\r\n\t\t\tthis.model.view.gameOver(stats, false);\r\n\t\t});\r\n\r\n\t\tthis.socket.on('stopGame', () => {\r\n\t\t\tthis.model.stop();\r\n\t\t});\r\n\r\n\t\tthis.socket.on('stopSpectate', (stats: PlayerStats, winnerName) => {\r\n\t\t\tthis.model.view.gameOver(stats, true, winnerName);\r\n\t\t});\r\n\r\n\t\t//startGame\r\n\t\tthis.socket.on('startGame', (mapData: MapData) => {\r\n\t\t\tthis.model.map.openMap(mapData);\r\n\t\t\tthis.model.gameStart();\r\n\t\t\tel.close(el.lobbyMenu.main);\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tel.close(el.hideGame);\r\n\t\t\t}, 100);\r\n\t\t});\r\n\r\n\t\t//playerId\r\n\t\tthis.socket.on('playerId', (playerId: number) => {\r\n\t\t\tthis.model.setPlayerId(playerId);\r\n\t\t});\r\n\r\n\t\t//createGame\r\n\t\tthis.socket.on('createGame', (gameId: number, playerName: string) => {\r\n\t\t\tthis.model.setGameId(gameId);\r\n\t\t\tel.close(el.mainMenu.main, el.lobbyMenu.forJoinPlayers);\r\n\t\t\tel.open(el.lobbyMenu.main, el.lobbyMenu.forCreatePlayer);\r\n\t\t});\r\n\r\n\t\t//joinGame\r\n\t\tthis.socket.on('joinGame', (gameId: number, playerName: string) => {\r\n\t\t\tthis.model.setGameId(gameId);\r\n\t\t\tel.close(el.mainMenu.main, el.lobbyMenu.forCreatePlayer);\r\n\t\t\tel.open(el.lobbyMenu.main, el.lobbyMenu.forJoinPlayers);\r\n\t\t});\r\n\r\n\t\t//leave lobby\r\n\t\tthis.socket.on('leaveLobby', () => {\r\n\t\t\tthis.model.setGameId(-1);\r\n\t\t\tel.close(el.lobbyMenu.main);\r\n\t\t\tel.open(el.mainMenu.main);\r\n\t\t});\r\n\r\n\t\t//cancel lobby\r\n\t\tthis.socket.on('cancelLobby', () => {\r\n\t\t\tthis.model.setGameId(-1);\r\n\t\t\tel.close(el.lobbyMenu.main);\r\n\t\t\tel.open(el.gameCanceledMenu.main);\r\n\t\t});\r\n\r\n\t\t//updateListOpenGames\r\n\t\tthis.socket.on('updateListOpenGames', (openGames: OpenGame[]) => {\r\n\t\t\tel.mainMenu.games.innerHTML = '';\r\n\t\t\tfor (const openGame of openGames) {\r\n\t\t\t\tconst option = document.createElement('option');\r\n\t\t\t\toption.textContent = openGame.name + \"'s game\";\r\n\t\t\t\toption.setAttribute('value', openGame.index.toString());\r\n\t\t\t\tel.mainMenu.games.appendChild(option);\r\n\t\t\t}\r\n\r\n\t\t\tif (openGames.length && (<HTMLInputElement>el.mainMenu.name).value.length) {\r\n\t\t\t\t(<HTMLInputElement>el.mainMenu.games).disabled = false;\r\n\t\t\t\t(<HTMLInputElement>el.mainMenu.join).disabled = false;\r\n\t\t\t} else {\r\n\t\t\t\t(<HTMLInputElement>el.mainMenu.games).disabled = true;\r\n\t\t\t\t(<HTMLInputElement>el.mainMenu.join).disabled = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//update listOfPlayers in lobby\r\n\t\tthis.socket.on('listOfPlayers', (playerNames: string[]) => {\r\n\t\t\t//title\r\n\t\t\tel.lobbyMenu.gameName.textContent = playerNames[0] + \"'s game\";\r\n\t\t\t//list\r\n\t\t\tel.lobbyMenu.players.innerHTML = '';\r\n\t\t\tfor (const playerName of playerNames) {\r\n\t\t\t\tconst li = document.createElement('li');\r\n\t\t\t\tli.textContent = playerName;\r\n\t\t\t\tel.lobbyMenu.players.appendChild(li);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.socket.on('collisionPoints', (body: Point[], hand: Point[], hammer: Point[][]) => {\r\n\t\t\tthis.model.collisionPoints.setData(body, hand, hammer);\r\n\t\t});\r\n\r\n\t\t//map\r\n\t\tthis.socket.on('sendMap', (map) => {\r\n\t\t\tthis.model.map.openMap(map);\r\n\t\t});\r\n\r\n\t\t//map saved\r\n\t\tthis.socket.on('mapSaved', () => {\r\n\t\t\tel.close(el.mapEditorMenu.main, el.editor.container);\r\n\t\t\tel.open(el.saveMapMenu.main);\r\n\t\t\tthis.editor.close();\r\n\t\t});\r\n\r\n\t\t//uodate listOfMaps\r\n\t\tthis.socket.on('listOfMaps', (maps: string[]) => {\r\n\t\t\tel.openMapMenu.maps.innerHTML = '';\r\n\t\t\tel.mainMenu.maps.innerHTML = '';\r\n\t\t\tfor (const map of maps) {\r\n\t\t\t\tconst option = document.createElement('option');\r\n\t\t\t\toption.setAttribute('value', map);\r\n\t\t\t\toption.textContent = map;\r\n\t\t\t\tel.mainMenu.maps.appendChild(option);\r\n\t\t\t\tconst optionCopy = option.cloneNode(true);\r\n\t\t\t\tel.openMapMenu.maps.appendChild(optionCopy);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.socket.on('createPlayer', (name: string) => {\r\n\t\t\tif (name) {\r\n\t\t\t\tthis.model.setName(name);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log('err: created player');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//sync\r\n\t\tthis.socket.on('serverClientSync', (clientDateNow, serverDateNow) => {\r\n\t\t\tconst timeNow = Date.now();\r\n\t\t\tconst ping = timeNow - clientDateNow;\r\n\t\t\tconst timeDiferenceClientServer = serverDateNow - (timeNow - ping / 2);\r\n\t\t\tthis.serverClientSync.addData(ping, timeDiferenceClientServer);\r\n\t\t});\r\n\r\n\t\t//u === update positions\r\n\t\tthis.socket.on('u', (snapshot: Snapshot) => {\r\n\t\t\tthis.model.snapshotManager.addSnapshot(snapshot);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate mouseController(): void {\r\n\t\t//deny right click menu\r\n\t\tdocument.addEventListener('contextmenu', function (e) {\r\n\t\t\te.preventDefault();\r\n\t\t});\r\n\t\t//deny middle button\r\n\t\tdocument.addEventListener('mousedown', function (e) {\r\n\t\t\tif (e.which === 2) e.preventDefault();\r\n\t\t});\r\n\r\n\t\t//player angle\r\n\t\tthis.myHtmlElements.transparentLayer.addEventListener('mousemove', (e: MouseEvent) => {\r\n\t\t\tif (!this.model.gameActive()) return;\r\n\t\t\tif (e.x == undefined) {\r\n\t\t\t\tthis.mouse.x = this.canvas.width / 2;\r\n\t\t\t\tthis.mouse.y = this.canvas.height / 2;\r\n\t\t\t} else {\r\n\t\t\t\tthis.mouse.x = e.x;\r\n\t\t\t\tthis.mouse.y = e.y;\r\n\t\t\t}\r\n\r\n\t\t\tconst previousPlayerAngle = this.playerAngle;\r\n\t\t\tthis.rotatePlayer(this.mouse.x, this.mouse.y);\r\n\t\t\t//change\r\n\t\t\tif (this.playerAngle !== previousPlayerAngle) {\r\n\t\t\t\tthis.socket.emit('a', this.model.getGameId(), this.playerAngle);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.myHtmlElements.transparentLayer.addEventListener('mousedown', (e: MouseEvent) => {\r\n\t\t\tif (!this.model.gameActive()) return;\r\n\t\t\tthis.mouse.left = true;\r\n\t\t\tconst clickPoint = new Point(e.clientX, e.clientY);\r\n\t\t\tconst serverPosition = this.model.view.calculateServerPosition(clickPoint);\r\n\t\t\tthis.socket.emit('m', this.model.getGameId(), 'l', serverPosition);\r\n\t\t});\r\n\t\tthis.myHtmlElements.transparentLayer.addEventListener('mouseup', (e: MouseEvent) => {\r\n\t\t\tif (!this.model.gameActive()) return;\r\n\t\t\tthis.mouse.left = false;\r\n\t\t\tthis.socket.emit('m', this.model.getGameId(), '-l');\r\n\t\t});\r\n\t}\r\n\r\n\tprivate rotatePlayer(mouseX: number, mouseY: number): void {\r\n\t\t//triangular sides\r\n\t\tconst centerX = this.canvas.width / 2;\r\n\t\tconst centerY = this.canvas.height / 2;\r\n\t\tlet x = centerX - mouseX;\r\n\t\tlet y = centerY - mouseY;\r\n\t\t//can not set x and y to 0 because angle\r\n\t\tif (x === 0) x = 0.1;\r\n\t\t//atangens\r\n\t\tlet angle = Math.abs((Math.atan(x / y) * 180) / Math.PI);\r\n\t\t//1..2..3..4.. Q; 0 - 90, 90 - 180...\r\n\t\t//1\r\n\t\tif (mouseX >= centerX && mouseY < centerY) {\r\n\t\t\tthis.playerAngle = angle;\r\n\t\t}\r\n\t\t//2\r\n\t\tif (mouseX >= centerX && mouseY >= centerY) {\r\n\t\t\tthis.playerAngle = 90 + 90 - angle;\r\n\t\t}\r\n\t\t//3\r\n\t\tif (mouseX < centerX && mouseY >= centerY) {\r\n\t\t\tthis.playerAngle = 180 + angle;\r\n\t\t}\r\n\t\t//4\r\n\t\tif (mouseX < centerX && mouseY < centerY) {\r\n\t\t\tthis.playerAngle = 270 + 90 - angle;\r\n\t\t}\r\n\t\tthis.playerAngle = Math.round(this.playerAngle);\r\n\t\tif (this.playerAngle === 360) this.playerAngle = 0;\r\n\t}\r\n\r\n\tprivate keysController(): void {\r\n\t\tdocument.addEventListener('keydown', (e: KeyboardEvent) => {\r\n\t\t\t//esc\r\n\t\t\tif (e.which === 27) {\r\n\t\t\t\tif (this.model.gameActive() || this.model.getSpectate()) {\r\n\t\t\t\t\tthis.myHtmlElements.escFromGameMenu.main.style.display = 'block';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!this.model.gameActive()) return;\r\n\t\t\t//w\r\n\t\t\tswitch (e.which) {\r\n\t\t\t\tcase 87:\r\n\t\t\t\t\tif (!this.keys.w) this.socket.emit('c', this.model.getGameId(), 'u');\r\n\t\t\t\t\tthis.keys.w = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//a\r\n\t\t\t\tcase 65:\r\n\t\t\t\t\tif (!this.keys.a) this.socket.emit('c', this.model.getGameId(), 'l');\r\n\t\t\t\t\tthis.keys.a = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//s\r\n\t\t\t\tcase 83:\r\n\t\t\t\t\tif (!this.keys.s) this.socket.emit('c', this.model.getGameId(), 'd');\r\n\t\t\t\t\tthis.keys.s = true;\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//d\r\n\t\t\t\tcase 68:\r\n\t\t\t\t\tif (!this.keys.d) this.socket.emit('c', this.model.getGameId(), 'r');\r\n\t\t\t\t\tthis.keys.d = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//e\r\n\t\t\t\tcase 69:\r\n\t\t\t\t\tif (!this.keys.e) this.socket.emit('c', this.model.getGameId(), 'e');\r\n\t\t\t\t\tthis.keys.e = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//r\r\n\t\t\t\tcase 82:\r\n\t\t\t\t\tif (!this.keys.e) this.socket.emit('c', this.model.getGameId(), 're');\r\n\t\t\t\t\tthis.keys.r = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//0\r\n\t\t\t\tcase 48:\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 0);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//1\r\n\t\t\t\tcase 49:\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//2\r\n\t\t\t\tcase 50:\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 2);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//3\r\n\t\t\t\tcase 51:\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 3);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//4\r\n\t\t\t\tcase 52:\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 4);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//5\r\n\t\t\t\tcase 53:\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 5);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//6\r\n\t\t\t\tcase 54:\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 6);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//7\r\n\t\t\t\tcase 55:\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 7);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//8\r\n\t\t\t\tcase 56:\r\n\t\t\t\t\tthis.socket.emit('i', this.model.getGameId(), 8);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdocument.addEventListener('keyup', (e: KeyboardEvent) => {\r\n\t\t\tif (!this.model.gameActive()) return;\r\n\t\t\tswitch (e.which) {\r\n\t\t\t\t//w\r\n\t\t\t\tcase 87:\r\n\t\t\t\t\tif (this.keys.w) this.socket.emit('c', this.model.getGameId(), '-u');\r\n\t\t\t\t\tthis.keys.w = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//a\r\n\t\t\t\tcase 65:\r\n\t\t\t\t\tif (this.keys.a) this.socket.emit('c', this.model.getGameId(), '-l');\r\n\t\t\t\t\tthis.keys.a = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//s\r\n\t\t\t\tcase 83:\r\n\t\t\t\t\tif (this.keys.s) this.socket.emit('c', this.model.getGameId(), '-d');\r\n\t\t\t\t\tthis.keys.s = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//d\r\n\t\t\t\tcase 68:\r\n\t\t\t\t\tif (this.keys.d) this.socket.emit('c', this.model.getGameId(), '-r');\r\n\t\t\t\t\tthis.keys.d = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//e\r\n\t\t\t\tcase 69:\r\n\t\t\t\t\tthis.keys.e = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//r\r\n\t\t\t\tcase 82:\r\n\t\t\t\t\tthis.keys.r = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate menuController(): void {\r\n\t\tconst el = this.myHtmlElements;\r\n\r\n\t\t//load player name\r\n\t\tif (localStorage.getItem('playerName')) {\r\n\t\t\t(<HTMLInputElement>el.mainMenu.name).value = localStorage.getItem('playerName');\r\n\t\t\tthis.changePlayerName();\r\n\t\t}\r\n\r\n\t\t//+++++++++++++ ESC MENU\r\n\t\tel.escFromGameMenu.back.addEventListener('click', () => {\r\n\t\t\tel.escFromGameMenu.main.style.display = 'none';\r\n\t\t});\r\n\r\n\t\tel.escFromGameMenu.leave.addEventListener('click', () => {\r\n\t\t\tel.escFromGameMenu.main.style.display = 'none';\r\n\t\t\tthis.socket.emit('leaveGame', this.model.getGameId());\r\n\t\t\tthis.model.reset();\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ GAME OVER MENU\r\n\t\tel.gameOverMenu.back.addEventListener('click', () => {\r\n\t\t\tthis.socket.emit('leaveGame', this.model.getGameId());\r\n\t\t\tthis.model.reset();\r\n\t\t});\r\n\r\n\t\tel.gameOverMenu.spectate.addEventListener('click', () => {\r\n\t\t\tthis.socket.emit('spectate', this.model.getGameId());\r\n\t\t\tel.close(el.gameOverMenu.main);\r\n\t\t\tthis.model.startSpectate();\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ MAP SIZE MENU\r\n\t\t//mapSize ok button\r\n\t\tel.mapSizeMenu.ok.addEventListener('click', () => {\r\n\t\t\tthis.editor.changeSize(parseInt((<HTMLInputElement>document.getElementById('mapSizeValue')).value));\r\n\t\t\tel.open(el.editor.container);\r\n\t\t\tel.close(el.mapSizeMenu.main);\r\n\t\t});\r\n\t\t//mapSize back button\r\n\t\tel.mapSizeMenu.back.addEventListener('click', () => {\r\n\t\t\tel.close(el.mapSizeMenu.main);\r\n\t\t\tif (this.editor.isActive()) {\r\n\t\t\t\tel.open(el.mapEditorMenu.main);\r\n\t\t\t} else {\r\n\t\t\t\tel.open(el.mapMenu.main);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ MAP EDITOR MAIN MENU\r\n\t\t//create a new map\r\n\t\tel.mapMenu.create.addEventListener('click', () => {\r\n\t\t\tthis.editor.create();\r\n\t\t\tel.close(el.mapMenu.main);\r\n\t\t\tel.open(el.mapSizeMenu.main);\r\n\t\t});\r\n\t\t//open maps\r\n\t\tel.mapMenu.open.addEventListener('click', () => {\r\n\t\t\tel.close(el.mapMenu.main);\r\n\t\t\tel.open(el.openMapMenu.main);\r\n\t\t});\r\n\t\t//close mapMenu\r\n\t\tel.mapMenu.back.addEventListener('click', () => {\r\n\t\t\tel.close(el.mapMenu.main);\r\n\t\t\tel.open(el.mainMenu.main);\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ OPEN MAP MENU\r\n\t\t//back\r\n\t\tel.openMapMenu.back.addEventListener('click', () => {\r\n\t\t\tel.close(el.openMapMenu.main);\r\n\t\t\tel.open(el.mapMenu.main);\r\n\t\t});\r\n\t\t//open\r\n\t\tel.openMapMenu.ok.addEventListener('click', () => {\r\n\t\t\tconst mapName = (<HTMLInputElement>el.openMapMenu.maps).value;\r\n\t\t\tthis.socket.emit('openMapInEditor', mapName);\r\n\t\t});\r\n\t\t//+++++++++++++ EDITOR MENU - from editor...\r\n\t\t//open menu\r\n\t\tel.editor.openMenu.addEventListener('click', () => {\r\n\t\t\tel.open(el.mapEditorMenu.main);\r\n\t\t});\r\n\t\t//back\r\n\t\tel.mapEditorMenu.back.addEventListener('click', () => {\r\n\t\t\tel.close(el.mapEditorMenu.main);\r\n\t\t});\r\n\t\t//close editor\r\n\t\tel.mapEditorMenu.close.addEventListener('click', () => {\r\n\t\t\tel.close(el.mapEditorMenu.main, el.editor.container);\r\n\t\t\tel.open(el.mainMenu.main);\r\n\t\t\tthis.editor.close();\r\n\t\t});\r\n\t\t//save\r\n\t\tel.mapEditorMenu.save.addEventListener('click', () => {\r\n\t\t\tconst mapData = this.editor.getMapData();\r\n\t\t\tconst mapName = (<HTMLInputElement>el.mapEditorMenu.name).value;\r\n\t\t\tif (this.model.isNameOk(mapName)) {\r\n\t\t\t\tthis.socket.emit('editorSaveMap', mapName, mapData);\r\n\t\t\t} else {\r\n\t\t\t\tel.open(el.alertMenu.main);\r\n\t\t\t}\r\n\t\t});\r\n\t\t//change size\r\n\t\tel.mapEditorMenu.changeSize.addEventListener('click', () => {\r\n\t\t\tel.close(el.mapEditorMenu.main);\r\n\t\t\tel.open(el.mapSizeMenu.main);\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ SAVE MAP MENU\r\n\t\t//return to main menu\r\n\t\tel.saveMapMenu.back.addEventListener('click', () => {\r\n\t\t\tel.close(el.saveMapMenu.main);\r\n\t\t\tel.open(el.mainMenu.main);\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ MAIN MENU\r\n\t\t//open editor menu and close main menu\r\n\t\tel.mainMenu.openEditor.addEventListener('click', () => {\r\n\t\t\tel.open(el.mapMenu.main);\r\n\t\t\tel.close(el.mainMenu.main);\r\n\t\t});\r\n\t\t//change player name and allow create game\r\n\t\tel.mainMenu.name.addEventListener('input', () => {\r\n\t\t\tthis.changePlayerName();\r\n\t\t});\r\n\t\t//select game - allow join\r\n\t\t/*\r\n\t\tel.mainMenu.games.addEventListener('change', () => {\r\n\t\t\tlet disabled = true;\r\n\t\t\tif ((<HTMLInputElement>el.mainMenu.name).value.length) disabled = false;\r\n\t\t\tlet disabled2 = true;\r\n\t\t\tif ((<HTMLInputElement>el.mainMenu.games).value) disabled2 = false;\r\n\t\t\tif (!disabled && !disabled2) (<HTMLInputElement>el.mainMenu.join).disabled = false;\r\n\t\t});\r\n\t\t*/\r\n\t\t//create a new game\r\n\t\tel.mainMenu.create.addEventListener('click', () => {\r\n\t\t\tif ((<HTMLInputElement>el.mainMenu.name).value.length) {\r\n\t\t\t\tconst playerName = (<HTMLInputElement>el.mainMenu.name).value;\r\n\t\t\t\tconst selectedMap = (<HTMLInputElement>el.mainMenu.maps).value;\r\n\t\t\t\tif (this.model.isNameOk(playerName)) {\r\n\t\t\t\t\tthis.socket.emit('createGame', playerName, selectedMap);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tel.open(el.alertMenu.main);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t//join\r\n\t\tel.mainMenu.join.addEventListener('click', () => {\r\n\t\t\tif ((<HTMLInputElement>el.mainMenu.name).value.length && (<HTMLInputElement>el.mainMenu.games).value) {\r\n\t\t\t\tconst playerName = (<HTMLInputElement>el.mainMenu.name).value;\r\n\t\t\t\tconst gameIndex = parseInt((<HTMLInputElement>el.mainMenu.games).value);\r\n\t\t\t\tif (this.model.isNameOk(playerName)) {\r\n\t\t\t\t\tthis.socket.emit('joinGame', playerName, gameIndex);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tel.open(el.alertMenu.main);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t//cancel lobby\r\n\t\tel.gameCanceledMenu.back.addEventListener('click', () => {\r\n\t\t\tel.close(el.gameCanceledMenu.main);\r\n\t\t\tel.open(el.mainMenu.main);\r\n\t\t});\r\n\t\t//controls\r\n\t\tel.mainMenu.controls.addEventListener('click', () => {\r\n\t\t\tel.open(el.controlsMenu.main);\r\n\t\t\tel.close(el.mainMenu.main);\r\n\t\t});\r\n\t\t//+++++++++++++ ALERT MENU\r\n\t\tel.alertMenu.ok.addEventListener('click', () => {\r\n\t\t\tel.close(el.alertMenu.main);\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ LOBBY MENU\r\n\t\t//leave join in lobby\r\n\t\tel.lobbyMenu.leave.addEventListener('click', () => {\r\n\t\t\tthis.socket.emit('leaveLobby', this.model.getGameId());\r\n\t\t});\r\n\t\t//cancel game in lobby\r\n\t\tel.lobbyMenu.cancel.addEventListener('click', () => {\r\n\t\t\tthis.socket.emit('cancelLobby', this.model.getGameId());\r\n\t\t});\r\n\t\t//start game\r\n\t\tel.lobbyMenu.start.addEventListener('click', () => {\r\n\t\t\tel.close(el.lobbyMenu.main);\r\n\t\t\tthis.socket.emit('startGame', this.model.getGameId());\r\n\t\t});\r\n\r\n\t\t//+++++++++++++ CONTROLS MENU\r\n\t\tel.controlsMenu.back.addEventListener('click', () => {\r\n\t\t\tel.open(el.mainMenu.main);\r\n\t\t\tel.close(el.controlsMenu.main);\r\n\t\t});\r\n\t}\r\n}\r\n","import { Controller } from './Controller';\r\nController.run();\r\nconsole.log('Version: 1.0.0');\r\n"],"sourceRoot":""}